<!DOCTYPE html>
<html th:fragment="hello">
<head>
	<meta charset="utf-8" />
	
	<!-- 正式环境下的cdn引用-->
	<link th:if="${not isDebug}" rel="stylesheet" th:href="@{//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css}"/>
	<script th:if="${not isDebug}" type="text/javascript" th:src="@{https://libs.baidu.com/jquery/1.9.1/jquery.min.js}"></script>
	<script th:if="${not isDebug}" src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script th:if="${not isDebug}" th:src="@{https://cdn.bootcss.com/layer/3.0.1/layer.js}" type="text/javascript"></script>
	<script th:if="${not isDebug}" th:src="@{https://cdn.bootcss.com/layer/3.0.1/layer.min.js}" type="text/javascript"></script>
	<!-- 通用引用 -->
	<script th:if="${isDebug}" th:src="@{http://7xnv8i.com1.z0.glb.clouddn.com/base.js}" type="text/javascript"></script>
	
	<!-- 测试环境下的引用 -->
	<link rel="stylesheet" th:if="${isDebug}" th:href="@{/page/other/bootstrap-3.3.0/css/bootstrap.min.css}" />
	<script th:if="${isDebug}" th:src="@{/page/other/jquery-1.9.1.min.js}" type="text/javascript"></script>
	<script th:if="${isDebug}" th:src="@{/page/other/bootstrap-3.3.0/js/bootstrap.min.js}" type="text/javascript"></script>
	<script th:if="${isDebug}" th:src="@{/page/other/layui/layui.js}" type="text/javascript"></script>
	<script th:if="${isDebug}" th:src="@{/page/other/layui/lay/dest/layui.all.js}" type="text/javascript"></script>
	<!-- 通用引用 -->
	<script th:if="${not isDebug}" th:src="@{/page/js/base.js}" type="text/javascript"></script>
	<style type="text/css">
		::-webkit-scrollbar {
			  width: 5px;
		} /* 这是针对缺省样式 (必须的) */
		::-webkit-scrollbar-track {
		  background-color: #f5f5f5;
		} /* 滚动条的滑轨背景颜色 */
	
		::-webkit-scrollbar-thumb {
			  background-color: rgba(0, 0, 0, 0.2); 
		} /* 滑块颜色 */
	
		/* ::-webkit-scrollbar-button {
			  background-color: #7c2929;
		} */ /* 滑轨两头的监听按钮颜色 */
	
		::-webkit-scrollbar-corner {
			  background-color: black;
		} /* 横向滚动条和纵向滚动条相交处尖角的颜色 */
		
		.container{
			padding-bottom: 10px;
		}
		.side-open{
			width: 25px;
			height: 20px;
			margin-top: 15px;
			margin-right: 10px;
		}
		.left-sider-bg{
			width: 100%;
			height: 100%;
			background-color: #999;
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			right: 0;
			z-index: 1500;
			opacity:0.5;
			filter:alpha(opacity=50); 
		}
		.left-sider{
			position: absolute;
			left: -200px;
			top: 0;
			width: 200px;
			height: 100%;
			z-index: 2000;
			
		}
		.side-open{
			margin-right: 10px;
			margin-top: 15px;
		}
		
		.hand{
			cursor: pointer;
		}
		.cut-text{
			display: block;
			white-space: nowrap; 
			overflow: hidden; 
			text-overflow: ellipsis;
		}
		/* 只显示两行数据 */
		.cut-text2{
		    line-height: 18px;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    -o-text-overflow: ellipsis; /* 针对Opera */
		    display: -webkit-box;
		    -webkit-line-clamp: 2;
		    -webkit-box-orient: vertical;
		}
		.color-red{
			color: red;
		}
		
		.color-blue{
			color: #428bca;
		}
		
		body {
			  font-family: "Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",Arial,sans-serif;
		}
		
		.nav-msg .badge {
		    background-color: #d9534f !important;
		}
		
		.pagination ul{
   			list-style:none; /* 去掉ul前面的符号 */
   			margin: 0px; /* 与外界元素的距离为0 */
   			padding: 0px; /* 与内部元素的距离为0 */
   			width: auto; /* 宽度根据元素内容调整 */
   		}
   		.pagination li{
   			float: left;
   			padding: 20px; 
   			margin-left: 10px!important;
   			margin-top: 10px!important;
   			padding: 0 !important;
   		}
	</style>
</head>

<nav class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse"
                data-target="#example-navbar-collapse">
            <span class="sr-only">切换导航</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="javascript:void(0);">LeeDane</a>
    </div>
    <div class="collapse navbar-collapse" id="example-navbar-collapse">
        <ul class="nav navbar-nav">
            <li class="nav-blog nav-main-li"><a th:href="@{/index}">博客</a></li>
            <!-- <li class="nav-shop nav-main-li"><a th:href="@{/shop/}">商城</a></li> -->
            <li class="nav-msg nav-main-li" th:if="${isLogin}"><a th:href="@{/msg}"><span class="badge pull-right">0</span>消息</a></li>
            <li class="nav-circle nav-main-li"><a th:href="@{/cc}">圈子</a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                			<span th:if="${isLogin}" th:text="${account}"></span>
                			<span th:if="not ${isLogin}">我</span>
                    	 <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                	<li th:if="${isLogin}"><a th:href="@{/pb}"><span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;&nbsp;&nbsp;记一博</a></li>
               		<li th:if="${isAdmin}"><a th:href="@{/ad/index}"><span class="glyphicon glyphicon-wrench"></span>&nbsp;&nbsp;&nbsp;&nbsp;系统后台</a></li>
               		<li class="nav-my nav-main-li" th:if="${isLogin}"><a th:href="@{/my}"><span class="glyphicon glyphicon-home"></span>&nbsp;&nbsp;&nbsp;&nbsp;中心</a></li>
               		<li class="nav-financial nav-main-li" th:if="${isLogin}"><a th:href="@{/fn}"><span class="glyphicon glyphicon-jpyglyphicon glyphicon-jpy"></span>&nbsp;&nbsp;&nbsp;&nbsp;记账</a></li>
               		<li class="nav-photo nav-main-li" th:if="${isLogin}"><a th:href="@{/pt}"><span class="glyphicon glyphicon-picture"></span>&nbsp;&nbsp;&nbsp;&nbsp;相册</a></li>
               		<li th:if="${isLogin}"><a th:href="@{/mt}"><span class="glyphicon glyphicon-th"></span>&nbsp;&nbsp;&nbsp;&nbsp;素材管理</a></li>
               		<li th:if="${isLogin}"><a th:href="@{/cg}"><span class="glyphicon glyphicon-th"></span>&nbsp;&nbsp;&nbsp;&nbsp;分类管理</a></li>
               		<li><a th:href="@{/cs}"><span class="glyphicon glyphicon-transfer"></span>&nbsp;&nbsp;&nbsp;&nbsp;聊天室</a></li>
               		<li><a th:href="@{/dl}"><span class="glyphicon glyphicon-download-alt"></span>&nbsp;&nbsp;&nbsp;&nbsp;app下载</a></li>
               		<li><a href="#"><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;&nbsp;&nbsp;关于我</a></li>
                	<li th:if="${isLogin}"><a href="javascript:void(0);" onclick="logout()"><span class="glyphicon glyphicon-bell"></span>&nbsp;&nbsp;&nbsp;&nbsp;退出</a></li>
                	<li th:if="${not isLogin}"><a th:href="@{/lg}"><span class="glyphicon glyphicon-bell"></span>&nbsp;&nbsp;&nbsp;&nbsp;登录</a></li>
                </ul>
            </li>
            <li>
            	<form class="navbar-form navbar-left common-search" role="search">  
	                <div class="input-group">
	                    <input type="text" id="common-search-text" class="form-control" onkeypress="if (event.keyCode == 13) searchCommon(this);" />
	                    <span class="input-group-btn">
	                        <button class="btn btn-primary btn-default" type="button" onclick="searchCommon(this);">Go!</button>
	                    </span>
	             	</div> 
	            </form>
            </li>
        </ul>
    </div>
    </div>
</nav>

<script th:inline="javascript">
	var isLogin;
	var isAdmin;
	var loginUserId;
	jQuery(function(){
		isLogin = /*[[${isLogin}]]*/;//取值  
		isAdmin = /*[[${isAdmin}]]*/;//取值  
		loginUserId = /*[[${loginUserId}]]*/;//取值  
		
		console.log($("body").height());
		resetSideHeight();
		$(".left-sider-bg").hide();
		
		//打开左侧菜单
		$(".side-open").on("click", function(){
			$(".left-sider-bg").show();
			$('.left-sider').animate({
		    	'left': '0px'
		    }, 500);
		});
		
		if(isLogin){
			getNoReadNumber();
			
		}
		
	});
	
	/**
	* 获取未读信息列表
	*/
	function getNoReadNumber(){
		$.ajax({
			dataType: 'json',
			url : "/nf/notification/noread/number",
			beforeSend:function(){
			},
			success : function(data) {
				if(data.isSuccess){
					var currentMsg = $(".nav-msg").hasClass("active");
					/*<![CDATA[*/
					for(var i = 0 ; i < data.message.length; i++){
						if(data.message[i]['type'] == '全部'){
							$(".nav-msg").find(".badge").text(data.message[i].number);
							if(!currentMsg)
								break;
						}else{
							if(currentMsg){
								var lis = $("#notification-tabs").find("li");
								for(var j = 0; j < lis.length; j++){
									if(lis.eq(j).attr("data-value") == data.message[i]['type']){
										lis.eq(j).find("a").text(data.message[i]['type'] +'(' + data.message[i]['number'] +')');
									}
								}
							}
						}
					}
					/*]]>*/  
				}				
			},
			error : function(data) {
				//刷新当前页面
				ajaxError(data);
			}
		});
	}
	
	//退出登录
	function logout(){
		$.ajax({
			dataType: 'json',
			url : "/us/logout",
			beforeSend:function(){
			},
			success : function(data) {
				layer.msg(data.message);
				if(data.isSuccess)
					//刷新当前页面
					window.location.reload();					
			},
			error : function() {
				//刷新当前页面
				window.location.reload();	
			}
		});
	}
	
	function sideClick(){
		$(".left-sider-bg").hide();
		$('.left-sider').animate({
	    	'left': '-200px'
	    }, 500);
	}
	
	function resetSideHeight(){
		var height = $("body").height();
		if(height > window.innerHeight)
			height = height + 100;
		else
			height = window.innerHeight;
		
		$(".left-sider-bg").height(height);
	}
	
	/**
	* 搜索
	*/
	function searchCommon(obj){
		var searchText = $(obj).closest("form").find("#common-search-text").val();
		if(isEmpty(searchText)){
			layer.msg("请输入您要搜索的内容！");
			$(obj).closest("form").find("#common-search-text").focus();
			return;
		}
		window.open('/s?q='+searchText, '_blank');
	}
</script>
</html>