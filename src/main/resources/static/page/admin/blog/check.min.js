layui.use(["layer"],function(){layer=layui.layer;winH=$(window).height();queryNoChecks();$(window).scroll(function(a){a=a||window.event;if(a.wheelDelta){if(0<a.wheelDelta)return}else if(a.detail&&0<a.detail)return;a=$(document.body).height();var c=$(window).scrollTop();a=(a-winH-c)/winH;!isLoad&&.2>a&&canLoadData&&!isLoad&&(isLoad=!0,method="lowloading",queryNoChecks())})});var blogs,last_id=0,first_id=0,method="firstloading",winH,canLoadData=!0,isLoad=!1;function getQueryPagingParams(){var a=15;"firstloading"!=method&&(a=10);return{pageSize:a,last_id:last_id,first_id:first_id,method:method,t:Math.random()}}function queryNoChecks(a){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/bg/noChecks?"+jsonToGetRequestParams(getQueryPagingParams()),dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);if(a.success){if(0==a.message.length){canLoadData=!1;layer.msg("\u65e0\u66f4\u591a\u6570\u636e");return}if("firstloading"==method){$(".each-row").remove();blogs=a.message;for(var b=0;b<blogs.length;b++)buildEachRow(blogs[b],b),0==b&&(first_id=blogs[b].id),b==blogs.length-1&&(last_id=blogs[b].id)}else for(var d=blogs.length,b=0;b<a.message.length;b++)blogs.push(a.message[b]),buildEachRow(a.message[b],d),b==a.message.length-1&&(last_id=a.message[b].id)}else ajaxError(a);isLoad=!1},error:function(a){layer.close(c);isLoad=!1;ajaxError(a)}})}function buildEachRow(a,c){var d='\x3ctr class\x3d"each-row" height\x3d"50"\x3e\x3ctd\x3e'+(c+1)+"\x3c/td\x3e\x3ctd\x3e"+changeNotNullString(a.title)+'\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d"/dt/'+a.id+'" target\x3d"_blank"\x3e'+changeNotNullString(a.digest)+'\x3c/a\x3e\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d"/my/'+a.create_user_id+'" target\x3d"_blank"\x3e'+changeNotNullString(a.account)+"\x3ca/\x3e\x3c/td\x3e\x3ctd\x3e"+changeNotNullString(a.create_time)+'\x3c/td\x3e\x3cth width\x3d"150" class\x3d"text-align-center"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary" onclick\x3d"showCheckDialog(this, '+c+');"\x3e\u7acb\u5373\u5ba1\u6838\x3c/button\x3e\x3c/th\x3e\x3c/tr\x3e';$(".main-table tbody").append(d)}function showCheckDialog(a,c){var d=blogs[c];$("#check-blog").find(".modal-body-check label:first-child").addClass("active");$("#check-blog").find(".modal-body-check label:eq(1)").removeClass("active");$("#check-blog").find(".reason-group").addClass("hide");$("#check-blog").attr("data-id",d.id);$("#check-blog").modal("show");$("#check-blog").find(".check-btn").on("click",function(){"no-agree"==$(this).find("input").attr("id")?$("#check-blog").find(".reason-group").removeClass("hide"):$("#check-blog").find(".reason-group").addClass("hide")})}function check(a){a=$("#check-blog").attr("data-id");var c=!1;if(isEmpty(a))layer.msg("\u9875\u9762\u53c2\u6570\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\uff01");else{var d="";if($("#check-blog").find("#no-agree").parent("label").hasClass("active")){if(isEmpty($("#check-blog").find('[name\x3d"reason"]').val())){layer.msg("\u8bf7\u8f93\u5165\u4e0d\u901a\u8fc7\u539f\u56e0\uff01");$("#check-blog").find('[name\x3d"reason"]').focus();return}d=$("#check-blog").find('[name\x3d"reason"]').val();c=!1}else c=!0;var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"put",data:{blog_id:a,reason:d,agree:c,t:Math.random()},url:"/bg/check",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.success?(layer.msg(a.message),$("#check-blog").modal("hide"),layer.msg(a.message+",1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})}};