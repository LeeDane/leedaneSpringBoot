(function(global,undefined){if(global.seajs){return}var seajs=global.seajs={version:"2.1.1"};var data=seajs.data={};function isType(type){return function(obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"}}var isObject=isType("Object");var isString=isType("String");var isArray=Array.isArray||isType("Array");var isFunction=isType("Function");var _cid=0;function cid(){return _cid++}var events=data.events={};seajs.on=function(name,callback){var list=events[name]||(events[name]=[]);list.push(callback);return seajs};seajs.off=function(name,callback){if(!(name||callback)){events=data.events={};return seajs}var list=events[name];if(list){if(callback){for(var i=list.length-1;i>=0;i--){if(list[i]===callback){list.splice(i,1)}}}else{delete events[name]}}return seajs};var emit=seajs.emit=function(name,data){var list=events[name],fn;if(list){list=list.slice();while((fn=list.shift())){fn(data)}}return seajs};var DIRNAME_RE=/[^?#]*\//;var DOT_RE=/\/\.\//g;var DOUBLE_DOT_RE=/\/[^/]+\/\.\.\//;function dirname(path){return path.match(DIRNAME_RE)[0]}function realpath(path){path=path.replace(DOT_RE,"/");while(path.match(DOUBLE_DOT_RE)){path=path.replace(DOUBLE_DOT_RE,"/")}return path}function normalize(path){var last=path.length-1;var lastC=path.charAt(last);if(lastC==="#"){return path.substring(0,last)}return(path.substring(last-2)===".js"||path.indexOf("?")>0||path.substring(last-3)===".css"||lastC==="/")?path:path+".js"}var PATHS_RE=/^([^/:]+)(\/.+)$/;var VARS_RE=/{([^{]+)}/g;function parseAlias(id){var alias=data.alias;return alias&&isString(alias[id])?alias[id]:id}function parsePaths(id){var paths=data.paths;var m;if(paths&&(m=id.match(PATHS_RE))&&isString(paths[m[1]])){id=paths[m[1]]+m[2]}return id}function parseVars(id){var vars=data.vars;if(vars&&id.indexOf("{")>-1){id=id.replace(VARS_RE,function(m,key){return isString(vars[key])?vars[key]:m})}return id}function parseMap(uri){var map=data.map;var ret=uri;if(map){for(var i=0,len=map.length;i<len;i++){var rule=map[i];ret=isFunction(rule)?(rule(uri)||uri):uri.replace(rule[0],rule[1]);if(ret!==uri){break}}}return ret}var ABSOLUTE_RE=/^\/\/.|:\//;var ROOT_DIR_RE=/^.*?\/\/.*?\//;function addBase(id,refUri){var ret;var first=id.charAt(0);if(ABSOLUTE_RE.test(id)){ret=id}else{if(first==="."){ret=realpath((refUri?dirname(refUri):data.cwd)+id)}else{if(first==="/"){var m=data.cwd.match(ROOT_DIR_RE);ret=m?m[0]+id.substring(1):id}else{ret=data.base+id}}}return ret}function id2Uri(id,refUri){if(!id){return""}id=parseAlias(id);id=parsePaths(id);id=parseVars(id);id=normalize(id);var uri=addBase(id,refUri);uri=parseMap(uri);return uri}var doc=document;var loc=location;var cwd=dirname(loc.href);var scripts=doc.getElementsByTagName("script");var loaderScript=doc.getElementById("seajsnode")||scripts[scripts.length-1];var loaderDir=dirname(getScriptAbsoluteSrc(loaderScript)||cwd);function getScriptAbsoluteSrc(node){return node.hasAttribute?node.src:node.getAttribute("src",4)}var head=doc.getElementsByTagName("head")[0]||doc.documentElement;var baseElement=head.getElementsByTagName("base")[0];var IS_CSS_RE=/\.css(?:\?|$)/i;var READY_STATE_RE=/^(?:loaded|complete|undefined)$/;var currentlyAddingScript;var interactiveScript;var isOldWebKit=(navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1"))*1<536;function request(url,callback,charset){var isCSS=IS_CSS_RE.test(url);var node=doc.createElement(isCSS?"link":"script");if(charset){var cs=isFunction(charset)?charset(url):charset;if(cs){node.charset=cs}}addOnload(node,callback,isCSS);if(isCSS){node.rel="stylesheet";node.href=url}else{node.async=true;node.src=url}currentlyAddingScript=node;baseElement?head.insertBefore(node,baseElement):head.appendChild(node);currentlyAddingScript=null}function addOnload(node,callback,isCSS){var missingOnload=isCSS&&(isOldWebKit||!("onload" in node));if(missingOnload){setTimeout(function(){pollCss(node,callback)},1);return}node.onload=node.onerror=node.onreadystatechange=function(){if(READY_STATE_RE.test(node.readyState)){node.onload=node.onerror=node.onreadystatechange=null;if(!isCSS&&!data.debug){head.removeChild(node)}node=null;callback()}}}function pollCss(node,callback){var sheet=node.sheet;var isLoaded;if(isOldWebKit){if(sheet){isLoaded=true}}else{if(sheet){try{if(sheet.cssRules){isLoaded=true}}catch(ex){if(ex.name==="NS_ERROR_DOM_SECURITY_ERR"){isLoaded=true}}}}setTimeout(function(){if(isLoaded){callback()}else{pollCss(node,callback)}},20)}function getCurrentScript(){if(currentlyAddingScript){return currentlyAddingScript}if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript}var scripts=head.getElementsByTagName("script");for(var i=scripts.length-1;i>=0;i--){var script=scripts[i];if(script.readyState==="interactive"){interactiveScript=script;return interactiveScript}}}var REQUIRE_RE=/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^\/\r\n])+\/(?=[^\/])|\/\/.*|\.\s*require|(?:^|[^$])\brequire\s*\(\s*(["'])(.+?)\1\s*\)/g;var SLASH_RE=/\\\\/g;
function parseDependencies(code){var ret=[];code.replace(SLASH_RE,"").replace(REQUIRE_RE,function(m,m1,m2){if(m2){ret.push(m2)}});return ret}var cachedMods=seajs.cache={};var anonymousMeta;var fetchingList={};var fetchedList={};var callbackList={};var STATUS=Module.STATUS={FETCHING:1,SAVED:2,LOADING:3,LOADED:4,EXECUTING:5,EXECUTED:6};function Module(uri,deps){this.uri=uri;this.dependencies=deps||[];this.exports=null;this.status=0;this._waitings={};this._remain=0}Module.prototype.resolve=function(){var mod=this;var ids=mod.dependencies;var uris=[];for(var i=0,len=ids.length;i<len;i++){uris[i]=Module.resolve(ids[i],mod.uri)}return uris};Module.prototype.load=function(){var mod=this;if(mod.status>=STATUS.LOADING){return}mod.status=STATUS.LOADING;var uris=mod.resolve();emit("load",uris);var len=mod._remain=uris.length;var m;for(var i=0;i<len;i++){m=Module.get(uris[i]);if(m.status<STATUS.LOADED){m._waitings[mod.uri]=(m._waitings[mod.uri]||0)+1}else{mod._remain--}}if(mod._remain===0){mod.onload();return}var requestCache={};for(i=0;i<len;i++){m=cachedMods[uris[i]];if(m.status<STATUS.FETCHING){m.fetch(requestCache)}else{if(m.status===STATUS.SAVED){m.load()}}}for(var requestUri in requestCache){if(requestCache.hasOwnProperty(requestUri)){requestCache[requestUri]()}}};Module.prototype.onload=function(){var mod=this;mod.status=STATUS.LOADED;if(mod.callback){mod.callback()}var waitings=mod._waitings;var uri,m;for(uri in waitings){if(waitings.hasOwnProperty(uri)){m=cachedMods[uri];m._remain-=waitings[uri];if(m._remain===0){m.onload()}}}delete mod._waitings;delete mod._remain};Module.prototype.fetch=function(requestCache){var mod=this;var uri=mod.uri;mod.status=STATUS.FETCHING;var emitData={uri:uri};emit("fetch",emitData);var requestUri=emitData.requestUri||uri;if(!requestUri||fetchedList[requestUri]){mod.load();return}if(fetchingList[requestUri]){callbackList[requestUri].push(mod);return}fetchingList[requestUri]=true;callbackList[requestUri]=[mod];emit("request",emitData={uri:uri,requestUri:requestUri,onRequest:onRequest,charset:data.charset});if(!emitData.requested){requestCache?requestCache[emitData.requestUri]=sendRequest:sendRequest()}function sendRequest(){request(emitData.requestUri,emitData.onRequest,emitData.charset)}function onRequest(){delete fetchingList[requestUri];fetchedList[requestUri]=true;if(anonymousMeta){Module.save(uri,anonymousMeta);anonymousMeta=null}var m,mods=callbackList[requestUri];delete callbackList[requestUri];while((m=mods.shift())){m.load()}}};Module.prototype.exec=function(){var mod=this;if(mod.status>=STATUS.EXECUTING){return mod.exports}mod.status=STATUS.EXECUTING;var uri=mod.uri;function require(id){return Module.get(require.resolve(id)).exec()}require.resolve=function(id){return Module.resolve(id,uri)};require.async=function(ids,callback){Module.use(ids,callback,uri+"_async_"+cid());return require};var factory=mod.factory;var exports=isFunction(factory)?factory(require,mod.exports={},mod):factory;if(exports===undefined){exports=mod.exports}if(exports===null&&!IS_CSS_RE.test(uri)){emit("error",mod)}delete mod.factory;mod.exports=exports;mod.status=STATUS.EXECUTED;emit("exec",mod);return exports};Module.resolve=function(id,refUri){var emitData={id:id,refUri:refUri};emit("resolve",emitData);return emitData.uri||id2Uri(emitData.id,refUri)};Module.define=function(id,deps,factory){var argsLen=arguments.length;if(argsLen===1){factory=id;id=undefined}else{if(argsLen===2){factory=deps;if(isArray(id)){deps=id;id=undefined}else{deps=undefined}}}if(!isArray(deps)&&isFunction(factory)){deps=parseDependencies(factory.toString())}var meta={id:id,uri:Module.resolve(id),deps:deps,factory:factory};if(!meta.uri&&doc.attachEvent){var script=getCurrentScript();if(script){meta.uri=script.src}}emit("define",meta);meta.uri?Module.save(meta.uri,meta):anonymousMeta=meta};Module.save=function(uri,meta){var mod=Module.get(uri);if(mod.status<STATUS.SAVED){mod.id=meta.id||uri;mod.dependencies=meta.deps||[];mod.factory=meta.factory;mod.status=STATUS.SAVED}};Module.get=function(uri,deps){return cachedMods[uri]||(cachedMods[uri]=new Module(uri,deps))};Module.use=function(ids,callback,uri){var mod=Module.get(uri,isArray(ids)?ids:[ids]);mod.callback=function(){var exports=[];var uris=mod.resolve();for(var i=0,len=uris.length;i<len;i++){exports[i]=cachedMods[uris[i]].exec()}if(callback){callback.apply(global,exports)}delete mod.callback};mod.load()};Module.preload=function(callback){var preloadMods=data.preload;var len=preloadMods.length;if(len){Module.use(preloadMods,function(){preloadMods.splice(0,len);Module.preload(callback)},data.cwd+"_preload_"+cid())}else{callback()}};seajs.use=function(ids,callback){Module.preload(function(){Module.use(ids,callback,data.cwd+"_use_"+cid())});return seajs};Module.define.cmd={};global.define=Module.define;seajs.Module=Module;data.fetchedList=fetchedList;data.cid=cid;seajs.resolve=id2Uri;seajs.require=function(id){return(cachedMods[Module.resolve(id)]||{}).exports};var BASE_RE=/^(.+?\/)(\?\?)?(seajs\/)+/;
data.base=(loaderDir.match(BASE_RE)||["",loaderDir])[1];data.dir=loaderDir;data.cwd=cwd;data.charset="utf-8";data.preload=(function(){var plugins=[];var str=loc.search.replace(/(seajs-\w+)(&|$)/g,"$1=1$2");str+=" "+doc.cookie;str.replace(/(seajs-\w+)=1/g,function(m,name){plugins.push(name)});return plugins})();seajs.config=function(configData){for(var key in configData){var curr=configData[key];var prev=data[key];if(prev&&isObject(prev)){for(var k in curr){prev[k]=curr[k]}}else{if(isArray(prev)){curr=prev.concat(curr)}else{if(key==="base"){(curr.slice(-1)==="/")||(curr+="/");curr=addBase(curr)}}data[key]=curr}}emit("config",configData);return seajs}})(this);(function(){var loaderPath=seajs.pluginSDK?seajs.pluginSDK.util.loaderDir:seajs.data.base,lastIndex=loaderPath.lastIndexOf("/");if(lastIndex==loaderPath.length-1){loaderPath=loaderPath.substr(0,lastIndex)}seajs.config({charset:"utf-8"});seajs.config({paths:{"bui":loaderPath}});var BUI=window.BUI=window.BUI||{};var scripts=document.getElementsByTagName("script"),loaderScript=scripts[scripts.length-1];BUI.loaderScript=loaderScript;if(loaderScript.getAttribute("data-debug")=="true"){BUI.debug=true}else{BUI.debug=false}BUI.use=seajs.use;BUI.config=function(cfg){if(cfg.alias){cfg.paths=cfg.alias;delete cfg.alias}seajs.config(cfg)};BUI.setDebug=function(debug){BUI.debug=debug;if(debug){var map=seajs.data.map,index=-1;if(map){for(var i=0;i<map.length;i++){var item=map[i];if(item[0].toString()==/.js$/.toString()&&item[1]=="-min.js"){index=i;break}}if(index!=-1){map.splice(index,1)}}}else{seajs.config({map:[[/.js$/,"-min.js"]]})}};BUI.setDebug(BUI.debug)})();(function(){var requires=["bui/util","bui/ua","bui/json","bui/date","bui/array","bui/keycode","bui/observable","bui/base","bui/component"];if(window.KISSY&&!window.KISSY.Node){requires.unshift("bui/adapter")}define("bui/common",requires,function(require){if(window.KISSY&&!window.KISSY.Node){require("bui/adapter")}var BUI=require("bui/util");BUI.mix(BUI,{UA:require("bui/ua"),JSON:require("bui/json"),Date:require("bui/date"),Array:require("bui/array"),KeyCode:require("bui/keycode"),Observable:require("bui/observable"),Base:require("bui/base"),Component:require("bui/component")});return BUI})})();window.BUI=window.BUI||{};if(!BUI.use&&window.seajs){BUI.use=seajs.use;BUI.config=seajs.config}define("bui/util",function(require){(function($){if($.fn){$.fn.on=$.fn.on||$.fn.bind;$.fn.off=$.fn.off||$.fn.unbind}})(jQuery);function mixAttrs(to,from){for(var c in from){if(from.hasOwnProperty(c)){to[c]=to[c]||{};mixAttr(to[c],from[c])}}}function mixAttr(attr,attrConfig){for(var p in attrConfig){if(attrConfig.hasOwnProperty(p)){if(p=="value"){if(BUI.isObject(attrConfig[p])){attr[p]=attr[p]||{};BUI.mix(attr[p],attrConfig[p])}else{if(BUI.isArray(attrConfig[p])){attr[p]=attr[p]||[];attr[p]=attr[p].concat(attrConfig[p])}else{attr[p]=attrConfig[p]}}}else{attr[p]=attrConfig[p]}}}}var win=window,doc=document,objectPrototype=Object.prototype,toString=objectPrototype.toString,BODY="body",DOC_ELEMENT="documentElement",SCROLL="scroll",SCROLL_WIDTH=SCROLL+"Width",SCROLL_HEIGHT=SCROLL+"Height",ATTRS="ATTRS",PARSER="PARSER",GUID_DEFAULT="guid";$.extend(BUI,{version:1,subVersion:79,isFunction:function(fn){return typeof(fn)==="function"},isArray:("isArray" in Array)?Array.isArray:function(value){return toString.call(value)==="[object Array]"},isDate:function(value){return toString.call(value)==="[object Date]"},isObject:(toString.call(null)==="[object Object]")?function(value){return value!==null&&value!==undefined&&toString.call(value)==="[object Object]"&&value.ownerDocument===undefined}:function(value){return toString.call(value)==="[object Object]"},isNumeric:function(value){return !isNaN(parseFloat(value))&&isFinite(value)},augment:function(r,s1){if(!BUI.isFunction(r)){return r}for(var i=1;i<arguments.length;i++){BUI.mix(r.prototype,arguments[i].prototype||arguments[i])}return r},cloneObject:function(obj){var result=BUI.isArray(obj)?[]:{};return BUI.mix(true,result,obj)},error:function(msg){if(BUI.debug){throw msg}},extend:function(subclass,superclass,overrides,staticOverrides){if(!BUI.isFunction(superclass)){overrides=superclass;superclass=subclass;subclass=function(){}}var create=Object.create?function(proto,c){return Object.create(proto,{constructor:{value:c}})}:function(proto,c){function F(){}F.prototype=proto;var o=new F();o.constructor=c;return o};var superObj=create(superclass.prototype,subclass);subclass.prototype=BUI.mix(superObj,subclass.prototype);subclass.superclass=create(superclass.prototype,superclass);BUI.mix(superObj,overrides);BUI.mix(subclass,staticOverrides);return subclass},guid:(function(){var map={};return function(prefix){prefix=prefix||BUI.prefix+GUID_DEFAULT;if(!map[prefix]){map[prefix]=1}else{map[prefix]+=1}return prefix+map[prefix]}})(),isString:function(value){return typeof value==="string"},isNumber:function(value){return typeof value==="number"},isBoolean:function(value){return typeof value==="boolean"},log:function(obj){if(BUI.debug&&win.console&&win.console.log){win.console.log(obj)
}},merge:function(){var args=$.makeArray(arguments),first=args[0];if(BUI.isBoolean(first)){args.shift();args.unshift({});args.unshift(first)}else{args.unshift({})}return BUI.mix.apply(null,args)},mix:function(){return $.extend.apply(null,arguments)},app:function(name){if(!window[name]){window[name]={namespace:function(nsName){return BUI.namespace(nsName,window[name])}}}return window[name]},mixAttrs:mixAttrs,mixAttr:mixAttr,mixin:function(c,mixins,attrs){attrs=attrs||[ATTRS,PARSER];var extensions=mixins;if(extensions){c.mixins=extensions;var desc={},constructors=extensions["concat"](c);BUI.each(constructors,function(ext){if(ext){BUI.each(attrs,function(K){if(ext[K]){desc[K]=desc[K]||{};if(K=="ATTRS"){mixAttrs(desc[K],ext[K])}else{BUI.mix(desc[K],ext[K])}}})}});BUI.each(desc,function(v,k){c[k]=v});var prototype={};BUI.each(constructors,function(ext){if(ext){var proto=ext.prototype;for(var p in proto){if(proto.hasOwnProperty(p)){prototype[p]=proto[p]}}}});BUI.each(prototype,function(v,k){c.prototype[k]=v})}return c},namespace:function(name,baseNS){baseNS=baseNS||BUI;if(!name){return baseNS}var list=name.split("."),curNS=baseNS;for(var i=0;i<list.length;i++){var nsName=list[i];if(!curNS[nsName]){curNS[nsName]={}}curNS=curNS[nsName]}return curNS},prefix:"bui-",substitute:function(str,o,regexp){if(!BUI.isString(str)||(!BUI.isObject(o))&&!BUI.isArray(o)){return str}return str.replace(regexp||/\\?\{([^{}]+)\}/g,function(match,name){if(match.charAt(0)==="\\"){return match.slice(1)}return(o[name]===undefined)?"":o[name]})},ucfirst:function(s){s+="";return s.charAt(0).toUpperCase()+s.substring(1)},isInView:function(offset){var left=offset.left,top=offset.top,viewWidth=BUI.viewportWidth(),wiewHeight=BUI.viewportHeight(),scrollTop=BUI.scrollTop(),scrollLeft=BUI.scrollLeft();if(left<scrollLeft||left>scrollLeft+viewWidth){return false}if(top<scrollTop||top>scrollTop+wiewHeight){return false}return true},isInVerticalView:function(top){var wiewHeight=BUI.viewportHeight(),scrollTop=BUI.scrollTop();if(top<scrollTop||top>scrollTop+wiewHeight){return false}return true},isInHorizontalView:function(left){var viewWidth=BUI.viewportWidth(),scrollLeft=BUI.scrollLeft();if(left<scrollLeft||left>scrollLeft+viewWidth){return false}return true},viewportWidth:function(){return $(window).width()},viewportHeight:function(){return $(window).height()},scrollLeft:function(){return $(window).scrollLeft()},scrollTop:function(){return $(window).scrollTop()},docWidth:function(){return Math.max(this.viewportWidth(),doc[DOC_ELEMENT][SCROLL_WIDTH],doc[BODY][SCROLL_WIDTH])},docHeight:function(){return Math.max(this.viewportHeight(),doc[DOC_ELEMENT][SCROLL_HEIGHT],doc[BODY][SCROLL_HEIGHT])},each:function(elements,func){if(!elements){return}$.each(elements,function(k,v){return func(v,k)})},wrapBehavior:function(self,action){return self["__bui_wrap_"+action]=function(e){if(!self.get("disabled")){self[action](e)}}},getWrapBehavior:function(self,action){return self["__bui_wrap_"+action]},getControl:function(id){return BUI.Component.Manager.getComponent(id)}});var formHelper=BUI.FormHelper={serializeToObject:function(form){var array=$(form).serializeArray(),result={};BUI.each(array,function(item){var name=item.name;if(!result[name]){result[name]=item.value}else{if(!BUI.isArray(result[name])){result[name]=[result[name]]}result[name].push(item.value)}});return result},setFields:function(form,obj){for(var name in obj){if(obj.hasOwnProperty(name)){BUI.FormHelper.setField(form,name,obj[name])}}},clear:function(form){var elements=$.makeArray(form.elements);BUI.each(elements,function(element){if(element.type==="checkbox"||element.type==="radio"){$(element).attr("checked",false)}else{$(element).val("")}$(element).change()})},setField:function(form,fieldName,value){var fields=form.elements[fieldName];if(fields&&fields.type){formHelper._setFieldValue(fields,value)}else{if(BUI.isArray(fields)||(fields&&fields.length)){BUI.each(fields,function(field){formHelper._setFieldValue(field,value)})}}},_setFieldValue:function(field,value){if(field.type==="checkbox"){if(field.value==""+value||(BUI.isArray(value)&&BUI.Array.indexOf(field.value,value)!==-1)){$(field).attr("checked",true)}else{$(field).attr("checked",false)}}else{if(field.type==="radio"){if(field.value==""+value){$(field).attr("checked",true)}else{$(field).attr("checked",false)}}else{$(field).val(value)}}},getField:function(form,fieldName){return BUI.FormHelper.serializeToObject(form)[fieldName]}};return BUI});define("bui/array",["bui/util"],function(r){var BUI=r("bui/util");BUI.Array={peek:function(array){return array[array.length-1]},indexOf:function(value,array,opt_fromIndex){var fromIndex=opt_fromIndex==null?0:(opt_fromIndex<0?Math.max(0,array.length+opt_fromIndex):opt_fromIndex);for(var i=fromIndex;i<array.length;i++){if(i in array&&array[i]===value){return i}}return -1},contains:function(value,array){return BUI.Array.indexOf(value,array)>=0},each:BUI.each,equals:function(a1,a2){if(a1==a2){return true}if(!a1||!a2){return false
}if(a1.length!=a2.length){return false}var rst=true;for(var i=0;i<a1.length;i++){if(a1[i]!==a2[i]){rst=false;break}}return rst},filter:function(array,func){var result=[];BUI.Array.each(array,function(value,index){if(func(value,index)){result.push(value)}});return result},map:function(array,func){var result=[];BUI.Array.each(array,function(value,index){result.push(func(value,index))});return result},find:function(array,func){var i=BUI.Array.findIndex(array,func);return i<0?null:array[i]},findIndex:function(array,func){var result=-1;BUI.Array.each(array,function(value,index){if(func(value,index)){result=index;return false}});return result},isEmpty:function(array){return array.length==0},add:function(array,value){array.push(value)},addAt:function(array,value,index){BUI.Array.splice(array,index,0,value)},empty:function(array){if(!(array instanceof (Array))){for(var i=array.length-1;i>=0;i--){delete array[i]}}array.length=0},remove:function(array,value){var i=BUI.Array.indexOf(value,array);var rv;if((rv=i>=0)){BUI.Array.removeAt(array,i)}return rv},removeAt:function(array,index){return BUI.Array.splice(array,index,1).length==1},slice:function(arr,start,opt_end){if(arguments.length<=2){return Array.prototype.slice.call(arr,start)}else{return Array.prototype.slice.call(arr,start,opt_end)}},splice:function(arr,index,howMany,var_args){return Array.prototype.splice.apply(arr,BUI.Array.slice(arguments,1))}};return BUI.Array});define("bui/observable",["bui/util"],function(r){var BUI=r("bui/util");var Callbacks=function(){this._init()};BUI.augment(Callbacks,{_functions:null,_init:function(){var _self=this;_self._functions=[]},add:function(fn){this._functions.push(fn)},remove:function(fn){var functions=this._functions;index=BUI.Array.indexOf(fn,functions);if(index>=0){functions.splice(index,1)}},empty:function(){var length=this._functions.length;this._functions.splice(0,length)},pause:function(){this._paused=true},resume:function(){this._paused=false},fireWith:function(scope,args){var _self=this,rst;if(this._paused){return}BUI.each(_self._functions,function(fn){rst=fn.apply(scope,args);if(rst===false){return false}});return rst}});function getCallbacks(){return new Callbacks()}var Observable=function(config){this._events=[];this._eventMap={};this._bubblesEvents=[];this._initEvents(config)};BUI.augment(Observable,{_events:[],_eventMap:{},_bubblesEvents:[],_bubbleTarget:null,_getCallbacks:function(eventType){var _self=this,eventMap=_self._eventMap;return eventMap[eventType]},_initEvents:function(config){var _self=this,listeners=null;if(!config){return}listeners=config.listeners||{};if(config.handler){listeners.click=config.handler}if(listeners){for(var name in listeners){if(listeners.hasOwnProperty(name)){_self.on(name,listeners[name])}}}},_isBubbles:function(eventType){return BUI.Array.indexOf(eventType,this._bubblesEvents)>=0},addTarget:function(target){this._bubbleTarget=target},addEvents:function(events){var _self=this,existEvents=_self._events,eventMap=_self._eventMap;function addEvent(eventType){if(BUI.Array.indexOf(eventType,existEvents)===-1){eventMap[eventType]=getCallbacks();existEvents.push(eventType)}}if(BUI.isArray(events)){$.each(events,function(index,eventType){addEvent(eventType)})}else{addEvent(events)}},clearListeners:function(){var _self=this,eventMap=_self._eventMap;for(var name in eventMap){if(eventMap.hasOwnProperty(name)){eventMap[name].empty()}}},fire:function(eventType,eventData){var _self=this,callbacks=_self._getCallbacks(eventType),args=$.makeArray(arguments),result;if(!eventData){eventData={};args.push(eventData)}if(!eventData.target){eventData.target=_self}if(callbacks){result=callbacks.fireWith(_self,Array.prototype.slice.call(args,1))}if(_self._isBubbles(eventType)){var bubbleTarget=_self._bubbleTarget;if(bubbleTarget&&bubbleTarget.fire){bubbleTarget.fire(eventType,eventData)}}return result},pauseEvent:function(eventType){var _self=this,callbacks=_self._getCallbacks(eventType);callbacks&&callbacks.pause()},resumeEvent:function(eventType){var _self=this,callbacks=_self._getCallbacks(eventType);callbacks&&callbacks.resume()},on:function(eventType,fn){var arr=eventType.split(" "),_self=this,callbacks=null;if(arr.length>1){BUI.each(arr,function(name){_self.on(name,fn)})}else{callbacks=_self._getCallbacks(eventType);if(callbacks){callbacks.add(fn)}else{_self.addEvents(eventType);_self.on(eventType,fn)}}return _self},off:function(eventType,fn){if(!eventType&&!fn){this.clearListeners();return this}var _self=this,callbacks=_self._getCallbacks(eventType);if(callbacks){callbacks.remove(fn)}return _self},publish:function(eventType,cfg){var _self=this,bubblesEvents=_self._bubblesEvents;if(cfg.bubbles){if(BUI.Array.indexOf(eventType,bubblesEvents)===-1){bubblesEvents.push(eventType)}}else{var index=BUI.Array.indexOf(eventType,bubblesEvents);if(index!==-1){bubblesEvents.splice(index,1)}}}});return Observable});define("bui/ua",function(){function numberify(s){var c=0;return parseFloat(s.replace(/\./g,function(){return(c++===0)?".":""
}))}function uaMatch(s){s=s.toLowerCase();var r=/(chrome)[ \/]([\w.]+)/.exec(s)||/(webkit)[ \/]([\w.]+)/.exec(s)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(s)||/(msie) ([\w.]+)/.exec(s)||s.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(s)||[],a={browser:r[1]||"",version:r[2]||"0"},b={};a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0);return b}var UA=$.UA||(function(){var browser=$.browser||uaMatch(navigator.userAgent),versionNumber=numberify(browser.version),ua={ie:browser.msie&&versionNumber,webkit:browser.webkit&&versionNumber,opera:browser.opera&&versionNumber,mozilla:browser.mozilla&&versionNumber};return ua})();return UA});define("bui/json",["bui/ua"],function(require){var win=window,UA=require("bui/ua"),JSON=win.JSON;if(!JSON||UA["ie"]<9){JSON=win.JSON={}}function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable["lastIndex"]=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}function looseParse(data){try{return new Function("return "+data+";")()}catch(e){throw"Json parse error!"}}var JSON={parse:$.parseJSON,looseParse:looseParse,stringify:JSON.stringify};return JSON});define("bui/keycode",function(){var keyCode={BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};return keyCode});define("bui/date",function(){var dateRegex=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function dateParse(val,format){if(val instanceof Date){return val}if(typeof(format)=="undefined"||format==null||format==""){var checkList=new Array("y-m-d","yyyy-mm-dd","yyyy-mm-dd HH:MM:ss","H:M:s");for(var i=0;i<checkList.length;i++){var d=dateParse(val,checkList[i]);if(d!=null){return d
}}return null}val=val+"";var i_val=0;var i_format=0;var c="";var token="";var x,y;var now=new Date();var year=now.getYear();var month=now.getMonth()+1;var date=1;var hh=0;var mm=0;var ss=0;this.isInteger=function(val){return/^\d*$/.test(val)};this.getInt=function(str,i,minlength,maxlength){for(var x=maxlength;x>=minlength;x--){var token=str.substring(i,i+x);if(token.length<minlength){return null}if(this.isInteger(token)){return token}}return null};while(i_format<format.length){c=format.charAt(i_format);token="";while((format.charAt(i_format)==c)&&(i_format<format.length)){token+=format.charAt(i_format++)}if(token=="yyyy"||token=="yy"||token=="y"){if(token=="yyyy"){x=4;y=4}if(token=="yy"){x=2;y=2}if(token=="y"){x=2;y=4}year=this.getInt(val,i_val,x,y);if(year==null){return null}i_val+=year.length;if(year.length==2){year=year>70?1900+(year-0):2000+(year-0)}}else{if(token=="mm"||token=="m"){month=this.getInt(val,i_val,token.length,2);if(month==null||(month<1)||(month>12)){return null}i_val+=month.length}else{if(token=="dd"||token=="d"){date=this.getInt(val,i_val,token.length,2);if(date==null||(date<1)||(date>31)){return null}i_val+=date.length}else{if(token=="hh"||token=="h"){hh=this.getInt(val,i_val,token.length,2);if(hh==null||(hh<1)||(hh>12)){return null}i_val+=hh.length}else{if(token=="HH"||token=="H"){hh=this.getInt(val,i_val,token.length,2);if(hh==null||(hh<0)||(hh>23)){return null}i_val+=hh.length}else{if(token=="MM"||token=="M"){mm=this.getInt(val,i_val,token.length,2);if(mm==null||(mm<0)||(mm>59)){return null}i_val+=mm.length}else{if(token=="ss"||token=="s"){ss=this.getInt(val,i_val,token.length,2);if(ss==null||(ss<0)||(ss>59)){return null}i_val+=ss.length}else{if(val.substring(i_val,i_val+token.length)!=token){return null}else{i_val+=token.length}}}}}}}}}if(i_val!=val.length){return null}if(month==2){if(((year%4==0)&&(year%100!=0))||(year%400==0)){if(date>29){return null}}else{if(date>28){return null}}}if((month==4)||(month==6)||(month==9)||(month==11)){if(date>30){return null}}return new Date(year,month-1,date,hh,mm,ss)}function DateAdd(strInterval,NumDay,dtDate){var dtTmp=new Date(dtDate);if(isNaN(dtTmp)){dtTmp=new Date()}NumDay=parseInt(NumDay,10);switch(strInterval){case"s":dtTmp=new Date(dtTmp.getTime()+(1000*NumDay));break;case"n":dtTmp=new Date(dtTmp.getTime()+(60000*NumDay));break;case"h":dtTmp=new Date(dtTmp.getTime()+(3600000*NumDay));break;case"d":dtTmp=new Date(dtTmp.getTime()+(86400000*NumDay));break;case"w":dtTmp=new Date(dtTmp.getTime()+((86400000*7)*NumDay));break;case"m":dtTmp=new Date(dtTmp.getFullYear(),(dtTmp.getMonth())+NumDay,dtTmp.getDate(),dtTmp.getHours(),dtTmp.getMinutes(),dtTmp.getSeconds());break;case"y":dtTmp=new Date(dtTmp.getFullYear()+NumDay,dtTmp.getMonth(),dtTmp.getDate(),dtTmp.getHours(),dtTmp.getMinutes(),dtTmp.getSeconds());break}return dtTmp}var dateFormat=function(){var token=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len){val="0"+val}return val},masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(date,mask,utc){if(arguments.length===1&&Object.prototype.toString.call(date)==="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date();if(isNaN(date)){throw SyntaxError("invalid date")}mask=String(masks[mask]||mask||masks["default"]);if(mask.slice(0,4)==="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d,undefined),ddd:i18n.dayNames[D],dddd:i18n.dayNames[D+7],w:i18n.dayNames[D+14],m:m+1,mm:pad(m+1,undefined),mmm:i18n.monthNames[m],mmmm:i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12,undefined),H:H,HH:pad(H,undefined),M:M,MM:pad(M,undefined),s:s,ss:pad(s,undefined),l:pad(L,3),L:pad(L>99?Math.round(L/10):L,undefined),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!==10)*d%10]};
return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();var DateUtil={add:function(strInterval,Num,dtDate){return DateAdd(strInterval,Num,dtDate)},addHour:function(hours,date){return DateAdd("h",hours,date)},addMinute:function(minutes,date){return DateAdd("n",minutes,date)},addSecond:function(seconds,date){return DateAdd("s",seconds,date)},addDay:function(days,date){return DateAdd("d",days,date)},addWeek:function(weeks,date){return DateAdd("w",weeks,date)},addMonths:function(months,date){return DateAdd("m",months,date)},addYear:function(years,date){return DateAdd("y",years,date)},isDateEquals:function(d1,d2){return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()===d2.getMonth()&&d1.getDate()===d2.getDate()},isEquals:function(d1,d2){if(d1==d2){return true}if(!d1||!d2){return false}if(!d1.getTime||!d2.getTime){return false}return d1.getTime()==d2.getTime()},isDateString:function(str){return dateRegex.test(str)},format:function(date,mask,utc){return dateFormat(date,mask,utc)},parse:function(date,s){if(BUI.isString(date)){date=date.replace("/","-")}return dateParse(date,s)},today:function(){var now=new Date();return new Date(now.getFullYear(),now.getMonth(),now.getDate())},getDate:function(date){return new Date(date.getFullYear(),date.getMonth(),date.getDate())}};return DateUtil});define("bui/base",["bui/observable"],function(require){var INVALID={},Observable=require("bui/observable");function ensureNonEmpty(obj,name,create){var ret=obj[name]||{};if(create){obj[name]=ret}return ret}function normalFn(host,method){if(BUI.isString(method)){return host[method]}return method}function __fireAttrChange(self,when,name,prevVal,newVal){var attrName=name;return self.fire(when+BUI.ucfirst(name)+"Change",{attrName:attrName,prevVal:prevVal,newVal:newVal})}function setInternal(self,name,value,opts,attrs){opts=opts||{};var ret,subVal,prevVal;prevVal=self.get(name);if(!$.isPlainObject(value)&&!BUI.isArray(value)&&prevVal===value){return undefined}if(!opts["silent"]){if(false===__fireAttrChange(self,"before",name,prevVal,value)){return false}}ret=self._set(name,value,opts);if(ret===false){return ret}if(!opts["silent"]){value=self.__attrVals[name];__fireAttrChange(self,"after",name,prevVal,value)}return self}function initClassAttrs(c){if(c._attrs||c==Base){return}var superCon=c.superclass.constructor;if(superCon&&!superCon._attrs){initClassAttrs(superCon)}c._attrs={};BUI.mixAttrs(c._attrs,superCon._attrs);BUI.mixAttrs(c._attrs,c.ATTRS)}var Base=function(config){var _self=this,c=_self.constructor,constructors=[];this.__attrs={};this.__attrVals={};Observable.apply(this,arguments);while(c){constructors.push(c);if(c.extensions){BUI.mixin(c,c.extensions);delete c.extensions}c=c.superclass?c.superclass.constructor:null}var con=_self.constructor;initClassAttrs(con);_self._initStaticAttrs(con._attrs);_self._initAttrs(config)};Base.INVALID=INVALID;BUI.extend(Base,Observable);BUI.augment(Base,{_initStaticAttrs:function(attrs){var _self=this,__attrs;__attrs=_self.__attrs={};for(var p in attrs){if(attrs.hasOwnProperty(p)){var attr=attrs[p];if(attr.shared===false||attr.valueFn){__attrs[p]={};BUI.mixAttr(__attrs[p],attrs[p])}else{__attrs[p]=attrs[p]}}}},addAttr:function(name,attrConfig,overrides){var _self=this,attrs=_self.__attrs,attr=attrs[name];if(!attr){attr=attrs[name]={}}for(var p in attrConfig){if(attrConfig.hasOwnProperty(p)){if(p=="value"){if(BUI.isObject(attrConfig[p])){attr[p]=attr[p]||{};BUI.mix(attr[p],attrConfig[p])}else{if(BUI.isArray(attrConfig[p])){attr[p]=attr[p]||[];BUI.mix(attr[p],attrConfig[p])}else{attr[p]=attrConfig[p]}}}else{attr[p]=attrConfig[p]}}}return _self},addAttrs:function(attrConfigs,initialValues,overrides){var _self=this;if(!attrConfigs){return _self}if(typeof(initialValues)==="boolean"){overrides=initialValues;initialValues=null}BUI.each(attrConfigs,function(attrConfig,name){_self.addAttr(name,attrConfig,overrides)});if(initialValues){_self.set(initialValues)}return _self},hasAttr:function(name){return name&&this.__attrs.hasOwnProperty(name)},getAttrs:function(){return this.__attrs},getAttrVals:function(){return this.__attrVals},get:function(name){var _self=this,attrVals=_self.__attrVals,attrConfig,getter,ret;attrConfig=ensureNonEmpty(_self.__attrs,name);getter=attrConfig["getter"];ret=name in attrVals?attrVals[name]:_self._getDefAttrVal(name);if(getter&&(getter=normalFn(_self,getter))){ret=getter.call(_self,ret,name)}return ret},clearAttrVals:function(){this.__attrVals={}},removeAttr:function(name){var _self=this;if(_self.hasAttr(name)){delete _self.__attrs[name];delete _self.__attrVals[name]}return _self},set:function(name,value,opts){var _self=this;if($.isPlainObject(name)){opts=value;var all=Object(name),attrs=[];for(name in all){if(all.hasOwnProperty(name)){setInternal(_self,name,all[name],opts)}}return _self}return setInternal(_self,name,value,opts)},setInternal:function(name,value,opts){return this._set(name,value,opts)},_getDefAttrVal:function(name){var _self=this,attrs=_self.__attrs,attrConfig=ensureNonEmpty(attrs,name),valFn=attrConfig.valueFn,val;
if(valFn&&(valFn=normalFn(_self,valFn))){val=valFn.call(_self);if(val!==undefined){attrConfig.value=val}delete attrConfig.valueFn;attrs[name]=attrConfig}return attrConfig.value},_set:function(name,value,opts){var _self=this,setValue,attrConfig=ensureNonEmpty(_self.__attrs,name,true),setter=attrConfig["setter"];if(setter&&(setter=normalFn(_self,setter))){setValue=setter.call(_self,value,name)}if(setValue===INVALID){return false}if(setValue!==undefined){value=setValue}_self.__attrVals[name]=value;return _self},_initAttrs:function(config){var _self=this;if(config){for(var attr in config){if(config.hasOwnProperty(attr)){_self._set(attr,config[attr])}}}}});return Base});define("bui/component",["bui/component/manage","bui/component/uibase","bui/component/view","bui/component/controller"],function(require){var Component={};BUI.mix(Component,{Manager:require("bui/component/manage"),UIBase:require("bui/component/uibase"),View:require("bui/component/view"),Controller:require("bui/component/controller")});function create(component,self){var childConstructor,xclass;if(component&&(xclass=component.xclass)){if(self&&!component.prefixCls){component.prefixCls=self.get("prefixCls")}childConstructor=Component.Manager.getConstructorByXClass(xclass);if(!childConstructor){BUI.error("can not find class by xclass desc : "+xclass)}component=new childConstructor(component)}return component}Component.create=create;return Component});define("bui/component/manage",function(require){var uis={};function getConstructorByXClass(cls){var cs=cls.split(/\s+/),p=-1,t,ui=null;for(var i=0;i<cs.length;i++){var uic=uis[cs[i]];if(uic&&(t=uic.priority)>p){p=t;ui=uic.constructor}}return ui}function getXClassByConstructor(constructor){for(var u in uis){var ui=uis[u];if(ui.constructor==constructor){return u}}return 0}function setConstructorByXClass(cls,uic){if(BUI.isFunction(uic)){uis[cls]={constructor:uic,priority:0}}else{uic.priority=uic.priority||0;uis[cls]=uic}}function getCssClassWithPrefix(cls){var cs=$.trim(cls).split(/\s+/);for(var i=0;i<cs.length;i++){if(cs[i]){cs[i]=this.get("prefixCls")+cs[i]}}return cs.join(" ")}var componentInstances={};var Manager={__instances:componentInstances,addComponent:function(id,component){componentInstances[id]=component},removeComponent:function(id){delete componentInstances[id]},eachComponent:function(fn){BUI.each(componentInstances,fn)},getComponent:function(id){return componentInstances[id]},getCssClassWithPrefix:getCssClassWithPrefix,getXClassByConstructor:getXClassByConstructor,getConstructorByXClass:getConstructorByXClass,setConstructorByXClass:setConstructorByXClass};return Manager});(function(){var BASE="bui/component/uibase/";define("bui/component/uibase",[BASE+"base",BASE+"align",BASE+"autoshow",BASE+"autohide",BASE+"close",BASE+"collapsable",BASE+"drag",BASE+"keynav",BASE+"list",BASE+"listitem",BASE+"mask",BASE+"position",BASE+"selection",BASE+"stdmod",BASE+"decorate",BASE+"tpl",BASE+"childcfg",BASE+"bindable",BASE+"depends"],function(r){var UIBase=r(BASE+"base");BUI.mix(UIBase,{Align:r(BASE+"align"),AutoShow:r(BASE+"autoshow"),AutoHide:r(BASE+"autohide"),Close:r(BASE+"close"),Collapsable:r(BASE+"collapsable"),Drag:r(BASE+"drag"),KeyNav:r(BASE+"keynav"),List:r(BASE+"list"),ListItem:r(BASE+"listitem"),Mask:r(BASE+"mask"),Position:r(BASE+"position"),Selection:r(BASE+"selection"),StdMod:r(BASE+"stdmod"),Decorate:r(BASE+"decorate"),Tpl:r(BASE+"tpl"),ChildCfg:r(BASE+"childcfg"),Bindable:r(BASE+"bindable"),Depends:r(BASE+"depends")});BUI.mix(UIBase,{CloseView:UIBase.Close.View,CollapsableView:UIBase.Collapsable.View,ChildList:UIBase.List.ChildList,ListItemView:UIBase.ListItem.View,MaskView:UIBase.Mask.View,PositionView:UIBase.Position.View,StdModView:UIBase.StdMod.View,TplView:UIBase.Tpl.View});return UIBase})})();define("bui/component/uibase/base",["bui/component/manage"],function(require){var Manager=require("bui/component/manage"),UI_SET="_uiSet",ATTRS="ATTRS",ucfirst=BUI.ucfirst,noop=$.noop,Base=require("bui/base");function initHierarchy(host,config){callMethodByHierarchy(host,"initializer","constructor")}function callMethodByHierarchy(host,mainMethod,extMethod){var c=host.constructor,extChains=[],ext,main,exts,t;while(c){t=[];if(exts=c.mixins){for(var i=0;i<exts.length;i++){ext=exts[i];if(ext){if(extMethod!="constructor"){if(ext.prototype.hasOwnProperty(extMethod)){ext=ext.prototype[extMethod]}else{ext=null}}ext&&t.push(ext)}}}if(c.prototype.hasOwnProperty(mainMethod)&&(main=c.prototype[mainMethod])){t.push(main)}if(t.length){extChains.push.apply(extChains,t.reverse())}c=c.superclass&&c.superclass.constructor}for(i=extChains.length-1;i>=0;i--){extChains[i]&&extChains[i].call(host)}}function destroyHierarchy(host){var c=host.constructor,extensions,d,i;while(c){if(c.prototype.hasOwnProperty("destructor")){c.prototype.destructor.apply(host)}if((extensions=c.mixins)){for(i=extensions.length-1;i>=0;i--){d=extensions[i]&&extensions[i].prototype.__destructor;d&&d.apply(host)}}c=c.superclass&&c.superclass.constructor
}}function constructPlugins(plugins){if(!plugins){return}BUI.each(plugins,function(plugin,i){if(BUI.isFunction(plugin)){plugins[i]=new plugin()}})}function actionPlugins(self,plugins,action){if(!plugins){return}BUI.each(plugins,function(plugin,i){if(plugin[action]){plugin[action](self)}})}function bindUI(self){}function syncUI(self){var v,f,attrs=self.getAttrs();for(var a in attrs){if(attrs.hasOwnProperty(a)){var m=UI_SET+ucfirst(a);if((f=self[m])&&attrs[a].sync!==false&&(v=self.get(a))!==undefined){f.call(self,v)}}}}var UIBase=function(config){var _self=this,id;Base.apply(_self,arguments);_self.setInternal("userConfig",config);initHierarchy(_self,config);var listener,n,plugins=_self.get("plugins");constructPlugins(plugins);var xclass=_self.get("xclass");if(xclass){_self.__xclass=xclass}actionPlugins(_self,plugins,"initializer");config&&config.autoRender&&_self.render()};UIBase.ATTRS={userConfig:{},autoRender:{value:false},listeners:{value:{}},plugins:{},rendered:{value:false},xclass:{valueFn:function(){return Manager.getXClassByConstructor(this.constructor)}}};BUI.extend(UIBase,Base);BUI.augment(UIBase,{create:function(){var self=this;if(!self.get("created")){self.fire("beforeCreateDom");callMethodByHierarchy(self,"createDom","__createDom");self._set("created",true);self.fire("afterCreateDom");actionPlugins(self,self.get("plugins"),"createDom")}return self},render:function(){var _self=this;if(!_self.get("rendered")){var plugins=_self.get("plugins");_self.create(undefined);_self.set("created",true);_self.fire("beforeRenderUI");callMethodByHierarchy(_self,"renderUI","__renderUI");_self.fire("afterRenderUI");actionPlugins(_self,plugins,"renderUI");_self.fire("beforeBindUI");bindUI(_self);callMethodByHierarchy(_self,"bindUI","__bindUI");_self.set("binded",true);_self.fire("afterBindUI");actionPlugins(_self,plugins,"bindUI");_self.fire("beforeSyncUI");syncUI(_self);callMethodByHierarchy(_self,"syncUI","__syncUI");_self.fire("afterSyncUI");actionPlugins(_self,plugins,"syncUI");_self._set("rendered",true)}return _self},createDom:noop,renderUI:noop,bindUI:noop,syncUI:noop,destroy:function(){var _self=this;if(_self.destroyed){return _self}_self.fire("beforeDestroy");actionPlugins(_self,_self.get("plugins"),"destructor");destroyHierarchy(_self);_self.fire("afterDestroy");_self.off();_self.clearAttrVals();_self.destroyed=true;return _self}});function initConstuctor(c){var constructors=[];while(c.base){constructors.push(c);c=c.base}for(var i=constructors.length-1;i>=0;i--){var C=constructors[i];BUI.mix(C.prototype,C.px);BUI.mix(C,C.sx);C.base=null;C.px=null;C.sx=null}}BUI.mix(UIBase,{define:function(base,extensions,px,sx){if($.isPlainObject(extensions)){sx=px;px=extensions;extensions=[]}function C(){var c=this.constructor;if(c.base){initConstuctor(c)}UIBase.apply(this,arguments)}BUI.extend(C,base);C.base=base;C.px=px;C.sx=sx;if(extensions.length){C.extensions=extensions}return C},extend:function extend(extensions,px,sx){var args=$.makeArray(arguments),ret,last=args[args.length-1];args.unshift(this);if(last.xclass){args.pop();args.push(last.xclass)}ret=UIBase.define.apply(UIBase,args);if(last.xclass){var priority=last.priority||(this.priority?(this.priority+1):1);Manager.setConstructorByXClass(last.xclass,{constructor:ret,priority:priority});ret.__xclass=last.xclass;ret.priority=priority;ret.toString=function(){return last.xclass}}ret.extend=extend;return ret}});return UIBase});define("bui/component/uibase/align",["bui/ua"],function(require){var UA=require("bui/ua"),CLS_ALIGN_PREFIX="x-align-",win=window;function getOffsetParent(element){var doc=element.ownerDocument,body=doc.body,parent,positionStyle=$(element).css("position"),skipStatic=positionStyle=="fixed"||positionStyle=="absolute";if(!skipStatic){return element.nodeName.toLowerCase()=="html"?null:element.parentNode}for(parent=element.parentNode;parent&&parent!=body;parent=parent.parentNode){positionStyle=$(parent).css("position");if(positionStyle!="static"){return parent}}return null}function getVisibleRectForElement(element){var visibleRect={left:0,right:Infinity,top:0,bottom:Infinity},el,scrollX,scrollY,winSize,doc=element.ownerDocument,body=doc.body,documentElement=doc.documentElement;for(el=element;el=getOffsetParent(el);){if((!UA.ie||el.clientWidth!=0)&&(el!=body&&el!=documentElement&&$(el).css("overflow")!="visible")){var pos=$(el).offset();pos.left+=el.clientLeft;pos.top+=el.clientTop;visibleRect.top=Math.max(visibleRect.top,pos.top);visibleRect.right=Math.min(visibleRect.right,pos.left+el.clientWidth);visibleRect.bottom=Math.min(visibleRect.bottom,pos.top+el.clientHeight);visibleRect.left=Math.max(visibleRect.left,pos.left)}}scrollX=$(win).scrollLeft();scrollY=$(win).scrollTop();visibleRect.left=Math.max(visibleRect.left,scrollX);visibleRect.top=Math.max(visibleRect.top,scrollY);winSize={width:BUI.viewportWidth(),height:BUI.viewportHeight()};visibleRect.right=Math.min(visibleRect.right,scrollX+winSize.width);visibleRect.bottom=Math.min(visibleRect.bottom,scrollY+winSize.height);
return visibleRect.top>=0&&visibleRect.left>=0&&visibleRect.bottom>visibleRect.top&&visibleRect.right>visibleRect.left?visibleRect:null}function getElFuturePos(elRegion,refNodeRegion,points,offset){var xy,diff,p1,p2;xy={left:elRegion.left,top:elRegion.top};p1=getAlignOffset(refNodeRegion,points[0]);p2=getAlignOffset(elRegion,points[1]);diff=[p2.left-p1.left,p2.top-p1.top];return{left:xy.left-diff[0]+(+offset[0]),top:xy.top-diff[1]+(+offset[1])}}function isFailX(elFuturePos,elRegion,visibleRect){return elFuturePos.left<visibleRect.left||elFuturePos.left+elRegion.width>visibleRect.right}function isFailY(elFuturePos,elRegion,visibleRect){return elFuturePos.top<visibleRect.top||elFuturePos.top+elRegion.height>visibleRect.bottom}function adjustForViewport(elFuturePos,elRegion,visibleRect,overflow){var pos=BUI.cloneObject(elFuturePos),size={width:elRegion.width,height:elRegion.height};if(overflow.adjustX&&pos.left<visibleRect.left){pos.left=visibleRect.left}if(overflow["resizeWidth"]&&pos.left>=visibleRect.left&&pos.left+size.width>visibleRect.right){size.width-=(pos.left+size.width)-visibleRect.right}if(overflow.adjustX&&pos.left+size.width>visibleRect.right){pos.left=Math.max(visibleRect.right-size.width,visibleRect.left)}if(overflow.adjustY&&pos.top<visibleRect.top){pos.top=visibleRect.top}if(overflow["resizeHeight"]&&pos.top>=visibleRect.top&&pos.top+size.height>visibleRect.bottom){size.height-=(pos.top+size.height)-visibleRect.bottom}if(overflow.adjustY&&pos.top+size.height>visibleRect.bottom){pos.top=Math.max(visibleRect.bottom-size.height,visibleRect.top)}return BUI.mix(pos,size)}function flip(points,reg,map){var ret=[];$.each(points,function(index,p){ret.push(p.replace(reg,function(m){return map[m]}))});return ret}function flipOffset(offset,index){offset[index]=-offset[index];return offset}function Align(){}Align.__getOffsetParent=getOffsetParent;Align.__getVisibleRectForElement=getVisibleRectForElement;Align.ATTRS={align:{shared:false,value:{}}};function getRegion(node){var offset,w,h;if(node.length&&!$.isWindow(node[0])){offset=node.offset();w=node.outerWidth();h=node.outerHeight()}else{offset={left:BUI.scrollLeft(),top:BUI.scrollTop()};w=BUI.viewportWidth();h=BUI.viewportHeight()}offset.width=w;offset.height=h;return offset}function getAlignOffset(region,align){var V=align.charAt(0),H=align.charAt(1),w=region.width,h=region.height,x,y;x=region.left;y=region.top;if(V==="c"){y+=h/2}else{if(V==="b"){y+=h}}if(H==="c"){x+=w/2}else{if(H==="r"){x+=w}}return{left:x,top:y}}function clearAlignCls(el){var cls=el.attr("class"),regex=new RegExp("s?"+CLS_ALIGN_PREFIX+"[a-z]{2}-[a-z]{2}","ig"),arr=regex.exec(cls);if(arr){el.removeClass(arr.join(" "))}}Align.prototype={_uiSetAlign:function(v,ev){var alignCls="",el,selfAlign;if(v&&v.points){this.align(v.node,v.points,v.offset,v.overflow);this.set("cachePosition",null);el=this.get("el");clearAlignCls(el);selfAlign=v.points.join("-");alignCls=CLS_ALIGN_PREFIX+selfAlign;el.addClass(alignCls)}},align:function(refNode,points,offset,overflow){refNode=$(refNode||win);offset=offset&&[].concat(offset)||[0,0];overflow=overflow||{};var self=this,el=self.get("el"),fail=0,visibleRect=getVisibleRectForElement(el[0]),elRegion=getRegion(el),refNodeRegion=getRegion(refNode),elFuturePos=getElFuturePos(elRegion,refNodeRegion,points,offset),newElRegion=BUI.merge(elRegion,elFuturePos);if(visibleRect&&(overflow.adjustX||overflow.adjustY)){if(isFailX(elFuturePos,elRegion,visibleRect)){fail=1;points=flip(points,/[lr]/ig,{l:"r",r:"l"});offset=flipOffset(offset,0)}if(isFailY(elFuturePos,elRegion,visibleRect)){fail=1;points=flip(points,/[tb]/ig,{t:"b",b:"t"});offset=flipOffset(offset,1)}if(fail){elFuturePos=getElFuturePos(elRegion,refNodeRegion,points,offset);BUI.mix(newElRegion,elFuturePos)}var newOverflowCfg={};newOverflowCfg.adjustX=overflow.adjustX&&isFailX(elFuturePos,elRegion,visibleRect);newOverflowCfg.adjustY=overflow.adjustY&&isFailY(elFuturePos,elRegion,visibleRect);if(newOverflowCfg.adjustX||newOverflowCfg.adjustY){newElRegion=adjustForViewport(elFuturePos,elRegion,visibleRect,newOverflowCfg)}}if(newElRegion.left!=elRegion.left){self.setInternal("x",null);self.get("view").setInternal("x",null);self.set("x",newElRegion.left)}if(newElRegion.top!=elRegion.top){self.setInternal("y",null);self.get("view").setInternal("y",null);self.set("y",newElRegion.top)}if(newElRegion.width!=elRegion.width){el.width(el.width()+newElRegion.width-elRegion.width)}if(newElRegion.height!=elRegion.height){el.height(el.height()+newElRegion.height-elRegion.height)}return self},center:function(node){var self=this;self.set("align",{node:node,points:["cc","cc"],offset:[0,0]});return self}};return Align});define("bui/component/uibase/autoshow",function(){function autoShow(){}autoShow.ATTRS={trigger:{},delegateTigger:{getter:function(){this.get("delegateTrigger")},setter:function(v){this.set("delegateTrigger",v)}},delegateTrigger:{value:false},autoAlign:{value:true},autoFocused:{value:true},triggerActiveCls:{},curTrigger:{},triggerCallback:{},triggerEvent:{value:"click"},triggerHideEvent:{},events:{value:{"triggerchange":false}}};
autoShow.prototype={__createDom:function(){this._setTrigger()},__bindUI:function(){var _self=this,triggerActiveCls=_self.get("triggerActiveCls");if(triggerActiveCls){_self.on("hide",function(){var curTrigger=_self.get("curTrigger");if(curTrigger){curTrigger.removeClass(triggerActiveCls)}})}},_setTrigger:function(){var _self=this,triggerEvent=_self.get("triggerEvent"),triggerHideEvent=_self.get("triggerHideEvent"),triggerCallback=_self.get("triggerCallback"),triggerActiveCls=_self.get("triggerActiveCls")||"",trigger=_self.get("trigger"),isDelegate=_self.get("delegateTrigger"),triggerEl=$(trigger);function tiggerShow(ev){var prevTrigger=_self.get("curTrigger"),curTrigger=isDelegate?$(ev.currentTarget):$(this),align=_self.get("align");if(!prevTrigger||prevTrigger[0]!=curTrigger[0]){if(prevTrigger){prevTrigger.removeClass(triggerActiveCls)}_self.set("curTrigger",curTrigger);_self.fire("triggerchange",{prevTrigger:prevTrigger,curTrigger:curTrigger})}curTrigger.addClass(triggerActiveCls);if(_self.get("autoAlign")){align.node=curTrigger}_self.set("align",align);_self.show();triggerCallback&&triggerCallback(ev)}function tiggerHide(ev){var toElement=ev.toElement||ev.relatedTarget;if(!toElement||!_self.containsElement(toElement)){_self.hide()}}if(triggerEvent){if(isDelegate&&BUI.isString(trigger)){$(document).delegate(trigger,triggerEvent,tiggerShow)}else{triggerEl.on(triggerEvent,tiggerShow)}}if(triggerHideEvent){if(isDelegate&&BUI.isString(trigger)){$(document).delegate(trigger,triggerHideEvent,tiggerHide)}else{triggerEl.on(triggerHideEvent,tiggerHide)}}},__renderUI:function(){var _self=this,align=_self.get("align");if(align&&!align.node){align.node=_self.get("render")||_self.get("trigger")}}};return autoShow});define("bui/component/uibase/autohide",function(){var wrapBehavior=BUI.wrapBehavior,getWrapBehavior=BUI.getWrapBehavior;function isExcept(self,elem){var hideExceptNode=self.get("hideExceptNode");if(hideExceptNode&&hideExceptNode.length){return $.contains(hideExceptNode[0],elem)}return false}function autoHide(){}autoHide.ATTRS={autoHideType:{value:"click"},autoHide:{value:false},hideExceptNode:{},events:{value:{autohide:false}}};autoHide.prototype={__bindUI:function(){var _self=this;_self.on("afterVisibleChange",function(ev){var visible=ev.newVal;if(_self.get("autoHide")){if(visible){_self._bindHideEvent()}else{_self._clearHideEvent()}}})},handleMoveOuter:function(ev){var _self=this,target=ev.toElement||ev.relatedTarget;if(!_self.containsElement(target)&&!isExcept(_self,target)){if(_self.fire("autohide")!==false){_self.hide()}}},handleDocumentClick:function(ev){var _self=this,target=ev.target;if(!_self.containsElement(target)&&!isExcept(_self,target)){if(_self.fire("autohide")!==false){_self.hide()}}},_bindHideEvent:function(){var _self=this,trigger=_self.get("curTrigger"),autoHideType=_self.get("autoHideType");if(autoHideType==="click"){$(document).on("mousedown",wrapBehavior(_self,"handleDocumentClick"))}else{_self.get("el").on("mouseleave",wrapBehavior(_self,"handleMoveOuter"));if(trigger){$(trigger).on("mouseleave",wrapBehavior(_self,"handleMoveOuter"))}}},_clearHideEvent:function(){var _self=this,trigger=_self.get("curTrigger"),autoHideType=_self.get("autoHideType");if(autoHideType==="click"){$(document).off("mousedown",getWrapBehavior(_self,"handleDocumentClick"))}else{_self.get("el").off("mouseleave",getWrapBehavior(_self,"handleMoveOuter"));if(trigger){$(trigger).off("mouseleave",getWrapBehavior(_self,"handleMoveOuter"))}}}};return autoHide});define("bui/component/uibase/close",function(){var CLS_PREFIX=BUI.prefix+"ext-";function getCloseRenderBtn(self){return $(self.get("closeTpl"))}function CloseView(){}CloseView.ATTRS={closeTpl:{value:"<a "+'tabindex="0" '+"href='javascript:void(\"\u5173\u95ed\")' "+'role="button" '+'class="'+CLS_PREFIX+"close"+'">'+'<span class="'+CLS_PREFIX+"close-x"+'">\u5173\u95ed<'+"/span>"+"<"+"/a>"},closeable:{value:true},closeBtn:{}};CloseView.prototype={_uiSetCloseable:function(v){var self=this,btn=self.get("closeBtn");if(v){if(!btn){self.setInternal("closeBtn",btn=getCloseRenderBtn(self))}btn.appendTo(self.get("el"),undefined)}else{if(btn){btn.remove()}}}};function Close(){}var HIDE="hide";Close.ATTRS={closeTpl:{view:true},closeable:{view:1},closeBtn:{view:1},closeAction:{value:HIDE}};var actions={hide:HIDE,destroy:"destroy",remove:"remove"};Close.prototype={_uiSetCloseable:function(v){var self=this;if(v&&!self.__bindCloseEvent){self.__bindCloseEvent=1;self.get("closeBtn").on("click",function(ev){if(self.fire("closeclick",{domTarget:ev.target})!==false){self.close()}ev.preventDefault()})}},__destructor:function(){var btn=this.get("closeBtn");btn&&btn.detach()},close:function(){var self=this,action=actions[self.get("closeAction")||HIDE];if(self.fire("closing",{action:action})!==false){self.fire("beforeclosed",{action:action});if(action=="remove"){self[action](true)}else{self[action]()}self.fire("closed",{action:action})}}};Close.View=CloseView;return Close});define("bui/component/uibase/drag",function(){var dragBackId=BUI.guid("drag");
var drag=function(){};drag.ATTRS={dragNode:{},draging:{setter:function(v){if(v===true){return{}}},value:null},constraint:{},dragBackEl:{getter:function(){return $("#"+dragBackId)}}};var dragTpl='<div id="'+dragBackId+'" style="background-color: red; position: fixed; left: 0px; width: 100%; height: 100%; top: 0px; cursor: move; z-index: 999999; display: none; "></div>';function initBack(){var el=$(dragTpl).css("opacity",0).prependTo("body");return el}drag.prototype={__bindUI:function(){var _self=this,constraint=_self.get("constraint"),dragNode=_self.get("dragNode");if(!dragNode){return}dragNode.on("mousedown",function(e){if(e.which==1){e.preventDefault();_self.set("draging",{elX:_self.get("x"),elY:_self.get("y"),startX:e.pageX,startY:e.pageY});registEvent()}});function mouseMove(e){var draging=_self.get("draging");if(draging){e.preventDefault();_self._dragMoveTo(e.pageX,e.pageY,draging,constraint)}}function mouseUp(e){if(e.which==1){_self.set("draging",false);var dragBackEl=_self.get("dragBackEl");if(dragBackEl){dragBackEl.hide()}unregistEvent()}}function registEvent(){$(document).on("mousemove",mouseMove);$(document).on("mouseup",mouseUp)}function unregistEvent(){$(document).off("mousemove",mouseMove);$(document).off("mouseup",mouseUp)}},_dragMoveTo:function(x,y,draging,constraint){var _self=this,dragBackEl=_self.get("dragBackEl"),draging=draging||_self.get("draging"),offsetX=draging.startX-x,offsetY=draging.startY-y;if(!dragBackEl.length){dragBackEl=initBack()}dragBackEl.css({cursor:"move",display:"block"});_self.set("xy",[_self._getConstrainX(draging.elX-offsetX,constraint),_self._getConstrainY(draging.elY-offsetY,constraint)])},_getConstrainX:function(x,constraint){var _self=this,width=_self.get("el").outerWidth(),endX=x+width,curX=_self.get("x");if(constraint){var constraintOffset=constraint.offset();if(constraintOffset.left>=x){return constraintOffset.left}if(constraintOffset.left+constraint.width()<endX){return constraintOffset.left+constraint.width()-width}return x}if(BUI.isInHorizontalView(x)&&BUI.isInHorizontalView(endX)){return x}return curX},_getConstrainY:function(y,constraint){var _self=this,height=_self.get("el").outerHeight(),endY=y+height,curY=_self.get("y");if(constraint){var constraintOffset=constraint.offset();if(constraintOffset.top>y){return constraintOffset.top}if(constraintOffset.top+constraint.height()<endY){return constraintOffset.top+constraint.height()-height}return y}if(BUI.isInVerticalView(y)&&BUI.isInVerticalView(endY)){return y}return curY}};return drag});define("bui/component/uibase/keynav",["bui/keycode"],function(require){var KeyCode=require("bui/keycode"),wrapBehavior=BUI.wrapBehavior,getWrapBehavior=BUI.getWrapBehavior;var keyNav=function(){};keyNav.ATTRS={allowKeyNav:{value:true},navEvent:{value:"keydown"},ignoreInputFields:{value:true}};keyNav.prototype={__bindUI:function(){},_uiSetAllowKeyNav:function(v){var _self=this,eventName=_self.get("navEvent"),el=_self.get("el");if(v){el.on(eventName,wrapBehavior(_self,"_handleKeyDown"))}else{el.off(eventName,getWrapBehavior(_self,"_handleKeyDown"))}},_handleKeyDown:function(ev){var _self=this,ignoreInputFields=_self.get("ignoreInputFields"),code=ev.which;if(ignoreInputFields&&$(ev.target).is("input,select,textarea")){return}switch(code){case KeyCode.UP:ev.preventDefault();_self.handleNavUp(ev);break;case KeyCode.DOWN:ev.preventDefault();_self.handleNavDown(ev);break;case KeyCode.RIGHT:ev.preventDefault();_self.handleNavRight(ev);break;case KeyCode.LEFT:ev.preventDefault();_self.handleNavLeft(ev);break;case KeyCode.ENTER:_self.handleNavEnter(ev);break;case KeyCode.ESC:_self.handleNavEsc(ev);break;case KeyCode.TAB:_self.handleNavTab(ev);break;default:break}},handleNavUp:function(ev){},handleNavDown:function(ev){},handleNavLeft:function(ev){},handleNavRight:function(ev){},handleNavEnter:function(ev){},handleNavEsc:function(ev){},handleNavTab:function(ev){}};return keyNav});define("bui/component/uibase/mask",function(require){var UA=require("bui/ua"),maskMap={},ie6=UA.ie==6;function getMaskCls(self){return self.get("prefixCls")+"ext-mask"}function docWidth(){return ie6?BUI.docWidth()+"px":"100%"}function docHeight(){return ie6?BUI.docHeight()+"px":"100%"}function initMask(maskCls){var mask=$("<div "+' style="width:'+docWidth()+";"+"left:0;"+"top:0;"+"height:"+docHeight()+";"+"position:"+(ie6?"absolute":"fixed")+';"'+' class="'+maskCls+'">'+(ie6?"<"+"iframe "+'style="position:absolute;'+"left:"+"0"+";"+"top:"+"0"+";"+"background:white;"+"width: expression(this.parentNode.offsetWidth);"+"height: expression(this.parentNode.offsetHeight);"+"filter:alpha(opacity=0);"+'z-index:-1;"></iframe>':"")+"</div>").prependTo("body");mask.on("mousedown",function(e){e.preventDefault()});return mask}function MaskView(){}MaskView.ATTRS={maskShared:{value:true}};MaskView.prototype={_maskExtShow:function(){var self=this,zIndex,maskCls=getMaskCls(self),maskDesc=maskMap[maskCls],maskShared=self.get("maskShared"),mask=self.get("maskNode");if(!mask){if(maskShared){if(maskDesc){mask=maskDesc.node
}else{mask=initMask(maskCls);maskDesc=maskMap[maskCls]={num:0,node:mask}}}else{mask=initMask(maskCls)}self.setInternal("maskNode",mask)}if(zIndex=self.get("zIndex")){mask.css("z-index",zIndex-1)}if(maskShared){maskDesc.num++}if(!maskShared||maskDesc.num==1){mask.show()}$("body").addClass("x-masked-relative")},_maskExtHide:function(){var self=this,maskCls=getMaskCls(self),maskDesc=maskMap[maskCls],maskShared=self.get("maskShared"),mask=self.get("maskNode");if(maskShared&&maskDesc){maskDesc.num=Math.max(maskDesc.num-1,0);if(maskDesc.num==0){mask.hide()}}else{if(mask){mask.hide()}}$("body").removeClass("x-masked-relative")},__destructor:function(){var self=this,maskShared=self.get("maskShared"),mask=self.get("maskNode");if(self.get("maskNode")){if(maskShared){if(self.get("visible")){self._maskExtHide()}}else{mask.remove()}}}};function Mask(){}Mask.ATTRS={mask:{value:false},maskNode:{view:1},maskShared:{view:1}};Mask.prototype={__bindUI:function(){var self=this,view=self.get("view"),_maskExtShow=view._maskExtShow,_maskExtHide=view._maskExtHide;if(self.get("mask")){self.on("show",function(){view._maskExtShow()});self.on("hide",function(){view._maskExtHide()})}}};Mask=Mask;Mask.View=MaskView;return Mask});define("bui/component/uibase/position",function(){function PositionView(){}PositionView.ATTRS={x:{valueFn:function(){var self=this;return self.get("el")&&self.get("el").offset().left}},y:{valueFn:function(){var self=this;return self.get("el")&&self.get("el").offset().top}},zIndex:{},visibleMode:{value:"visibility"}};PositionView.prototype={__createDom:function(){this.get("el").addClass(BUI.prefix+"ext-position")},_uiSetZIndex:function(x){this.get("el").css("z-index",x)},_uiSetX:function(x){if(x!=null){this.get("el").offset({left:x})}},_uiSetY:function(y){if(y!=null){this.get("el").offset({top:y})}},_uiSetLeft:function(left){if(left!=null){this.get("el").css({left:left})}},_uiSetTop:function(top){if(top!=null){this.get("el").css({top:top})}}};function Position(){}Position.ATTRS={x:{view:1},y:{view:1},left:{view:1},top:{view:1},xy:{setter:function(v){var self=this,xy=$.makeArray(v);if(xy.length){xy[0]&&self.set("x",xy[0]);xy[1]&&self.set("y",xy[1])}return v},getter:function(){return[this.get("x"),this.get("y")]}},zIndex:{view:1},visible:{view:true,value:true}};Position.prototype={move:function(x,y){var self=this;if(BUI.isArray(x)){y=x[1];x=x[0]}self.set("xy",[x,y]);return self},_uiSetX:function(v){if(v!=null){var _self=this,el=_self.get("el");_self.setInternal("left",el.position().left);if(v!=-999){this.set("cachePosition",null)}}},_uiSetY:function(v){if(v!=null){var _self=this,el=_self.get("el");_self.setInternal("top",el.position().top);if(v!=-999){this.set("cachePosition",null)}}},_uiSetLeft:function(v){var _self=this,el=_self.get("el");if(v!=null){_self.setInternal("x",el.offset().left)}},_uiSetTop:function(v){var _self=this,el=_self.get("el");if(v!=null){_self.setInternal("y",el.offset().top)}}};Position.View=PositionView;return Position});define("bui/component/uibase/listitem",function(){function listItemView(){}listItemView.ATTRS={selected:{}};listItemView.prototype={_uiSetSelected:function(v){var _self=this,cls=_self.getStatusCls("selected"),el=_self.get("el");if(v){el.addClass(cls)}else{el.removeClass(cls)}}};function listItem(){}listItem.ATTRS={selectable:{value:true},selected:{view:true,sync:false,value:false}};listItem.prototype={};listItem.View=listItemView;return listItem});define("bui/component/uibase/stdmod",function(){var CLS_PREFIX=BUI.prefix+"stdmod-";function StdModView(){}StdModView.ATTRS={header:{},body:{},footer:{},bodyStyle:{},footerStyle:{},headerStyle:{},headerContent:{},bodyContent:{},footerContent:{}};StdModView.PARSER={header:function(el){return el.one("."+CLS_PREFIX+"header")},body:function(el){return el.one("."+CLS_PREFIX+"body")},footer:function(el){return el.one("."+CLS_PREFIX+"footer")}};function createUI(self,part){var el=self.get("contentEl"),partEl=self.get(part);if(!partEl){partEl=$('<div class="'+CLS_PREFIX+part+'"'+" "+" >"+"</div>");partEl.appendTo(el);self.setInternal(part,partEl)}}function _setStdModRenderContent(self,part,v){part=self.get(part);if(BUI.isString(v)){part.html(v)}else{part.html("").append(v)}}StdModView.prototype={__createDom:function(){createUI(this,"header");createUI(this,"body");createUI(this,"footer")},_uiSetBodyStyle:function(v){this.get("body").css(v)},_uiSetHeaderStyle:function(v){this.get("header").css(v)},_uiSetFooterStyle:function(v){this.get("footer").css(v)},_uiSetBodyContent:function(v){_setStdModRenderContent(this,"body",v)},_uiSetHeaderContent:function(v){_setStdModRenderContent(this,"header",v)},_uiSetFooterContent:function(v){_setStdModRenderContent(this,"footer",v)}};function StdMod(){}StdMod.ATTRS={header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{view:1},footerStyle:{view:1},headerStyle:{view:1},headerContent:{view:1},bodyContent:{view:1},footerContent:{view:1}};StdMod.View=StdModView;return StdMod});define("bui/component/uibase/decorate",["bui/array","bui/json","bui/component/manage"],function(require){var ArrayUtil=require("bui/array"),JSON=require("bui/json"),prefixCls=BUI.prefix,FIELD_PREFIX="data-",FIELD_CFG=FIELD_PREFIX+"cfg",PARSER="PARSER",Manager=require("bui/component/manage"),regx=/^[\{\[]/;
function isConfigField(name,cfgFields){if(cfgFields[name]){return true}var reg=new RegExp("^"+FIELD_PREFIX);if(name!==FIELD_CFG&&reg.test(name)){return true}return false}function collectConstructorChains(self){var constructorChains=[],c=self.constructor;while(c){constructorChains.push(c);c=c.superclass&&c.superclass.constructor}return constructorChains}function parseFieldValue(value){value=$.trim(value);if(regx.test(value)){value=JSON.looseParse(value)}return value}function setConfigFields(self,cfg){var userConfig=self.userConfig||{};for(var p in cfg){if(!(p in userConfig)){self.setInternal(p,cfg[p])}}}function applyParser(srcNode,parser){var self=this,p,v,userConfig=self.userConfig||{};for(p in parser){if(!(p in userConfig)){v=parser[p];if(BUI.isFunction(v)){self.setInternal(p,v.call(self,srcNode))}else{if(typeof v=="string"){self.setInternal(p,srcNode.find(v))}else{if(BUI.isArray(v)&&v[0]){self.setInternal(p,srcNode.find(v[0]))}}}}}}function initParser(self,srcNode){var c=self.constructor,len,p,constructorChains;constructorChains=collectConstructorChains(self);for(len=constructorChains.length-1;len>=0;len--){c=constructorChains[len];if(p=c[PARSER]){applyParser.call(self,srcNode,p)}}}function initDecorate(self){var _self=self,srcNode=_self.get("srcNode"),userConfig,decorateCfg;if(srcNode){srcNode=$(srcNode);_self.setInternal("el",srcNode);_self.setInternal("srcNode",srcNode);userConfig=_self.get("userConfig");decorateCfg=_self.getDecorateConfig(srcNode);setConfigFields(self,decorateCfg);if(_self.get("isDecorateChild")&&_self.decorateInternal){_self.decorateInternal(srcNode)}initParser(self,srcNode)}}function decorate(){initDecorate(this)}decorate.ATTRS={srcNode:{view:true},isDecorateChild:{value:false},decorateCfgFields:{value:{"id":true,"name":true,"value":true,"title":true}}};decorate.prototype={getDecorateConfig:function(el){if(!el.length){return null}var _self=this,dom=el[0],attributes=dom.attributes,decorateCfgFields=_self.get("decorateCfgFields"),config={},statusCfg=_self._getStautsCfg(el);BUI.each(attributes,function(attr){var name=attr.nodeName;try{if(name===FIELD_CFG){var cfg=parseFieldValue(attr.nodeValue);BUI.mix(config,cfg)}else{if(isConfigField(name,decorateCfgFields)){name=name.replace(FIELD_PREFIX,"");var value=parseFieldValue(attr.nodeValue);if(config[name]&&BUI.isObject(value)){BUI.mix(config[name],value)}else{config[name]=value}}}}catch(e){BUI.log("parse field error,the attribute is:"+name)}});return BUI.mix(config,statusCfg)},_getStautsCfg:function(el){var _self=this,rst={},statusCls=_self.get("statusCls");BUI.each(statusCls,function(v,k){if(el.hasClass(v)){rst[k]=true}});return rst},getDecorateElments:function(){var _self=this,el=_self.get("el"),contentContainer=_self.get("childContainer");if(contentContainer){return el.find(contentContainer).children()}else{return el.children()}},decorateInternal:function(el){var self=this;self.decorateChildren(el)},findXClassByNode:function(childNode,ignoreError){var _self=this,cls=childNode.attr("class")||"",childClass=_self.get("defaultChildClass");cls=cls.replace(new RegExp("\\b"+prefixCls,"ig"),"");var UI=Manager.getConstructorByXClass(cls)||Manager.getConstructorByXClass(childClass);if(!UI&&!ignoreError){BUI.log(childNode);BUI.error("can not find ui "+cls+" from this markup")}return Manager.getXClassByConstructor(UI)},decorateChildrenInternal:function(xclass,c){var _self=this,children=_self.get("children");children.push({xclass:xclass,srcNode:c})},decorateChildren:function(el){var _self=this,children=_self.getDecorateElments();BUI.each(children,function(c){var xclass=_self.findXClassByNode($(c));_self.decorateChildrenInternal(xclass,$(c))})}};return decorate});define("bui/component/uibase/tpl",function(){function tplView(){}tplView.ATTRS={tpl:{},tplEl:{}};tplView.prototype={__renderUI:function(){var _self=this,contentContainer=_self.get("childContainer"),contentEl;if(contentContainer){contentEl=_self.get("el").find(contentContainer);if(contentEl.length){_self.set("contentEl",contentEl)}}},getTpl:function(attrs){var _self=this,tpl=_self.get("tpl"),tplRender=_self.get("tplRender");attrs=attrs||_self.getAttrVals();if(tplRender){return tplRender(attrs)}if(tpl){return BUI.substitute(tpl,attrs)}return""},setTplContent:function(attrs){var _self=this,el=_self.get("el"),content=_self.get("content"),tplEl=_self.get("tplEl"),tpl=_self.getTpl(attrs);if(!content&&tpl){el.empty();el.html(tpl)}}};function tpl(){}tpl.ATTRS={tpl:{view:true,sync:false},tplRender:{view:true,value:null},childContainer:{view:true}};tpl.prototype={__renderUI:function(){if(!this.get("srcNode")){this.setTplContent()}},updateContent:function(){this.setTplContent()},setTplContent:function(){var _self=this,attrs=_self.getAttrVals();_self.get("view").setTplContent(attrs)},_uiSetTpl:function(){this.setTplContent()}};tpl.View=tplView;return tpl});define("bui/component/uibase/collapsable",function(){var collapsableView=function(){};collapsableView.ATTRS={collapsed:{}};collapsableView.prototype={_uiSetCollapsed:function(v){var _self=this,cls=_self.getStatusCls("collapsed"),el=_self.get("el");
if(v){el.addClass(cls)}else{el.removeClass(cls)}}};var collapsable=function(){};collapsable.ATTRS={collapsable:{value:false},collapsed:{view:true,value:false},events:{value:{"expanded":true,"collapsed":true}}};collapsable.prototype={_uiSetCollapsed:function(v){var _self=this;if(v){_self.fire("collapsed")}else{_self.fire("expanded")}}};collapsable.View=collapsableView;return collapsable});define("bui/component/uibase/selection",function(){var SINGLE_SELECTED="single";var selection=function(){};selection.ATTRS={selectedEvent:{value:"click"},events:{value:{"selectedchange":false,"beforeselectedchange":false,"itemselected":false,"itemunselected":false}},idField:{value:"id"},multipleSelect:{value:false}};selection.prototype={clearSelection:function(){var _self=this,selection=_self.getSelection();BUI.each(selection,function(item){_self.clearSelected(item)})},getSelection:function(){},getSelected:function(){return this.getSelection()[0]},getSelectedValue:function(){var _self=this,field=_self.get("idField"),item=_self.getSelected();return _self.getValueByField(item,field)},getSelectionValues:function(){var _self=this,field=_self.get("idField"),items=_self.getSelection();return $.map(items,function(item){return _self.getValueByField(item,field)})},getSelectionText:function(){var _self=this,items=_self.getSelection();return $.map(items,function(item){return _self.getItemText(item)})},clearSelected:function(item){var _self=this;item=item||_self.getSelected();if(item){_self.setItemSelected(item,false)}},getSelectedText:function(){var _self=this,item=_self.getSelected();return _self.getItemText(item)},setSelection:function(items){var _self=this;items=BUI.isArray(items)?items:[items];BUI.each(items,function(item){_self.setSelected(item)})},setSelected:function(item){var _self=this,multipleSelect=_self.get("multipleSelect");if(!_self.isItemSelectable(item)){return}if(!multipleSelect){var selectedItem=_self.getSelected();if(item!=selectedItem){_self.clearSelected(selectedItem)}}_self.setItemSelected(item,true)},isItemSelected:function(item){},isItemSelectable:function(item){return true},setItemSelected:function(item,selected){var _self=this,isSelected;if(item){isSelected=_self.isItemSelected(item);if(isSelected==selected){return}}if(_self.fire("beforeselectedchange",{item:item,selected:selected})!==false){_self.setItemSelectedStatus(item,selected)}},setItemSelectedStatus:function(item,selected){},setAllSelection:function(){},setSelectedByField:function(field,value){if(!value){value=field;field=this.get("idField")}var _self=this,item=_self.findItemByField(field,value);_self.setSelected(item)},setSelectionByField:function(field,values){if(!values){values=field;field=this.get("idField")}var _self=this;BUI.each(values,function(value){_self.setSelectedByField(field,value)})},afterSelected:function(item,selected,element){var _self=this;if(selected){_self.fire("itemselected",{item:item,domTarget:element});_self.fire("selectedchange",{item:item,domTarget:element,selected:selected})}else{_self.fire("itemunselected",{item:item,domTarget:element});if(_self.get("multipleSelect")){_self.fire("selectedchange",{item:item,domTarget:element,selected:selected})}}}};return selection});define("bui/component/uibase/list",["bui/component/uibase/selection"],function(require){var Selection=require("bui/component/uibase/selection");var list=function(){};list.ATTRS={items:{shared:false,view:true},idField:{value:"id"},itemTpl:{view:true},itemTplRender:{view:true},itemStatusCls:{view:true,value:{}},events:{value:{"itemclick":true}}};list.prototype={getItemCount:function(){return this.getItems().length},getValueByField:function(item,field){},getItems:function(){},getFirstItem:function(){return this.getItemAt(0)},getLastItem:function(){return this.getItemAt(this.getItemCount()-1)},getItemAt:function(index){return this.getItems()[index]||null},getItem:function(id){var field=this.get("idField");return this.findItemByField(field,id)},indexOfItem:function(item){return BUI.Array.indexOf(item,this.getItems())},addItems:function(items){var _self=this;BUI.each(items,function(item){_self.addItem(item)})},addItemsAt:function(items,start){var _self=this;BUI.each(items,function(item,index){_self.addItemAt(item,start+index)})},updateItem:function(item){},addItem:function(item){return this.addItemAt(item,this.getItemCount())},addItemAt:function(item,index){},findItemByField:function(field,value){},getItemText:function(item){},clearItems:function(){var _self=this,items=_self.getItems();items.splice(0);_self.clearControl()},removeItem:function(item){},removeItems:function(items){var _self=this;BUI.each(items,function(item){_self.removeItem(item)})},removeItemAt:function(index){this.removeItem(this.getItemAt(index))},clearControl:function(){}};function clearSelected(item){if(item.selected){item.selected=false}if(item.set){item.set("selected",false)}}function beforeAddItem(self,item){var c=item.isController?item.getAttrVals():item,defaultTpl=self.get("itemTpl"),defaultStatusCls=self.get("itemStatusCls"),defaultTplRender=self.get("itemTplRender");
if(defaultTpl&&!c.tpl){setItemAttr(item,"tpl",defaultTpl)}if(defaultTplRender&&!c.tplRender){setItemAttr(item,"tplRender",defaultTplRender)}if(defaultStatusCls){var statusCls=c.statusCls||item.isController?item.get("statusCls"):{};BUI.each(defaultStatusCls,function(v,k){if(v&&!statusCls[k]){statusCls[k]=v}});setItemAttr(item,"statusCls",statusCls)}}function setItemAttr(item,name,val){if(item.isController){item.set(name,val)}else{item[name]=val}}var childList=function(){this.__init()};childList.ATTRS=BUI.merge(true,list.ATTRS,Selection.ATTRS,{items:{sync:false},autoInitItems:{value:true},isDecorateChild:{value:true},defaultLoaderCfg:{value:{property:"children",dataType:"json"}}});BUI.augment(childList,list,Selection,{__init:function(){var _self=this,items=_self.get("items");if(items&&_self.get("autoInitItems")){_self.addItems(items)}_self.on("beforeRenderUI",function(){_self._beforeRenderUI()})},_uiSetItems:function(items){var _self=this;_self.clearControl();_self.addItems(items)},_beforeRenderUI:function(){var _self=this,children=_self.get("children"),items=_self.get("items");BUI.each(children,function(item){beforeAddItem(_self,item)})},__bindUI:function(){var _self=this,selectedEvent=_self.get("selectedEvent");_self.on(selectedEvent,function(e){var item=e.target;if(item.get("selectable")){if(!item.get("selected")){_self.setSelected(item)}else{if(_self.get("multipleSelect")){_self.clearSelected(item)}}}});_self.on("click",function(e){if(e.target!==_self){_self.fire("itemclick",{item:e.target,domTarget:e.domTarget,domEvent:e})}});_self.on("beforeAddChild",function(ev){beforeAddItem(_self,ev.child)});_self.on("beforeRemoveChild",function(ev){var item=ev.child,selected=item.get("selected");if(selected){if(_self.get("multipleSelect")){_self.clearSelected(item)}else{_self.setSelected(null)}}item.set("selected",false)})},clearControl:function(){this.removeChildren(true)},getItems:function(){return this.get("children")},updateItem:function(item){var _self=this,idField=_self.get("idField"),element=_self.findItemByField(idField,item[idField]);if(element){element.setTplContent()}return element},removeItem:function(item){var _self=this,idField=_self.get("idField");if(!(item instanceof BUI.Component.Controller)){item=_self.findItemByField(idField,item[idField])}this.removeChild(item,true)},addItemAt:function(item,index){return this.addChild(item,index)},findItemByField:function(field,value,root){root=root||this;var _self=this,children=root.get("children"),result=null;$(children).each(function(index,item){if(item.get(field)==value){result=item}else{if(item.get("children").length){result=_self.findItemByField(field,value,item)}}if(result){return false}});return result},getItemText:function(item){return item.get("el").text()},getValueByField:function(item,field){return item&&item.get(field)},setItemSelectedStatus:function(item,selected){var _self=this,method=selected?"addClass":"removeClass",element=null;if(item){item.set("selected",selected);element=item.get("el")}_self.afterSelected(item,selected,element)},isItemSelected:function(item){return item?item.get("selected"):false},setAllSelection:function(){var _self=this,items=_self.getItems();_self.setSelection(items)},getSelection:function(){var _self=this,items=_self.getItems(),rst=[];BUI.each(items,function(item){if(_self.isItemSelected(item)){rst.push(item)}});return rst}});list.ChildList=childList;return list});define("bui/component/uibase/childcfg",function(require){var childCfg=function(config){this._init()};childCfg.ATTRS={defaultChildCfg:{}};childCfg.prototype={_init:function(){var _self=this,defaultChildCfg=_self.get("defaultChildCfg");if(defaultChildCfg){_self.on("beforeAddChild",function(ev){var child=ev.child;if($.isPlainObject(child)){BUI.each(defaultChildCfg,function(v,k){if(child[k]==null){child[k]=v}})}})}}};return childCfg});define("bui/component/uibase/depends",["bui/component/manage"],function(require){var regexp=/^#(.*):(.*)$/,Manager=require("bui/component/manage");function getDepend(name){var arr=regexp.exec(name),id=arr[1],eventType=arr[2],source=getSource(id);return{source:source,eventType:eventType}}function bindDepend(self,name,action){var depend=getDepend(name),source=depend.source,eventType=depend.eventType,callbak;if(source&&action&&eventType){if(BUI.isFunction(action)){callbak=action}else{if(BUI.isArray(action)){callbak=function(){BUI.each(action,function(methodName){if(self[methodName]){self[methodName]()}})}}}}if(callbak){depend.callbak=callbak;source.on(eventType,callbak);return depend}return null}function offDepend(depend){var source=depend.source,eventType=depend.eventType,callbak=depend.callbak;source.off(eventType,callbak)}function getSource(id){var control=Manager.getComponent(id);if(!control){control=$("#"+id);if(!control.length){control=null}}return control}function Depends(){}Depends.ATTRS={depends:{},dependencesMap:{shared:false,value:{}}};Depends.prototype={__syncUI:function(){this.initDependences()},initDependences:function(){var _self=this,depends=_self.get("depends");
BUI.each(depends,function(action,name){_self.addDependence(name,action)})},addDependence:function(name,action){var _self=this,dependencesMap=_self.get("dependencesMap"),depend;_self.removeDependence(name);depend=bindDepend(_self,name,action);if(depend){dependencesMap[name]=depend}},removeDependence:function(name){var _self=this,dependencesMap=_self.get("dependencesMap"),depend=dependencesMap[name];if(depend){offDepend(depend);delete dependencesMap[name]}},clearDependences:function(){var _self=this,map=_self.get("dependencesMap");BUI.each(map,function(depend,name){offDepend(depend)});_self.set("dependencesMap",{})},__destructor:function(){this.clearDependences()}};return Depends});define("bui/component/uibase/bindable",function(){function bindable(){}bindable.ATTRS={store:{},loadMask:{value:false}};BUI.augment(bindable,{__bindUI:function(){var _self=this,store=_self.get("store"),loadMask=_self.get("loadMask");if(!store){return}store.on("beforeload",function(e){_self.onBeforeLoad(e);if(loadMask&&loadMask.show){loadMask.show()}});store.on("load",function(e){_self.onLoad(e);if(loadMask&&loadMask.hide){loadMask.hide()}});store.on("exception",function(e){_self.onException(e);if(loadMask&&loadMask.hide){loadMask.hide()}});store.on("add",function(e){_self.onAdd(e)});store.on("remove",function(e){_self.onRemove(e)});store.on("update",function(e){_self.onUpdate(e)});store.on("localsort",function(e){_self.onLocalSort(e)})},__syncUI:function(){var _self=this,store=_self.get("store");if(!store){return}if(store.hasData()){_self.onLoad()}},onBeforeLoad:function(e){},onLoad:function(e){},onException:function(e){},onAdd:function(e){},onRemove:function(e){},onUpdate:function(e){},onLocalSort:function(e){}});return bindable});define("bui/component/view",["bui/component/manage","bui/component/uibase"],function(require){var win=window,Manager=require("bui/component/manage"),UIBase=require("bui/component/uibase"),doc=document;var View=UIBase.extend([UIBase.TplView],{getComponentCssClassWithState:function(state){var self=this,componentCls=self.get("ksComponentCss");state=state||"";return self.getCssClassWithPrefix(componentCls.split(/\s+/).join(state+" ")+state)},getCssClassWithPrefix:Manager.getCssClassWithPrefix,getKeyEventTarget:function(){return this.get("el")},getContentElement:function(){return this.get("contentEl")||this.get("el")},getStatusCls:function(name){var self=this,statusCls=self.get("statusCls"),cls=statusCls[name];if(!cls){cls=self.getComponentCssClassWithState("-"+name)}return cls},renderUI:function(){var self=this;if(!self.get("srcNode")){var render=self.get("render"),el=self.get("el"),renderBefore=self.get("elBefore");if(renderBefore){el.insertBefore(renderBefore,undefined)}else{if(render){el.appendTo(render,undefined)}else{el.appendTo(doc.body,undefined)}}}},createDom:function(){var self=this,contentEl=self.get("contentEl"),el=self.get("el");if(!self.get("srcNode")){el=$("<"+self.get("elTagName")+">");if(contentEl){el.append(contentEl)}self.setInternal("el",el)}el.addClass(self.getComponentCssClassWithState());if(!contentEl){self.setInternal("contentEl",el)}},_uiSetHighlighted:function(v){var self=this,componentCls=self.getStatusCls("hover"),el=self.get("el");el[v?"addClass":"removeClass"](componentCls)},_uiSetDisabled:function(v){var self=this,componentCls=self.getStatusCls("disabled"),el=self.get("el");el[v?"addClass":"removeClass"](componentCls).attr("aria-disabled",v);if(v&&self.get("highlighted")){self.set("highlighted",false)}if(self.get("focusable")){self.getKeyEventTarget().attr("tabIndex",v?-1:0)}},_uiSetActive:function(v){var self=this,componentCls=self.getStatusCls("active");self.get("el")[v?"addClass":"removeClass"](componentCls).attr("aria-pressed",!!v)},_uiSetFocused:function(v){var self=this,el=self.get("el"),componentCls=self.getStatusCls("focused");el[v?"addClass":"removeClass"](componentCls)},_uiSetElAttrs:function(attrs){this.get("el").attr(attrs)},_uiSetElCls:function(cls){this.get("el").addClass(cls)},_uiSetElStyle:function(style){this.get("el").css(style)},_uiSetRole:function(role){if(role){this.get("el").attr("role",role)}},_uiSetWidth:function(w){this.get("el").width(w)},_uiSetHeight:function(h){var self=this;self.get("el").height(h)},_uiSetContent:function(c){var self=this,el;if(self.get("srcNode")&&!self.get("rendered")){}else{el=self.get("contentEl");if(typeof c=="string"){el.html(c)}else{if(c){el.empty().append(c)}}}},_uiSetVisible:function(isVisible){var self=this,el=self.get("el"),visibleMode=self.get("visibleMode");if(visibleMode==="visibility"){el.css("visibility",isVisible?"visible":"hidden")}else{el.css("display",isVisible?"":"none")}},set:function(name,value){var _self=this,attr=_self.__attrs[name],ev,ucName,m;if(!attr||!_self.get("binded")){View.superclass.set.call(this,name,value);return _self}var prevVal=View.superclass.get.call(this,name);if(!$.isPlainObject(value)&&!BUI.isArray(value)&&prevVal===value){return _self}View.superclass.set.call(this,name,value);value=_self.__attrVals[name];
ev={attrName:name,prevVal:prevVal,newVal:value};ucName=BUI.ucfirst(name);m="_uiSet"+ucName;if(_self[m]){_self[m](value,ev)}return _self},destructor:function(){var el=this.get("el");if(el){el.remove()}}},{xclass:"view",priority:0});View.ATTRS={el:{setter:function(v){return $(v)}},elCls:{},elStyle:{},role:{},width:{},height:{},statusCls:{value:{}},elTagName:{value:"div"},elAttrs:{},content:{},elBefore:{},render:{},visible:{value:true},visibleMode:{value:"display"},cachePosition:{},contentEl:{valueFn:function(){return this.get("el")}},prefixCls:{value:BUI.prefix},focusable:{value:true},focused:{},active:{},disabled:{},highlighted:{}};return View});define("bui/component/loader",["bui/util"],function(require){var BUI=require("bui/util"),Base=require("bui/base"),Loader=function(config){Loader.superclass.constructor.call(this,config);this._init()};Loader.ATTRS={url:{},target:{},hasLoad:{value:false},autoLoad:{},lazyLoad:{},property:{},renderer:{value:function(value){return value}},loadMask:{value:false},dataType:{value:"text"},ajaxOptions:{value:{type:"get",cache:false}},params:{},appendParams:{},lastParams:{shared:false,value:{}},callback:{},failure:{}};BUI.extend(Loader,Base);BUI.augment(Loader,{isLoader:true,_init:function(){var _self=this,autoLoad=_self.get("autoLoad"),params=_self.get("params");_self._initMask();if(autoLoad){_self.load(params)}else{_self._initParams();_self._initLazyLoad()}},_initLazyLoad:function(){var _self=this,target=_self.get("target"),lazyLoad=_self.get("lazyLoad");if(target&&lazyLoad&&lazyLoad.event){target.on(lazyLoad.event,function(){if(!_self.get("hasLoad")||lazyLoad.repeat){_self.load()}})}},_initMask:function(){var _self=this,target=_self.get("target"),loadMask=_self.get("loadMask");if(target&&loadMask){BUI.use("bui/mask",function(Mask){var cfg=$.isPlainObject(loadMask)?loadMask:{};loadMask=new Mask.LoadMask(BUI.mix({el:target.get("el")},cfg));_self.set("loadMask",loadMask)})}},_initParams:function(){var _self=this,lastParams=_self.get("lastParams"),params=_self.get("params");BUI.mix(lastParams,params)},load:function(params){var _self=this,url=_self.get("url"),ajaxOptions=_self.get("ajaxOptions"),lastParams=_self.get("lastParams"),appendParams=_self.get("appendParams");params=params||lastParams;params=BUI.merge(appendParams,params);_self.set("lastParams",params);if(!url){return}_self.onBeforeLoad();_self.set("hasLoad",true);$.ajax(BUI.mix({dataType:_self.get("dataType"),data:params,url:url,success:function(data){_self.onload(data,params)},error:function(jqXHR,textStatus,errorThrown){_self.onException({jqXHR:jqXHR,textStatus:textStatus,errorThrown:errorThrown},params)}},ajaxOptions))},onBeforeLoad:function(){var _self=this,loadMask=_self.get("loadMask");if(loadMask&&loadMask.show){loadMask.show()}},onload:function(data,params){var _self=this,loadMask=_self.get("loadMask"),property=_self.get("property"),callback=_self.get("callback"),renderer=_self.get("renderer"),target=_self.get("target");target.set(property,renderer.call(_self,data));if(loadMask&&loadMask.hide){loadMask.hide()}if(callback){callback.call(this,data,params)}},onException:function(response,params){var _self=this,failure=_self.get("failure");if(failure){failure.call(this,response,params)}}});return Loader});define("bui/component/controller",["bui/component/uibase","bui/component/manage","bui/component/view","bui/component/loader"],function(require){var UIBase=require("bui/component/uibase"),Manager=require("bui/component/manage"),View=require("bui/component/view"),Loader=require("bui/component/loader"),wrapBehavior=BUI.wrapBehavior,getWrapBehavior=BUI.getWrapBehavior;function wrapperViewSetter(attrName){return function(ev){var self=this;if(self===ev.target){var value=ev.newVal,view=self.get("view");if(view){view.set(attrName,value)}}}}function wrapperViewGetter(attrName){return function(v){var self=this,view=self.get("view");return v===undefined?view.get(attrName):v}}function initChild(self,c,renderBefore){self.create();var contentEl=self.getContentElement(),defaultCls=self.get("defaultChildClass");if(!c.xclass&&!(c instanceof Controller)){if(!c.xtype){c.xclass=defaultCls}else{c.xclass=defaultCls+"-"+c.xtype}}c=BUI.Component.create(c,self);c.setInternal("parent",self);c.set("render",contentEl);c.set("elBefore",renderBefore);c.create(undefined);return c}function constructView(self){var attrs,attrCfg,attrName,cfg={},v,Render=self.get("xview");attrs=self.getAttrs();for(attrName in attrs){if(attrs.hasOwnProperty(attrName)){attrCfg=attrs[attrName];if(attrCfg.view){if((v=self.get(attrName))!==undefined){cfg[attrName]=v}}}}delete cfg.autoRender;cfg.ksComponentCss=getComponentCss(self);return new Render(cfg)}function getComponentCss(self){var constructor=self.constructor,cls,re=[];while(constructor&&constructor!==Controller){cls=Manager.getXClassByConstructor(constructor);if(cls){re.push(cls)}constructor=constructor.superclass&&constructor.superclass.constructor}return re.join(" ")}function isMouseEventWithinElement(e,elem){var relatedTarget=e.relatedTarget;
return relatedTarget&&(relatedTarget===elem[0]||$.contains(elem,relatedTarget))}var Controller=UIBase.extend([UIBase.Decorate,UIBase.Tpl,UIBase.ChildCfg,UIBase.KeyNav,UIBase.Depends],{isController:true,getCssClassWithPrefix:Manager.getCssClassWithPrefix,initializer:function(){var self=this;if(!self.get("id")){self.set("id",self.getNextUniqueId())}Manager.addComponent(self.get("id"),self);var view=constructView(self);self.setInternal("view",view);self.__view=view},getNextUniqueId:function(){var self=this,xclass=Manager.getXClassByConstructor(self.constructor);return BUI.guid(xclass)},createDom:function(){var self=this,view=self.get("view");view.create(undefined)},renderUI:function(){var self=this,loader=self.get("loader");self.get("view").render();self._initChildren();if(loader){self.setInternal("loader",loader)}},_initChildren:function(children){var self=this,i,children,child;children=children||self.get("children").concat();self.get("children").length=0;for(i=0;i<children.length;i++){child=self.addChild(children[i]);child.render()}},bindUI:function(){var self=this,events=self.get("events");this.on("afterVisibleChange",function(e){this.fire(e.newVal?"show":"hide")});BUI.each(events,function(v,k){self.publish(k,{bubbles:v})})},containsElement:function(elem){var _self=this,el=_self.get("el"),children=_self.get("children"),result=false;if(!_self.get("rendered")){return false}if($.contains(el[0],elem)||el[0]===elem){result=true}else{BUI.each(children,function(item){if(item.containsElement(elem)){result=true;return false}})}return result},isChildrenElement:function(elem){var _self=this,children=_self.get("children"),rst=false;BUI.each(children,function(child){if(child.containsElement(elem)){rst=true;return false}});return rst},show:function(){var self=this;self.render();self.set("visible",true);return self},hide:function(){var self=this;self.set("visible",false);return self},toggle:function(){this.set("visible",!this.get("visible"));return this},_uiSetFocusable:function(focusable){var self=this,t,el=self.getKeyEventTarget();if(focusable){el.attr("tabIndex",0).attr("hideFocus",true).on("focus",wrapBehavior(self,"handleFocus")).on("blur",wrapBehavior(self,"handleBlur")).on("keydown",wrapBehavior(self,"handleKeydown")).on("keyup",wrapBehavior(self,"handleKeyUp"))}else{el.removeAttr("tabIndex");if(t=getWrapBehavior(self,"handleFocus")){el.off("focus",t)}if(t=getWrapBehavior(self,"handleBlur")){el.off("blur",t)}if(t=getWrapBehavior(self,"handleKeydown")){el.off("keydown",t)}if(t=getWrapBehavior(self,"handleKeyUp")){el.off("keyup",t)}}},_uiSetHandleMouseEvents:function(handleMouseEvents){var self=this,el=self.get("el"),t;if(handleMouseEvents){el.on("mouseenter",wrapBehavior(self,"handleMouseEnter")).on("mouseleave",wrapBehavior(self,"handleMouseLeave")).on("contextmenu",wrapBehavior(self,"handleContextMenu")).on("mousedown",wrapBehavior(self,"handleMouseDown")).on("mouseup",wrapBehavior(self,"handleMouseUp")).on("dblclick",wrapBehavior(self,"handleDblClick"))}else{t=getWrapBehavior(self,"handleMouseEnter")&&el.off("mouseenter",t);t=getWrapBehavior(self,"handleMouseLeave")&&el.off("mouseleave",t);t=getWrapBehavior(self,"handleContextMenu")&&el.off("contextmenu",t);t=getWrapBehavior(self,"handleMouseDown")&&el.off("mousedown",t);t=getWrapBehavior(self,"handleMouseUp")&&el.off("mouseup",t);t=getWrapBehavior(self,"handleDblClick")&&el.off("dblclick",t)}},_uiSetFocused:function(v){if(v){this.getKeyEventTarget()[0].focus()}},_uiSetVisible:function(isVisible){var self=this,el=self.get("el"),visibleMode=self.get("visibleMode");if(visibleMode==="visibility"){if(isVisible){var position=self.get("cachePosition");if(position){self.set("xy",position)}}if(!isVisible){var position=[self.get("x"),self.get("y")];self.set("cachePosition",position);self.set("xy",[-999,-999])}}},_uiSetChildren:function(v){var self=this,children=BUI.cloneObject(v);self._initChildren(children)},enable:function(){this.set("disabled",false);return this},disable:function(){this.set("disabled",true);return this},focus:function(){if(this.get("focusable")){this.set("focused",true)}},getContentElement:function(){return this.get("view").getContentElement()},getKeyEventTarget:function(){return this.get("view").getKeyEventTarget()},addChild:function(c,index){var self=this,children=self.get("children"),renderBefore;if(index===undefined){index=children.length}self.fire("beforeAddChild",{child:c,index:index});renderBefore=children[index]&&children[index].get("el")||null;c=initChild(self,c,renderBefore);children.splice(index,0,c);if(self.get("rendered")){c.render()}self.fire("afterAddChild",{child:c,index:index});return c},remove:function(destroy){var self=this,parent=self.get("parent");if(parent){parent.removeChild(self,destroy)}else{if(destroy){self.destroy()}}return self},removeChild:function(c,destroy){var self=this,children=self.get("children"),index=BUI.Array.indexOf(c,children);if(index===-1){return}self.fire("beforeRemoveChild",{child:c,destroy:destroy});if(index!==-1){children.splice(index,1)
}if(destroy&&c.destroy){c.destroy()}self.fire("afterRemoveChild",{child:c,destroy:destroy});return c},removeChildren:function(destroy){var self=this,i,t=[].concat(self.get("children"));for(i=0;i<t.length;i++){self.removeChild(t[i],destroy)}},getChildAt:function(index){var children=this.get("children");return children[index]||null},getChild:function(id,deep){return this.getChildBy(function(item){return item.get("id")===id},deep)},getChildBy:function(math,deep){return this.getChildrenBy(math,deep)[0]||null},getAppendHeight:function(){var el=this.get("el");return el.outerHeight()-el.height()},getAppendWidth:function(){var el=this.get("el");return el.outerWidth()-el.width()},getChildrenBy:function(math,deep){var self=this,results=[];if(!math){return results}self.eachChild(function(child){if(math(child)){results.push(child)}else{if(deep){results=results.concat(child.getChildrenBy(math,deep))}}});return results},eachChild:function(func){BUI.each(this.get("children"),func)},handleDblClick:function(ev){this.performActionInternal(ev);if(!this.isChildrenElement(ev.target)){this.fire("dblclick",{domTarget:ev.target,domEvent:ev})}},handleMouseOver:function(ev){var self=this,el=self.get("el");if(!isMouseEventWithinElement(ev,el)){self.handleMouseEnter(ev)}},handleMouseOut:function(ev){var self=this,el=self.get("el");if(!isMouseEventWithinElement(ev,el)){self.handleMouseLeave(ev)}},handleMouseEnter:function(ev){var self=this;this.set("highlighted",!!ev);self.fire("mouseenter",{domTarget:ev.target,domEvent:ev})},handleMouseLeave:function(ev){var self=this;self.set("active",false);self.set("highlighted",!ev);self.fire("mouseleave",{domTarget:ev.target,domEvent:ev})},handleMouseDown:function(ev){var self=this,n,target=$(ev.target),isMouseActionButton=ev["which"]===1,el;if(isMouseActionButton){el=self.getKeyEventTarget();if(self.get("activeable")){self.set("active",true)}if(self.get("focusable")){self.setInternal("focused",true)}if(!self.get("allowTextSelection")){n=ev.target.nodeName;n=n&&n.toLowerCase();if(n!=="input"&&n!=="textarea"){ev.preventDefault()}}if(!self.isChildrenElement(ev.target)){self.fire("mousedown",{domTarget:ev.target,domEvent:ev})}}},handleMouseUp:function(ev){var self=this,isChildrenElement=self.isChildrenElement(ev.target);if(self.get("active")&&ev.which===1){self.performActionInternal(ev);self.set("active",false);if(!isChildrenElement){self.fire("click",{domTarget:ev.target,domEvent:ev})}}if(!isChildrenElement){self.fire("mouseup",{domTarget:ev.target,domEvent:ev})}},handleContextMenu:function(ev){},handleFocus:function(ev){this.set("focused",!!ev);this.fire("focus",{domEvent:ev,domTarget:ev.target})},handleBlur:function(ev){this.set("focused",!ev);this.fire("blur",{domEvent:ev,domTarget:ev.target})},handleKeyEventInternal:function(ev){var self=this,isChildrenElement=self.isChildrenElement(ev.target);if(ev.which===13){if(!isChildrenElement){self.fire("click",{domTarget:ev.target,domEvent:ev})}return this.performActionInternal(ev)}if(!isChildrenElement){self.fire("keydown",{domTarget:ev.target,domEvent:ev})}},handleKeydown:function(ev){var self=this;if(self.handleKeyEventInternal(ev)){ev.halt();return true}},handleKeyUp:function(ev){var self=this;if(!self.isChildrenElement(ev.target)){self.fire("keyup",{domTarget:ev.target,domEvent:ev})}},performActionInternal:function(ev){},destructor:function(){var self=this,id,i,view,children=self.get("children");id=self.get("id");for(i=0;i<children.length;i++){children[i].destroy&&children[i].destroy()}self.get("view").destroy();Manager.removeComponent(id)},set:function(name,value,opt){var _self=this,view=_self.__view,attr=_self.__attrs[name],ucName,ev,m;if(BUI.isObject(name)){opt=value;BUI.each(name,function(v,k){_self.set(k,v,opt)})}if(!view||!attr||(opt&&opt.silent)){Controller.superclass.set.call(this,name,value,opt);return _self}var prevVal=Controller.superclass.get.call(this,name);if(!$.isPlainObject(value)&&!BUI.isArray(value)&&prevVal===value){return _self}ucName=BUI.ucfirst(name);m="_uiSet"+ucName;_self.fire("before"+ucName+"Change",{attrName:name,prevVal:prevVal,newVal:value});_self.setInternal(name,value);value=_self.__attrVals[name];if(view&&attr.view){view.set(name,value)}ev={attrName:name,prevVal:prevVal,newVal:value};_self.fire("after"+ucName+"Change",ev);if(_self.get("binded")&&_self[m]){_self[m](value,ev)}return _self},get:function(name){var _self=this,view=_self.__view,attr=_self.__attrs[name],value=Controller.superclass.get.call(this,name);if(value!==undefined){return value}if(view&&attr&&attr.view){return view.get(name)}return value}},{ATTRS:{content:{view:1},elTagName:{view:true,value:"div"},defaultChildClass:{},xtype:{},id:{view:true},width:{view:1},height:{view:1},elCls:{view:1},elStyle:{view:1},elAttrs:{view:1},elBefore:{view:1},el:{view:1},events:{value:{"click":true,"dblclick":true,"mouseenter":true,"mouseleave":true,"keydown":true,"keyup":true,"focus":false,"blur":false,"mousedown":true,"mouseup":true,"show":false,"hide":false}},render:{view:1},role:{view:1},statusCls:{view:true,value:{}},visibleMode:{view:1,value:"display"},visible:{value:true,view:1},handleMouseEvents:{value:true},focusable:{value:false,view:1},defaultLoaderCfg:{value:{property:"content",autoLoad:true}},loader:{getter:function(v){var _self=this,defaultCfg;
if(v&&!v.isLoader){v.target=_self;defaultCfg=_self.get("defaultLoaderCfg");v=new Loader(BUI.merge(defaultCfg,v));_self.setInternal("loader",v)}return v}},allowTextSelection:{value:true},activeable:{value:true},focused:{view:1},active:{view:1},highlighted:{view:1},children:{sync:false,shared:false,value:[]},prefixCls:{value:BUI.prefix,view:1},parent:{setter:function(p){this.addTarget(p)}},disabled:{view:1,value:false},xview:{value:View}},PARSER:{visible:function(el){var _self=this,display=el.css("display"),visibility=el.css("visibility"),visibleMode=_self.get("visibleMode");if((display=="none"&&visibleMode=="display")||(visibility=="hidden"&&visibleMode=="visibility")){return false}return true}}},{xclass:"controller",priority:0});return Controller});define("bui/cookie",function(){var doc=document,MILLISECONDS_OF_DAY=24*60*60*1000,encode=encodeURIComponent,decode=decodeURIComponent;function isNotEmptyString(val){return typeof(val)==="string"&&val!==""}var Cookie={get:function(name){var ret,m;if(isNotEmptyString(name)){if((m=String(doc.cookie).match(new RegExp("(?:^| )"+name+"(?:(?:=([^;]*))|;|$)")))){ret=m[1]?decode(m[1]):""}}return ret},set:function(name,val,expires,domain,path,secure){var text=String(encode(val)),date=expires;if(typeof date==="number"){date=new Date();date.setTime(date.getTime()+expires*MILLISECONDS_OF_DAY)}if(date instanceof Date){text+="; expires="+date.toUTCString()}if(isNotEmptyString(domain)){text+="; domain="+domain}if(isNotEmptyString(path)){text+="; path="+path}if(secure){text+="; secure"}doc.cookie=name+"="+text},remove:function(name,domain,path,secure){this.set(name,"",-1,domain,path,secure)}};BUI.Cookie=Cookie;return Cookie});(function(){var BASE="bui/data/";define("bui/data",["bui/common",BASE+"sortable",BASE+"proxy",BASE+"abstractstore",BASE+"store",BASE+"node",BASE+"treestore"],function(r){var BUI=r("bui/common"),Data=BUI.namespace("Data");BUI.mix(Data,{Sortable:r(BASE+"sortable"),Proxy:r(BASE+"proxy"),AbstractStore:r(BASE+"abstractstore"),Store:r(BASE+"store"),Node:r(BASE+"node"),TreeStore:r(BASE+"treestore")});return Data})})();define("bui/data/sortable",function(){var ASC="ASC",DESC="DESC";var sortable=function(){};sortable.ATTRS={compareFunction:{value:function(v1,v2){if(v1===undefined){v1=""}if(v2===undefined){v2=""}if(BUI.isString(v1)){return v1.localeCompare(v2)}if(v1>v2){return 1}else{if(v1===v2){return 0}else{return -1}}}},sortField:{},sortDirection:{value:"ASC"},sortInfo:{getter:function(){var _self=this,field=_self.get("sortField");return{field:field,direction:_self.get("sortDirection")}},setter:function(v){var _self=this;_self.set("sortField",v.field);_self.set("sortDirection",v.direction)}}};BUI.augment(sortable,{compare:function(obj1,obj2,field,direction){var _self=this,dir;field=field||_self.get("sortField");direction=direction||_self.get("sortDirection");if(!field||!direction){return 1}dir=direction===ASC?1:-1;return _self.get("compareFunction")(obj1[field],obj2[field])*dir},getSortData:function(){},sortData:function(field,direction,records){var _self=this,records=records||_self.getSortData();if(BUI.isArray(field)){records=field;field=null}field=field||_self.get("sortField");direction=direction||_self.get("sortDirection");_self.set("sortField",field);_self.set("sortDirection",direction);if(!field||!direction){return records}records.sort(function(obj1,obj2){return _self.compare(obj1,obj2,field,direction)});return records}});return sortable});define("bui/data/proxy",["bui/data/sortable"],function(require){var Sortable=require("bui/data/sortable");var proxy=function(config){proxy.superclass.constructor.call(this,config)};proxy.ATTRS={};BUI.extend(proxy,BUI.Base);BUI.augment(proxy,{_read:function(params,callback){},read:function(params,callback,scope){var _self=this;scope=scope||_self;_self._read(params,function(data){callback.call(scope,data)})},_save:function(ype,data,callback){},save:function(type,saveData,callback,scope){var _self=this;scope=scope||_self;_self._save(type,saveData,function(data){callback.call(scope,data)})}});var TYPE_AJAX={READ:"read",ADD:"add",UPDATE:"update",REMOVE:"remove",SAVE_ALL:"all"};var ajaxProxy=function(config){ajaxProxy.superclass.constructor.call(this,config)};ajaxProxy.ATTRS=BUI.mix(true,proxy.ATTRS,{limitParam:{value:"limit"},startParam:{value:"start"},pageIndexParam:{value:"pageIndex"},saveTypeParam:{value:"saveType"},saveDataParam:{},pageStart:{value:0},dataType:{value:"json"},method:{value:"GET"},ajaxOptions:{value:{}},cache:{value:false},save:{},url:{}});BUI.extend(ajaxProxy,proxy);BUI.augment(ajaxProxy,{_processParams:function(params){var _self=this,pageStart=_self.get("pageStart"),arr=["start","limit","pageIndex"];if(params.pageIndex!=null){params.pageIndex=params.pageIndex+pageStart}BUI.each(arr,function(field){var fieldParam=_self.get(field+"Param");if(fieldParam!==field){params[fieldParam]=params[field];delete params[field]}})},_getUrl:function(type){var _self=this,save=_self.get("save"),url;if(type===TYPE_AJAX.READ){return _self.get("url")
}if(!save){return _self.get("url")}if(BUI.isString(save)){return save}url=save[type+"Url"];if(!url){url=_self.get("url")}return url},_getAppendParams:function(type){var _self=this,save,saveTypeParam,rst=null;if(type==TYPE_AJAX.READ){return rst}save=_self.get("save");saveTypeParam=_self.get("saveTypeParam");if(save&&!save[type+"Url"]){rst={};rst[saveTypeParam]=type}return rst},_read:function(params,callback){var _self=this,cfg;params=BUI.cloneObject(params);_self._processParams(params);cfg=_self._getAjaxOptions(TYPE_AJAX.READ,params);_self._ajax(cfg,callback)},_getAjaxOptions:function(type,params){var _self=this,ajaxOptions=_self.get("ajaxOptions"),url=_self._getUrl(type),cfg;BUI.mix(params,_self._getAppendParams(type));cfg=BUI.merge({url:url,type:_self.get("method"),dataType:_self.get("dataType"),data:params,cache:_self.get("cache")},ajaxOptions);return cfg},_ajax:function(cfg,callback){var _self=this,success=cfg.success,error=cfg.error;cfg.success=function(data){success&&success(data);callback(data)};cfg.error=function(jqXHR,textStatus,errorThrown){error&&error(jqXHR,textStatus,errorThrown);var result={exception:{status:textStatus,errorThrown:errorThrown,jqXHR:jqXHR}};callback(result)};$.ajax(cfg)},_save:function(type,data,callback){var _self=this,cfg;cfg=_self._getAjaxOptions(type,data);_self._ajax(cfg,callback)}});var memeryProxy=function(config){memeryProxy.superclass.constructor.call(this,config)};memeryProxy.ATTRS={matchFields:{value:[]}};BUI.extend(memeryProxy,proxy);BUI.mixin(memeryProxy,[Sortable]);BUI.augment(memeryProxy,{_read:function(params,callback){var _self=this,pageable=params.pageable,start=params.start,sortField=params.sortField,sortDirection=params.sortDirection,limit=params.limit,data=_self.get("data"),rows=[];data=_self._getMatches(params);_self.sortData(sortField,sortDirection);if(limit){rows=data.slice(start,start+limit);callback({rows:rows,results:data.length})}else{rows=data.slice(start);callback(rows)}},_getMatchFn:function(params,matchFields){var _self=this;return function(obj){var result=true;BUI.each(matchFields,function(field){if(params[field]!=null&&!(params[field]===obj[field])){result=false;return false}});return result}},_getMatches:function(params){var _self=this,matchFields=_self.get("matchFields"),matchFn,data=_self.get("data")||[];if(params&&matchFields.length){matchFn=_self._getMatchFn(params,matchFields);data=BUI.Array.filter(data,matchFn)}return data},_save:function(type,saveData,callback){var _self=this,data=_self.get("data");if(type==TYPE_AJAX.ADD){data.push(saveData)}else{if(type==TYPE_AJAX.REMOVE){BUI.Array.remove(data,saveData)}else{if(type==TYPE_AJAX.SAVE_ALL){BUI.each(saveData.add,function(item){data.push(item)});BUI.each(saveData.remove,function(item){BUI.Array.remove(data,item)})}}}}});proxy.Ajax=ajaxProxy;proxy.Memery=memeryProxy;return proxy});define("bui/data/abstractstore",["bui/common","bui/data/proxy"],function(require){var BUI=require("bui/common"),Proxy=require("bui/data/proxy");function AbstractStore(config){AbstractStore.superclass.constructor.call(this,config);this._init()}AbstractStore.ATTRS={autoLoad:{value:false},remoteFilter:{value:false},lastParams:{shared:false,value:{}},params:{},proxy:{shared:false,value:{}},url:{},events:{value:["acceptchanges","load","beforeload","beforeprocessload","add","exception","remove","update","localsort"]},data:{setter:function(data){var _self=this,proxy=_self.get("proxy");if(proxy.set){proxy.set("data",data)}else{proxy.data=data}_self.set("autoLoad",true)}}};BUI.extend(AbstractStore,BUI.Base);BUI.augment(AbstractStore,{isStore:true,_init:function(){var _self=this;_self.beforeInit();_self._initParams();_self._initProxy();_self._initData()},beforeInit:function(){},_initData:function(){var _self=this,autoLoad=_self.get("autoLoad");if(autoLoad){_self.load()}},_initParams:function(){var _self=this,lastParams=_self.get("lastParams"),params=_self.get("params");BUI.mix(lastParams,params)},_initProxy:function(){var _self=this,url=_self.get("url"),proxy=_self.get("proxy");if(!(proxy instanceof Proxy)){if(url){proxy.url=url}if(proxy.type==="ajax"||proxy.url){proxy=new Proxy.Ajax(proxy)}else{proxy=new Proxy.Memery(proxy)}_self.set("proxy",proxy)}},load:function(params,callback){var _self=this,proxy=_self.get("proxy"),lastParams=_self.get("lastParams");BUI.mix(lastParams,_self.getAppendParams(),params);_self.fire("beforeload",{params:lastParams});params=BUI.cloneObject(lastParams);proxy.read(lastParams,function(data){_self.onLoad(data,params);if(callback){callback(data,params)}},_self)},onFiltered:function(data,filter){var _self=this;_self.fire("filtered",{data:data,filter:filter})},onLoad:function(data,params){var _self=this;var processResult=_self.processLoad(data,params);if(processResult){_self.afterProcessLoad(data,params)}},filter:function(filter){var _self=this,remoteFilter=_self.get("remoteFilter"),result;if(remoteFilter){_self.load({filter:filter})}else{_self.set("filter",filter);result=_self._filterLocal(filter);_self.onFiltered(result,filter)
}},_filterLocal:function(fn){},_clearLocalFilter:function(){this._filterLocal(function(){return true})},clearFilter:function(){var _self=this,remoteFilter=_self.get("remoteFilter"),result;if(remoteFilter){_self.load({filter:""})}else{_self._clearLocalFilter()}},processLoad:function(data,params){var _self=this,hasErrorField=_self.get("hasErrorProperty");_self.fire("beforeprocessload",{data:data});_self.fire("beforeProcessLoad",data);if(data[hasErrorField]||data.exception){_self.onException(data);return false}return true},afterProcessLoad:function(data,params){},onException:function(data){var _self=this,errorProperty=_self.get("errorProperty"),obj={};if(data.exception){obj.type="exception";obj[errorProperty]=data.exception}else{obj.type="error";obj[errorProperty]=data[errorProperty]}_self.fire("exception",obj)},hasData:function(){},getAppendParams:function(){return{}}});return AbstractStore});define("bui/data/node",["bui/common"],function(require){var BUI=require("bui/common");function mapNode(cfg,map){var rst={};if(map){BUI.each(cfg,function(v,k){var name=map[k]||k;rst[name]=v});rst.record=cfg}else{rst=cfg}return rst}function Node(cfg,map){var _self=this;cfg=mapNode(cfg,map);BUI.mix(this,cfg)}BUI.augment(Node,{root:false,leaf:null,text:"",id:null,loaded:false,path:null,parent:null,level:0,record:null,children:null,isNode:true});return Node});define("bui/data/treestore",["bui/common","bui/data/node","bui/data/abstractstore","bui/data/proxy"],function(require){var BUI=require("bui/common"),Node=require("bui/data/node"),Proxy=require("bui/data/proxy"),AbstractStore=require("bui/data/abstractstore");function TreeStore(config){TreeStore.superclass.constructor.call(this,config)}TreeStore.ATTRS={root:{},map:{},pidField:{},dataProperty:{value:"nodes"},events:{value:["add","update","remove","load"]}};BUI.extend(TreeStore,AbstractStore);BUI.augment(TreeStore,{beforeInit:function(){this.initRoot()},_initData:function(){var _self=this,autoLoad=_self.get("autoLoad"),pidField=_self.get("pidField"),proxy=_self.get("proxy"),root=_self.get("root");if(!proxy.get("url")&&pidField){proxy.get("matchFields").push(pidField)}if(autoLoad&&!root.children){_self.loadNode(root)}},initRoot:function(){var _self=this,map=_self.get("map"),root=_self.get("root");if(!root){root={}}if(!root.isNode){root=new Node(root,map)}root.path=[root.id];root.level=0;if(root.children){_self.setChildren(root,root.children)}_self.set("root",root)},add:function(node,parent,index){var _self=this;node=_self._add(node,parent,index);_self.fire("add",{node:node,record:node,index:index});return node},_add:function(node,parent,index){parent=parent||this.get("root");var _self=this,map=_self.get("map"),nodes=parent.children,nodeChildren;if(!node.isNode){node=new Node(node,map)}nodeChildren=node.children||[];if(nodeChildren.length==0&&node.leaf==null){node.leaf=true}if(parent){parent.leaf=false}node.parent=parent;node.level=parent.level+1;node.path=parent.path.concat(node.id);index=index==null?parent.children.length:index;BUI.Array.addAt(nodes,node,index);_self.setChildren(node,nodeChildren);return node},remove:function(node){var parent=node.parent||_self.get("root"),index=BUI.Array.indexOf(node,parent.children);BUI.Array.remove(parent.children,node);if(parent.children.length===0){parent.leaf=true}this.fire("remove",{node:node,record:node,index:index});node.parent=null;return node},setValue:function(node,field,value){var _self=this;node[field]=value;_self.fire("update",{node:node,record:node,field:field,value:value})},update:function(node){this.fire("update",{node:node,record:node})},getResult:function(){return this.get("root").children},setResult:function(data){var _self=this,proxy=_self.get("proxy"),root=_self.get("root");if(proxy instanceof Proxy.Memery){_self.set("data",data);_self.load({id:root.id})}else{_self.setChildren(root,data)}},setChildren:function(node,children){var _self=this;node.children=[];if(!children.length){return}BUI.each(children,function(item){_self._add(item,node)})},findNode:function(id,parent,deep){return this.findNodeBy(function(node){return node.id===id},parent,deep)},findNodeBy:function(fn,parent,deep){var _self=this;deep=deep==null?true:deep;if(!parent){var root=_self.get("root");if(fn(root)){return root}return _self.findNodeBy(fn,root)}var children=parent.children,rst=null;BUI.each(children,function(item){if(fn(item)){rst=item}else{if(deep){rst=_self.findNodeBy(fn,item)}}if(rst){return false}});return rst},findNodesBy:function(func,parent){var _self=this,root,rst=[];if(!parent){parent=_self.get("root")}BUI.each(parent.children,function(item){if(func(item)){rst.push(item)}rst=rst.concat(_self.findNodesBy(func,item))});return rst},findNodeByPath:function(path){if(!path){return null}var _self=this,root=_self.get("root"),pathArr=path.split(","),node,i,tempId=pathArr[0];if(!tempId){return null}if(root.id==tempId){node=root}else{node=_self.findNode(tempId,root,false)}if(!node){return}for(i=1;i<pathArr.length;i=i+1){var tempId=pathArr[i];node=_self.findNode(tempId,node,false);
if(!node){break}}return node},contains:function(node,parent){var _self=this,findNode=_self.findNode(node.id,parent);return !!findNode},afterProcessLoad:function(data,params){var _self=this,pidField=_self.get("pidField"),id=params.id||params[pidField],dataProperty=_self.get("dataProperty"),node=_self.findNode(id)||_self.get("root");if(BUI.isArray(data)){_self.setChildren(node,data)}else{_self.setChildren(node,data[dataProperty])}node.loaded=true;_self.fire("load",{node:node,params:params})},hasData:function(){return this.get("root").children&&this.get("root").children.length!==0},isLoaded:function(node){var root=this.get("root");if(node==root&&!root.children){return false}if(!this.get("url")&&!this.get("pidField")){return true}return node.loaded||node.leaf||!!(node.children&&node.children.length)},loadNode:function(node,forceLoad){var _self=this,pidField=_self.get("pidField"),params;if(!forceLoad&&_self.isLoaded(node)){return}params={id:node.id};if(pidField){params[pidField]=node.id}_self.load(params)},reloadNode:function(node){var _self=this;node=node||_self.get("root");node.loaded=false;_self.loadNode(node,true)},loadPath:function(path){var _self=this,arr=path.split(","),id=arr[0];if(_self.findNodeByPath(path)){return}_self.load({id:id,path:path})}});return TreeStore});define("bui/data/store",["bui/data/proxy","bui/data/abstractstore","bui/data/sortable"],function(require){var Proxy=require("bui/data/proxy"),AbstractStore=require("bui/data/abstractstore"),Sortable=require("bui/data/sortable");function removeAt(index,array){if(index<0){return}var records=array,record=records[index];records.splice(index,1);return record}function removeFrom(record,array){var index=BUI.Array.indexOf(record,array);if(index>=0){removeAt(index,array)}}function contains(record,array){return BUI.Array.indexOf(record,array)!==-1}var store=function(config){store.superclass.constructor.call(this,config)};store.ATTRS={autoSync:{value:false},currentPage:{value:0},deletedRecords:{shared:false,value:[]},errorProperty:{value:"error"},hasErrorProperty:{value:"hasError"},matchFunction:{value:function(obj1,obj2){return obj1==obj2}},modifiedRecords:{shared:false,value:[]},newRecords:{shared:false,value:[]},remoteSort:{value:false},resultMap:{shared:false,value:{}},root:{value:"rows"},rowCount:{value:0},totalProperty:{value:"results"},start:{value:0},pageSize:{}};BUI.extend(store,AbstractStore);BUI.mixin(store,[Sortable]);BUI.augment(store,{add:function(data,noRepeat,match){var _self=this,count=_self.getCount();_self.addAt(data,count,noRepeat,match)},addAt:function(data,index,noRepeat,match){var _self=this;match=match||_self._getDefaultMatch();if(!BUI.isArray(data)){data=[data]}$.each(data,function(pos,element){if(!noRepeat||!_self.contains(element,match)){_self._addRecord(element,pos+index);_self.get("newRecords").push(element);removeFrom(element,_self.get("deletedRecords"));removeFrom(element,_self.get("modifiedRecords"))}})},contains:function(record,match){return this.findIndexBy(record,match)!==-1},find:function(field,value){var _self=this,result=null,records=_self.getResult();$.each(records,function(index,record){if(record[field]===value){result=record;return false}});return result},findAll:function(field,value){var _self=this,result=[],records=_self.getResult();$.each(records,function(index,record){if(record[field]===value){result.push(record)}});return result},findByIndex:function(index){return this.getResult()[index]},findIndexBy:function(target,match){var _self=this,position=-1,records=_self.getResult();match=match||_self._getDefaultMatch();if(target===null||target===undefined){return -1}$.each(records,function(index,record){if(match(target,record)){position=index;return false}});return position},findNextRecord:function(record){var _self=this,index=_self.findIndexBy(record);if(index>=0){return _self.findByIndex(index+1)}return},getCount:function(){return this.getResult().length},getTotalCount:function(){var _self=this,resultMap=_self.get("resultMap"),total=_self.get("totalProperty");return parseInt(resultMap[total],10)||0},getResult:function(){var _self=this,resultMap=_self.get("resultMap"),root=_self.get("root");return resultMap[root]},hasData:function(){return this.getCount()!==0},setResult:function(data){var _self=this,proxy=_self.get("proxy");if(proxy instanceof Proxy.Memery){_self.set("data",data);_self.load({start:0})}else{_self._setResult(data)}},remove:function(data,match){var _self=this,delData=[];match=match||_self._getDefaultMatch();if(!BUI.isArray(data)){data=[data]}$.each(data,function(index,element){var index=_self.findIndexBy(element,match),record=removeAt(index,_self.getResult());if(!contains(record,_self.get("newRecords"))&&!contains(record,_self.get("deletedRecords"))){_self.get("deletedRecords").push(record)}removeFrom(record,_self.get("newRecords"));removeFrom(record,_self.get("modifiedRecords"));_self.fire("remove",{record:record})})},save:function(type,saveData,callback){var _self=this,proxy=_self.get("proxy");if(BUI.isFunction(type)){callback=type;
type=undefined}if(BUI.isObject(type)){callback=saveData;saveData=type;type=undefined}if(!type){type=_self._getSaveType(saveData)}if(type=="all"&&!saveData){saveData=_self._getDirtyData()}_self.fire("beforesave",{type:type,saveData:saveData});proxy.save(type,saveData,function(data){_self.onSave(type,saveData,data);if(callback){callback(data,saveData)}},_self)},_getSaveType:function(saveData){var _self=this;if(!saveData){return"all"}if(BUI.Array.contains(saveData,_self.get("newRecords"))){return"add"}if(BUI.Array.contains(saveData,_self.get("modifiedRecords"))){return"update"}if(BUI.Array.contains(saveData,_self.get("deletedRecords"))){return"remove"}return"custom"},_getDirtyData:function(){var _self=this,proxy=_self.get("proxy");if(proxy.get("url")){return{add:BUI.JSON.stringify(_self.get("newRecords")),update:BUI.JSON.stringify(_self.get("modifiedRecords")),remove:BUI.JSON.stringify(_self.get("deletedRecords"))}}else{return{add:_self.get("newRecords"),update:_self.get("modifiedRecords"),remove:_self.get("deletedRecords")}}},onSave:function(type,saveData,data){var _self=this,hasErrorField=_self.get("hasErrorProperty");if(data[hasErrorField]||data.exception){_self.onException(data);return}_self._clearDirty(type,saveData);_self.fire("saved",{type:type,saveData:saveData,data:data});if(_self.get("autoSync")){_self.load()}},_clearDirty:function(type,saveData){var _self=this;switch(type){case"all":_self._clearChanges();break;case"add":removeFrom(saveData,"newRecords");break;case"update":removeFrom(saveData,"modifiedRecords");break;case"remove":removeFrom(saveData,"deletedRecords");break;default:break}function removeFrom(obj,name){BUI.Array.remove(_self.get(name),obj)}},sort:function(field,direction){var _self=this,remoteSort=_self.get("remoteSort");if(!remoteSort){_self._localSort(field,direction)}else{_self.set("sortField",field);_self.set("sortDirection",direction);_self.load(_self.get("sortInfo"))}},sum:function(field,data){var _self=this,records=data||_self.getResult(),sum=0;BUI.each(records,function(record){var val=record[field];if(!isNaN(val)){sum+=parseFloat(val)}});return sum},setValue:function(obj,field,value){var record=obj,_self=this;record[field]=value;if(!contains(record,_self.get("newRecords"))&&!contains(record,_self.get("modifiedRecords"))){_self.get("modifiedRecords").push(record)}_self.fire("update",{record:record,field:field,value:value})},update:function(obj,isMatch,match){var record=obj,_self=this,match=null,index=null;if(isMatch){match=match||_self._getDefaultMatch();index=_self.findIndexBy(obj,match);if(index>=0){record=_self.getResult()[index]}}record=BUI.mix(record,obj);if(!contains(record,_self.get("newRecords"))&&!contains(record,_self.get("modifiedRecords"))){_self.get("modifiedRecords").push(record)}_self.fire("update",{record:record})},_addRecord:function(record,index){var records=this.getResult();if(index==undefined){index=records.length}records.splice(index,0,record);this.fire("add",{record:record,index:index})},_clearChanges:function(){var _self=this;BUI.Array.empty(_self.get("newRecords"));BUI.Array.empty(_self.get("modifiedRecords"));BUI.Array.empty(_self.get("deletedRecords"))},_filterLocal:function(fn,data){var _self=this,rst=[];data=data||_self.getResult();if(!fn){return data}BUI.each(data,function(record){if(fn(record)){rst.push(record)}});return rst},_getDefaultMatch:function(){return this.get("matchFunction")},_getPageParams:function(){var _self=this,sortInfo=_self.get("sortInfo"),start=_self.get("start"),limit=_self.get("pageSize"),pageIndex=_self.get("pageIndex")||(limit?start/limit:0);params={start:start,limit:limit,pageIndex:pageIndex};if(_self.get("remoteSort")){BUI.mix(params,sortInfo)}return params},getAppendParams:function(){return this._getPageParams()},beforeInit:function(){this._setResult([])},_localSort:function(field,direction){var _self=this;_self._sortData(field,direction);_self.fire("localsort",{field:field,direction:direction})},_sortData:function(field,direction,data){var _self=this;data=data||_self.getResult();_self.sortData(field,direction,data)},afterProcessLoad:function(data,params){var _self=this,root=_self.get("root"),start=params.start,limit=params.limit,totalProperty=_self.get("totalProperty");if(BUI.isArray(data)){_self._setResult(data)}else{_self._setResult(data[root],data[totalProperty])}_self.set("start",start);if(limit){_self.set("pageIndex",start/limit)}if(!_self.get("remoteSort")){_self._sortData()}_self.fire("load",{params:params})},_setResult:function(rows,totalCount){var _self=this,resultMap=_self.get("resultMap");totalCount=totalCount||rows.length;resultMap[_self.get("root")]=rows;resultMap[_self.get("totalProperty")]=totalCount;_self._clearChanges()}});return store});define("bui/overlay",["bui/common","bui/overlay/overlay","bui/overlay/dialog","bui/overlay/message"],function(require){var BUI=require("bui/common"),Overlay=BUI.namespace("Overlay");BUI.mix(Overlay,{Overlay:require("bui/overlay/overlay"),Dialog:require("bui/overlay/dialog"),Message:require("bui/overlay/message")});
BUI.mix(Overlay,{OverlayView:Overlay.Overlay.View,DialogView:Overlay.Dialog.View});BUI.Message=BUI.Overlay.Message;return Overlay});define("bui/overlay/overlay",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,CLS_ARROW="x-align-arrow",UIBase=Component.UIBase;var overlayView=Component.View.extend([UIBase.PositionView,UIBase.CloseView]);var overlay=Component.Controller.extend([UIBase.Position,UIBase.Align,UIBase.Close,UIBase.AutoShow,UIBase.AutoHide],{renderUI:function(){var _self=this,el=_self.get("el"),arrowContainer=_self.get("arrowContainer"),container=arrowContainer?el.one(arrowContainer):el;if(_self.get("showArrow")){$(_self.get("arrowTpl")).appendTo(container)}},show:function(){var _self=this,effectCfg=_self.get("effect"),el=_self.get("el"),visibleMode=_self.get("visibleMode"),effect=effectCfg.effect,duration=effectCfg.duration;if(!_self.get("rendered")){_self.set("visible",true);_self.render();_self.set("visible",false);el=_self.get("el")}if(visibleMode==="visibility"){_self.set("visible",true);el.css({display:"none"})}switch(effect){case"linear":el.show(duration,callback);break;case"fade":el.fadeIn(duration,callback);break;case"slide":el.slideDown(duration,callback);break;default:callback();break}function callback(){if(visibleMode==="visibility"){el.css({display:"block"})}else{_self.set("visible",true)}if(effectCfg.callback){effectCfg.callback.call(_self)}}},hide:function(){var _self=this,effectCfg=_self.get("effect"),el=_self.get("el"),effect=effectCfg.effect,duration=effectCfg.duration;switch(effect){case"linear":el.hide(duration,callback);break;case"fade":el.fadeOut(duration,callback);break;case"slide":el.slideUp(duration,callback);break;default:callback();break}function callback(){if(_self.get("visibleMode")==="visibility"){el.css({display:"block"})}_self.set("visible",false);if(effectCfg.callback){effectCfg.callback.call(_self)}}}},{ATTRS:{effect:{value:{effect:"none",duration:0,callback:null}},closeable:{value:false},showArrow:{value:false},arrowContainer:{view:true},arrowTpl:{value:'<s class="'+CLS_ARROW+'"><s class="'+CLS_ARROW+'-inner"></s></s>'},visibleMode:{value:"visibility"},visible:{value:false},xview:{value:overlayView}}},{xclass:"overlay"});overlay.View=overlayView;return overlay});define("bui/overlay/dialog",["bui/overlay/overlay"],function(require){var Overlay=require("bui/overlay/overlay"),UIBase=BUI.Component.UIBase,CLS_TITLE="header-title",PREFIX=BUI.prefix,HEIGHT_PADDING=20;var dialogView=Overlay.View.extend([UIBase.StdModView,UIBase.MaskView],{_uiSetTitle:function(v){var _self=this,el=_self.get("el");el.find("."+CLS_TITLE).html(v)},_uiSetContentId:function(v){var _self=this,body=_self.get("body"),children=$("#"+v).children();children.appendTo(body)},_uiSetHeight:function(v){var _self=this,bodyHeight=v,header=_self.get("header"),body=_self.get("body"),footer=_self.get("footer");bodyHeight-=header.outerHeight()+footer.outerHeight();bodyHeight-=HEIGHT_PADDING*2;body.height(bodyHeight)},_removeContent:function(){var _self=this,body=_self.get("body"),contentId=_self.get("contentId");if(contentId){body.children().appendTo($("#"+contentId))}else{body.children().remove()}}},{xclass:"dialog-view"});var dialog=Overlay.extend([UIBase.StdMod,UIBase.Mask,UIBase.Drag],{show:function(){var _self=this;dialog.superclass.show.call(this);_self.center()},bindUI:function(){var _self=this;_self.on("closeclick",function(){return _self.onCancel()})},onCancel:function(){var _self=this,cancel=_self.get("cancel");return cancel.call(this)},_uiSetButtons:function(buttons){var _self=this,footer=_self.get("footer");footer.children().remove();BUI.each(buttons,function(conf){_self._createButton(conf,footer)})},_createButton:function(conf,parent){var _self=this,temp='<button class="'+conf.elCls+'">'+conf.text+"</button>",btn=$(temp).appendTo(parent);btn.on("click",function(){conf.handler.call(_self,_self,this)})},destructor:function(){var _self=this,contentId=_self.get("contentId"),body=_self.get("body"),closeAction=_self.get("closeAction");if(closeAction=="destroy"){_self.hide();if(contentId){body.children().appendTo("#"+contentId)}}}},{ATTRS:{closeTpl:{view:true,value:'<a tabindex="0" href=javascript:void("\u5173\u95ed") role="button" class="'+PREFIX+'ext-close" style=""><span class="'+PREFIX+'ext-close-x x-icon x-icon-normal">\u00d7</span></a>'},buttons:{value:[{text:"\u786e\u5b9a",elCls:"button button-primary",handler:function(){var _self=this,success=_self.get("success");if(success){success.call(_self)}}},{text:"\u53d6\u6d88",elCls:"button button-primary",handler:function(dialog,btn){if(this.onCancel()!==false){this.close()}}}]},contentId:{view:true},success:{value:function(){this.close()}},cancel:{value:function(){}},dragNode:{valueFn:function(){return this.get("header")}},defaultLoaderCfg:{valueFn:function(){var _self=this;return{property:"bodyContent",autoLoad:false,lazyLoad:{event:"show"},loadMask:{el:_self.get("body")}}}},title:{view:true,value:""},mask:{value:true},maskShared:{value:false},headerContent:{value:'<div class="'+CLS_TITLE+'">\u6807\u9898</div>'},footerContent:{},closeable:{value:true},xview:{value:dialogView}}},{xclass:"dialog"});
dialog.View=dialogView;return dialog});define("bui/overlay/message",["bui/overlay/dialog"],function(require){var Dialog=require("bui/overlay/dialog"),PREFIX=BUI.prefix,iconText={info:"i",error:"\u00d7",success:'<i class="icon-ok icon-white"></i>',question:"?",warning:"!"};var message=Dialog.extend({renderUI:function(){this._setContent()},bindUI:function(){var _self=this,body=_self.get("body");_self.on("afterVisibleChange",function(ev){if(ev.newVal){if(BUI.UA.ie<8){var outerWidth=body.outerWidth();if(BUI.UA.ie==6){outerWidth=outerWidth>350?350:outerWidth}_self.get("header").width(outerWidth-20);_self.get("footer").width(outerWidth)}}})},_setContent:function(){var _self=this,body=_self.get("body"),contentTpl=BUI.substitute(_self.get("contentTpl"),{msg:_self.get("msg"),iconTpl:_self.get("iconTpl")});body.empty();$(contentTpl).appendTo(body)},_uiSetIcon:function(v){if(!this.get("rendered")){return}this._setContent()},_uiSetMsg:function(v){if(!this.get("rendered")){return}this._setContent()}},{ATTRS:{icon:{},msg:{},iconTpl:{getter:function(){var _self=this,type=_self.get("icon");return'<div class="x-icon x-icon-'+type+'">'+iconText[type]+"</div>"}},contentTpl:{value:'{iconTpl}<div class="'+PREFIX+'message-content">{msg}</div>'}}},{xclass:"message",priority:0});var singlelon;function messageFun(buttons,defaultIcon){return function(msg,callback,icon){if(BUI.isString(callback)){icon=callback;callback=null}icon=icon||defaultIcon;callback=callback||hide;showMessage({"buttons":buttons,"icon":icon,"msg":msg,"success":callback})}}function showMessage(config){if(!singlelon){singlelon=new message({icon:"info",title:""})}singlelon.set(config);singlelon.show()}function success(){var _self=this,success=_self.get("success");if(success){success.call(_self);_self.hide()}}function hide(){this.hide()}var Alert=messageFun([{text:"\u786e\u5b9a",elCls:"button button-primary",handler:success}],"info"),Confirm=messageFun([{text:"\u786e\u5b9a",elCls:"button button-primary",handler:success},{text:"\u53d6\u6d88",elCls:"button button-primary",handler:hide}],"question");message.Alert=Alert;message.Confirm=Confirm;message.Show=showMessage;return message});(function(){var BASE="bui/list/";define("bui/list",["bui/common",BASE+"list",BASE+"listitem",BASE+"simplelist",BASE+"listbox"],function(r){var BUI=r("bui/common"),List=BUI.namespace("List");BUI.mix(List,{List:r(BASE+"list"),ListItem:r(BASE+"listitem"),SimpleList:r(BASE+"simplelist"),Listbox:r(BASE+"listbox")});BUI.mix(List,{ListItemView:List.ListItem.View,SimpleListView:List.SimpleList.View});return List})})();define("bui/list/domlist",["bui/common"],function(require){var BUI=require("bui/common"),Selection=BUI.Component.UIBase.Selection,FIELD_PREFIX="data-",List=BUI.Component.UIBase.List;function getItemStatusCls(name,self){var _self=self,itemCls=_self.get("itemCls"),itemStatusCls=_self.get("itemStatusCls");if(itemStatusCls&&itemStatusCls[name]){return itemStatusCls[name]}return itemCls+"-"+name}var domListView=function(){};domListView.ATTRS={items:{}};domListView.prototype={clearControl:function(){var _self=this,listEl=_self.getItemContainer(),itemCls=_self.get("itemCls");listEl.find("."+itemCls).remove()},addItem:function(item,index){return this._createItem(item,index)},getItems:function(){var _self=this,elements=_self.getAllElements(),rst=[];BUI.each(elements,function(elem){rst.push(_self.getItemByElement(elem))});return rst},updateItem:function(item){var _self=this,items=_self.getItems(),index=BUI.Array.indexOf(item,items),element=null,tpl;if(index>=0){element=_self.findElement(item);tpl=_self.getItemTpl(item,index);if(element){$(element).html($(tpl).html())}}return element},removeItem:function(item,element){element=element||this.findElement(item);$(element).remove()},getItemContainer:function(){var container=this.get("itemContainer");if(container.length){return container}return this.get("el")},getItemTpl:function(item,index){var _self=this,render=_self.get("itemTplRender"),itemTpl=_self.get("itemTpl");if(render){return render(item,index)}return BUI.substitute(itemTpl,item)},_createItem:function(item,index){var _self=this,listEl=_self.getItemContainer(),itemCls=_self.get("itemCls"),dataField=_self.get("dataField"),tpl=_self.getItemTpl(item,index),node=$(tpl);if(index!==undefined){var target=listEl.find("."+itemCls)[index];if(target){node.insertBefore(target)}else{node.appendTo(listEl)}}else{node.appendTo(listEl)}node.addClass(itemCls);node.data(dataField,item);return node},getItemStatusCls:function(name){return getItemStatusCls(name,this)},setItemStatusCls:function(name,element,value){var _self=this,cls=_self.getItemStatusCls(name),method=value?"addClass":"removeClass";if(element){$(element)[method](cls)}},hasStatus:function(name,element){var _self=this,cls=_self.getItemStatusCls(name);return $(element).hasClass(cls)},setItemSelected:function(item,selected,element){var _self=this;element=element||_self.findElement(item);_self.setItemStatusCls("selected",element,selected)},getAllElements:function(){var _self=this,itemCls=_self.get("itemCls"),el=_self.get("el");
return el.find("."+itemCls)},getItemByElement:function(element){var _self=this,dataField=_self.get("dataField");return $(element).data(dataField)},getFirstElementByStatus:function(name){var _self=this,cls=_self.getItemStatusCls(name),el=_self.get("el");return el.find("."+cls)[0]},getElementsByStatus:function(status){var _self=this,cls=_self.getItemStatusCls(status),el=_self.get("el");return el.find("."+cls)},getSelectedElements:function(){var _self=this,cls=_self.getItemStatusCls("selected"),el=_self.get("el");return el.find("."+cls)},findElement:function(item){var _self=this,elements=_self.getAllElements(),result=null;BUI.each(elements,function(element){if(_self.getItemByElement(element)==item){result=element;return false}});return result},isElementSelected:function(element){var _self=this,cls=_self.getItemStatusCls("selected");return element&&$(element).hasClass(cls)}};function parseItem(element,self){var attrs=element.attributes,itemStatusFields=self.get("itemStatusFields"),item={};BUI.each(attrs,function(attr){var name=attr.nodeName;if(name.indexOf(FIELD_PREFIX)!==-1){name=name.replace(FIELD_PREFIX,"");item[name]=attr.nodeValue}});item.text=$(element).text();BUI.each(itemStatusFields,function(v,k){var cls=getItemStatusCls(k,self);if($(element).hasClass(cls)){item[v]=true}});return item}var domList=function(){};domList.ATTRS=BUI.merge(true,List.ATTRS,Selection.ATTRS,{dataField:{view:true,value:"data-item"},itemContainer:{view:true},itemStatusFields:{value:{}},itemCls:{view:true},cancelSelected:{value:false},textGetter:{},defaultLoaderCfg:{value:{property:"items",dataType:"json"}},events:{value:{"itemrendered":true,"itemremoved":true,"itemupdated":true,"itemsshow":false,"beforeitemsshow":false,"itemsclear":false,"itemdblclick":false,"beforeitemsclear":false}}});domList.PARSER={items:function(el){var _self=this,rst=[],itemCls=_self.get("itemCls"),dataField=_self.get("dataField"),elements=el.find("."+itemCls);if(!elements.length){elements=el.children();elements.addClass(itemCls)}BUI.each(elements,function(element){var item=parseItem(element,_self);rst.push(item);$(element).data(dataField,item)});return rst}};BUI.augment(domList,List,Selection,{_uiSetItems:function(items){var _self=this;if(_self.get("srcNode")&&!_self.get("rendered")){return}this.setItems(items)},__bindUI:function(){var _self=this,selectedEvent=_self.get("selectedEvent"),itemCls=_self.get("itemCls"),itemContainer=_self.get("view").getItemContainer();itemContainer.delegate("."+itemCls,"click",function(ev){if(_self.get("disabled")){return}var itemEl=$(ev.currentTarget),item=_self.getItemByElement(itemEl);if(_self.isItemDisabled(item,itemEl)){return}var rst=_self.fire("itemclick",{item:item,element:itemEl[0],domTarget:ev.target,domEvent:ev});if(rst!==false&&selectedEvent=="click"&&_self.isItemSelectable(item)){setItemSelectedStatus(item,itemEl)}});if(selectedEvent!=="click"){itemContainer.delegate("."+itemCls,selectedEvent,function(ev){if(_self.get("disabled")){return}var itemEl=$(ev.currentTarget),item=_self.getItemByElement(itemEl);if(_self.isItemDisabled(item,itemEl)){return}if(_self.isItemSelectable(item)){setItemSelectedStatus(item,itemEl)}})}itemContainer.delegate("."+itemCls,"dblclick",function(ev){if(_self.get("disabled")){return}var itemEl=$(ev.currentTarget),item=_self.getItemByElement(itemEl);if(_self.isItemDisabled(item,itemEl)){return}_self.fire("itemdblclick",{item:item,element:itemEl[0],domTarget:ev.target})});function setItemSelectedStatus(item,itemEl){var multipleSelect=_self.get("multipleSelect"),isSelected;isSelected=_self.isItemSelected(item,itemEl);if(!isSelected){if(!multipleSelect){_self.clearSelected()}_self.setItemSelected(item,true,itemEl)}else{if(multipleSelect){_self.setItemSelected(item,false,itemEl)}else{if(_self.get("cancelSelected")){_self.setSelected(null)}}}}_self.on("itemrendered itemupdated",function(ev){var item=ev.item,element=ev.element;_self._syncItemStatus(item,element)})},getValueByField:function(item,field){return item&&item[field]},_syncItemStatus:function(item,element){var _self=this,itemStatusFields=_self.get("itemStatusFields");BUI.each(itemStatusFields,function(v,k){if(item[v]!=null){_self.get("view").setItemStatusCls(k,element,item[v])}})},getStatusValue:function(item,status){var _self=this,itemStatusFields=_self.get("itemStatusFields"),field=itemStatusFields[status];return item[field]},getCount:function(){var items=this.getItems();return items?items.length:0},getStatusField:function(status){var _self=this,itemStatusFields=_self.get("itemStatusFields");return itemStatusFields[status]},setStatusValue:function(item,status,value){var _self=this,itemStatusFields=_self.get("itemStatusFields"),field=itemStatusFields[status];if(field){item[field]=value}},getItemText:function(item){var _self=this,textGetter=_self.get("textGetter");if(!item){return""}if(textGetter){return textGetter(item)}else{return $(_self.findElement(item)).text()}},removeItem:function(item){var _self=this,items=_self.get("items"),element=_self.findElement(item),index;
index=BUI.Array.indexOf(item,items);if(index!==-1){items.splice(index,1)}_self.get("view").removeItem(item,element);_self.fire("itemremoved",{item:item,domTarget:$(element)[0],element:element})},addItemAt:function(item,index){var _self=this,items=_self.get("items");if(index===undefined){index=items.length}items.splice(index,0,item);_self.addItemToView(item,index);return item},addItemToView:function(item,index){var _self=this,element=_self.get("view").addItem(item,index);_self.fire("itemrendered",{item:item,domTarget:$(element)[0],element:element});return element},updateItem:function(item){var _self=this,element=_self.get("view").updateItem(item);_self.fire("itemupdated",{item:item,domTarget:$(element)[0],element:element})},setItems:function(items){var _self=this;if(items!=_self.getItems()){_self.setInternal("items",items)}_self.clearControl();_self.fire("beforeitemsshow");BUI.each(items,function(item,index){_self.addItemToView(item,index)});_self.fire("itemsshow")},getItems:function(){return this.get("items")},getItemByElement:function(element){return this.get("view").getItemByElement(element)},getSelected:function(){var _self=this,element=_self.get("view").getFirstElementByStatus("selected");return _self.getItemByElement(element)||null},getItemsByStatus:function(status){var _self=this,elements=_self.get("view").getElementsByStatus(status),rst=[];BUI.each(elements,function(element){rst.push(_self.getItemByElement(element))});return rst},findElement:function(item){var _self=this;if(BUI.isString(item)){item=_self.getItem(item)}return this.get("view").findElement(item)},findItemByField:function(field,value){var _self=this,items=_self.get("items"),result=null;BUI.each(items,function(item){if(item[field]!=null&&item[field]==value){result=item;return false}});return result},setItemSelectedStatus:function(item,selected,element){var _self=this;element=element||_self.findElement(item);_self.setItemStatus(item,"selected",selected,element)},setAllSelection:function(){var _self=this,items=_self.getItems();_self.setSelection(items)},isItemSelected:function(item,element){var _self=this;element=element||_self.findElement(item);return _self.get("view").isElementSelected(element)},isItemDisabled:function(item,element){return this.hasStatus(item,"disabled",element)},setItemDisabled:function(item,disabled){var _self=this;_self.setItemStatus(item,"disabled",disabled)},getSelection:function(){var _self=this,elements=_self.get("view").getSelectedElements(),rst=[];BUI.each(elements,function(elem){rst.push(_self.getItemByElement(elem))});return rst},clearControl:function(){this.fire("beforeitemsclear");this.get("view").clearControl();this.fire("itemsclear")},hasStatus:function(item,status,element){if(!item){return false}var _self=this,field=_self.getStatusField(status);element=element||_self.findElement(item);return _self.get("view").hasStatus(status,element)},setItemStatus:function(item,status,value,element){var _self=this;if(item){element=element||_self.findElement(item)}if(!_self.isItemDisabled(item,element)||status==="disabled"){if(item){if(status==="disabled"&&value){_self.clearItemStatus(item)}_self.setStatusValue(item,status,value);_self.get("view").setItemStatusCls(status,element,value);_self.fire("itemstatuschange",{item:item,status:status,value:value,element:element})}if(status==="selected"){_self.afterSelected(item,value,element)}}},clearItemStatus:function(item,status,element){var _self=this,itemStatusFields=_self.get("itemStatusFields");element=element||_self.findElement(item);if(status){_self.setItemStatus(item,status,false,element)}else{BUI.each(itemStatusFields,function(v,k){_self.setItemStatus(item,k,false,element)});if(!itemStatusFields["selected"]){_self.setItemSelected(item,false)}_self.setItemStatus(item,"hover",false)}}});domList.View=domListView;return domList});define("bui/list/keynav",["bui/common"],function(require){var BUI=require("bui/common"),KeyNav=function(){};KeyNav.ATTRS={highlightedStatus:{value:"hover"}};BUI.augment(KeyNav,{setHighlighted:function(item,element){if(this.hasStatus(item,"hover",element)){return}var _self=this,highlightedStatus=_self.get("highlightedStatus"),lightedElement=_self._getHighLightedElement(),lightedItem=lightedElement?_self.getItemByElement(lightedElement):null;if(lightedItem!==item){if(lightedItem){this.setItemStatus(lightedItem,highlightedStatus,false,lightedElement)}this.setItemStatus(item,highlightedStatus,true,element);_self._scrollToItem(item,element)}},_getHighLightedElement:function(){var _self=this,highlightedStatus=_self.get("highlightedStatus"),element=_self.get("view").getFirstElementByStatus(highlightedStatus);return element},getHighlighted:function(){var _self=this,highlightedStatus=_self.get("highlightedStatus"),element=_self.get("view").getFirstElementByStatus(highlightedStatus);return _self.getItemByElement(element)||null},getColumnCount:function(){var _self=this,firstItem=_self.getFirstItem(),element=_self.findElement(firstItem),node=$(element);if(element){return parseInt(node.parent().width()/node.outerWidth(),10)
}return 1},getRowCount:function(columns){var _self=this;columns=columns||_self.getColumnCount();return(this.getCount()+columns-1)/columns},_getNextItem:function(forward,skip,count){var _self=this,currentIndx=_self._getCurrentIndex(),itemCount=_self.getCount(),factor=forward?1:-1,nextIndex;if(currentIndx===-1){return forward?_self.getFirstItem():_self.getLastItem()}if(!forward){skip=skip*factor}nextIndex=(currentIndx+skip+count)%count;if(nextIndex>itemCount-1){if(forward){nextIndex=nextIndex-(itemCount-1)}else{nextIndex=nextIndex+skip}}return _self.getItemAt(nextIndex)},_getLeftItem:function(){var _self=this,count=_self.getCount(),column=_self.getColumnCount();if(!count||column<=1){return null}return _self._getNextItem(false,1,count)},_getCurrentItem:function(){return this.getHighlighted()},_getCurrentIndex:function(){var _self=this,item=_self._getCurrentItem();return this.indexOfItem(item)},_getRightItem:function(){var _self=this,count=_self.getCount(),column=_self.getColumnCount();if(!count||column<=1){return null}return this._getNextItem(true,1,count)},_getDownItem:function(){var _self=this,columns=_self.getColumnCount(),rows=_self.getRowCount(columns);if(rows<=1){return null}return this._getNextItem(true,columns,columns*rows)},getScrollContainer:function(){return this.get("el")},isScrollVertical:function(){var _self=this,el=_self.get("el"),container=_self.get("view").getItemContainer();return el.height()<container.height()},_scrollToItem:function(item,element){var _self=this;if(_self.isScrollVertical()){element=element||_self.findElement(item);var container=_self.getScrollContainer(),top=$(element).position().top,ctop=container.position().top,cHeight=container.height(),distance=top-ctop,height=$(element).height(),scrollTop=container.scrollTop();if(distance<0||distance>cHeight-height){container.scrollTop(scrollTop+distance)}}},_getUpperItem:function(){var _self=this,columns=_self.getColumnCount(),rows=_self.getRowCount(columns);if(rows<=1){return null}return this._getNextItem(false,columns,columns*rows)},handleNavUp:function(ev){var _self=this,upperItem=_self._getUpperItem();_self.setHighlighted(upperItem)},handleNavDown:function(ev){this.setHighlighted(this._getDownItem())},handleNavLeft:function(ev){this.setHighlighted(this._getLeftItem())},handleNavRight:function(ev){this.setHighlighted(this._getRightItem())},handleNavEnter:function(ev){var _self=this,current=_self._getCurrentItem(),element;if(current){element=_self.findElement(current);$(element).trigger("click")}},handleNavEsc:function(ev){this.setHighlighted(null)},handleNavTab:function(ev){this.setHighlighted(this._getRightItem())}});return KeyNav});define("bui/list/sortable",["bui/common","bui/data"],function(require){var BUI=require("bui/common"),DataSortable=require("bui/data").Sortable;var Sortable=function(){};Sortable.ATTRS=BUI.merge(true,DataSortable.ATTRS,{});BUI.augment(Sortable,DataSortable,{compare:function(obj1,obj2,field,direction){var _self=this,dir;field=field||_self.get("sortField");direction=direction||_self.get("sortDirection");if(!field||!direction){return 1}dir=direction==="ASC"?1:-1;if(!$.isPlainObject(obj1)){obj1=_self.getItemByElement(obj1)}if(!$.isPlainObject(obj2)){obj2=_self.getItemByElement(obj2)}return _self.get("compareFunction")(obj1[field],obj2[field])*dir},getSortData:function(){return $.makeArray(this.get("view").getAllElements())},sort:function(field,direction){var _self=this,sortedElements=_self.sortData(field,direction),itemContainer=_self.get("view").getItemContainer();if(!_self.get("store")){_self.sortData(field,direction,_self.get("items"))}BUI.each(sortedElements,function(el){$(el).appendTo(itemContainer)})}});return Sortable});define("bui/list/simplelist",["bui/common","bui/list/domlist","bui/list/keynav","bui/list/sortable"],function(require){var BUI=require("bui/common"),UIBase=BUI.Component.UIBase,UA=BUI.UA,DomList=require("bui/list/domlist"),KeyNav=require("bui/list/keynav"),Sortable=require("bui/list/sortable"),CLS_ITEM=BUI.prefix+"list-item";var simpleListView=BUI.Component.View.extend([DomList.View],{setElementHover:function(element,hover){var _self=this;_self.setItemStatusCls("hover",element,hover)}},{ATTRS:{itemContainer:{valueFn:function(){return this.get("el").find(this.get("listSelector"))}}}},{xclass:"simple-list-view"});var simpleList=BUI.Component.Controller.extend([DomList,UIBase.Bindable,KeyNav,Sortable],{bindUI:function(){var _self=this,itemCls=_self.get("itemCls"),itemContainer=_self.get("view").getItemContainer();itemContainer.delegate("."+itemCls,"mouseover",function(ev){if(_self.get("disabled")){return}var element=ev.currentTarget,item=_self.getItemByElement(element);if(_self.isItemDisabled(ev.item,ev.currentTarget)){return}if(!(UA.ie&&UA.ie<8)&&_self.get("focusable")&&_self.get("highlightedStatus")==="hover"){_self.setHighlighted(item,element)}else{_self.setItemStatus(item,"hover",true,element)}}).delegate("."+itemCls,"mouseout",function(ev){if(_self.get("disabled")){return}var sender=$(ev.currentTarget);
_self.get("view").setElementHover(sender,false)})},onAdd:function(e){var _self=this,store=_self.get("store"),item=e.record;if(_self.getCount()==0){_self.setItems(store.getResult())}else{_self.addItemToView(item,e.index)}},onRemove:function(e){var _self=this,item=e.record;_self.removeItem(item)},onUpdate:function(e){this.updateItem(e.record)},onLocalSort:function(e){if(this.get("frontSortable")){this.sort(e.field,e.direction)}else{this.onLoad(e)}},onLoad:function(){var _self=this,store=_self.get("store"),items=store.getResult();_self.set("items",items)}},{ATTRS:{frontSortable:{value:false},focusable:{value:false},items:{view:true,value:[]},itemCls:{view:true,value:CLS_ITEM},idField:{value:"value"},listSelector:{view:true,value:"ul"},itemTpl:{view:true,value:'<li role="option" class="'+CLS_ITEM+'">{text}</li>'},tpl:{value:"<ul></ul>"},xview:{value:simpleListView}}},{xclass:"simple-list",prority:0});simpleList.View=simpleListView;return simpleList});define("bui/list/listbox",["bui/list/simplelist"],function(require){var SimpleList=require("bui/list/simplelist");var listbox=SimpleList.extend({bindUI:function(){var _self=this;_self.on("selectedchange",function(e){var item=e.item,sender=$(e.domTarget),checkbox=sender.find("input");if(item){checkbox.attr("checked",e.selected)}})}},{ATTRS:{itemTpl:{value:'<li><span class="x-checkbox"></span>{text}</li>'},multipleSelect:{value:true}}},{xclass:"listbox"});return listbox});define("bui/list/listitem",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,UIBase=Component.UIBase;var itemView=Component.View.extend([UIBase.ListItemView],{});var item=Component.Controller.extend([UIBase.ListItem],{},{ATTRS:{elTagName:{view:true,value:"li"},xview:{value:itemView},tpl:{view:true,value:"<span>{text}</span>"}}},{xclass:"list-item"});item.View=itemView;return item});define("bui/list/list",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,UIBase=Component.UIBase;var list=Component.Controller.extend([UIBase.ChildList],{},{ATTRS:{elTagName:{view:true,value:"ul"},idField:{value:"id"},defaultChildClass:{value:"list-item"}}},{xclass:"list"});return list});define("bui/picker",["bui/common","bui/picker/picker","bui/picker/listpicker"],function(require){var BUI=require("bui/common"),Picker=BUI.namespace("Picker");BUI.mix(Picker,{Picker:require("bui/picker/picker"),ListPicker:require("bui/picker/listpicker")});return Picker});define("bui/picker/picker",["bui/overlay"],function(require){var Overlay=require("bui/overlay").Overlay;var picker=Overlay.extend({bindUI:function(){var _self=this,hideEvent=_self.get("hideEvent"),trigger=$(_self.get("trigger"));_self.on("show",function(ev){if(!_self.get("isInit")){_self._initControl()}if(_self.get("autoSetValue")){var valueField=_self.get("valueField")||_self.get("textField")||_self.get("curTrigger"),val=$(valueField).val();_self.setSelectedValue(val)}})},_initControl:function(){var _self=this;if(_self.get("isInit")){return}if(!_self.get("innerControl")){var control=_self.createControl();_self.get("children").push(control)}_self.initControlEvent();_self.set("isInit",true)},initControl:function(){this._initControl()},createControl:function(){},initControlEvent:function(){var _self=this,innerControl=_self.get("innerControl"),trigger=$(_self.get("trigger")),hideEvent=_self.get("hideEvent");innerControl.on(_self.get("changeEvent"),function(e){var curTrigger=_self.get("curTrigger"),textField=_self.get("textField")||curTrigger||trigger,valueField=_self.get("valueField"),selValue=_self.getSelectedValue(),isChange=false;if(textField){var selText=_self.getSelectedText(),preText=$(textField).val();if(selText!=preText){$(textField).val(selText);isChange=true;$(textField).trigger("change")}}if(valueField){var preValue=$(valueField).val();if(valueField!=preValue){$(valueField).val(selValue);isChange=true;$(valueField).trigger("change")}}if(isChange){_self.onChange(selText,selValue,e)}});if(hideEvent){innerControl.on(_self.get("hideEvent"),function(){var curTrigger=_self.get("curTrigger");try{if(curTrigger){curTrigger.focus()}}catch(e){BUI.log(e)}_self.hide()})}},setSelectedValue:function(val){},getSelectedValue:function(){},getSelectedText:function(){},focus:function(){this.get("innerControl").focus()},onChange:function(selText,selValue,ev){var _self=this,curTrigger=_self.get("curTrigger");_self.fire("selectedchange",{value:selValue,text:selText,curTrigger:curTrigger})},handleNavEsc:function(ev){this.hide()},_uiSetValueField:function(v){var _self=this;if(v!=null&&v!==""){_self.setSelectedValue($(v).val())}},_getTextField:function(){var _self=this;return _self.get("textField")||_self.get("curTrigger")}},{ATTRS:{innerControl:{getter:function(){return this.get("children")[0]}},triggerEvent:{value:"click"},autoSetValue:{value:true},changeEvent:{value:"selectedchange"},autoHide:{value:true},hideEvent:{value:"itemclick"},textField:{},align:{value:{points:["bl","tl"],offset:[0,0]}},valueField:{}}},{xclass:"picker"});
return picker});define("bui/picker/listpicker",["bui/picker/picker","bui/list"],function(require){var List=require("bui/list"),Picker=require("bui/picker/picker"),listPicker=Picker.extend({initializer:function(){var _self=this,children=_self.get("children"),list=_self.get("list");if(!list){children.push({})}},setSelectedValue:function(val){val=val?val.toString():"";if(!this.get("isInit")){this._initControl()}var _self=this,list=_self.get("list"),selectedValue=_self.getSelectedValue();if(val!==selectedValue&&list.getCount()){if(list.get("multipleSelect")){list.clearSelection()}list.setSelectionByField(val.split(","))}},onChange:function(selText,selValue,ev){var _self=this,curTrigger=_self.get("curTrigger");_self.fire("selectedchange",{value:selValue,text:selText,curTrigger:curTrigger,item:ev.item})},getSelectedValue:function(){if(!this.get("isInit")){this._initControl()}return this.get("list").getSelectionValues().join(",")},getSelectedText:function(){if(!this.get("isInit")){this._initControl()}return this.get("list").getSelectionText().join(",")}},{ATTRS:{defaultChildClass:{value:"simple-list"},list:{getter:function(){return this.get("children")[0]}}}},{xclass:"list-picker"});return listPicker});(function(){var BASE="bui/form/";define("bui/form",["bui/common",BASE+"fieldcontainer",BASE+"form",BASE+"row",BASE+"fieldgroup",BASE+"horizontal",BASE+"rules",BASE+"field",BASE+"fieldgroup"],function(r){var BUI=r("bui/common"),Form=BUI.namespace("Form"),Tips=r(BASE+"tips");BUI.mix(Form,{Tips:Tips,TipItem:Tips.Item,FieldContainer:r(BASE+"fieldcontainer"),Form:r(BASE+"form"),Row:r(BASE+"row"),Group:r(BASE+"fieldgroup"),HForm:r(BASE+"horizontal"),Rules:r(BASE+"rules"),Field:r(BASE+"field"),FieldGroup:r(BASE+"fieldgroup")});return Form})})();define("bui/form/tips",["bui/common","bui/overlay"],function(require){var BUI=require("bui/common"),prefix=BUI.prefix,Overlay=require("bui/overlay").Overlay,FIELD_TIP="data-tip",CLS_TIP_CONTAINER=prefix+"form-tip-container";var tipItem=Overlay.extend({initializer:function(){var _self=this,render=_self.get("render");if(!render){var parent=$(_self.get("trigger")).parent();_self.set("render",parent)}},renderUI:function(){var _self=this;_self.resetVisible()},resetVisible:function(){var _self=this,triggerEl=$(_self.get("trigger"));if(triggerEl.val()){_self.set("visible",false)}else{_self.set("align",{node:$(_self.get("trigger")),points:["cl","cl"]});_self.set("visible",true)}},bindUI:function(){var _self=this,triggerEl=$(_self.get("trigger"));_self.get("el").on("click",function(){_self.hide();triggerEl.focus()});triggerEl.on("click focus",function(){_self.hide()});triggerEl.on("blur",function(){_self.resetVisible()})}},{ATTRS:{trigger:{},text:{},iconCls:{},tpl:{value:'<span class="{iconCls}"></span><span class="tip-text">{text}</span>'}}},{xclass:"form-tip"});var Tips=function(config){if(this.constructor!==Tips){return new Tips(config)}Tips.superclass.constructor.call(this,config);this._init()};Tips.ATTRS={form:{},items:{valueFn:function(){return[]}}};BUI.extend(Tips,BUI.Base);BUI.augment(Tips,{_init:function(){var _self=this,form=$(_self.get("form"));if(form.length){BUI.each($.makeArray(form[0].elements),function(elem){var tipConfig=$(elem).attr(FIELD_TIP);if(tipConfig){_self._initFormElement(elem,$.parseJSON(tipConfig))}});form.addClass(CLS_TIP_CONTAINER)}},_initFormElement:function(element,config){if(config){config.trigger=element}var _self=this,items=_self.get("items"),item=new tipItem(config);items.push(item)},getItem:function(name){var _self=this,items=_self.get("items"),result=null;BUI.each(items,function(item){if($(item.get("trigger")).attr("name")===name){result=item;return false}});return result},resetVisible:function(){var _self=this,items=_self.get("items");BUI.each(items,function(item){item.resetVisible()})},render:function(){var _self=this,items=_self.get("items");BUI.each(items,function(item){item.render()})},destroy:function(){var _self=this,items=_self.get(items);BUI.each(items,function(item){item.destroy()})}});Tips.Item=tipItem;return Tips});define("bui/form/basefield",["bui/common","bui/form/tips","bui/form/valid","bui/form/remote"],function(require){var BUI=require("bui/common"),Component=BUI.Component,TipItem=require("bui/form/tips").Item,Valid=require("bui/form/valid"),Remote=require("bui/form/remote"),CLS_FIELD_ERROR=BUI.prefix+"form-field-error",DATA_ERROR="data-error";var fieldView=Component.View.extend([Remote.View,Valid.View],{renderUI:function(){var _self=this,control=_self.get("control");if(!control){var controlTpl=_self.get("controlTpl"),container=_self.getControlContainer();if(controlTpl){var control=$(controlTpl).appendTo(container);_self.set("control",control)}}else{_self.set("controlContainer",control.parent())}},clearErrors:function(){var _self=this,msgEl=_self.get("msgEl");if(msgEl){msgEl.remove();_self.set("msgEl",null)}_self.get("el").removeClass(CLS_FIELD_ERROR)},showError:function(msg,errorTpl){var _self=this,control=_self.get("control"),errorMsg=BUI.substitute(errorTpl,{error:msg}),el=$(errorMsg);
el.appendTo(control.parent());_self.set("msgEl",el);_self.get("el").addClass(CLS_FIELD_ERROR)},getControlContainer:function(){var _self=this,el=_self.get("el"),controlContainer=_self.get("controlContainer");if(controlContainer){if(BUI.isString(controlContainer)){controlContainer=el.find(controlContainer)}}return(controlContainer&&controlContainer.length)?controlContainer:el},getLoadingContainer:function(){return this.getControlContainer()},_uiSetName:function(v){var _self=this;_self.get("control").attr("name",v)}},{ATTRS:{error:{},controlContainer:{},msgEl:{},control:{}}});var field=Component.Controller.extend([Remote,Valid],{isField:true,initializer:function(){var _self=this;_self.on("afterRenderUI",function(){var tip=_self.get("tip");if(tip){tip.trigger=_self.getTipTigger();tip.autoRender=true;tip=new TipItem(tip);_self.set("tip",tip)}})},bindUI:function(){var _self=this,validEvent=_self.get("validEvent"),changeEvent=_self.get("changeEvent"),firstValidEvent=_self.get("firstValidEvent"),innerControl=_self.getInnerControl();if(innerControl.is("select")){validEvent="change"}innerControl.on(validEvent,function(){var value=_self.getControlValue(innerControl);_self.validControl(value)});if(firstValidEvent){innerControl.on(firstValidEvent,function(){if(!_self.get("hasValid")){var value=_self.getControlValue(innerControl);_self.validControl(value)}})}_self.on(changeEvent,function(){_self.onValid()});_self.on("remotecomplete",function(ev){_self._setError(ev.error)})},onValid:function(){var _self=this,value=_self.getControlValue();value=_self.parseValue(value);if(!_self.isCurrentValue(value)){_self.setInternal("value",value);_self.onChange()}},onChange:function(){this.fire("change")},isCurrentValue:function(value){return value==this.get("value")},_clearError:function(){this.set("error",null);this.get("view").clearErrors()},_setError:function(msg){this.set("error",msg);this.showErrors()},getControlValue:function(innerControl){var _self=this;innerControl=innerControl||_self.getInnerControl();return innerControl.val()},getControlContainer:function(){return this.get("view").getControlContainer()},getRemoteParams:function(){var _self=this,rst={};rst[_self.get("name")]=_self.getControlValue();return rst},setControlValue:function(value){var _self=this,innerControl=_self.getInnerControl();innerControl.val(value)},parseValue:function(value){return value},valid:function(){var _self=this;_self.validControl()},validControl:function(value){var _self=this,errorMsg;value=value||_self.getControlValue(),preError=_self.get("error");errorMsg=_self.getValidError(value);_self.setInternal("hasValid",true);if(errorMsg){_self._setError(errorMsg);_self.fire("error",{msg:errorMsg,value:value});if(preError!==errorMsg){_self.fire("validchange",{valid:false})}}else{_self._clearError();_self.fire("valid");if(preError){_self.fire("validchange",{valid:true})}}return !errorMsg},focus:function(){this.getInnerControl().focus()},change:function(){var control=this.getInnerControl();control.change()},blur:function(){this.getInnerControl().blur()},isValid:function(){var _self=this;if(!_self.get("hasValid")){_self.validControl()}return !_self.get("error")},getError:function(){return this.get("error")},getErrors:function(){var error=this.getError();if(error){return[error]}return[]},clearErrors:function(reset){var _self=this;_self._clearError();if(reset&&_self.getControlValue()!=_self.get("value")){_self.setControlValue(_self.get("value"))}},getInnerControl:function(){return this.get("view").get("control")},getTipTigger:function(){return this.getInnerControl()},destructor:function(){var _self=this,tip=_self.get("tip");if(tip&&tip.destroy){tip.destroy()}},setInnerWidth:function(width){var _self=this,innerControl=_self.getInnerControl(),siblings=innerControl.siblings(),appendWidth=innerControl.outerWidth()-innerControl.width();BUI.each(siblings,function(dom){appendWidth+=$(dom).outerWidth()});innerControl.width(width-appendWidth)},_resetTip:function(){var _self=this,tip=_self.get("tip");if(tip){tip.resetVisible()}},resetTip:function(){this._resetTip()},_uiSetValue:function(v){var _self=this;_self.setControlValue(v);if(_self.get("rendered")){_self.validControl();_self.onChange()}_self._resetTip()},_uiSetDisabled:function(v){var _self=this,innerControl=_self.getInnerControl(),children=_self.get("children");innerControl.attr("disabled",v);if(_self.get("rendered")){if(v){_self.clearErrors()}if(!v){_self.valid()}}BUI.each(children,function(child){child.set("disabled",v)})},_uiSetWidth:function(v){var _self=this;if(v!=null&&_self.get("forceFit")){_self.setInnerWidth(v)}}},{ATTRS:{hasValid:{value:false},forceFit:{value:false},tip:{},changeEvent:{value:"valid"},firstValidEvent:{value:"blur"},validEvent:{value:"keyup change"},name:{view:true},showError:{view:true,value:true},value:{view:true},label:{},controlContainer:{view:true},control:{view:true},controlTpl:{view:true,value:'<input type="text"/>'},events:{value:{error:false,valid:false,change:true,validchange:true}},tpl:{value:"<label>{label}</label>"},xview:{value:fieldView}},PARSER:{control:function(el){var control=el.find("input,select,textarea");
if(control.length){return control}return el},disabled:function(el){return !!el.attr("disabled")},value:function(el){var _self=this,selector="select,input,textarea",value=_self.get("value");if(!value){if(el.is(selector)){value=el.val();if(!value&&el.is("select")){value=el.attr("value")}}else{value=el.find(selector).val()}}return value},name:function(el){var _self=this,selector="select,input,textarea",name=_self.get("name");if(!name){if(el.is(selector)){name=el.attr("name")}else{name=el.find(selector).attr("name")}}return name}}},{xclass:"form-field"});field.View=fieldView;return field});define("bui/form/textfield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield");var textField=Field.extend({},{xclass:"form-field-text"});return textField});define("bui/form/textareafield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield");var TextAreaField=Field.extend({_uiSetRows:function(v){var _self=this,innerControl=_self.getInnerControl();if(v){innerControl.attr("rows",v)}},_uiSetCols:function(v){var _self=this,innerControl=_self.getInnerControl();if(v){innerControl.attr("cols",v)}}},{ATTRS:{controlTpl:{value:"<textarea></textarea>"},rows:{},cols:{},decorateCfgFields:{value:{"rows":true,"cols":true}}}},{xclass:"form-field-textarea"});return TextAreaField});define("bui/form/numberfield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield"),numberField=Field.extend({parseValue:function(value){if(value==""||value==null){return null}if(BUI.isNumber(value)){return value}var _self=this,allowDecimals=_self.get("allowDecimals");value=value.replace(/\,/g,"");if(!allowDecimals){return parseInt(value,10)}return parseFloat(parseFloat(value).toFixed(_self.get("decimalPrecision")))},_uiSetMax:function(v){this.addRule("max",v)},_uiSetMin:function(v){this.addRule("min",v)}},{ATTRS:{max:{},min:{},decorateCfgFields:{value:{min:true,max:true}},validEvent:{value:"keyup change"},defaultRules:{value:{number:true}},allowDecimals:{value:true},decimalPrecision:{value:2},step:{value:1}}},{xclass:"form-field-number"});return numberField});define("bui/form/hiddenfield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield");var hiddenField=Field.extend({},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},tpl:{value:""}}},{xclass:"form-field-hidden"});return hiddenField});define("bui/form/readonlyfield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield");var readonlyField=Field.extend({},{ATTRS:{controlTpl:{value:'<input type="text" readonly="readonly"/>'}}},{xclass:"form-field-readonly"});return readonlyField});define("bui/form/selectfield",["bui/common","bui/form/basefield"],function(require){var BUI=require("bui/common"),Field=require("bui/form/basefield");function resetOptions(select,options,self){select.children().remove();var emptyText=self.get("emptyText");if(emptyText&&self.get("showBlank")){appendItem("",emptyText,select)}BUI.each(options,function(option){appendItem(option.value,option.text,select)})}function appendItem(value,text,select){var str='<option value="'+value+'">'+text+"</option>";$(str).appendTo(select)}var selectField=Field.extend({renderUI:function(){var _self=this,innerControl=_self.getInnerControl(),select=_self.get("select");if(_self.get("srcNode")&&innerControl.is("select")){return}if($.isPlainObject(select)){_self._initSelect(select)}},_initSelect:function(select){var _self=this,items=_self.get("items");BUI.use("bui/select",function(Select){select.render=_self.getControlContainer();select.valueField=_self.getInnerControl();select.autoRender=true;select=new Select.Select(select);_self.set("select",select);_self.set("isCreate",true);_self.get("children").push(select);select.on("change",function(ev){var val=select.getSelectedValue();_self.set("value",val)})})},setItems:function(items){var _self=this,select=_self.get("select");if($.isPlainObject(items)){var tmp=[];BUI.each(items,function(v,n){tmp.push({value:n,text:v})});items=tmp}var control=_self.getInnerControl();if(control.is("select")){resetOptions(control,items,_self);_self.setControlValue(_self.get("value"));if(!_self.getControlValue()){_self.setInternal("value","")}}if(select){if(select.set){select.set("items",items)}else{select.items=items}}},setControlValue:function(value){var _self=this,select=_self.get("select"),innerControl=_self.getInnerControl();innerControl.val(value);if(select&&select.set&&select.getSelectedValue()!==value){select.setSelectedValue(value)}},getSelectedText:function(){var _self=this,select=_self.get("select"),innerControl=_self.getInnerControl();if(innerControl.is("select")){var dom=innerControl[0],item=dom.options[dom.selectedIndex];return item?item.text:""}else{return select.getSelectedText()}},getTipTigger:function(){var _self=this,select=_self.get("select");if(select&&select.rendered){return select.get("el").find("input")}return _self.get("el")},_uiSetItems:function(v){if(v){this.setItems(v)}},setInnerWidth:function(width){var _self=this,innerControl=_self.getInnerControl(),select=_self.get("select"),appendWidth=innerControl.outerWidth()-innerControl.width();
innerControl.width(width-appendWidth);if(select&&select.set){select.set("width",width)}}},{ATTRS:{items:{},controlTpl:{value:'<input type="hidden"/>'},showBlank:{value:true},emptyText:{value:"\u8bf7\u9009\u62e9"},select:{shared:false,value:{}}},PARSER:{emptyText:function(el){if(!this.get("showBlank")){return""}var options=el.find("option"),rst=this.get("emptyText");if(options.length){rst=$(options[0]).text()}return rst}}},{xclass:"form-field-select"});return selectField});define("bui/form/datefield",["bui/common","bui/form/basefield","bui/calendar"],function(require){var BUI=require("bui/common"),Field=require("bui/form/basefield"),DateUtil=BUI.Date;var dateField=Field.extend({renderUI:function(){var _self=this,datePicker=_self.get("datePicker");if($.isPlainObject(datePicker)){_self.initDatePicker(datePicker)}if((datePicker.get&&datePicker.get("showTime"))||datePicker.showTime){_self.getInnerControl().addClass("calendar-time")}},initDatePicker:function(datePicker){var _self=this;BUI.use("bui/calendar",function(Calendar){datePicker.trigger=_self.getInnerControl();datePicker.autoRender=true;datePicker=new Calendar.DatePicker(datePicker);_self.set("datePicker",datePicker);_self.set("isCreatePicker",true);_self.get("children").push(datePicker)})},setControlValue:function(value){var _self=this,innerControl=_self.getInnerControl();if(BUI.isDate(value)){value=DateUtil.format(value,_self._getFormatMask())}innerControl.val(value)},_getFormatMask:function(){var _self=this,datePicker=_self.get("datePicker");if(datePicker.showTime||(datePicker.get&&datePicker.get("showTime"))){return"yyyy-mm-dd HH:MM:ss"}return"yyyy-mm-dd"},parseValue:function(value){if(BUI.isNumber(value)){return new Date(value)}return DateUtil.parse(value)},isCurrentValue:function(value){return DateUtil.isEquals(value,this.get("value"))},_uiSetMax:function(v){this.addRule("max",v);var _self=this,datePicker=_self.get("datePicker");if(datePicker){if(datePicker.set){datePicker.set("maxDate",v)}else{datePicker.maxDate=v}}},_uiSetMin:function(v){this.addRule("min",v);var _self=this,datePicker=_self.get("datePicker");if(datePicker){if(datePicker.set){datePicker.set("minDate",v)}else{datePicker.minDate=v}}}},{ATTRS:{controlTpl:{value:'<input type="text" class="calendar"/>'},defaultRules:{value:{date:true}},max:{},min:{},value:{setter:function(v){if(BUI.isNumber(v)){return new Date(v)}return v}},datePicker:{shared:false,value:{}},isCreatePicker:{value:true}},PARSER:{datePicker:function(el){var _self=this,cfg=_self.get("datePicker")||{};if(el.hasClass("calendar-time")){BUI.mix(cfg,{showTime:true})}return cfg}}},{xclass:"form-field-date"});return dateField});define("bui/form/checkfield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield");var checkField=Field.extend({onValid:function(){var _self=this,checked=_self._getControlChecked();_self.setInternal("checked",checked);_self.fire("change");if(checked){_self.fire("checked")}else{_self.fire("unchecked")}},_setControlChecked:function(checked){var _self=this,innerControl=_self.getInnerControl();innerControl.attr("checked",!!checked)},_getControlChecked:function(){var _self=this,innerControl=_self.getInnerControl();return !!innerControl.attr("checked")},_uiSetValue:function(v){},_uiSetWidth:function(v){},_uiSetChecked:function(v){var _self=this;_self._setControlChecked(v);if(_self.get("rendered")){_self.onValid()}}},{ATTRS:{validEvent:{value:"click"},checked:{value:false},events:{value:{"checked":false,"unchecked":false}}},PARSER:{checked:function(el){return !!el.attr("checked")}}},{xclass:"form-check-field"});return checkField});define("bui/form/checkboxfield",["bui/form/checkfield"],function(required){var CheckField=required("bui/form/checkfield");var CheckBoxField=CheckField.extend({},{ATTRS:{controlTpl:{view:true,value:'<input type="checkbox"/>'},controlContainer:{value:".checkbox"},tpl:{value:'<label><span class="checkbox"></span>{label}</label>'}}},{xclass:"form-field-checkbox"});return CheckBoxField});define("bui/form/radiofield",["bui/form/checkfield"],function(required){var CheckField=required("bui/form/checkfield");var RadioField=CheckField.extend({bindUI:function(){var _self=this,parent=_self.get("parent"),name=_self.get("name");if(parent){_self.getInnerControl().on("click",function(ev){var fields=parent.getFields(name);BUI.each(fields,function(field){if(field!=_self){field.set("checked",false)}})})}}},{ATTRS:{controlTpl:{view:true,value:'<input type="radio"/>'},controlContainer:{value:".radio"},tpl:{value:'<label><span class="radio"></span>{label}</label>'}}},{xclass:"form-field-radio"});return RadioField});define("bui/form/plainfield",["bui/form/basefield"],function(require){var Field=require("bui/form/basefield");var PlainFieldView=Field.View.extend({_uiSetValue:function(v){var _self=this,textEl=_self.get("textEl"),container=_self.getControlContainer(),renderer=_self.get("renderer"),text=renderer?renderer(v):v,width=_self.get("width"),appendWidth=0,textTpl;if(textEl){textEl.remove()
}text=text||"&nbsp;";textTpl=BUI.substitute(_self.get("textTpl"),{text:text});textEl=$(textTpl).appendTo(container);appendWidth=textEl.outerWidth()-textEl.width();textEl.width(width-appendWidth);_self.set("textEl",textEl)}},{ATTRS:{textEl:{},value:{}}},{xclass:"form-field-plain-view"});var PlainField=Field.extend({},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},textTpl:{view:true,value:'<span class="x-form-text">{text}</span>'},renderer:{view:true,value:function(value){return value}},tpl:{value:""},xview:{value:PlainFieldView}}},{xclass:"form-field-plain"});return PlainField});define("bui/form/listfield",["bui/common","bui/form/basefield","bui/list"],function(require){var BUI=require("bui/common"),List=require("bui/list"),Field=require("bui/form/basefield");function parseItems(items){var rst=items;if($.isPlainObject(items)){rst=[];BUI.each(items,function(v,k){rst.push({text:v,value:k})})}return rst}var List=Field.extend({initializer:function(){var _self=this;_self._initList()},_getList:function(){var _self=this,children=_self.get("children");return children[0]},bindUI:function(){var _self=this,list=_self._getList();if(list){list.on("selectedchange",function(){var value=_self._getListValue(list);_self.set("value",value)})}},_getListValue:function(list){var _self=this;list=list||_self._getList();return list.getSelectionValues().join(",")},setControlValue:function(value){var _self=this,innerControl=_self.getInnerControl(),list=_self._getList();innerControl.val(value);if(_self._getListValue(list)!==value&&list.getCount()){if(list.get("multipleSelect")){list.clearSelection()}list.setSelectionByField(value.split(","))}},syncUI:function(){this.set("list",this._getList())},_initList:function(){var _self=this,defaultListCfg=_self.get("defaultListCfg"),children=_self.get("children"),list=_self.get("list")||{};if(children[0]){return}if($.isPlainObject(list)){BUI.mix(list,defaultListCfg)}children.push(list)},setItems:function(items){var _self=this,value=_self.get("value"),list=_self._getList();list.set("items",parseItems(items));list.setSelectionByField(value.split(","))},_uiSetItems:function(v){if(v){this.setItems(v)}}},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},defaultListCfg:{value:{xclass:"simple-list"}},items:{setter:function(v){if($.isPlainObject(v)){var rst=[];BUI.each(v,function(v,k){rst.push({value:k,text:v})});v=rst}return v}},list:{}},PARSER:{list:function(el){var listEl=el.find(".bui-simple-list");if(listEl.length){return{srcNode:listEl}}}}},{xclass:"form-field-list"});return List});define("bui/form/uploaderfield",["bui/common","bui/form/basefield","bui/form/rules"],function(require){var BUI=require("bui/common"),JSON=BUI.JSON,Field=require("bui/form/basefield"),Rules=require("bui/form/rules");var uploaderField=Field.extend({renderUI:function(){var _self=this,innerControl=_self.getInnerControl();if(_self.get("srcNode")&&innerControl.get(0).type==="file"){return}_self._initControlValue();_self._initUpload()},_initUpload:function(){var _self=this,children=_self.get("children"),uploader=_self.get("uploader")||{};BUI.use("bui/uploader",function(Uploader){uploader.render=_self.getControlContainer();uploader.autoRender=true;uploader=new Uploader.Uploader(uploader);_self.set("uploader",uploader);_self.set("isCreate",true);_self.get("children").push(uploader);_self._initQueue(uploader.get("queue"));uploader.on("success",function(ev){var result=_self._getUploaderResult();_self.setControlValue(result)});uploader.get("queue").on("itemremoved",function(){var result=_self._getUploaderResult();_self.setControlValue(result)})})},_getUploaderResult:function(){var _self=this,uploader=_self.get("uploader"),queue=uploader.get("queue"),items=queue.getItems(),result=[];BUI.each(items,function(item){item.result&&result.push(item.result)});return result},setControlValue:function(items){var _self=this,innerControl=_self.getInnerControl();innerControl.val(JSON.stringify(items))},_initControlValue:function(){var _self=this,textValue=_self.getControlValue(),value;if(textValue){value=BUI.JSON.parse(textValue);_self.set("value",value)}},_initQueue:function(queue){var _self=this,value=_self.get("value"),result=[];BUI.each(value,function(item){var newItem=BUI.cloneObject(item);newItem.success=true;newItem.result=item;result.push(newItem)});queue&&queue.setItems(result)}},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},uploader:{setter:function(v){var disabled=this.get("disabled");v&&v.isController&&v.set("disabled",disabled);return v}},disabled:{setter:function(v){var _self=this,uploader=_self.get("uploader");uploader&&uploader.isController&&uploader.set("disabled",v)}},value:{shared:false,value:[]},defaultRules:function(){uploader:true}}},{xclass:"form-field-uploader"});Rules.add({name:"uploader",msg:"\u4e0a\u4f20\u6587\u4ef6\u9009\u62e9\u6709\u8bef\uff01",validator:function(value,baseValue,formatMsg,field){var uploader=field.get("uploader");if(uploader&&!uploader.isValid()){return formatMsg}}});return uploaderField});
define("bui/form/checklistfield",["bui/common","bui/form/listfield"],function(require){var BUI=require("bui/common"),ListField=require("bui/form/listfield");var CheckList=ListField.extend({},{ATTRS:{defaultListCfg:{value:{itemTpl:'<li><span class="x-checkbox"></span>{text}</li>',multipleSelect:true,allowTextSelection:false}}}},{xclass:"form-field-checklist"});return CheckList});define("bui/form/radiolistfield",["bui/common","bui/form/listfield"],function(require){var BUI=require("bui/common"),ListField=require("bui/form/listfield");var RadioList=ListField.extend({},{ATTRS:{defaultListCfg:{value:{itemTpl:'<li><span class="x-radio"></span>{text}</li>',allowTextSelection:false}}}},{xclass:"form-field-radiolist"});return RadioList});(function(){var BASE="bui/form/";define(BASE+"field",["bui/common",BASE+"textfield",BASE+"datefield",BASE+"selectfield",BASE+"hiddenfield",BASE+"numberfield",BASE+"checkfield",BASE+"radiofield",BASE+"checkboxfield",BASE+"plainfield",BASE+"listfield",BASE+"uploaderfield",BASE+"checklistfield",BASE+"radiolistfield",BASE+"textareafield"],function(require){var BUI=require("bui/common"),Field=require(BASE+"basefield");BUI.mix(Field,{Text:require(BASE+"textfield"),Date:require(BASE+"datefield"),Select:require(BASE+"selectfield"),Hidden:require(BASE+"hiddenfield"),Number:require(BASE+"numberfield"),Check:require(BASE+"checkfield"),Radio:require(BASE+"radiofield"),Checkbox:require(BASE+"checkboxfield"),Plain:require(BASE+"plainfield"),List:require(BASE+"listfield"),TextArea:require(BASE+"textareafield"),Uploader:require(BASE+"uploaderfield"),CheckList:require(BASE+"checklistfield"),RadioList:require(BASE+"radiolistfield")});return Field})})();define("bui/form/valid",["bui/common","bui/form/rules"],function(require){var BUI=require("bui/common"),Rules=require("bui/form/rules");var ValidView=function(){};ValidView.prototype={getErrorsContainer:function(){var _self=this,errorContainer=_self.get("errorContainer");if(errorContainer){if(BUI.isString(errorContainer)){return _self.get("el").find(errorContainer)}return errorContainer}return _self.getContentElement()},showErrors:function(errors){var _self=this,errorsContainer=_self.getErrorsContainer(),errorTpl=_self.get("errorTpl");_self.clearErrors();if(!_self.get("showError")){return}if(_self.get("showOneError")){if(errors&&errors.length){_self.showError(errors[0],errorTpl,errorsContainer)}return}BUI.each(errors,function(error){if(error){_self.showError(error,errorTpl,errorsContainer)}})},showError:function(msg,errorTpl,container){},clearErrors:function(){}};var Valid=function(){};Valid.ATTRS={defaultRules:{value:{}},defaultMessages:{value:{}},rules:{shared:false,value:{}},messages:{shared:false,value:{}},validator:{},errorContainer:{view:true},errorTpl:{view:true,value:'<span class="x-field-error"><span class="x-icon x-icon-mini x-icon-error">!</span><label class="x-field-error-text">{error}</label></span>'},showError:{view:true,value:true},showOneError:{},error:{}};Valid.prototype={__bindUI:function(){var _self=this;_self.on("afterDisabledChange",function(ev){var disabled=ev.newVal;if(disabled){_self.clearErrors(false,false)}else{_self.valid()}})},isValid:function(){},valid:function(){},validControl:function(){},validRules:function(rules,value){if(!rules){return}var _self=this,messages=_self._getValidMessages(),error=null;for(var name in rules){if(rules.hasOwnProperty(name)){var baseValue=rules[name];error=Rules.valid(name,value,baseValue,messages[name],_self);if(error){break}}}return error},_getValidMessages:function(){var _self=this,defaultMessages=_self.get("defaultMessages"),messages=_self.get("messages");return BUI.merge(defaultMessages,messages)},getValidError:function(value){var _self=this,validator=_self.get("validator"),error=null;error=_self.validRules(_self.get("defaultRules"),value)||_self.validRules(_self.get("rules"),value);if(!error){if(_self.parseValue){value=_self.parseValue(value)}error=validator?validator.call(this,value):""}return error},getErrors:function(){},showErrors:function(errors){var _self=this,errors=errors||_self.getErrors();_self.get("view").showErrors(errors)},clearErrors:function(reset,deep){deep=deep==null?true:deep;var _self=this,children=_self.get("children");if(deep){BUI.each(children,function(item){if(item.clearErrors){if(item.field){item.clearErrors(reset)}else{item.clearErrors(deep,reset)}}})}_self.set("error",null);_self.get("view").clearErrors()},addRule:function(name,value,message){var _self=this,rules=_self.get("rules"),messages=_self.get("messages");rules[name]=value;if(message){messages[name]=message}},addRules:function(rules,messages){var _self=this;BUI.each(rules,function(value,name){var msg=messages?messages[name]:null;_self.addRule(name,value,msg)})},removeRule:function(name){var _self=this,rules=_self.get("rules");delete rules[name]},clearRules:function(){var _self=this;_self.set("rules",{})}};Valid.View=ValidView;return Valid});define("bui/form/groupvalid",["bui/form/valid"],function(require){var CLS_ERROR="x-form-error",Valid=require("bui/form/valid");
function GroupValidView(){}BUI.augment(GroupValidView,Valid.View,{showError:function(msg,errorTpl,container){var errorMsg=BUI.substitute(errorTpl,{error:msg}),el=$(errorMsg);el.appendTo(container);el.addClass(CLS_ERROR)},clearErrors:function(){var _self=this,errorContainer=_self.getErrorsContainer();errorContainer.children("."+CLS_ERROR).remove()}});function GroupValid(){}GroupValid.ATTRS=ATTRS=BUI.merge(true,Valid.ATTRS,{events:{value:{validchange:true,change:true}}});BUI.augment(GroupValid,Valid,{__bindUI:function(){var _self=this,validEvent="validchange change";_self.on(validEvent,function(ev){var sender=ev.target;if(sender!=this&&_self.get("showError")){var valid=sender.isValid();if(_self._hasAllChildrenValid()){valid=valid&&_self.isChildrenValid();if(valid){_self.validControl(_self.getRecord());valid=_self.isSelfValid()}}if(!valid){_self.showErrors()}else{_self.clearErrors()}}})},isValid:function(){if(this.get("disabled")){return true}var _self=this,isValid=_self.isChildrenValid();return isValid&&_self.isSelfValid()},valid:function(){var _self=this,children=_self.get("children");if(_self.get("disabled")){return}BUI.each(children,function(item){if(!item.get("disabled")){item.valid()}})},_hasAllChildrenValid:function(){var _self=this,children=_self.get("children"),rst=true;BUI.each(children,function(item){if(!item.get("disabled")&&item.get("hasValid")===false){rst=false;return false}});return rst},isChildrenValid:function(){var _self=this,children=_self.get("children"),isValid=true;BUI.each(children,function(item){if(!item.get("disabled")&&!item.isValid()){isValid=false;return false}});return isValid},isSelfValid:function(){return !this.get("error")},validControl:function(record){var _self=this,error=_self.getValidError(record);_self.set("error",error)},getErrors:function(){var _self=this,children=_self.get("children"),showChildError=_self.get("showChildError"),validError=null,rst=[];if(showChildError){BUI.each(children,function(child){if(child.getErrors){rst=rst.concat(child.getErrors())}})}if(_self._hasAllChildrenValid()&&_self.isChildrenValid()){validError=_self.get("error");if(validError){rst.push(validError)}}return rst},_uiSetErrorTpl:function(v){var _self=this,children=_self.get("children");BUI.each(children,function(item){if(!item.get("userConfig")["errorTpl"]){item.set("errorTpl",v)}})}});GroupValid.View=GroupValidView;return GroupValid});define("bui/form/fieldcontainer",["bui/common","bui/form/field","bui/form/groupvalid"],function(require){var BUI=require("bui/common"),Field=require("bui/form/field"),GroupValid=require("bui/form/groupvalid"),PREFIX=BUI.prefix;var FIELD_XCLASS="form-field",CLS_FIELD=PREFIX+FIELD_XCLASS,CLS_GROUP=PREFIX+"form-group",FIELD_TAGS="input,select,textarea";function isField(node){return node.is(FIELD_TAGS)}function getDecorateChilds(node,srcNode){if(node!=srcNode){if(isField(node)){return[node]}var cls=node.attr("class");if(cls&&(cls.indexOf(CLS_GROUP)!==-1||cls.indexOf(CLS_FIELD)!==-1)){return[node]}}var rst=[],children=node.children();BUI.each(children,function(subNode){rst=rst.concat(getDecorateChilds($(subNode),srcNode))});return rst}var containerView=BUI.Component.View.extend([GroupValid.View]);var container=BUI.Component.Controller.extend([GroupValid],{syncUI:function(){var _self=this,fields=_self.getFields(),validators=_self.get("validators");BUI.each(fields,function(field){var name=field.get("name");if(validators[name]){field.set("validator",validators[name])}});BUI.each(validators,function(item,key){if(key.indexOf("#")==0){var id=key.replace("#",""),child=_self.getChild(id,true);if(child){child.set("validator",item)}}})},getDecorateElments:function(){var _self=this,el=_self.get("el");var items=getDecorateChilds(el,el);return items},findXClassByNode:function(childNode,ignoreError){if(childNode.attr("type")==="checkbox"){return FIELD_XCLASS+"-checkbox"}if(childNode.attr("type")==="radio"){return FIELD_XCLASS+"-radio"}if(childNode.attr("type")==="number"){return FIELD_XCLASS+"-number"}if(childNode.hasClass("calendar")){return FIELD_XCLASS+"-date"}if(childNode[0].tagName=="SELECT"){return FIELD_XCLASS+"-select"}if(isField(childNode)){return FIELD_XCLASS}return BUI.Component.Controller.prototype.findXClassByNode.call(this,childNode,ignoreError)},getRecord:function(){var _self=this,rst={},fields=_self.getFields();BUI.each(fields,function(field){var name=field.get("name"),value=_self._getFieldValue(field);if(!rst[name]){rst[name]=value}else{if(BUI.isArray(rst[name])&&value!=null){rst[name].push(value)}else{if(value!=null){var arr=[rst[name]];arr.push(value);rst[name]=arr}}}});return rst},getFields:function(name){var _self=this,rst=[],children=_self.get("children");BUI.each(children,function(item){if(item instanceof Field){if(!name||item.get("name")==name){rst.push(item)}}else{if(item.getFields){rst=rst.concat(item.getFields(name))}}});return rst},getField:function(name){var _self=this,fields=_self.getFields(),rst=null;BUI.each(fields,function(field){if(field.get("name")===name){rst=field;
return false}});return rst},getFieldAt:function(index){return this.getFields()[index]},setFieldValue:function(name,value){var _self=this,fields=_self.getFields(name);BUI.each(fields,function(field){_self._setFieldValue(field,value)})},_setFieldValue:function(field,value){if(field.get("disabled")){return}if(field instanceof Field.Check){var fieldValue=field.get("value");if(value&&(fieldValue===value||(BUI.isArray(value)&&BUI.Array.contains(fieldValue,value)))){field.set("checked",true)}else{field.set("checked",false)}}else{if(value==null){value=""}field.set("value",value)}},getFieldValue:function(name){var _self=this,fields=_self.getFields(name),rst=[];BUI.each(fields,function(field){var value=_self._getFieldValue(field);if(value){rst.push(value)}});if(rst.length===0){return null}if(rst.length===1){return rst[0]}return rst},_getFieldValue:function(field){if(!(field instanceof Field.Check)||field.get("checked")){return field.get("value")}return null},clearFields:function(){this.clearErrors();this.setRecord({})},setRecord:function(record){var _self=this,fields=_self.getFields();BUI.each(fields,function(field){var name=field.get("name");_self._setFieldValue(field,record[name])})},updateRecord:function(record){var _self=this,fields=_self.getFields();BUI.each(fields,function(field){var name=field.get("name");if(record.hasOwnProperty(name)){_self._setFieldValue(field,record[name])}})},focus:function(){var _self=this,fields=_self.getFields(),firstField=fields[0];if(firstField){firstField.focus()}},_uiSetDisabled:function(v){var _self=this,children=_self.get("children");BUI.each(children,function(item){item.set("disabled",v)})}},{ATTRS:{record:{setter:function(v){this.setRecord(v)},getter:function(){return this.getRecord()}},validators:{value:{}},defaultLoaderCfg:{value:{property:"children",dataType:"json"}},disabled:{sync:false},isDecorateChild:{value:true},xview:{value:containerView}}},{xclass:"form-field-container"});container.View=containerView;return container});define("bui/form/group/base",["bui/common","bui/form/fieldcontainer"],function(require){var BUI=require("bui/common"),FieldContainer=require("bui/form/fieldcontainer");var Group=FieldContainer.extend({},{ATTRS:{label:{view:true},defaultChildClass:{value:"form-field"}}},{xclass:"form-group"});return Group});define("bui/form/group/range",["bui/form/group/base"],function(require){var Group=require("bui/form/group/base");function testRange(self,curVal,prevVal){var allowEqual=self.get("allowEqual");if(allowEqual){return prevVal<=curVal}return prevVal<curVal}var Range=Group.extend({},{ATTRS:{rangeText:{value:"\u5f00\u59cb\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\uff01"},allowEqual:{value:true},validator:{value:function(record){var _self=this,fields=_self.getFields(),valid=true;for(var i=1;i<fields.length;i++){var cur=fields[i],prev=fields[i-1],curVal,prevVal;if(cur&&prev){curVal=cur.get("value");prevVal=prev.get("value");if(!testRange(_self,curVal,prevVal)){valid=false;break}}}if(!valid){return _self.get("rangeText")}return null}}}},{xclass:"form-group-range"});return Range});define("bui/form/group/check",["bui/form/group/base"],function(require){var Group=require("bui/form/group/base");function getFieldName(self){var firstField=self.getFieldAt(0);if(firstField){return firstField.get("name")}return""}var Check=Group.extend({bindUI:function(){var _self=this;_self.on("change",function(ev){var name=getFieldName(_self),range=_self.get("range"),record=_self.getRecord(),value=record[name],max=range[1];if(value&&value.length>=max){_self._setFieldsEnable(name,false)}else{_self._setFieldsEnable(name,true)}})},_setFieldsEnable:function(name,enable){var _self=this,fields=_self.getFields(name);BUI.each(fields,function(field){if(enable){field.enable()}else{if(!field.get("checked")){field.disable()}}})},_uiSetRange:function(v){this.addRule("checkRange",v)}},{ATTRS:{range:{setter:function(v){if(BUI.isString(v)||BUI.isNumber(v)){v=[parseInt(v,10)]}return v}}}},{xclass:"form-group-check"});return Check});define("bui/form/group/select",["bui/form/group/base","bui/data"],function(require){var Group=require("bui/form/group/base"),Data=require("bui/data"),Bindable=BUI.Component.UIBase.Bindable;function getItems(nodes){var items=[];BUI.each(nodes,function(node){items.push({text:node.text,value:node.id})});return items}var Select=Group.extend([Bindable],{initializer:function(){var _self=this,url=_self.get("url"),store=_self.get("store")||_self._getStore();if(!store.isStore){store.autoLoad=true;if(url){store.url=url}store=new Data.TreeStore(store);_self.set("store",store)}},bindUI:function(){var _self=this;_self.on("change",function(ev){var target=ev.target;if(target!=_self){var field=target,value=field.get("value"),level=_self._getFieldIndex(field)+1;_self._valueChange(value,level)}})},onLoad:function(e){var _self=this,node=e?e.node:_self.get("store").get("root");_self._setFieldItems(node.level,node.children)},_getStore:function(){var _self=this,type=_self.get("type");if(type&&TypeMap[type]){return TypeMap[type]
}return{}},_valueChange:function(value,level){var _self=this,store=_self.get("store");if(value){var node=store.findNode(value);if(!node){return}if(store.isLoaded(node)){_self._setFieldItems(level,node.children)}else{store.loadNode(node)}}else{_self._setFieldItems(level,[])}},_setFieldItems:function(level,nodes){var _self=this,field=_self.getFieldAt(level),items=getItems(nodes);if(field){field.setItems(items);_self._valueChange(field.get("value"),level+1)}},_getFieldIndex:function(field){var _self=this,fields=_self.getFields();return BUI.Array.indexOf(field,fields)}},{ATTRS:{type:{},store:{}}},{xclass:"form-group-select"});var TypeMap={};Select.addType=function(name,cfg){TypeMap[name]=cfg};Select.addType("city",{proxy:{url:"http://lp.taobao.com/go/rgn/citydistrictdata.php",dataType:"jsonp"},map:{isleaf:"leaf",value:"text"}});return Select});define("bui/form/fieldgroup",["bui/common","bui/form/group/base","bui/form/group/range","bui/form/group/check","bui/form/group/select"],function(require){var BUI=require("bui/common"),Group=require("bui/form/group/base");BUI.mix(Group,{Range:require("bui/form/group/range"),Check:require("bui/form/group/check"),Select:require("bui/form/group/select")});return Group});define("bui/form/form",["bui/common","bui/form/fieldcontainer"],function(require){var BUI=require("bui/common"),TYPE_SUBMIT={NORMAL:"normal",AJAX:"ajax",IFRAME:"iframe"},FieldContainer=require("bui/form/fieldcontainer"),Component=BUI.Component;var FormView=FieldContainer.View.extend({_uiSetMethod:function(v){this.get("el").attr("method",v)},_uiSetAction:function(v){this.get("el").attr("action",v)}},{ATTRS:{method:{},action:{}}},{xclass:"form-view"});var Form=FieldContainer.extend({renderUI:function(){var _self=this,buttonBar=_self.get("buttonBar"),cfg;if($.isPlainObject(buttonBar)&&_self.get("buttons")){cfg=BUI.merge(_self.getDefaultButtonBarCfg(),buttonBar);_self._initButtonBar(cfg)}_self._initSubmitMask()},_initButtonBar:function(cfg){var _self=this;BUI.use("bui/toolbar",function(Toolbar){buttonBar=new Toolbar.Bar(cfg);_self.set("buttonBar",buttonBar)})},bindUI:function(){var _self=this,formEl=_self.get("el");formEl.on("submit",function(ev){_self.valid();if(!_self.isValid()||_self.onBeforeSubmit()===false){ev.preventDefault();_self.focusError();return}if(_self.isValid()&&_self.get("submitType")===TYPE_SUBMIT.AJAX){ev.preventDefault();_self.ajaxSubmit()}})},getDefaultButtonBarCfg:function(){var _self=this,buttons=_self.get("buttons");return{autoRender:true,elCls:"toolbar",render:_self.get("el"),items:buttons,defaultChildClass:"bar-item-button"}},focusError:function(){var _self=this,fields=_self.getFields();BUI.each(fields,function(field){if(field.get("visible")&&!field.get("disabled")&&!field.isValid()){try{field.focus()}catch(e){BUI.log(e)}return false}})},submit:function(options){var _self=this,submitType=_self.get("submitType");_self.valid();if(_self.isValid()){if(_self.onBeforeSubmit()==false){return}if(submitType===TYPE_SUBMIT.NORMAL){_self.get("el")[0].submit()}else{if(submitType===TYPE_SUBMIT.AJAX){_self.ajaxSubmit(options)}}}else{_self.focusError()}},ajaxSubmit:function(options){var _self=this,method=_self.get("method"),action=_self.get("action"),callback=_self.get("callback"),submitMask=_self.get("submitMask"),data=_self.serializeToObject(),success,ajaxParams=BUI.merge(true,{url:action,type:method,dataType:"json",data:data},options);if(options&&options.success){success=options.success}ajaxParams.success=function(data){if(submitMask&&submitMask.hide){submitMask.hide()}if(success){success(data)}callback&&callback.call(_self,data)};if(submitMask&&submitMask.show){submitMask.show()}$.ajax(ajaxParams)},_initSubmitMask:function(){var _self=this,submitType=_self.get("submitType"),submitMask=_self.get("submitMask");if(submitType===TYPE_SUBMIT.AJAX&&submitMask){BUI.use("bui/mask",function(Mask){var cfg=$.isPlainObject(submitMask)?submitMask:{};submitMask=new Mask.LoadMask(BUI.mix({el:_self.get("el")},cfg));_self.set("submitMask",submitMask)})}},serializeToObject:function(){return BUI.FormHelper.serializeToObject(this.get("el")[0])},toObject:function(){return this.serializeToObject()},onBeforeSubmit:function(){return this.fire("beforesubmit")},reset:function(){var _self=this,initRecord=_self.get("initRecord");_self.setRecord(initRecord)},resetTips:function(){var _self=this,fields=_self.getFields();BUI.each(fields,function(field){field.resetTip()})},destructor:function(){var _self=this,buttonBar=_self.get("buttonBar"),submitMask=_self.get("submitMask");if(buttonBar&&buttonBar.destroy){buttonBar.destroy()}if(submitMask&&submitMask.destroy){submitMask.destroy()}},_uiSetInitRecord:function(v){this.setRecord(v)}},{ATTRS:{action:{view:true,value:""},allowTextSelection:{value:true},events:{value:{beforesubmit:false}},method:{view:true,value:"get"},defaultLoaderCfg:{value:{autoLoad:true,property:"record",dataType:"json"}},submitMask:{value:{msg:"\u6b63\u5728\u63d0\u4ea4\u3002\u3002\u3002"}},submitType:{value:"normal"},focusError:{value:true},callback:{},decorateCfgFields:{value:{"method":true,"action":true}},defaultChildClass:{value:"form-field"},elTagName:{value:"form"},buttons:{},buttonBar:{shared:false,value:{}},childContainer:{value:".x-form-fields"},initRecord:{},showError:{value:false},xview:{value:FormView},tpl:{value:'<div class="x-form-fields"></div>'}}},{xclass:"form"});
Form.View=FormView;return Form});define("bui/form/horizontal",["bui/common","bui/form/form"],function(require){var BUI=require("bui/common"),Form=require("bui/form/form");var Horizontal=Form.extend({getDefaultButtonBarCfg:function(){var _self=this,buttons=_self.get("buttons");return{autoRender:true,elCls:"actions-bar toolbar row",tpl:'<div class="form-actions span21 offset3"></div>',childContainer:".form-actions",render:_self.get("el"),items:buttons,defaultChildClass:"bar-item-button"}}},{ATTRS:{defaultChildClass:{value:"form-row"},errorTpl:{value:'<span class="valid-text"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error">!</span><em>{error}</em></span></span>'},elCls:{value:"form-horizontal"}},PARSER:{}},{xclass:"form-horizontal"});return Horizontal});define("bui/form/row",["bui/common","bui/form/fieldcontainer"],function(require){var BUI=require("bui/common"),FieldContainer=require("bui/form/fieldcontainer");var Row=FieldContainer.extend({},{ATTRS:{elCls:{value:"row"},defaultChildCfg:{value:{tpl:' <label class="control-label">{label}</label>                <div class="controls">                </div>',childContainer:".controls",showOneError:true,controlContainer:".controls",elCls:"control-group span8",errorTpl:'<span class="valid-text"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error">!</span><em>{error}</em></span></span>'}},defaultChildClass:{value:"form-field-text"}}},{xclass:"form-row"});return Row});define("bui/form/rule",["bui/common"],function(require){var BUI=require("bui/common");var Rule=function(config){Rule.superclass.constructor.call(this,config)};BUI.extend(Rule,BUI.Base);Rule.ATTRS={name:{},msg:{},validator:{value:function(value,baseValue,formatedMsg,control){}}};function valid(self,value,baseValue,msg,control){if(BUI.isArray(baseValue)&&BUI.isString(baseValue[1])){if(baseValue[1]){msg=baseValue[1]}baseValue=baseValue[0]}var _self=self,validator=_self.get("validator"),formatedMsg=formatError(self,baseValue,msg),valid=true;value=value==null?"":value;return validator.call(_self,value,baseValue,formatedMsg,control)}function parseParams(values){if(values==null){return{}}if($.isPlainObject(values)){return values}var ars=values,rst={};if(BUI.isArray(values)){for(var i=0;i<ars.length;i++){rst[i]=ars[i]}return rst}return{"0":values}}function formatError(self,values,msg){var ars=parseParams(values);msg=msg||self.get("msg");return BUI.substitute(msg,ars)}BUI.augment(Rule,{valid:function(value,baseValue,msg,control){var _self=this;return valid(_self,value,baseValue,msg,control)}});return Rule});define("bui/form/rules",["bui/form/rule"],function(require){var Rule=require("bui/form/rule");function toNumber(value){return parseFloat(value)}function toDate(value){return BUI.Date.parse(value)}var ruleMap={};var rules={add:function(rule){var name;if($.isPlainObject(rule)){name=rule.name;ruleMap[name]=new Rule(rule)}else{if(rule.get){name=rule.get("name");ruleMap[name]=rule}}return ruleMap[name]},remove:function(name){delete ruleMap[name]},get:function(name){return ruleMap[name]},valid:function(name,value,baseValue,msg,control){var rule=rules.get(name);if(rule){return rule.valid(value,baseValue,msg,control)}return null},isValid:function(name,value,baseValue,control){return rules.valid(name,value,baseValue,control)==null}};var required=rules.add({name:"required",msg:"\u4e0d\u80fd\u4e3a\u7a7a\uff01",validator:function(value,required,formatedMsg){if(required!==false&&/^\s*$/.test(value)){return formatedMsg}}});var equalTo=rules.add({name:"equalTo",msg:"\u4e24\u6b21\u8f93\u5165\u4e0d\u4e00\u81f4\uff01",validator:function(value,equalTo,formatedMsg){var el=$(equalTo);if(el.length){equalTo=el.val()}return value===equalTo?undefined:formatedMsg}});var min=rules.add({name:"min",msg:"\u8f93\u5165\u503c\u4e0d\u80fd\u5c0f\u4e8e{0}\uff01",validator:function(value,min,formatedMsg){if(value!==""&&toNumber(value)<toNumber(min)){return formatedMsg}}});var max=rules.add({name:"max",msg:"\u8f93\u5165\u503c\u4e0d\u80fd\u5927\u4e8e{0}\uff01",validator:function(value,max,formatedMsg){if(value!==""&&toNumber(value)>toNumber(max)){return formatedMsg}}});var length=rules.add({name:"length",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e3a{0}\uff01",validator:function(value,len,formatedMsg){if(value!=null){value=$.trim(value.toString());if(len!=value.length){return formatedMsg}}}});var minlength=rules.add({name:"minlength",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e0d\u5c0f\u4e8e{0}\uff01",validator:function(value,min,formatedMsg){if(value!=null){value=$.trim(value.toString());var len=value.length;if(len<min){return formatedMsg}}}});var maxlength=rules.add({name:"maxlength",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e0d\u5927\u4e8e{0}\uff01",validator:function(value,max,formatedMsg){if(value){value=$.trim(value.toString());var len=value.length;if(len>max){return formatedMsg}}}});var regexp=rules.add({name:"regexp",msg:"\u8f93\u5165\u503c\u4e0d\u7b26\u5408{0}\uff01",validator:function(value,regexp,formatedMsg){if(regexp){return regexp.test(value)?undefined:formatedMsg
}}});var email=rules.add({name:"email",msg:"\u4e0d\u662f\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740\uff01",validator:function(value,baseValue,formatedMsg){value=$.trim(value);if(value){return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(value)?undefined:formatedMsg}}});var date=rules.add({name:"date",msg:"\u4e0d\u662f\u6709\u6548\u7684\u65e5\u671f\uff01",validator:function(value,baseValue,formatedMsg){if(BUI.isNumber(value)){return}if(BUI.isDate(value)){return}value=$.trim(value);if(value){return BUI.Date.isDateString(value)?undefined:formatedMsg}}});var minDate=rules.add({name:"minDate",msg:"\u8f93\u5165\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e{0}\uff01",validator:function(value,minDate,formatedMsg){if(value){var date=toDate(value);if(date&&date<toDate(minDate)){return formatedMsg}}}});var maxDate=rules.add({name:"maxDate",msg:"\u8f93\u5165\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e{0}\uff01",validator:function(value,maxDate,formatedMsg){if(value){var date=toDate(value);if(date&&date>toDate(maxDate)){return formatedMsg}}}});var mobile=rules.add({name:"mobile",msg:"\u4e0d\u662f\u6709\u6548\u7684\u624b\u673a\u53f7\u7801\uff01",validator:function(value,baseValue,formatedMsg){value=$.trim(value);if(value){return/^\d{11}$/.test(value)?undefined:formatedMsg}}});var number=rules.add({name:"number",msg:"\u4e0d\u662f\u6709\u6548\u7684\u6570\u5b57\uff01",validator:function(value,baseValue,formatedMsg){if(BUI.isNumber(value)){return}value=value.replace(/\,/g,"");return !isNaN(value)?undefined:formatedMsg}});function testRange(baseValue,curVal,prevVal){var allowEqual=baseValue&&(baseValue.equals!==false);if(allowEqual){return prevVal<=curVal}return prevVal<curVal}function isEmpty(value){return value==""||value==null}function rangeValid(value,baseValue,formatedMsg,group){var fields=group.getFields(),valid=true;for(var i=1;i<fields.length;i++){var cur=fields[i],prev=fields[i-1],curVal,prevVal;if(cur&&prev){curVal=cur.get("value");prevVal=prev.get("value");if(!isEmpty(curVal)&&!isEmpty(prevVal)&&!testRange(baseValue,curVal,prevVal)){valid=false;break}}}if(!valid){return formatedMsg}return null}var dateRange=rules.add({name:"dateRange",msg:"\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u8d77\u59cb\u65e5\u671f\uff01",validator:rangeValid});var numberRange=rules.add({name:"numberRange",msg:"\u7ed3\u675f\u6570\u5b57\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u6570\u5b57\uff01",validator:rangeValid});function getFieldName(self){var firstField=self.getFieldAt(0);if(firstField){return firstField.get("name")}return""}function testCheckRange(value,range){if(!BUI.isArray(range)){range=[range]}if(!value||!range.length){return false}var len=!value?0:!BUI.isArray(value)?1:value.length;if(range.length==1){var number=range[0];if(!number){return true}if(number>len){return false}}else{var min=range[0],max=range[1];if(min>len||max<len){return false}}return true}var checkRange=rules.add({name:"checkRange",msg:"\u5fc5\u987b\u9009\u4e2d{0}\u9879\uff01",validator:function(record,baseValue,formatedMsg,group){var name=getFieldName(group),value,range=baseValue;if(name&&range){value=record[name];if(!testCheckRange(value,range)){return formatedMsg}}return null}});return rules});define("bui/form/remote",["bui/common"],function(require){var BUI=require("bui/common");var RemoteView=function(){};RemoteView.ATTRS={isLoading:{},loadingEl:{}};RemoteView.prototype={getLoadingContainer:function(){},_setLoading:function(){var _self=this,loadingEl=_self.get("loadingEl"),loadingTpl=_self.get("loadingTpl");if(!loadingEl){loadingEl=$(loadingTpl).appendTo(_self.getLoadingContainer());_self.setInternal("loadingEl",loadingEl)}},_clearLoading:function(){var _self=this,loadingEl=_self.get("loadingEl");if(loadingEl){loadingEl.remove();_self.setInternal("loadingEl",null)}},_uiSetIsLoading:function(v){var _self=this;if(v){_self._setLoading()}else{_self._clearLoading()}}};var Remote=function(){};Remote.ATTRS={defaultRemote:{value:{method:"GET",cache:true,callback:function(data){return data}}},remoteDaly:{value:500},cacheMap:{value:{}},loadingTpl:{view:true,value:'<img src="http://img02.taobaocdn.com/tps/i2/T1NU8nXCVcXXaHNz_X-16-16.gif" alt="loading"/>'},isLoading:{view:true,value:false},remote:{setter:function(v){if(BUI.isString(v)){v={url:v}}return v}},remoteHandler:{},events:{value:{remotecomplete:false,remotestart:false}}};Remote.prototype={__bindUI:function(){var _self=this;_self.on("valid",function(ev){if(_self.get("remote")&&_self.isValid()){var value=_self.getControlValue(),data=_self.getRemoteParams();_self._startRemote(data,value)}});_self.on("error",function(ev){if(_self.get("remote")){_self._cancelRemote()}})},_startRemote:function(data,value){var _self=this,remoteHandler=_self.get("remoteHandler"),cacheMap=_self.get("cacheMap"),remoteDaly=_self.get("remoteDaly");if(remoteHandler){_self._cancelRemote(remoteHandler)}if(cacheMap[value]!=null){_self._validResult(_self._getCallback(),cacheMap[value]);return}function dalayFunc(){_self._remoteValid(data,remoteHandler,value);
_self.set("isLoading",true)}remoteHandler=setTimeout(dalayFunc,remoteDaly);_self.setInternal("remoteHandler",remoteHandler)},_validResult:function(callback,data){var _self=this,error=callback(data);_self.onRemoteComplete(error,data)},onRemoteComplete:function(error,data,remoteHandler){var _self=this;if(remoteHandler==_self.get("remoteHandler")){_self.fire("remotecomplete",{error:error,data:data});_self.set("isLoading",false);_self.setInternal("remoteHandler",null)}},_getOptions:function(data){var _self=this,remote=_self.get("remote"),defaultRemote=_self.get("defaultRemote"),options=BUI.merge(defaultRemote,remote,{data:data});return options},_getCallback:function(){return this._getOptions().callback},_remoteValid:function(data,remoteHandler,value){var _self=this,cacheMap=_self.get("cacheMap"),options=_self._getOptions(data);options.success=function(data){var callback=options.callback,error=callback(data);cacheMap[value]=data;_self.onRemoteComplete(error,data,remoteHandler)};options.error=function(jqXHR,textStatus,errorThrown){_self.onRemoteComplete(errorThrown,null,remoteHandler)};_self.fire("remotestart",{data:data});$.ajax(options)},getRemoteParams:function(){},clearCache:function(){this.set("cacheMap",{})},_cancelRemote:function(remoteHandler){var _self=this;remoteHandler=remoteHandler||_self.get("remoteHandler");if(remoteHandler){clearTimeout(remoteHandler);_self.setInternal("remoteHandler",null)}_self.set("isLoading",false)}};Remote.View=RemoteView;return Remote});define("bui/select",["bui/common","bui/select/select","bui/select/combox","bui/select/suggest"],function(require){var BUI=require("bui/common"),Select=BUI.namespace("Select");BUI.mix(Select,{Select:require("bui/select/select"),Combox:require("bui/select/combox"),Suggest:require("bui/select/suggest")});return Select});define("bui/select/select",["bui/common","bui/picker"],function(require){var BUI=require("bui/common"),ListPicker=require("bui/picker").ListPicker,PREFIX=BUI.prefix;function formatItems(items){if($.isPlainObject(items)){var tmp=[];BUI.each(items,function(v,n){tmp.push({value:n,text:v})});return tmp}var rst=[];BUI.each(items,function(item,index){if(BUI.isString(item)){rst.push({value:item,text:item})}else{rst.push(item)}});return rst}var Component=BUI.Component,Picker=ListPicker,CLS_INPUT=PREFIX+"select-input",select=Component.Controller.extend({initializer:function(){var _self=this,multipleSelect=_self.get("multipleSelect"),xclass,picker=_self.get("picker");if(!picker){xclass=multipleSelect?"listbox":"simple-list";picker=new Picker({children:[{xclass:xclass,elCls:PREFIX+"select-list",store:_self.get("store"),items:formatItems(_self.get("items"))}],valueField:_self.get("valueField")});_self.set("picker",picker)}else{if(_self.get("valueField")){picker.set("valueField",_self.get("valueField"))}}if(multipleSelect){picker.set("hideEvent","")}},renderUI:function(){var _self=this,picker=_self.get("picker"),el=_self.get("el"),textEl=el.find("."+_self.get("inputCls"));picker.set("trigger",el);picker.set("triggerEvent",_self.get("triggerEvent"));picker.set("autoSetValue",_self.get("autoSetValue"));picker.set("textField",textEl);picker.render();_self.set("list",picker.get("list"))},bindUI:function(){var _self=this,picker=_self.get("picker"),list=picker.get("list"),store=list.get("store");picker.on("selectedchange",function(ev){_self.fire("change",{text:ev.text,value:ev.value,item:ev.item})});list.on("itemsshow",function(){_self._syncValue()});picker.on("show",function(){if(_self.get("forceFit")){picker.set("width",_self.get("el").outerWidth())}})},containsElement:function(elem){var _self=this,picker=_self.get("picker");return Component.Controller.prototype.containsElement.call(this,elem)||picker.containsElement(elem)},_uiSetItems:function(items){if(!items){return}var _self=this,picker=_self.get("picker"),list=picker.get("list");list.set("items",formatItems(items));_self._syncValue()},_syncValue:function(){var _self=this,picker=_self.get("picker"),valueField=_self.get("valueField");if(valueField){picker.setSelectedValue($(valueField).val())}},_uiSetName:function(v){var _self=this,textEl=_self._getTextEl();if(v){textEl.attr("name",v)}},_uiSetWidth:function(v){var _self=this;if(v!=null){var textEl=_self._getTextEl(),iconEl=_self.get("el").find(".x-icon"),appendWidth=textEl.outerWidth()-textEl.width(),picker=_self.get("picker"),width=v-iconEl.outerWidth()-appendWidth;textEl.width(width);if(_self.get("forceFit")){picker.set("width",v)}}},_getTextEl:function(){var _self=this,el=_self.get("el");return el.find("."+_self.get("inputCls"))},destructor:function(){var _self=this,picker=_self.get("picker");if(picker){picker.destroy()}},_getList:function(){var _self=this,picker=_self.get("picker"),list=picker.get("list");return list},getSelectedValue:function(){return this.get("picker").getSelectedValue()},setSelectedValue:function(value){var _self=this,picker=_self.get("picker");picker.setSelectedValue(value)},getSelectedText:function(){return this.get("picker").getSelectedText()
}},{ATTRS:{picker:{},list:{},valueField:{},store:{},focusable:{value:true},multipleSelect:{value:false},name:{},items:{sync:false},inputCls:{value:CLS_INPUT},forceFit:{value:true},events:{value:{"change":false}},tpl:{view:true,value:'<input type="text" readonly="readonly" class="'+CLS_INPUT+'"/><span class="x-icon x-icon-normal"><i class="icon icon-caret icon-caret-down"></i></span>'},triggerEvent:{value:"click"}}},{xclass:"select"});return select});define("bui/select/combox",["bui/common","bui/select/select"],function(require){var BUI=require("bui/common"),Select=require("bui/select/select"),CLS_INPUT=BUI.prefix+"combox-input";var combox=Select.extend({renderUI:function(){var _self=this,picker=_self.get("picker");picker.set("autoFocused",false)},_uiSetItems:function(v){var _self=this;for(var i=0;i<v.length;i++){var item=v[i];if(BUI.isString(item)){v[i]={value:item,text:item}}}combox.superclass._uiSetItems.call(_self,v)},bindUI:function(){var _self=this,picker=_self.get("picker"),list=picker.get("list"),textField=picker.get("textField");$(textField).on("keyup",function(ev){var item=list.getSelected();if(item){list.clearItemStatus(item)}})}},{ATTRS:{tpl:{view:true,value:'<input type="text" class="'+CLS_INPUT+'"/>'},inputCls:{value:CLS_INPUT}}},{xclass:"combox"});return combox});define("bui/select/suggest",["bui/common","bui/select/combox"],function(require){var BUI=require("bui/common"),Combox=require("bui/select/combox"),TIMER_DELAY=200,EMPTY="";var suggest=Combox.extend({bindUI:function(){var _self=this,textEl=_self.get("el").find("input"),triggerEvent=(_self.get("triggerEvent")==="keyup")?"keyup":"keyup click";textEl.on(triggerEvent,function(){_self._start()})},_start:function(){var _self=this;_self._timer=_self.later(function(){_self._updateContent()},TIMER_DELAY)},_updateContent:function(){var _self=this,isStatic=_self.get("data"),textEl=_self.get("el").find("input"),text;if(!isStatic&&(textEl.val()===_self.get("query"))){return}_self.set("query",textEl.val());text=textEl.val();if(!isStatic&&!text){return}var cacheable=_self.get("cacheable"),url=_self.get("url"),data=_self.get("data");if(cacheable&&url){var dataCache=_self.get("dataCache");if(dataCache[text]!==undefined){_self._handleResponse(dataCache[text])}else{_self._requestData()}}else{if(url){_self._requestData()}else{if(data){_self._handleResponse(data,true)}}}},_getStore:function(){var _self=this,picker=_self.get("picker"),list=picker.get("list");if(list){return list.get("store")}},_requestData:function(){var _self=this,textEl=_self.get("el").find("input"),callback=_self.get("callback"),store=_self.get("store"),param={};param[textEl.attr("name")]=textEl.val();if(store){param.start=0;store.load(param,callback)}else{$.ajax({url:_self.get("url"),type:"post",dataType:_self.get("dataType"),data:param,success:function(data){_self._handleResponse(data);if(callback){callback(data)}}})}},_handleResponse:function(data,filter){var _self=this,items=filter?_self._getFilterItems(data):data;_self.set("items",items);if(_self.get("cacheable")){_self.get("dataCache")[_self.get("query")]=items}},_getItemText:function(item){var _self=this,picker=_self.get("picker"),list=picker.get("list");if(list){return list.getItemText(item)}return""},_getFilterItems:function(data){var _self=this,result=[],textEl=_self.get("el").find("input"),text=textEl.val(),isStatic=_self.get("data");data=data||[];function push(str,item){if(BUI.isString(item)){result.push(str)}else{result.push(item)}}BUI.each(data,function(item){var str=BUI.isString(item)?item:_self._getItemText(item);if(isStatic){if(str.indexOf($.trim(text))!==-1){push(str,item)}}else{push(str,item)}});return result},later:function(fn,when,periodic){when=when||0;var r=periodic?setInterval(fn,when):setTimeout(fn,when);return{id:r,interval:periodic,cancel:function(){if(this.interval){clearInterval(r)}else{clearTimeout(r)}}}}},{ATTRS:{data:{value:null},query:{value:EMPTY},cacheable:{value:false},dataCache:{shared:false,value:{}},dataType:{value:"jsonp"},url:{},callback:{},triggerEvent:{valueFn:function(){if(this.get("data")){return"click"}return"keyup"}},autoSetValue:{value:false}}},{xclass:"suggest"});return suggest});define("bui/mask",["bui/common","bui/mask/mask","bui/mask/loadmask"],function(require){var BUI=require("bui/common"),Mask=require("bui/mask/mask");Mask.LoadMask=require("bui/mask/loadmask");return Mask});define("bui/mask/mask",["bui/common"],function(require){var BUI=require("bui/common"),Mask=BUI.namespace("Mask"),UA=BUI.UA,CLS_MASK=BUI.prefix+"ext-mask",CLS_MASK_MSG=CLS_MASK+"-msg";BUI.mix(Mask,{maskElement:function(element,msg,msgCls){var maskedEl=$(element),maskDiv=$("."+CLS_MASK,maskedEl),tpl=null,msgDiv=null,top=null,left=null;if(!maskDiv.length){maskDiv=$('<div class="'+CLS_MASK+'"></div>').appendTo(maskedEl);maskedEl.addClass("x-masked-relative x-masked");if(UA.ie===6){maskDiv.height(maskedEl.height())}if(msg){tpl=['<div class="'+CLS_MASK_MSG+'"><div>',msg,"</div></div>"].join("");msgDiv=$(tpl).appendTo(maskedEl);
if(msgCls){msgDiv.addClass(msgCls)}try{top=(maskedEl.height()-msgDiv.height())/2;left=(maskedEl.width()-msgDiv.width())/2;msgDiv.css({left:left,top:top})}catch(ex){BUI.log("mask error occurred")}}}return maskDiv},unmaskElement:function(element){var maskedEl=$(element),msgEl=maskedEl.children("."+CLS_MASK_MSG),maskDiv=maskedEl.children("."+CLS_MASK);if(msgEl){msgEl.remove()}if(maskDiv){maskDiv.remove()}maskedEl.removeClass("x-masked-relative x-masked")}});return Mask});define("bui/mask/loadmask",["bui/mask/mask"],function(require){var Mask=require("bui/mask/mask");function LoadMask(config){var _self=this;LoadMask.superclass.constructor.call(_self,config)}BUI.extend(LoadMask,BUI.Base);LoadMask.ATTRS={el:{},msg:{value:"Loading..."},msgCls:{value:"x-mask-loading"},disabled:{value:false}};BUI.augment(LoadMask,{disable:function(){this.set("disabled",true)},onLoad:function(){Mask.unmaskElement(this.get("el"))},onBeforeLoad:function(){var _self=this;if(!_self.get("disabled")){Mask.maskElement(_self.get("el"),_self.get("msg"),this.get("msgCls"))}},show:function(){this.onBeforeLoad()},hide:function(){this.onLoad()},destroy:function(){this.hide();this.clearAttrVals();this.off()}});return LoadMask});define("bui/menu",["bui/common","bui/menu/menu","bui/menu/menuitem","bui/memu/contextmenu","bui/menu/popmenu","bui/menu/sidemenu"],function(require){var BUI=require("bui/common"),Menu=BUI.namespace("Menu");BUI.mix(Menu,{Menu:require("bui/menu/menu"),MenuItem:require("bui/menu/menuitem"),ContextMenu:require("bui/memu/contextmenu"),PopMenu:require("bui/menu/popmenu"),SideMenu:require("bui/menu/sidemenu")});Menu.ContextMenuItem=Menu.ContextMenu.Item;return Menu});define("bui/menu/menuitem",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,UIBase=Component.UIBase,PREFIX=BUI.prefix,CLS_OPEN=PREFIX+"menu-item-open",CLS_CARET="x-caret",CLS_COLLAPSE=PREFIX+"menu-item-collapsed",DATA_ID="data-id";var menuItemView=Component.View.extend([UIBase.ListItemView,UIBase.CollapsableView],{_uiSetOpen:function(v){var _self=this,cls=_self.getStatusCls("open");if(v){_self.get("el").addClass(cls)}else{_self.get("el").removeClass(cls)}}},{ATTRS:{}},{xclass:"menu-item-view"});var menuItem=Component.Controller.extend([UIBase.ListItem,UIBase.Collapsable],{renderUI:function(){var _self=this,el=_self.get("el"),id=_self.get("id"),temp=null;if(!id){id=BUI.guid("menu-item");_self.set("id",id)}el.attr(DATA_ID,id)},handleMouseEnter:function(ev){var _self=this;if(this.get("subMenu")){this.set("open",true)}menuItem.superclass.handleMouseEnter.call(this,ev)},handleMouseLeave:function(ev){var _self=this,subMenu=_self.get("subMenu"),toElement=ev.toElement||ev.relatedTarget;if(toElement&&subMenu&&subMenu.containsElement(toElement)){_self.set("open",true)}else{_self.set("open",false)}menuItem.superclass.handleMouseLeave.call(this,ev)},containsElement:function(elem){var _self=this,subMenu,contains=menuItem.superclass.containsElement.call(_self,elem);if(!contains){subMenu=_self.get("subMenu");contains=subMenu&&subMenu.containsElement(elem)}return contains},_uiSetOpen:function(v){var _self=this,subMenu=_self.get("subMenu"),subMenuAlign=_self.get("subMenuAlign");if(subMenu){if(v){subMenuAlign.node=_self.get("el");subMenu.set("align",subMenuAlign);subMenu.show()}else{var menuAlign=subMenu.get("align");if(!menuAlign||menuAlign.node==_self.get("el")){subMenu.hide()}}}},_uiSetSubMenu:function(subMenu){if(subMenu){var _self=this,el=_self.get("el"),parent=_self.get("parent");if(!subMenu.get("parentMenu")){subMenu.set("parentMenu",parent);if(parent.get("autoHide")){subMenu.set("autoHide",false)}}$(_self.get("arrowTpl")).appendTo(el)}},destructor:function(){var _self=this,subMenu=_self.get("subMenu");if(subMenu){subMenu.destroy()}}},{ATTRS:{elTagName:{value:"li"},xview:{value:menuItemView},open:{view:true,value:false},subMenu:{view:true},subMenuAlign:{valueFn:function(argument){return{points:["tr","tl"],offset:[-5,0]}}},arrowTpl:{value:'<span class="'+CLS_CARET+" "+CLS_CARET+'-left"></span>'},events:{value:{"afterOpenChange":true}}},PARSER:{subMenu:function(el){var subList=el.find("ul"),sub;if(subList&&subList.length){sub=BUI.Component.create({srcNode:subList,xclass:"pop-menu"});subList.appendTo("body")}return sub}}},{xclass:"menu-item",priority:0});var separator=menuItem.extend({},{ATTRS:{focusable:{value:false},selectable:{value:false},handleMouseEvents:{value:false}}},{xclass:"menu-item-sparator"});menuItem.View=menuItemView;menuItem.Separator=separator;return menuItem});define("bui/menu/menu",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,UIBase=Component.UIBase;var Menu=Component.Controller.extend([UIBase.ChildList],{bindUI:function(){var _self=this;_self.on("click",function(e){var item=e.target,multipleSelect=_self.get("multipleSelect");if(_self!=item){if(!multipleSelect&&_self.get("clickHide")&&!item.get("subMenu")){_self.getTopAutoHideMenu().hide()}}});_self.on("afterOpenChange",function(ev){var target=ev.target,opened=ev.newVal,children=_self.get("children");
if(opened){BUI.each(children,function(item){if(item!==target&&item.get("open")){item.set("open",false)}})}});_self.on("afterVisibleChange",function(ev){var visible=ev.newVal,parent=_self.get("parentMenu");_self._clearOpen()})},getTopAutoHideMenu:function(){var _self=this,parentMenu=_self.get("parentMenu"),topHideMenu;if(parentMenu&&parentMenu.get("autoHide")){return parentMenu.getTopAutoHideMenu()}if(_self.get("autoHide")){return _self}return null},_clearOpen:function(){var _self=this,children=_self.get("children");BUI.each(children,function(item){if(item.set){item.set("open",false)}})},findItemById:function(id){return this.findItemByField("id",id)},_uiSetSelectedItem:function(item){if(item){_self.setSelected(item)}}},{ATTRS:{elTagName:{view:true,value:"ul"},idField:{value:"id"},isDecorateChild:{value:true},defaultChildClass:{value:"menu-item"},selectedItem:{},parentMenu:{}}},{xclass:"menu",priority:0});return Menu});define("bui/menu/popmenu",["bui/common","bui/menu/menu"],function(require){var BUI=require("bui/common"),UIBase=BUI.Component.UIBase,Menu=require("bui/menu/menu");var popMenuView=BUI.Component.View.extend([UIBase.PositionView],{});var popMenu=Menu.extend([UIBase.Position,UIBase.Align,UIBase.AutoShow,,UIBase.AutoHide],{},{ATTRS:{clickHide:{value:true},align:{value:{points:["bl","tl"],offset:[0,0]}},visibleMode:{value:"visibility"},autoHide:{value:true},visible:{value:false},xview:{value:popMenuView}}},{xclass:"pop-menu"});return popMenu});define("bui/memu/contextmenu",["bui/common","bui/menu/menuitem","bui/menu/popmenu"],function(require){var BUI=require("bui/common"),MenuItem=require("bui/menu/menuitem"),PopMenu=require("bui/menu/popmenu"),PREFIX=BUI.prefix,CLS_Link=PREFIX+"menu-item-link",CLS_ITEM_ICON=PREFIX+"menu-item-icon",Component=BUI.Component,UIBase=Component.UIBase;var contextMenuItem=MenuItem.extend({bindUI:function(){var _self=this;_self.get("el").delegate("."+CLS_Link,"click",function(ev){ev.preventDefault()})},_uiSetIconCls:function(v,ev){var _self=this,preCls=ev.prevVal,iconEl=_self.get("el").find("."+CLS_ITEM_ICON);iconEl.removeClass(preCls);iconEl.addClass(v)}},{ATTRS:{text:{veiw:true,value:""},iconCls:{sync:false,value:""},tpl:{value:'<a class="'+CLS_Link+'" href="#">        <span class="'+CLS_ITEM_ICON+' {iconCls}"></span><span class="'+PREFIX+'menu-item-text">{text}</span></a>'}}},{xclass:"context-menu-item"});var contextMenu=PopMenu.extend({},{ATTRS:{defaultChildClass:{value:"context-menu-item"},align:{value:null}}},{xclass:"context-menu"});contextMenu.Item=contextMenuItem;return contextMenu});define("bui/menu/sidemenu",["bui/common","bui/menu/menu"],function(require){var BUI=require("bui/common"),Menu=require("bui/menu/menu"),Component=BUI.Component,CLS_MENU_TITLE=BUI.prefix+"menu-title",CLS_MENU_LEAF="menu-leaf";var sideMenu=Menu.extend({initializer:function(){var _self=this,items=_self.get("items"),children=_self.get("children");BUI.each(items,function(item){var menuCfg=_self._initMenuCfg(item);children.push(menuCfg)})},bindUI:function(){var _self=this,children=_self.get("children");BUI.each(children,function(item){var menu=item.get("children")[0];if(menu){menu.publish("click",{bubbles:1})}});_self.get("el").delegate("a","click",function(ev){ev.preventDefault()});_self.on("itemclick",function(ev){var item=ev.item,titleEl=$(ev.domTarget).closest("."+CLS_MENU_TITLE);if(titleEl.length){var collapsed=item.get("collapsed");item.set("collapsed",!collapsed)}else{if(item.get("el").hasClass(CLS_MENU_LEAF)){_self.fire("menuclick",{item:item});_self.clearSelection();_self.setSelected(item)}}})},getItems:function(){var _self=this,items=[],children=_self.get("children");BUI.each(children,function(item){var menu=item.get("children")[0];items=items.concat(menu.get("children"))});return items},_initMenuCfg:function(item){var _self=this,items=item.items,subItems=[],cfg={xclass:"menu-item",elCls:"menu-second",collapsed:item.collapsed,selectable:false,children:[{xclass:"menu",children:subItems}],content:'<div class="'+CLS_MENU_TITLE+'"><s></s><span class="'+CLS_MENU_TITLE+'-text">'+item.text+"</span></div>"};BUI.each(items,function(subItem){var subItemCfg=_self._initSubMenuCfg(subItem);subItems.push(subItemCfg)});return cfg},_initSubMenuCfg:function(subItem){var _self=this,cfg={xclass:"menu-item",elCls:"menu-leaf",tpl:'<a href="{href}"><em>{text}</em></a>'};return BUI.mix(cfg,subItem)}},{ATTRS:{autoInitItems:{value:false},events:{value:{"menuclick":false}}}},{xclass:"side-menu"});return sideMenu});define("bui/tab",["bui/common","bui/tab/tab","bui/tab/tabitem","bui/tab/navtabitem","bui/tab/navtab","bui/tab/tabpanel","bui/tab/tabpanelitem"],function(require){var BUI=require("bui/common"),Tab=BUI.namespace("Tab");BUI.mix(Tab,{Tab:require("bui/tab/tab"),TabItem:require("bui/tab/tabitem"),NavTabItem:require("bui/tab/navtabitem"),NavTab:require("bui/tab/navtab"),TabPanel:require("bui/tab/tabpanel"),TabPanelItem:require("bui/tab/tabpanelitem")});return Tab});define("bui/tab/panelitem",function(requrie){var PanelItem=function(){};
PanelItem.ATTRS={panel:{},panelContent:{},panelVisibleStatus:{value:"selected"},defaultLoaderCfg:{valueFn:function(){var _self=this,eventName=_self._getVisibleEvent();return{property:"panelContent",autoLoad:false,lazyLoad:{event:eventName},loadMask:{el:_self.get("panel")}}}},panelDestroyable:{value:true}};BUI.augment(PanelItem,{__renderUI:function(){this._resetPanelVisible()},__bindUI:function(){var _self=this,eventName=_self._getVisibleEvent();_self.on(eventName,function(ev){_self._setPanelVisible(ev.newVal)})},_resetPanelVisible:function(){var _self=this,status=_self.get("panelVisibleStatus"),visible=_self.get(status);_self._setPanelVisible(visible)},_getVisibleEvent:function(){var _self=this,status=_self.get("panelVisibleStatus");return"after"+BUI.ucfirst(status)+"Change"},_setPanelVisible:function(visible){var _self=this,panel=_self.get("panel"),method=visible?"show":"hide";if(panel){$(panel)[method]()}},__destructor:function(){var _self=this,panel=_self.get("panel");if(panel&&_self.get("panelDestroyable")){$(panel).remove()}},_setPanelContent:function(panel,content){var panelEl=$(panel);$(panel).html(content)},_uiSetPanelContent:function(v){var _self=this,panel=_self.get("panel");_self._setPanelContent(panel,v)},_uiSetPanel:function(v){var _self=this,content=_self.get("panelContent");if(content){_self._setPanelContent(v,content)}_self._resetPanelVisible()}});return PanelItem});define("bui/tab/panels",function(require){var Panels=function(){};Panels.ATTRS={panelTpl:{},panelContainer:{},panelCls:{}};BUI.augment(Panels,{__renderUI:function(){var _self=this,children=_self.get("children"),panelContainer=_self._initPanelContainer(),panelCls=_self.get("panelCls"),panels=panelCls?panelContainer.find("."+panels):panelContainer.children();BUI.each(children,function(item,index){var panel=panels[index];_self._initPanelItem(item,panel)})},__bindUI:function(){var _self=this;_self.on("beforeAddChild",function(ev){var item=ev.child;_self._initPanelItem(item)})},_initPanelContainer:function(){var _self=this,panelContainer=_self.get("panelContainer");if(panelContainer&&BUI.isString(panelContainer)){if(panelContainer.indexOf("#")==0){panelContainer=$(panelContainer)}else{panelContainer=_self.get("el").find(panelContainer)}_self.setInternal("panelContainer",panelContainer)}return panelContainer},_initPanelItem:function(item,panel){var _self=this;if(item.set){if(!item.get("panel")){panel=panel||_self._getPanel(item.get("userConfig"));item.set("panel",panel)}}else{if(!item.panel){panel=panel||_self._getPanel(item);item.panel=panel}}},_getPanel:function(item){var _self=this,panelContainer=_self.get("panelContainer"),panelTpl=BUI.substitute(_self.get("panelTpl"),item);return $(panelTpl).appendTo(panelContainer)}});return Panels});define("bui/tab/navtabitem",["bui/common"],function(requrie){var BUI=requrie("bui/common"),Component=BUI.Component,CLS_ITEM_TITLE="tab-item-title",CLS_ITEM_CLOSE="tab-item-close",CLS_ITEM_INNER="tab-item-inner",CLS_NAV_ACTIVED="tab-nav-actived",CLS_CONTENT="tab-content";var navTabItemView=Component.View.extend({renderUI:function(){var _self=this,contentContainer=_self.get("tabContentContainer"),contentTpl=_self.get("tabContentTpl");if(contentContainer){var tabContentEl=$(contentTpl).appendTo(contentContainer);_self.set("tabContentEl",tabContentEl)}},_uiSetHref:function(v){this._setHref(v)},_setHref:function(href){var _self=this,tabContentEl=_self.get("tabContentEl");href=href||_self.get("href");if(tabContentEl){$("iframe",tabContentEl).attr("src",href)}},resetHref:function(){this._setHref()},_uiSetTitle:function(v){var _self=this,el=_self.get("el");el.attr("title",v);$("."+CLS_ITEM_TITLE,el).text(v)},_uiSetActived:function(v){var _self=this,el=_self.get("el");_self.setTabContentVisible(v);if(v){el.addClass(CLS_NAV_ACTIVED)}else{el.removeClass(CLS_NAV_ACTIVED)}},destructor:function(){var _self=this,tabContentEl=_self.get("tabContentEl");if(tabContentEl){tabContentEl.remove()}},setTabContentVisible:function(v){var _self=this,tabContentEl=_self.get("tabContentEl");if(tabContentEl){if(v){tabContentEl.show()}else{tabContentEl.hide()}}}},{ATTRS:{tabContentContainer:{},tabContentEl:{},title:{},href:{}}});var navTabItem=Component.Controller.extend({createDom:function(){var _self=this,parent=_self.get("parent");if(parent){_self.set("tabContentContainer",parent.getTabContentContainer())}},bindUI:function(){var _self=this,el=_self.get("el"),events=_self.get("events");el.on("click",function(ev){var sender=$(ev.target);if(sender.hasClass(CLS_ITEM_CLOSE)){if(_self.fire("closing")!==false){_self.close()}}})},handleDblClick:function(ev){var _self=this;if(_self.get("closeable")&&_self.fire("closing")!==false){_self.close()}_self.fire("dblclick",{domTarget:ev.target,domEvent:ev})},handleContextMenu:function(ev){ev.preventDefault();this.fire("showmenu",{position:{x:ev.pageX,y:ev.pageY}})},setTitle:function(title){this.set("title",title)},close:function(){this.fire("closed")},reload:function(){this.get("view").resetHref()
},show:function(){var _self=this;_self.get("el").show(500,function(){_self.set("visible",true)})},hide:function(callback){var _self=this;this.get("el").hide(500,function(){_self.set("visible",false);callback&&callback()})},_uiSetActived:function(v){var _self=this,parent=_self.get("parent");if(parent&&v){parent._setItemActived(_self)}},_uiSetCloseable:function(v){var _self=this,el=_self.get("el"),closeEl=el.find("."+CLS_ITEM_CLOSE);if(v){closeEl.show()}else{closeEl.hide()}}},{ATTRS:{elTagName:{value:"li"},actived:{view:true,value:false},closeable:{value:true},allowTextSelection:{view:false,value:false},events:{value:{"click":true,"closing":true,"closed":true,"showmenu":true,"afterVisibleChange":true}},tabContentContainer:{view:true},tabContentTpl:{view:true,value:'<div class="'+CLS_CONTENT+'" style="display:none;"><iframe src="" width="100%" height="100%" frameborder="0"></iframe></div>'},href:{view:true,value:""},visible:{view:true,value:true},title:{view:true,value:""},tpl:{view:true,value:'<s class="l"></s><div class="'+CLS_ITEM_INNER+'">{icon}<span class="'+CLS_ITEM_TITLE+'"></span><s class="'+CLS_ITEM_CLOSE+'"></s></div><s class="r"></s>'},xview:{value:navTabItemView}}},{xclass:"nav-tab-item",priority:0});navTabItem.View=navTabItemView;return navTabItem});define("bui/tab/navtab",["bui/common","bui/menu"],function(require){var BUI=require("bui/common"),Menu=require("bui/menu"),Component=BUI.Component,CLS_NAV_LIST="tab-nav-list",CLS_ARROW_LEFT="arrow-left",CLS_ARROW_RIGHT="arrow-right",CLS_FORCE_FIT=BUI.prefix+"tab-force",ID_CLOSE="m_close",ITEM_WIDTH=140;var navTabView=Component.View.extend({renderUI:function(){var _self=this,el=_self.get("el"),listEl=null;listEl=el.find("."+CLS_NAV_LIST);_self.setInternal("listEl",listEl)},getContentElement:function(){return this.get("listEl")},getTabContentContainer:function(){return this.get("el").find(".tab-content-container")},_uiSetHeight:function(v){var _self=this,el=_self.get("el"),barEl=el.find(".tab-nav-bar"),containerEl=_self.getTabContentContainer();if(v){containerEl.height(v-barEl.height())}el.height(v)},_uiSetForceFit:function(v){var _self=this,el=_self.get("el");if(v){el.addClass(CLS_FORCE_FIT)}else{el.removeClass(CLS_FORCE_FIT)}}},{ATTRS:{forceFit:{}}},{xclass:"nav-tab-view",priority:0});var navTab=Component.Controller.extend({addTab:function(config,reload){var _self=this,id=config.id||BUI.guid("tab-item"),forceFit=_self.get("forceFit"),item=_self.getItemById(id);if(item){var hrefChage=false;if(config.href&&item.get("href")!=config.href){item.set("href",config.href);hrefChage=true}_self._setItemActived(item);if(reload&&!hrefChage){item.reload()}}else{config=BUI.mix({id:id,visible:false,actived:true,xclass:"nav-tab-item"},config);item=_self.addChild(config);if(forceFit){_self.forceFit()}item.show();_self._resetItemList()}return item},getTabContentContainer:function(){return this.get("view").getTabContentContainer()},bindUI:function(){var _self=this,forceFit=_self.get("forceFit");if(!forceFit){_self._bindScrollEvent();_self.on("afterVisibleChange",function(ev){var item=ev.target;if(item.get("actived")){_self._scrollToItem(item)}})}_self.on("click",function(ev){var item=ev.target;if(item!=_self){_self._setItemActived(item);_self.fire("itemclick",{item:item})}});_self.on("closed",function(ev){var item=ev.target;_self._closeItem(item)});_self.on("showmenu",function(ev){_self._showMenu(ev.target,ev.position)})},_bindScrollEvent:function(){var _self=this,el=_self.get("el");el.find(".arrow-left").on("click",function(){if(el.hasClass(CLS_ARROW_LEFT+"-active")){_self._scrollLeft()}});el.find(".arrow-right").on("click",function(){if(el.hasClass(CLS_ARROW_RIGHT+"-active")){_self._scrllRight()}})},_showMenu:function(item,position){var _self=this,menu=_self._getMenu(),closeable=item.get("closeable"),closeItem;_self.set("showMenuItem",item);menu.set("xy",[position.x,position.y]);menu.show();closeItem=menu.getItem(ID_CLOSE);if(closeItem){closeItem.set("disabled",!closeable)}},setActived:function(id){var _self=this,item=_self.getItemById(id);_self._setItemActived(item)},getActivedItem:function(){var _self=this,children=_self.get("children"),result=null;BUI.each(children,function(item){if(item.get("actived")){result=item;return false}});return result},getItemById:function(id){var _self=this,children=_self.get("children"),result=null;BUI.each(children,function(item){if(item.get("id")===id){result=item;return false}});return result},_getMenu:function(){var _self=this;return _self.get("menu")||_self._initMenu()},_initMenu:function(){var _self=this,menu=new Menu.ContextMenu({children:[{xclass:"context-menu-item",iconCls:"icon icon-refresh",text:"\u5237\u65b0",listeners:{"click":function(){var item=_self.get("showMenuItem");if(item){item.reload()}}}},{id:ID_CLOSE,xclass:"context-menu-item",iconCls:"icon icon-remove",text:"\u5173\u95ed",listeners:{"click":function(){var item=_self.get("showMenuItem");if(item){item.close()}}}},{xclass:"context-menu-item",iconCls:"icon icon-remove-sign",text:"\u5173\u95ed\u5176\u4ed6",listeners:{"click":function(){var item=_self.get("showMenuItem");
if(item){_self.closeOther(item)}}}},{xclass:"context-menu-item",iconCls:"icon icon-remove-sign",text:"\u5173\u95ed\u6240\u6709",listeners:{"click":function(){_self.closeAll()}}}]});_self.set("menu",menu);return menu},_closeItem:function(item){var _self=this,index=_self._getIndex(item),activedItem=_self.getActivedItem(),preItem=_self.get("preItem")||_self._getItemByIndex(index-1),nextItem=_self._getItemByIndex(index+1);item.hide(function(){_self.removeChild(item,true);_self._resetItemList();if(activedItem===item){if(preItem){_self._setItemActived(preItem)}else{_self._setItemActived(nextItem)}}else{_self._scrollToItem(activedItem)}_self.forceFit()})},closeAll:function(){var _self=this,children=_self.get("children");BUI.each(children,function(item){if(item.get("closeable")){item.close()}})},closeOther:function(curItem){var _self=this,children=_self.get("children");BUI.each(children,function(item){if(curItem!==item){item.close()}})},_getItemByIndex:function(index){var _self=this,children=_self.get("children");return children[index]},_getIndex:function(item){var _self=this,children=_self.get("children");return BUI.Array.indexOf(item,children)},_resetItemList:function(){if(this.get("forceFit")){return}var _self=this,container=_self.getContentElement();container.width(_self._getTotalWidth())},_getTotalWidth:function(){var _self=this,children=_self.get("children");return children.length*_self.get("itemWidth")},_getForceItemWidth:function(){var _self=this,width=_self.getContentElement().width(),children=_self.get("children"),totalWidth=_self._getTotalWidth(),itemWidth=_self.get(itemWidth);if(totalWidth>width){itemWidth=width/children.length}return itemWidth},forceFit:function(){var _self=this;_self._forceItemWidth(_self._getForceItemWidth())},_forceItemWidth:function(width){width=width||this.get("itemWidth");var _self=this,children=_self.get("children");BUI.each(children,function(item){item.set("width",width)})},_scrollToItem:function(item){if(this.get("forceFit")){return}var _self=this,container=_self.getContentElement(),containerPosition=container.position(),disWidth=_self._getDistanceToEnd(item,container,containerPosition),disBegin=_self._getDistanceToBegin(item,containerPosition);if(container.width()<container.parent().width()){_self._scrollTo(container,0)}else{if(disBegin<0){_self._scrollTo(container,containerPosition.left-(disBegin))}else{if(disWidth>0){_self._scrollTo(container,containerPosition.left+(disWidth)*-1)}else{if(containerPosition.left<0){var lastDistance=_self._getLastDistance(container,containerPosition),toLeft=0;if(lastDistance<0){toLeft=containerPosition.left-lastDistance;toLeft=toLeft<0?toLeft:0;_self._scrollTo(container,toLeft)}}}}}},_getDistanceToBegin:function(item,containerPosition){var position=item.get("el").position();return position.left+containerPosition.left},_getDistanceToEnd:function(item,container,containerPosition){var _self=this,container=container||_self.getContentElement(),wraperWidth=container.parent().width(),containerPosition=containerPosition||container.position(),offsetLeft=_self._getDistanceToBegin(item,containerPosition),disWidth=offsetLeft+_self.get("itemWidth")-wraperWidth;return disWidth},_getLastDistance:function(container,containerPosition){var _self=this,children=_self.get("children"),lastItem=children[children.length-1];if(lastItem){return _self._getDistanceToEnd(lastItem,container,containerPosition)}return 0},_scrollTo:function(el,left,callback){var _self=this;el.animate({left:left},500,function(){_self._setArrowStatus(el)})},_scrollLeft:function(){var _self=this,container=_self.getContentElement(),position=container.position(),disWidth=_self._getLastDistance(container,position),toLeft;if(disWidth>0){toLeft=disWidth>_self.get("itemWidth")?_self.get("itemWidth"):disWidth;_self._scrollTo(container,position.left-toLeft)}},_scrllRight:function(){var _self=this,container=_self.getContentElement(),position=container.position(),toRight;if(position.left<0){toRight=position.left+_self.get("itemWidth");toRight=toRight<0?toRight:0;_self._scrollTo(container,toRight)}},_setArrowStatus:function(container,containerPosition){container=container||this.getContentElement();var _self=this,wapperEl=_self.get("el"),position=containerPosition||container.position(),disWidth=_self._getLastDistance(container,containerPosition);if(position.left<0){wapperEl.addClass(CLS_ARROW_RIGHT+"-active")}else{wapperEl.removeClass(CLS_ARROW_RIGHT+"-active")}if(disWidth>0){wapperEl.addClass(CLS_ARROW_LEFT+"-active")}else{wapperEl.removeClass(CLS_ARROW_LEFT+"-active")}},_setItemActived:function(item){var _self=this,preActivedItem=_self.getActivedItem();if(item===preActivedItem){return}if(preActivedItem){preActivedItem.set("actived",false)}_self.set("preItem",preActivedItem);if(item){if(!item.get("actived")){item.set("actived",true)}if(item.get("visible")){_self._scrollToItem(item)}_self.fire("activeChange",{item:item});_self.fire("activedchange",{item:item})}}},{ATTRS:{defaultChildClass:{value:"nav-tab-item"},menu:{},forceFit:{view:true,value:false},itemWidth:{value:ITEM_WIDTH},tpl:{view:true,value:'<div class="tab-nav-bar">'+'<s class="tab-nav-arrow arrow-left"></s><div class="tab-nav-wrapper"><div class="tab-nav-inner"><ul class="'+CLS_NAV_LIST+'"></ul></div></div><s class="tab-nav-arrow arrow-right"></s>'+"</div>"+'<div class="tab-content-container"></div>'},xview:{value:navTabView},events:{value:{"itemclick":false,activedchange:false}}}},{xclass:"nav-tab",priority:0});
return navTab});define("bui/tab/tabitem",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,UIBase=Component.UIBase;var itemView=Component.View.extend([UIBase.ListItemView],{},{xclass:"tab-item-view"});var item=Component.Controller.extend([UIBase.ListItem],{},{ATTRS:{elTagName:{view:true,value:"li"},xview:{value:itemView},tpl:{view:true,value:'<span class="bui-tab-item-text">{text}</span>'}}},{xclass:"tab-item"});item.View=itemView;return item});define("bui/tab/tab",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,UIBase=Component.UIBase;var tab=Component.Controller.extend([UIBase.ChildList],{},{ATTRS:{elTagName:{view:true,value:"ul"},defaultChildClass:{value:"tab-item"}}},{xclass:"tab"});return tab});define("bui/tab/tabpanelitem",["bui/common","bui/tab/tabitem","bui/tab/panelitem"],function(require){var BUI=require("bui/common"),TabItem=require("bui/tab/tabitem"),PanelItem=require("bui/tab/panelitem"),CLS_TITLE="bui-tab-item-text",Component=BUI.Component;var itemView=TabItem.View.extend([Component.UIBase.Close.View],{_uiSetTitle:function(v){var _self=this,el=_self.get("el"),titleEl=el.find("."+CLS_TITLE);titleEl.text(v)}},{xclass:"tab-panel-item-view"});var item=TabItem.extend([PanelItem,Component.UIBase.Close],{},{ATTRS:{closeAction:{value:"remove"},title:{view:true,sync:false},tpl:{value:'<span class="'+CLS_TITLE+'">{text}{title}</span>'},closeable:{value:false},events:{value:{beforeclosed:true}},xview:{value:itemView}}},{xclass:"tab-panel-item"});item.View=itemView;return item});define("bui/tab/tabpanel",["bui/common","bui/tab/tab","bui/tab/panels"],function(require){var BUI=require("bui/common"),Tab=require("bui/tab/tab"),Panels=require("bui/tab/panels");var tabPanel=Tab.extend([Panels],{bindUI:function(){var _self=this;_self.on("beforeclosed",function(ev){var item=ev.target;_self._beforeClosedItem(item)})},_beforeClosedItem:function(item){if(!item.get("selected")){return}var _self=this,index=_self.indexOfItem(item),count=_self.getItemCount(),preItem,nextItem;if(index!==count-1){nextItem=_self.getItemAt(index+1);_self.setSelected(nextItem)}else{if(index!==0){preItem=_self.getItemAt(index-1);_self.setSelected(preItem)}}}},{ATTRS:{elTagName:{value:"div"},childContainer:{value:"ul"},tpl:{value:'<div class="tab-panel-inner"><ul></ul><div class="tab-panels"></div></div>'},panelTpl:{value:"<div></div>"},panelContainer:{value:".tab-panels"},defaultChildClass:{value:"tab-panel-item"}}},{xclass:"tab-panel"});return tabPanel});define("bui/toolbar",["bui/common","bui/toolbar/baritem","bui/toolbar/bar","bui/toolbar/pagingbar","bui/toolbar/numberpagingbar"],function(require){var BUI=require("bui/common"),Toolbar=BUI.namespace("Toolbar");BUI.mix(Toolbar,{BarItem:require("bui/toolbar/baritem"),Bar:require("bui/toolbar/bar"),PagingBar:require("bui/toolbar/pagingbar"),NumberPagingBar:require("bui/toolbar/numberpagingbar")});return Toolbar});define("bui/toolbar/baritem",function(){var PREFIX=BUI.prefix,Component=BUI.Component,UIBase=Component.UIBase;var BarItemView=Component.View.extend([UIBase.ListItemView]);var BarItem=Component.Controller.extend([UIBase.ListItem],{renderUI:function(){var el=this.get("el");el.addClass(PREFIX+"inline-block");if(!el.attr("id")){el.attr("id",this.get("id"))}}},{ATTRS:{elTagName:{view:true,value:"li"},selectable:{value:false},focusable:{value:false},xview:{value:BarItemView}}},{xclass:"bar-item",priority:1});var ButtonBarItem=BarItem.extend({_uiSetDisabled:function(value){var _self=this,el=_self.get("el"),method=value?"addClass":"removeClass";el.find("button").attr("disabled",value)[method](PREFIX+"button-disabled")},_uiSetChecked:function(value){var _self=this,el=_self.get("el"),method=value?"addClass":"removeClass";el.find("button")[method](PREFIX+"button-checked")},_uiSetText:function(v){var _self=this,el=_self.get("el");el.find("button").text(v)},_uiSetbtnCls:function(v){var _self=this,el=_self.get("el");el.find("button").addClass(v)}},{ATTRS:{checked:{value:false},tpl:{view:true,value:'<button type="button" class="{btnCls}">{text}</button>'},btnCls:{sync:false},text:{sync:false,value:""}}},{xclass:"bar-item-button",priority:2});var SeparatorBarItem=BarItem.extend({renderUI:function(){var el=this.get("el");el.attr("role","separator")}},{xclass:"bar-item-separator",priority:2});var SpacerBarItem=BarItem.extend({},{ATTRS:{width:{view:true,value:2}}},{xclass:"bar-item-spacer",priority:2});var TextBarItem=BarItem.extend({_uiSetText:function(text){var _self=this,el=_self.get("el");el.html(text)}},{ATTRS:{text:{value:""}}},{xclass:"bar-item-text",priority:2});BarItem.types={"button":ButtonBarItem,"separator":SeparatorBarItem,"spacer":SpacerBarItem,"text":TextBarItem};return BarItem});define("bui/toolbar/bar",function(){var Component=BUI.Component,UIBase=Component.UIBase;var barView=Component.View.extend({renderUI:function(){var el=this.get("el");el.attr("role","toolbar");if(!el.attr("id")){el.attr("id",BUI.guid("bar"))
}}});var Bar=Component.Controller.extend([UIBase.ChildList],{getItem:function(id){return this.getChild(id)}},{ATTRS:{elTagName:{view:true,value:"ul"},defaultChildClass:{value:"bar-item"},focusable:{value:false},xview:{value:barView}}},{xclass:"bar",priority:1});return Bar});define("bui/toolbar/pagingbar",["bui/toolbar/bar"],function(require){var Bar=require("bui/toolbar/bar"),Component=BUI.Component,Bindable=Component.UIBase.Bindable;var PREFIX=BUI.prefix,ID_FIRST="first",ID_PREV="prev",ID_NEXT="next",ID_LAST="last",ID_SKIP="skip",ID_REFRESH="refresh",ID_TOTAL_PAGE="totalPage",ID_CURRENT_PAGE="curPage",ID_TOTAL_COUNT="totalCount",ID_BUTTONS=[ID_FIRST,ID_PREV,ID_NEXT,ID_LAST,ID_SKIP,ID_REFRESH],ID_TEXTS=[ID_TOTAL_PAGE,ID_CURRENT_PAGE,ID_TOTAL_COUNT];var PagingBar=Bar.extend([Bindable],{initializer:function(){var _self=this,children=_self.get("children"),items=_self.get("items"),store=_self.get("store");if(!items){items=_self._getItems();BUI.each(items,function(item){children.push(item)})}else{BUI.each(items,function(item,index){if(BUI.isString(item)){if(BUI.Array.contains(item,ID_BUTTONS)){item=_self._getButtonItem(item)}else{if(BUI.Array.contains(item,ID_TEXTS)){item=_self._getTextItem(item)}else{item={xtype:item}}}}children.push(item)})}if(store&&store.get("pageSize")){_self.set("pageSize",store.get("pageSize"))}},bindUI:function(){var _self=this;_self._bindButtonEvent()},jumpToPage:function(page){if(page<=0||page>this.get("totalPage")){return}var _self=this,store=_self.get("store"),pageSize=_self.get("pageSize"),index=page-1,start=index*pageSize;var result=_self.fire("beforepagechange",{from:_self.get("curPage"),to:page});if(store&&result!==false){store.load({start:start,limit:pageSize,pageIndex:index})}},_afterStoreLoad:function(store,params){var _self=this,pageSize=_self.get("pageSize"),start=0,end,totalCount,curPage,totalPage;start=store.get("start");totalCount=store.getTotalCount();end=totalCount-start>pageSize?start+store.getCount()-1:totalCount;totalPage=parseInt((totalCount+pageSize-1)/pageSize,10);totalPage=totalPage>0?totalPage:1;curPage=parseInt(start/pageSize,10)+1;_self.set("start",start);_self.set("end",end);_self.set("totalCount",totalCount);_self.set("curPage",curPage);_self.set("totalPage",totalPage);_self._setAllButtonsState();_self._setNumberPages()},_bindButtonEvent:function(){var _self=this;_self._bindButtonItemEvent(ID_FIRST,function(){_self.jumpToPage(1)});_self._bindButtonItemEvent(ID_PREV,function(){_self.jumpToPage(_self.get("curPage")-1)});_self._bindButtonItemEvent(ID_NEXT,function(){_self.jumpToPage(_self.get("curPage")+1)});_self._bindButtonItemEvent(ID_LAST,function(){_self.jumpToPage(_self.get("totalPage"))});_self._bindButtonItemEvent(ID_SKIP,function(){handleSkip()});_self._bindButtonItemEvent(ID_REFRESH,function(){_self.jumpToPage(_self.get("curPage"))});var curPage=_self.getItem(ID_CURRENT_PAGE);if(curPage){curPage.get("el").on("keyup",function(event){event.stopPropagation();if(event.keyCode===13){handleSkip()}})}function handleSkip(){var value=parseInt(_self._getCurrentPageValue(),10);if(_self._isPageAllowRedirect(value)){_self.jumpToPage(value)}else{_self._setCurrentPageValue(_self.get("curPage"))}}},_bindButtonItemEvent:function(id,func){var _self=this,item=_self.getItem(id);if(item){item.on("click",func)}},onLoad:function(params){var _self=this,store=_self.get("store");_self._afterStoreLoad(store,params)},_getItems:function(){var _self=this,items=_self.get("items");if(items&&items.length){return items}items=[];items.push(_self._getButtonItem(ID_FIRST));items.push(_self._getButtonItem(ID_PREV));items.push(_self._getSeparator());items.push(_self._getTextItem(ID_TOTAL_PAGE));items.push(_self._getTextItem(ID_CURRENT_PAGE));items.push(_self._getButtonItem(ID_SKIP));items.push(_self._getSeparator());items.push(_self._getButtonItem(ID_NEXT));items.push(_self._getButtonItem(ID_LAST));items.push(_self._getSeparator());items.push(_self._getTextItem(ID_TOTAL_COUNT));return items},_getButtonItem:function(id){var _self=this;return{id:id,xclass:"bar-item-button",text:_self.get(id+"Text"),disabled:true,elCls:_self.get(id+"Cls")}},_getSeparator:function(){return{xclass:"bar-item-separator"}},_getTextItem:function(id){var _self=this;return{id:id,xclass:"bar-item-text",text:_self._getTextItemTpl(id)}},_getTextItemTpl:function(id){var _self=this,obj=_self.getAttrVals();return BUI.substitute(this.get(id+"Tpl"),obj)},_isPageAllowRedirect:function(value){var _self=this;return value&&value>0&&value<=_self.get("totalPage")&&value!==_self.get("curPage")},_setAllButtonsState:function(){var _self=this,store=_self.get("store");if(store){_self._setButtonsState([ID_PREV,ID_NEXT,ID_FIRST,ID_LAST,ID_SKIP],true)}if(_self.get("curPage")===1){_self._setButtonsState([ID_PREV,ID_FIRST],false)}if(_self.get("curPage")===_self.get("totalPage")){_self._setButtonsState([ID_NEXT,ID_LAST],false)}},_setButtonsState:function(buttons,enable){var _self=this,children=_self.get("children");BUI.each(children,function(child){if(BUI.Array.indexOf(child.get("id"),buttons)!==-1){child.set("disabled",!enable)
}})},_setNumberPages:function(){var _self=this,items=_self.getItems();BUI.each(items,function(item){if(item.__xclass==="bar-item-text"){item.set("content",_self._getTextItemTpl(item.get("id")))}})},_getCurrentPageValue:function(curItem){var _self=this;curItem=curItem||_self.getItem(ID_CURRENT_PAGE);if(curItem){var textEl=curItem.get("el").find("input");return textEl.val()}},_setCurrentPageValue:function(value,curItem){var _self=this;curItem=curItem||_self.getItem(ID_CURRENT_PAGE);if(curItem){var textEl=curItem.get("el").find("input");textEl.val(value)}}},{ATTRS:{firstText:{value:"\u9996 \u9875"},firstCls:{value:PREFIX+"pb-first"},prevText:{value:"\u4e0a\u4e00\u9875"},prevCls:{value:PREFIX+"pb-prev"},nextText:{value:"\u4e0b\u4e00\u9875"},nextCls:{value:PREFIX+"pb-next"},lastText:{value:"\u672b \u9875"},lastCls:{value:PREFIX+"pb-last"},skipText:{value:"\u786e\u5b9a"},skipCls:{value:PREFIX+"pb-skip"},refreshText:{value:"\u5237\u65b0"},refreshCls:{value:PREFIX+"pb-refresh"},totalPageTpl:{value:"\u5171 {totalPage} \u9875"},curPageTpl:{value:'\u7b2c <input type="text" '+'autocomplete="off" class="'+PREFIX+'pb-page" size="20" value="{curPage}" name="inputItem"> \u9875'},totalCountTpl:{value:"\u5171{totalCount}\u6761\u8bb0\u5f55"},autoInitItems:{value:false},curPage:{value:0},totalPage:{value:0},totalCount:{value:0},pageSize:{value:30},store:{}},ID_FIRST:ID_FIRST,ID_PREV:ID_PREV,ID_NEXT:ID_NEXT,ID_LAST:ID_LAST,ID_SKIP:ID_SKIP,ID_REFRESH:ID_REFRESH,ID_TOTAL_PAGE:ID_TOTAL_PAGE,ID_CURRENT_PAGE:ID_CURRENT_PAGE,ID_TOTAL_COUNT:ID_TOTAL_COUNT},{xclass:"pagingbar",priority:2});return PagingBar});define("bui/toolbar/numberpagingbar",["bui/toolbar/pagingbar"],function(require){var Component=BUI.Component,PBar=require("bui/toolbar/pagingbar");var PREFIX=BUI.prefix,NUMBER_CONTAINER="numberContainer",CLS_NUMBER_BUTTON=PREFIX+"button-number";var NumberPagingBar=PBar.extend({_getItems:function(){var _self=this,items=_self.get("items");if(items){return items}items=[];items.push(_self._getButtonItem(PBar.ID_PREV));items.push(_self._getButtonItem(PBar.ID_NEXT));return items},_getButtonItem:function(id){var _self=this;return{id:id,content:'<a href="javascript:;">'+_self.get(id+"Text")+"</a>",disabled:true}},_bindButtonEvent:function(){var _self=this,cls=_self.get("numberButtonCls");_self.constructor.superclass._bindButtonEvent.call(this);_self.get("el").delegate("a","click",function(ev){ev.preventDefault()});_self.on("click",function(ev){var item=ev.target;if(item&&item.get("el").hasClass(cls)){var page=item.get("id");_self.jumpToPage(page)}})},_setNumberPages:function(){var _self=this;_self._setNumberButtons()},_setNumberButtons:function(){var _self=this,curPage=_self.get("curPage"),totalPage=_self.get("totalPage"),numberItems=_self._getNumberItems(curPage,totalPage),curItem;_self._clearNumberButtons();BUI.each(numberItems,function(item){_self._appendNumberButton(item)});curItem=_self.getItem(curPage);if(curItem){curItem.set("selected",true)}},_appendNumberButton:function(cfg){var _self=this,count=_self.getItemCount();var item=_self.addItemAt(cfg,count-1)},_clearNumberButtons:function(){var _self=this,items=_self.getItems(),count=_self.getItemCount();while(count>2){_self.removeItemAt(count-2);count=_self.getItemCount()}},_getNumberItems:function(curPage,totalPage){var _self=this,result=[],maxLimitCount=_self.get("maxLimitCount"),showRangeCount=_self.get("showRangeCount"),maxPage;function addNumberItem(from,to){for(var i=from;i<=to;i++){result.push(_self._getNumberItem(i))}}function addEllipsis(){result.push(_self._getEllipsisItem())}if(totalPage<maxLimitCount){maxPage=totalPage;addNumberItem(1,totalPage)}else{var startNum=(curPage<=maxLimitCount)?1:(curPage-showRangeCount),lastLimit=curPage+showRangeCount,endNum=lastLimit<totalPage?(lastLimit>maxLimitCount?lastLimit:maxLimitCount):totalPage;if(startNum>1){addNumberItem(1,1);if(startNum>2){addEllipsis()}}maxPage=endNum;addNumberItem(startNum,endNum)}if(maxPage<totalPage){if(maxPage<totalPage-1){addEllipsis()}addNumberItem(totalPage,totalPage)}return result},_getEllipsisItem:function(){var _self=this;return{disabled:true,content:_self.get("ellipsisTpl")}},_getNumberItem:function(page){var _self=this;return{id:page,elCls:_self.get("numberButtonCls")}}},{ATTRS:{itemStatusCls:{value:{selected:"active",disabled:"disabled"}},itemTpl:{value:'<a href="">{id}</a>'},prevText:{value:"<<"},nextText:{value:">>"},maxLimitCount:{value:4},showRangeCount:{value:1},numberButtonCls:{value:CLS_NUMBER_BUTTON},ellipsisTpl:{value:'<a href="#">...</a>'}}},{xclass:"pagingbar-number",priority:3});return NumberPagingBar});define("bui/progressbar",["bui/common","bui/progressbar/base","bui/progressbar/load"],function(require){var BUI=require("bui/common"),ProgressBar=BUI.namespace("ProgressBar");BUI.mix(ProgressBar,{Base:require("bui/progressbar/base"),Load:require("bui/progressbar/load")});return ProgressBar});define("bui/progressbar/base",["bui/common"],function(require){var BUI=require("bui/common");var progressBarView=BUI.Component.View.extend({_uiSetPercent:function(v){var _self=this,innerEl=_self.get("el").children();
if(!BUI.isArray(v)){v=[v]}BUI.each(innerEl,function(item,index){$(item).width(v[index]+"%")})}},{ATTRS:{percent:{}}});var progressBar=BUI.Component.Controller.extend({},{ATTRS:{percent:{view:true,value:0},tpl:{value:'<div class="progress-bar-inner"></div>'},xview:{value:progressBarView}}},{xclass:"progress-bar"});return progressBar});define("bui/progressbar/load",["bui/progressbar/base"],function(require){var Base=require("bui/progressbar/base"),notStarted=0,hasStarted=1,hasEnded=2;var loadProgressBar=Base.extend({bindUI:function(){var _self=this;_self.on("afterPercentChange",function(ev){if(_self.isLoading()){var percent=_self.get("percent");if(percent==100){_self.onCompleted()}_self.onChange()}})},start:function(){var _self=this;if(!_self.isLoading()){_self.onstart()}},complete:function(){var _self=this;clearTimeout(_self.get("t"));_self.set("percent",100)},cancel:function(){var _self=this;clearTimeout(_self.get("t"));if(_self.get("percent")){_self.set("percent",0)}_self.set("status",notStarted)},onstart:function(){var _self=this,cfg=_self.get("cfg");_self.set("percent",0);_self.set("status",hasStarted);_self.fire("start",cfg);_self._startLoad()},onChange:function(){var _self=this;_self.fire("loadchange")},onCompleted:function(){var _self=this;_self.set("status",hasEnded);_self.fire("completed")},isLoading:function(){return this.get("status")===hasStarted},isCompleted:function(){return this.get("status")===hasEnded},_startLoad:function(){var _self=this,ajaxCfg=_self.get("ajaxCfg"),interval=_self.get("interval"),t;ajaxCfg.success=function(data){var percent=data.percent;_self.set("percent",percent);if(percent<100&&_self.isLoading()){t=setTimeout(function(){$.ajax(ajaxCfg)},interval);_self.set("t",t)}};$.ajax(ajaxCfg)}},{ATTRS:{status:{value:0},ajaxCfg:{},interval:{value:500},events:{}}},{xclass:"progress-bar-load"});return loadProgressBar});define("bui/calendar",["bui/common","bui/calendar/calendar","bui/calendar/monthpicker","bui/calendar/datepicker"],function(require){var BUI=require("bui/common"),Calendar=BUI.namespace("Calendar");BUI.mix(Calendar,{Calendar:require("bui/calendar/calendar"),MonthPicker:require("bui/calendar/monthpicker"),DatePicker:require("bui/calendar/datepicker")});return Calendar});define("bui/calendar/monthpicker",["bui/common","bui/overlay","bui/list","bui/toolbar"],function(require){var BUI=require("bui/common"),Component=BUI.Component,Overlay=require("bui/overlay").Overlay,List=require("bui/list").SimpleList,Toolbar=require("bui/toolbar"),PREFIX=BUI.prefix,CLS_MONTH="x-monthpicker-month",DATA_MONTH="data-month",DATA_YEAR="data-year",CLS_YEAR="x-monthpicker-year",CLS_YEAR_NAV="x-monthpicker-yearnav",CLS_SELECTED="x-monthpicker-selected",CLS_ITEM="x-monthpicker-item",months=["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"];function getMonths(){return $.map(months,function(month,index){return{text:month,value:index}})}var MonthPanel=List.extend({bindUI:function(){var _self=this;_self.get("el").delegate("a","click",function(ev){ev.preventDefault()}).delegate("."+CLS_MONTH,"dblclick",function(){_self.fire("dblclick")})}},{ATTRS:{itemTpl:{view:true,value:'<li class="'+CLS_ITEM+' x-monthpicker-month"><a href="#" hidefocus="on">{text}</a></li>'},itemCls:{value:CLS_ITEM},items:{view:true,value:getMonths()},elCls:{view:true,value:"x-monthpicker-months"}}},{xclass:"calendar-month-panel"});var YearPanel=List.extend({bindUI:function(){var _self=this,el=_self.get("el");el.delegate("a","click",function(ev){ev.preventDefault()});el.delegate("."+CLS_YEAR,"dblclick",function(){_self.fire("dblclick")});el.delegate(".x-icon","click",function(ev){var sender=$(ev.currentTarget);if(sender.hasClass(CLS_YEAR_NAV+"-prev")){_self._prevPage()}else{if(sender.hasClass(CLS_YEAR_NAV+"-next")){_self._nextPage()}}});_self.on("itemselected",function(ev){if(ev.item){_self.setInternal("year",ev.item.value)}})},_prevPage:function(){var _self=this,start=_self.get("start"),yearCount=_self.get("yearCount");_self.set("start",start-yearCount)},_nextPage:function(){var _self=this,start=_self.get("start"),yearCount=_self.get("yearCount");_self.set("start",start+yearCount)},_uiSetStart:function(){var _self=this;_self._setYearsContent()},_uiSetYear:function(v){var _self=this,item=_self.findItemByField("value",v);if(item){_self.setSelectedByField(v)}else{_self.set("start",v)}},_setYearsContent:function(){var _self=this,year=_self.get("year"),start=_self.get("start"),yearCount=_self.get("yearCount"),items=[];for(var i=start;i<start+yearCount;i++){var text=i.toString();items.push({text:text,value:i})}_self.set("items",items);_self.setSelectedByField(year)}},{ATTRS:{items:{view:true,value:[]},elCls:{view:true,value:"x-monthpicker-years"},itemCls:{value:CLS_ITEM},year:{},start:{value:new Date().getFullYear()},yearCount:{value:10},itemTpl:{view:true,value:'<li class="'+CLS_ITEM+" "+CLS_YEAR+'"><a href="#" hidefocus="on">{text}</a></li>'},tpl:{view:true,value:'<div class="'+CLS_YEAR_NAV+'">'+'<span class="'+CLS_YEAR_NAV+'-prev x-icon x-icon-normal x-icon-small"><span class="icon icon-caret icon-caret-left"></span></span>'+'<span class="'+CLS_YEAR_NAV+'-next x-icon x-icon-normal x-icon-small"><span class="icon icon-caret icon-caret-right"></span></span>'+"</div>"+"<ul></ul>"}}},{xclass:"calendar-year-panel"});
var monthPicker=Overlay.extend({initializer:function(){var _self=this,children=_self.get("children"),monthPanel=new MonthPanel(),yearPanel=new YearPanel(),footer=_self._createFooter();children.push(monthPanel);children.push(yearPanel);children.push(footer);_self.set("yearPanel",yearPanel);_self.set("monthPanel",monthPanel)},bindUI:function(){var _self=this;_self.get("monthPanel").on("itemselected",function(ev){if(ev.item){_self.setInternal("month",ev.item.value)}}).on("dblclick",function(){_self._successCall()});_self.get("yearPanel").on("itemselected",function(ev){if(ev.item){_self.setInternal("year",ev.item.value)}}).on("dblclick",function(){_self._successCall()})},_successCall:function(){var _self=this,callback=_self.get("success");if(callback){callback.call(_self)}},_createFooter:function(){var _self=this;return new Toolbar.Bar({elCls:PREFIX+"clear x-monthpicker-footer",children:[{xclass:"bar-item-button",text:"\u786e\u5b9a",btnCls:"button button-small button-primary",handler:function(){_self._successCall()}},{xclass:"bar-item-button",text:"\u53d6\u6d88",btnCls:"button button-small last",handler:function(){var callback=_self.get("cancel");if(callback){callback.call(_self)}}}]})},_uiSetYear:function(v){this.get("yearPanel").set("year",v)},_uiSetMonth:function(v){this.get("monthPanel").setSelectedByField(v)}},{ATTRS:{footer:{},align:{value:{}},year:{},success:{value:function(){}},cancel:{value:function(){}},width:{value:180},month:{},yearPanel:{},monthPanel:{}}},{xclass:"monthpicker"});return monthPicker});define("bui/calendar/header",["bui/common"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,Component=BUI.Component,CLS_TEXT_YEAR="year-text",CLS_TEXT_MONTH="month-text",CLS_ARROW="x-datepicker-arrow",CLS_PREV="x-datepicker-prev",CLS_NEXT="x-datepicker-next";var header=Component.Controller.extend({bindUI:function(){var _self=this,el=_self.get("el");el.delegate("."+CLS_ARROW,"click",function(e){e.preventDefault();var sender=$(e.currentTarget);if(sender.hasClass(CLS_NEXT)){_self.nextMonth()}else{if(sender.hasClass(CLS_PREV)){_self.prevMonth()}}});el.delegate(".x-datepicker-month","click",function(){_self.fire("headerclick")})},setMonth:function(year,month){var _self=this,curYear=_self.get("year"),curMonth=_self.get("month");if(year!==curYear||month!==curMonth){_self.set("year",year);_self.set("month",month);_self.fire("monthchange",{year:year,month:month})}},nextMonth:function(){var _self=this,date=new Date(_self.get("year"),_self.get("month")+1);_self.setMonth(date.getFullYear(),date.getMonth())},prevMonth:function(){var _self=this,date=new Date(_self.get("year"),_self.get("month")-1);_self.setMonth(date.getFullYear(),date.getMonth())},_uiSetYear:function(v){var _self=this;_self.get("el").find("."+CLS_TEXT_YEAR).text(v)},_uiSetMonth:function(v){var _self=this;_self.get("el").find("."+CLS_TEXT_MONTH).text(v+1)}},{ATTRS:{year:{sync:false},month:{sync:false,setter:function(v){this.set("monthText",v+1)}},monthText:{},tpl:{view:true,value:'<div class="'+CLS_ARROW+" "+CLS_PREV+'"><span class="icon icon-white icon-caret  icon-caret-left"></span></div>'+'<div class="x-datepicker-month">'+'<div class="month-text-container">'+'<span><span class="year-text">{year}</span>\u5e74 <span class="month-text">{monthText}</span>\u6708</span>'+'<span class="'+PREFIX+"caret "+PREFIX+'caret-down"></span>'+"</div>"+"</div>"+'<div class="'+CLS_ARROW+" "+CLS_NEXT+'"><span class="icon icon-white icon-caret  icon-caret-right"></span></div>'},elCls:{view:true,value:"x-datepicker-header"},events:{value:{"monthchange":true}}}},{xclass:"calendar-header"});return header});define("bui/calendar/panel",["bui/common"],function(require){var BUI=require("bui/common"),Component=BUI.Component,DateUtil=BUI.Date,CLS_DATE="x-datepicker-date",CLS_TODAY="x-datepicker-today",CLS_DISABLED="x-datepicker-disabled",CLS_ACTIVE="x-datepicker-active",DATA_DATE="data-date",DATE_MASK="isoDate",CLS_SELECTED="x-datepicker-selected",SHOW_WEEKS=6,dateTypes={deactive:"prevday",active:"active",disabled:"disabled"},weekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var panelView=Component.View.extend({renderUI:function(){this.updatePanel()},updatePanel:function(){var _self=this,el=_self.get("el"),bodyEl=el.find("tbody"),innerTem=_self._getPanelInnerTpl();bodyEl.empty();$(innerTem).appendTo(bodyEl)},_getPanelInnerTpl:function(){var _self=this,startDate=_self._getFirstDate(),temps=[];for(var i=0;i<SHOW_WEEKS;i++){var weekStart=DateUtil.addWeek(i,startDate);temps.push(_self._getWeekTpl(weekStart))}return temps.join("")},_getWeekTpl:function(startDate){var _self=this,weekTpl=_self.get("weekTpl"),daysTemps=[];for(var i=0;i<weekDays.length;i++){var date=DateUtil.addDay(i,startDate);daysTemps.push(_self._getDayTpl(date))}return BUI.substitute(weekTpl,{daysTpl:daysTemps.join("")})},_getDayTpl:function(date){var _self=this,dayTpl=_self.get("dayTpl"),day=date.getDay(),todayCls=_self._isToday(date)?CLS_TODAY:"",dayOfWeek=weekDays[day],dateNumber=date.getDate(),dateType=_self._isInRange(date)?(_self._isCurrentMonth(date)?dateTypes.active:dateTypes.deactive):dateTypes.disabled;
return BUI.substitute(dayTpl,{dayOfWeek:dayOfWeek,dateType:dateType,dateNumber:dateNumber,todayCls:todayCls,date:DateUtil.format(date,DATE_MASK)})},_getFirstDate:function(year,month){var _self=this,monthFirstDate=_self._getMonthFirstDate(year,month),day=monthFirstDate.getDay();return DateUtil.addDay(day*-1,monthFirstDate)},_getMonthFirstDate:function(year,month){var _self=this,year=year||_self.get("year"),month=month||_self.get("month");return new Date(year,month)},_isCurrentMonth:function(date){return date.getMonth()===this.get("month")},_isToday:function(date){var tody=new Date();return tody.getFullYear()===date.getFullYear()&&tody.getMonth()===date.getMonth()&&tody.getDate()===date.getDate()},_isInRange:function(date){var _self=this,maxDate=_self.get("maxDate"),minDate=_self.get("minDate");if(minDate&&date<minDate){return false}if(maxDate&&date>maxDate){return false}return true},_clearSelectedDate:function(){var _self=this;_self.get("el").find("."+CLS_SELECTED).removeClass(CLS_SELECTED)},_findDateElement:function(date){var _self=this,dateStr=DateUtil.format(date,DATE_MASK),activeList=_self.get("el").find("."+CLS_DATE),result=null;if(dateStr){activeList.each(function(index,item){if($(item).attr("title")===dateStr){result=$(item);return false}})}return result},_setSelectedDate:function(date){var _self=this,dateEl=_self._findDateElement(date);_self._clearSelectedDate();if(dateEl){dateEl.addClass(CLS_SELECTED)}}},{ATTRS:{}});var panel=Component.Controller.extend({initializer:function(){var _self=this,now=new Date();if(!_self.get("year")){_self.set("year",now.getFullYear())}if(!_self.get("month")){_self.set("month",now.getMonth())}},bindUI:function(){var _self=this,el=_self.get("el");el.delegate("."+CLS_DATE,"click",function(e){e.preventDefault()});el.delegate("."+CLS_DISABLED,"mouseup",function(e){e.stopPropagation()})},performActionInternal:function(ev){var _self=this,sender=$(ev.target).closest("."+CLS_DATE);if(sender){var date=sender.attr("title");if(date){date=DateUtil.parse(date);if(_self.get("view")._isInRange(date)){_self.set("selected",date)}}}},setMonth:function(year,month){var _self=this,curYear=_self.get("year"),curMonth=_self.get("month");if(year!==curYear||month!==curMonth){_self.set("year",year);_self.set("month",month);_self.get("view").updatePanel()}},_uiSetSelected:function(date,ev){var _self=this;if(!(ev&&ev.prevVal&&DateUtil.isDateEquals(date,ev.prevVal))){_self.setMonth(date.getFullYear(),date.getMonth());_self.get("view")._setSelectedDate(date);_self.fire("selectedchange",{date:date})}},_uiSetMaxDate:function(v){if(v){this.get("view").updatePanel()}},_uiSetMinDate:function(v){if(v){this.get("view").updatePanel()}}},{ATTRS:{year:{view:true},month:{view:true},selected:{},focusable:{value:true},dayTpl:{view:true,value:'<td class="x-datepicker-date x-datepicker-{dateType} {todayCls} day-{dayOfWeek}" title="{date}">'+'<a href="#" hidefocus="on" tabindex="1">'+"<em><span>{dateNumber}</span></em>"+"</a>"+"</td>"},events:{value:{"click":false,"selectedchange":true}},maxDate:{view:true,setter:function(val){if(val){if(BUI.isString(val)){return DateUtil.parse(val)}return val}}},minDate:{view:true,setter:function(val){if(val){if(BUI.isString(val)){return DateUtil.parse(val)}return val}}},weekTpl:{view:true,value:"<tr>{daysTpl}</tr>"},tpl:{view:true,value:'<table class="x-datepicker-inner" cellspacing="0">'+"<thead>"+"<tr>"+'<th  title="Sunday"><span>\u65e5</span></th>'+'<th  title="Monday"><span>\u4e00</span></th>'+'<th  title="Tuesday"><span>\u4e8c</span></th>'+'<th  title="Wednesday"><span>\u4e09</span></th>'+'<th  title="Thursday"><span>\u56db</span></th>'+'<th  title="Friday"><span>\u4e94</span></th>'+'<th  title="Saturday"><span>\u516d</span></th>'+"</tr>"+"</thead>"+'<tbody class="x-datepicker-body">'+"</tbody>"+"</table>"},xview:{value:panelView}}},{xclass:"calendar-panel",priority:0});return panel});define("bui/calendar/calendar",["bui/picker","bui/calendar/monthpicker","bui/calendar/header","bui/calendar/panel","bui/toolbar"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,CLS_PICKER_TIME="x-datepicker-time",CLS_PICKER_HOUR="x-datepicker-hour",CLS_PICKER_MINUTE="x-datepicker-minute",CLS_PICKER_SECOND="x-datepicker-second",CLS_TIME_PICKER="x-timepicker",Picker=require("bui/picker").ListPicker,MonthPicker=require("bui/calendar/monthpicker"),Header=require("bui/calendar/header"),Panel=require("bui/calendar/panel"),Toolbar=require("bui/toolbar"),Component=BUI.Component,DateUtil=BUI.Date;function today(){var now=new Date();return new Date(now.getFullYear(),now.getMonth(),now.getDate())}function fixedNumber(n){if(n<10){return"0"+n}return n.toString()}function getNumberItems(end){var items=[];for(var i=0;i<end;i++){items.push({text:fixedNumber(i),value:fixedNumber(i)})}return items}function getTimeUnit(self,cls){var inputEl=self.get("el").find("."+cls);return parseInt(inputEl.val(),10)}function setTimeUnit(self,cls,val){var inputEl=self.get("el").find("."+cls);if(BUI.isNumber(val)){val=fixedNumber(val)
}inputEl.val(val)}var calendar=Component.Controller.extend({initializer:function(){var _self=this,children=_self.get("children"),header=new Header(),panel=new Panel(),footer=_self.get("footer")||_self._createFooter();children.push(header);children.push(panel);children.push(footer);_self.set("header",header);_self.set("panel",panel);_self.set("footer",footer)},renderUI:function(){var _self=this,children=_self.get("children");if(_self.get("showTime")){var timepicker=_self.get("timepicker")||_self._initTimePicker();children.push(timepicker);_self.set("timepicker",timepicker)}},bindUI:function(){var _self=this,header=_self.get("header"),panel=_self.get("panel");panel.on("selectedchange",function(e){var date=e.date;if(!DateUtil.isDateEquals(date,_self.get("selectedDate"))){_self.set("selectedDate",date)}});if(!_self.get("showTime")){panel.on("click",function(){_self.fire("accept")})}else{_self._initTimePickerEvent()}header.on("monthchange",function(e){_self._setYearMonth(e.year,e.month)});header.on("headerclick",function(){var monthPicker=_self.get("monthpicker")||_self._createMonthPicker();monthPicker.set("year",header.get("year"));monthPicker.set("month",header.get("month"));monthPicker.show()})},_initTimePicker:function(){var _self=this,lockTime=_self.get("lockTime"),_timePickerEnum={hour:CLS_PICKER_HOUR,minute:CLS_PICKER_MINUTE,second:CLS_PICKER_SECOND};if(lockTime){for(var key in lockTime){var noCls=_timePickerEnum[key.toLowerCase()];_self.set(key,lockTime[key]);_self.get("el").find("."+noCls).attr("disabled","")}}var picker=new Picker({elCls:CLS_TIME_PICKER,children:[{itemTpl:'<li><a href="#">{text}</a></li>'}],autoAlign:false,align:{node:_self.get("el"),points:["bl","bl"],offset:[0,-30]},trigger:_self.get("el").find("."+CLS_PICKER_TIME)});picker.render();_self._initTimePickerEvent(picker);return picker},_initTimePickerEvent:function(picker){var _self=this,picker=_self.get("timepicker");if(!picker){return}picker.get("el").delegate("a","click",function(ev){ev.preventDefault()});picker.on("triggerchange",function(ev){var curTrigger=ev.curTrigger;if(curTrigger.hasClass(CLS_PICKER_HOUR)){picker.get("list").set("items",getNumberItems(24))}else{picker.get("list").set("items",getNumberItems(60))}});picker.on("selectedchange",function(ev){var curTrigger=ev.curTrigger,val=ev.value;if(curTrigger.hasClass(CLS_PICKER_HOUR)){_self.setInternal("hour",val)}else{if(curTrigger.hasClass(CLS_PICKER_MINUTE)){_self.setInternal("minute",val)}else{_self.setInternal("second",val)}}})},_setYearMonth:function(year,month){var _self=this,selectedDate=_self.get("selectedDate"),date=selectedDate.getDate();if(year!==selectedDate.getFullYear()||month!==selectedDate.getMonth()){_self.set("selectedDate",new Date(year,month,date))}},_createMonthPicker:function(){var _self=this,monthpicker;monthpicker=new MonthPicker({render:_self.get("el"),effect:{effect:"slide",duration:300},visibleMode:"display",success:function(){var picker=this;_self._setYearMonth(picker.get("year"),picker.get("month"));picker.hide()},cancel:function(){this.hide()}});_self.set("monthpicker",monthpicker);_self.get("children").push(monthpicker);return monthpicker},_createFooter:function(){var _self=this,showTime=this.get("showTime"),items=[];if(showTime){items.push({content:_self.get("timeTpl")});items.push({xclass:"bar-item-button",text:"\u786e\u5b9a",btnCls:"button button-small button-primary",listeners:{click:function(){_self.fire("accept")}}})}else{items.push({xclass:"bar-item-button",text:"\u4eca\u5929",btnCls:"button button-small",id:"todayBtn",listeners:{click:function(){var day=today();_self.set("selectedDate",day);_self.fire("accept")}}})}return new Toolbar.Bar({elCls:PREFIX+"calendar-footer",children:items})},_updateTodayBtnAble:function(){var _self=this;if(!_self.get("showTime")){var footer=_self.get("footer"),panelView=_self.get("panel").get("view"),now=today(),btn=footer.getItem("todayBtn");panelView._isInRange(now)?btn.enable():btn.disable()}},_uiSetSelectedDate:function(v){var _self=this,year=v.getFullYear(),month=v.getMonth();_self.get("header").setMonth(year,month);_self.get("panel").set("selected",v);_self.fire("datechange",{date:v})},_uiSetHour:function(v){setTimeUnit(this,CLS_PICKER_HOUR,v)},_uiSetMinute:function(v){setTimeUnit(this,CLS_PICKER_MINUTE,v)},_uiSetSecond:function(v){setTimeUnit(this,CLS_PICKER_SECOND,v)},_uiSetMaxDate:function(v){var _self=this;_self.get("panel").set("maxDate",v);_self._updateTodayBtnAble()},_uiSetMinDate:function(v){var _self=this;_self.get("panel").set("minDate",v);_self._updateTodayBtnAble()}},{ATTRS:{header:{},panel:{},maxDate:{},minDate:{},monthPicker:{},timepicker:{},width:{value:180},events:{value:{"click":false,"accept":false,"datechange":false,"monthchange":false}},showTime:{value:false},lockTime:{},timeTpl:{value:'<input type="text" readonly class="'+CLS_PICKER_TIME+" "+CLS_PICKER_HOUR+'" />:<input type="text" readonly class="'+CLS_PICKER_TIME+" "+CLS_PICKER_MINUTE+'" />:<input type="text" readonly class="'+CLS_PICKER_TIME+" "+CLS_PICKER_SECOND+'" />'},selectedDate:{value:today()},hour:{value:new Date().getHours()},minute:{value:new Date().getMinutes()},second:{value:0}}},{xclass:"calendar",priority:0});
return calendar});define("bui/calendar/datepicker",["bui/common","bui/picker","bui/calendar/calendar"],function(require){var BUI=require("bui/common"),Picker=require("bui/picker").Picker,Calendar=require("bui/calendar/calendar"),DateUtil=BUI.Date;var datepicker=Picker.extend({initializer:function(){},createControl:function(){var _self=this,children=_self.get("children"),calendar=new Calendar({render:_self.get("el"),showTime:_self.get("showTime"),lockTime:_self.get("lockTime"),minDate:_self.get("minDate"),maxDate:_self.get("maxDate"),autoRender:true});if(!_self.get("dateMask")){if(_self.get("showTime")){_self.set("dateMask","yyyy-mm-dd HH:MM:ss")}else{_self.set("dateMask","yyyy-mm-dd")}}children.push(calendar);_self.set("calendar",calendar);return calendar},setSelectedValue:function(val){if(!this.get("calendar")){return}var _self=this,calendar=this.get("calendar"),date=DateUtil.parse(val,_self.get("dateMask"));date=date||new Date(new Date().setSeconds(0));calendar.set("selectedDate",DateUtil.getDate(date));if(_self.get("showTime")){var lockTime=this.get("lockTime"),hour=lockTime&&lockTime["hour"]?lockTime["hour"]:date.getHours(),minute=lockTime&&lockTime["minute"]?lockTime["minute"]:date.getMinutes(),second=lockTime&&lockTime["second"]?lockTime["second"]:date.getSeconds();calendar.set("hour",hour);calendar.set("minute",minute);calendar.set("second",second)}},getSelectedValue:function(){if(!this.get("calendar")){return null}var _self=this,calendar=_self.get("calendar"),date=DateUtil.getDate(calendar.get("selectedDate"));if(_self.get("showTime")){date=DateUtil.addHour(calendar.get("hour"),date);date=DateUtil.addMinute(calendar.get("minute"),date);date=DateUtil.addSecond(calendar.get("second"),date)}return date},getSelectedText:function(){if(!this.get("calendar")){return""}return DateUtil.format(this.getSelectedValue(),this._getFormatType())},_getFormatType:function(){return this.get("dateMask")},_uiSetMaxDate:function(v){if(!this.get("calendar")){return null}var _self=this;_self.get("calendar").set("maxDate",v)},_uiSetMinDate:function(v){if(!this.get("calendar")){return null}var _self=this;_self.get("calendar").set("minDate",v)}},{ATTRS:{showTime:{value:false},lockTime:{},maxDate:{},minDate:{},dateMask:{},changeEvent:{value:"accept"},hideEvent:{value:"accept"},calendar:{}}},{xclass:"datepicker",priority:0});return datepicker});define("bui/editor",["bui/common","bui/form","bui/editor/editor","bui/editor/record","bui/editor/dialog"],function(require){var BUI=require("bui/common"),Form=require("bui/form"),Editor=BUI.namespace("Editor");BUI.mix(Editor,{Editor:require("bui/editor/editor"),RecordEditor:require("bui/editor/record"),DialogEditor:require("bui/editor/dialog")});return Editor});define("bui/editor/mixin",function(require){function initEditor(self){var _self=self,controlCfgField=_self.get("controlCfgField"),control=_self.get(controlCfgField),c=_self.addChild(control);_self.setInternal(controlCfgField,c)}var Mixin=function(){initEditor(this)};Mixin.ATTRS={acceptEvent:{value:"autohide"},preventHide:{value:true},changeSourceEvent:{value:"show triggerchange"},ignoreInputFields:{value:true},innerValueField:{},emptyValue:{},controlCfgField:{},focusable:{value:true},autoUpdate:{value:true},events:{value:{accept:false,cancel:false}}};Mixin.prototype={__bindUI:function(){var _self=this,acceptEvent=_self.get("acceptEvent"),changeSourceEvent=_self.get("changeSourceEvent");if(acceptEvent){_self.on(acceptEvent,function(){if(_self.accept()){return}else{if(_self.get("preventHide")){return false}else{_self.cancel()}}})}if(changeSourceEvent){_self.on(changeSourceEvent,function(){_self.setValue(_self.getSourceValue());if(_self.get("visible")){_self.focus()}})}},getInnerControl:function(){var _self=this,children=_self.get("children");return children[0]},setValue:function(value,hideError){var _self=this,innerControl=_self.getInnerControl();_self.set("editValue",value);_self.clearControlValue();innerControl.set(_self.get("innerValueField"),value);if(!value){_self.valid()}if(hideError){_self.clearErrors()}},getValue:function(){var _self=this,innerControl=_self.getInnerControl();return innerControl.get(_self.get("innerValueField"))},isValid:function(){var _self=this,innerControl=_self.getInnerControl();return innerControl.isValid?innerControl.isValid():true},valid:function(){var _self=this,innerControl=_self.getInnerControl();innerControl.valid&&innerControl.valid()},getErrors:function(){var _self=this,innerControl=_self.getInnerControl();return innerControl.getErrors?innerControl.getErrors():[]},isChange:function(){var _self=this,editValue=_self.get("editValue"),value=_self.getValue();return editValue!==value},clearValue:function(){this.clearControlValue();this.clearErrors()},clearControlValue:function(){var _self=this,innerControl=_self.getInnerControl();innerControl.set(_self.get("innerValueField"),_self.get("emptyValue"))},clearErrors:function(){var _self=this,innerControl=_self.getInnerControl();innerControl.clearErrors()},getSourceValue:function(){},updateSource:function(){},handleNavEsc:function(){this.cancel()
},handleNavEnter:function(ev){var sender=ev.target;if(sender.tagName==="TEXTAREA"){return}if(sender.tagName==="BUTTON"){$(sender).trigger("click")}this.accept()},focus:function(){var _self=this,innerControl=_self.getInnerControl();innerControl.focus&&innerControl.focus()},accept:function(){var _self=this,value;_self.valid();if(!_self.isValid()){return false}value=_self.getValue();if(_self.get("autoUpdate")){_self.updateSource(value)}if(_self.fire("beforeaccept",{value:value})==false){return}_self.fire("accept",{value:value,editValue:_self.get("editValue")});_self.hide();return true},cancel:function(){this.fire("cancel");this.clearValue();this.close()}};return Mixin});define("bui/editor/editor",["bui/common","bui/overlay","bui/editor/mixin"],function(require){var BUI=require("bui/common"),Overlay=require("bui/overlay").Overlay;CLS_TIPS="x-editor-tips",Mixin=require("bui/editor/mixin");var editor=Overlay.extend([Mixin],{bindUI:function(){var _self=this,innerControl=_self.getInnerControl();_self.on("validchange",function(ev){if(!_self.isValid()&&_self.get("visible")){_self._showError(_self.getErrors())}else{_self._hideError()}});_self.on("hide",function(){_self._hideError()});_self.on("show",function(){if(!_self.isValid()){_self._showError(_self.getErrors())}})},_initOverlay:function(){var _self=this,tooltip=_self.get("tooltip"),overlay=new Overlay(tooltip);overlay.render();_self.set("overlay",overlay);return overlay},_getErrorList:function(){var _self=this,overlay=_self.get("overlay");return overlay&&overlay.get("children")[0]},_showError:function(errors){var _self=this,overlay=_self.get("overlay")||_self._initOverlay(),list=_self._getErrorList(),align=_self.get("errorAlign"),items=BUI.Array.map(errors,function(text){return{error:text}});list.set("items",items);align.node=_self.get("el");overlay.set("align",align);overlay.show()},_hideError:function(){var _self=this,overlay=_self.get("overlay");overlay&&overlay.hide()},getSourceValue:function(){var _self=this,trigger=_self.get("curTrigger"),parser=_self.get("parser"),text=trigger.text();if(parser){text=parser.call(this,text,trigger)}return text},updateSource:function(text){var _self=this,trigger=_self.get("curTrigger");if(trigger&&trigger.length){text=_self._formatText(text);trigger.text(text)}},_formatText:function(text){var _self=this,formatter=_self.get("formatter");if(formatter){text=formatter.call(_self,text)}return text},_uiSetWidth:function(v){var _self=this;if(v!=null){var innerControl=_self.getInnerControl();if(innerControl.set){innerControl.set("width",v)}}}},{ATTRS:{innerValueField:{value:"value"},emptyValue:{value:""},autoHide:{value:true},controlCfgField:{value:"field"},defaultChildCfg:{value:{tpl:"",forceFit:true,errorTpl:""}},tooltip:{valueFn:function(){return{children:[{xclass:"simple-list",itemTpl:'<li><span class="x-icon x-icon-mini x-icon-error" title="{error}">!</span>&nbsp;<span>{error}</span></li>'}],elCls:CLS_TIPS}}},defaultChildClass:{value:"form-field"},align:{value:{points:["tl","tl"]}},parser:{},formatter:{},errorAlign:{value:{points:["bl","tl"],offset:[0,10]}},overlay:{},field:{value:{}}}},{xclass:"editor"});return editor});define("bui/editor/record",["bui/common","bui/editor/editor"],function(require){var BUI=require("bui/common"),Editor=require("bui/editor/editor");var editor=Editor.extend({getSourceValue:function(){return this.get("record")},updateSource:function(value){var _self=this,record=_self.get("record");BUI.mix(record,value)},_uiSetRecord:function(v){this.setValue(v)}},{ATTRS:{innerValueField:{value:"record"},acceptEvent:{value:""},emptyValue:{value:{}},autoHide:{value:false},record:{value:{}},controlCfgField:{value:"form"},form:{value:{}},errorAlign:{value:{points:["tr","tl"],offset:[10,0]}},defaultChildCfg:{valueFn:function(){var _self=this;return{xclass:"form",errorTpl:"",showError:true,showChildError:true,defaultChildCfg:{elCls:"bui-inline-block",tpl:"",forceFit:true},buttons:[{btnCls:"button button-primary",text:"\u786e\u5b9a",handler:function(){_self.accept()}},{btnCls:"button",text:"\u53d6\u6d88",handler:function(){_self.cancel()}}]}}}}},{xclass:"record-editor"});return editor});define("bui/editor/dialog",["bui/overlay","bui/editor/mixin"],function(require){var Dialog=require("bui/overlay").Dialog,Mixin=require("bui/editor/mixin");var editor=Dialog.extend([Mixin],{getSourceValue:function(){return this.get("record")},handleNavEnter:function(ev){var _self=this,success=_self.get("success"),sender=ev.target;if(sender.tagName==="TEXTAREA"){return}if(sender.tagName==="BUTTON"){$(sender).trigger("click")}if(success){success.call(_self)}else{this.accept()}},cancel:function(){this.fire("cancel");this.clearValue();this.close()},updateSource:function(value){var _self=this,record=_self.get("record");BUI.mix(record,value)},_uiSetRecord:function(v){this.setValue(v)}},{ATTRS:{innerValueField:{value:"record"},acceptEvent:{value:""},record:{value:{}},emptyValue:{shared:false,value:{}},controlCfgField:{value:"form"},changeSourceEvent:{value:""},defaultChildCfg:{value:{xclass:"form-horizontal"}},focusable:{value:false},success:{value:function(){this.accept()
}},cancel:{value:function(){this.cancel()}},form:{value:{}}}},{xclass:"dialog-editor"});return editor});define("bui/grid",["bui/common","bui/grid/simplegrid","bui/grid/grid","bui/grid/column","bui/grid/header","bui/grid/format","bui/grid/plugins"],function(require){var BUI=require("bui/common"),Grid=BUI.namespace("Grid");BUI.mix(Grid,{SimpleGrid:require("bui/grid/simplegrid"),Grid:require("bui/grid/grid"),Column:require("bui/grid/column"),Header:require("bui/grid/header"),Format:require("bui/grid/format"),Plugins:require("bui/grid/plugins")});return Grid});define("bui/grid/simplegrid",["bui/common","bui/list"],function(require){var BUI=require("bui/common"),List=require("bui/list"),Component=BUI.Component,UIBase=Component.UIBase,PREFIX=BUI.prefix,CLS_GRID=PREFIX+"grid",CLS_GRID_ROW=CLS_GRID+"-row",CLS_ROW_ODD=PREFIX+"grid-row-odd",CLS_ROW_EVEN=PREFIX+"grid-row-even",CLS_GRID_BORDER=PREFIX+"grid-border",CLS_ROW_FIRST=PREFIX+"grid-row-first";var simpleGridView=List.SimpleListView.extend({setColumns:function(columns){var _self=this,headerRowEl=_self.get("headerRowEl");columns=columns||_self.get("columns");headerRowEl.empty();BUI.each(columns,function(column){_self._createColumn(column,headerRowEl)})},_createColumn:function(column,parent){var _self=this,columnTpl=BUI.substitute(_self.get("columnTpl"),column);$(columnTpl).appendTo(parent)},getItemTpl:function(record,index){var _self=this,columns=_self.get("columns"),rowTpl=_self.get("rowTpl"),oddCls=index%2===0?CLS_ROW_ODD:CLS_ROW_EVEN,cellsTpl=[],rowEl;BUI.each(columns,function(column){var dataIndex=column["dataIndex"];cellsTpl.push(_self._getCellTpl(column,dataIndex,record))});rowTpl=BUI.substitute(rowTpl,{cellsTpl:cellsTpl.join(""),oddCls:oddCls});return rowTpl},_getCellTpl:function(column,dataIndex,record){var _self=this,renderer=column.renderer,text=renderer?renderer(record[dataIndex],record):record[dataIndex],cellTpl=_self.get("cellTpl");return BUI.substitute(cellTpl,{elCls:column.elCls,text:text})},clearData:function(){var _self=this,tbodyEl=_self.get("itemContainer");tbodyEl.empty()},showData:function(data){var _self=this;BUI.each(data,function(record,index){_self._createRow(record,index)})},_uiSetInnerBorder:function(v){var _self=this,el=_self.get("el");if(v){el.addClass(CLS_GRID_BORDER)}else{el.removeClass(CLS_GRID_BORDER)}},_uiSetTableCls:function(v){var _self=this,tableEl=_self.get("el").find("table");tableEl.attr("class",v)}},{ATTRS:{headerRowEl:{valueFn:function(){var _self=this,thead=_self.get("el").find("thead");return thead.children("tr")}},itemContainer:{valueFn:function(){return this.get("el").find("tbody")}},tableCls:{}}},{xclass:"simple-grid-veiw"});var simpleGrid=BUI.List.SimpleList.extend({renderUI:function(){this.get("view").setColumns()},bindUI:function(){var _self=this,itemCls=_self.get("itemCls"),hoverCls=itemCls+"-hover",el=_self.get("el");el.delegate("."+itemCls,"mouseover",function(ev){var sender=$(ev.currentTarget);sender.addClass(hoverCls)}).delegate("."+itemCls,"mouseout",function(ev){var sender=$(ev.currentTarget);sender.removeClass(hoverCls)})},showData:function(data){this.clearData();this.set("items",data)},clearData:function(){this.get("view").clearData()},_uiSetColumns:function(columns){var _self=this;_self.clearData();_self.get("view").setColumns(columns)}},{ATTRS:{itemCls:{view:true,value:CLS_GRID_ROW},tableCls:{view:true,value:CLS_GRID+"-table"},columns:{view:true,sync:false,value:[]},tpl:{view:true,value:'<table cellspacing="0" class="{tableCls}" cellpadding="0"><thead><tr></tr></thead><tbody></tbody></table>'},innerBorder:{view:true,value:true},rowTpl:{view:true,value:'<tr class="'+CLS_GRID_ROW+' {oddCls}">{cellsTpl}</tr>'},cellTpl:{view:true,value:'<td class="'+CLS_GRID+'-cell {elCls}"><div class="'+CLS_GRID+'-cell-inner"><span class="'+CLS_GRID+'-cell-text">{text}</span></div></td>'},columnTpl:{view:true,value:'<th class="'+CLS_GRID+'-hd {elCls}" width="{width}"><div class="'+CLS_GRID+'-hd-inner"><span class="'+CLS_GRID+'-hd-title">{title}</span></div></th>'},events:{value:{}},xview:{value:simpleGridView}}},{xclass:"simple-grid"});simpleGrid.View=simpleGridView;return simpleGrid});define("bui/grid/column",["bui/common"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,CLS_HD_TITLE=PREFIX+"grid-hd-title",CLS_OPEN=PREFIX+"grid-hd-open",SORT_PREFIX="sort-",SORT_ASC="ASC",SORT_DESC="DESC",CLS_TRIGGER=PREFIX+"grid-hd-menu-trigger",CLS_HD_TRIGGER="grid-hd-menu-trigger";var columnView=BUI.Component.View.extend({setTplContent:function(attrs){var _self=this,sortTpl=_self.get("sortTpl"),triggerTpl=_self.get("triggerTpl"),el=_self.get("el"),titleEl;columnView.superclass.setTplContent.call(_self,attrs);titleEl=el.find("."+CLS_HD_TITLE);$(sortTpl).insertAfter(titleEl);$(triggerTpl).insertAfter(titleEl)},_setContent:function(){this.setTplContent()},_uiSetShowMenu:function(v){var _self=this,triggerTpl=_self.get("triggerTpl"),el=_self.get("el"),titleEl=el.find("."+CLS_HD_TITLE);if(v){$(triggerTpl).insertAfter(titleEl)
}else{el.find("."+CLS_TRIGGER).remove()}},_uiSetTitle:function(title){if(!this.get("rendered")){return}this._setContent()},_uiSetDraggable:function(v){if(!this.get("rendered")){return}this._setContent()},_uiSetSortable:function(v){if(!this.get("rendered")){return}this._setContent()},_uiSetTpl:function(v){if(!this.get("rendered")){return}this._setContent()},_uiSetSortState:function(v){var _self=this,el=_self.get("el"),method=v?"addClass":"removeClass",ascCls=SORT_PREFIX+"asc",desCls=SORT_PREFIX+"desc";el.removeClass(ascCls+" "+desCls);if(v==="ASC"){el.addClass(ascCls)}else{if(v==="DESC"){el.addClass(desCls)}}},_uiSetOpen:function(v){var _self=this,el=_self.get("el");if(v){el.addClass(CLS_OPEN)}else{el.removeClass(CLS_OPEN)}}},{ATTRS:{sortTpl:{view:true,getter:function(){var _self=this,sortable=_self.get("sortable");if(sortable){return'<span class="'+PREFIX+'grid-sort-icon">&nbsp;</span>'}return""}},tpl:{}}});var column=BUI.Component.Controller.extend({_toggleSortState:function(){var _self=this,sortState=_self.get("sortState"),v=sortState?(sortState===SORT_ASC?SORT_DESC:SORT_ASC):SORT_ASC;_self.set("sortState",v)},performActionInternal:function(ev){var _self=this,sender=$(ev.target),prefix=_self.get("prefixCls");if(sender.hasClass(prefix+CLS_HD_TRIGGER)){}else{if(_self.get("sortable")){_self._toggleSortState()}}},_uiSetWidth:function(v){if(v){this.set("originWidth",v)}}},{ATTRS:{elTagName:{value:"th"},open:{view:true,value:false},dataIndex:{view:true,value:""},draggable:{sync:false,view:true,value:true},editor:{},focusable:{value:false},fixed:{value:false},id:{},renderer:{},resizable:{value:true},sortable:{sync:false,view:true,value:true},sortState:{view:true,value:null},title:{sync:false,view:true,value:"&#160;"},width:{value:100},showMenu:{view:true,value:false},triggerTpl:{view:true,value:'<span class="'+CLS_TRIGGER+'"></span>'},tpl:{sync:false,view:true,value:'<div class="'+PREFIX+'grid-hd-inner">'+'<span class="'+CLS_HD_TITLE+'">{title}</span>'+"</div>"},cellTpl:{value:""},events:{value:{"afterWidthChange":true,"afterSortStateChange":true,"afterVisibleChange":true,"click":true,"resize":true,"move":true}},xview:{value:columnView}}},{xclass:"grid-hd",priority:1});column.Empty=column.extend({},{ATTRS:{type:{value:"empty"},sortable:{view:true,value:false},width:{view:true,value:null},tpl:{view:true,value:'<div class="'+PREFIX+'grid-hd-inner"></div>'}}},{xclass:"grid-hd-empty",priority:1});return column});define("bui/grid/header",["bui/common","bui/grid/column"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,Grid=BUI.namespace("Grid"),Column=require("bui/grid/column"),View=BUI.Component.View,Controller=BUI.Component.Controller,CLS_SCROLL_WITH=17,UA=BUI.UA;var headerView=View.extend({getContentElement:function(){return this.get("el").find("tr")},scrollTo:function(obj){var _self=this,el=_self.get("el");if(obj.top!==undefined){el.scrollTop(obj.top)}if(obj.left!==undefined){el.scrollLeft(obj.left)}},_uiSetTableCls:function(v){var _self=this,tableEl=_self.get("el").find("table");tableEl.attr("class",v)}},{ATTRS:{emptyCellEl:{},tableCls:{}}},{xclass:"header-view"});var header=Controller.extend({addColumn:function(c,index){var _self=this,insertIndex=index,columns=_self.get("columns");c=_self._createColumn(c);if(index===undefined){index=columns.length;insertIndex=_self.get("children").length-1}columns.splice(index,0,c);_self.addChild(c,insertIndex);_self.fire("add",{column:c,index:index});return c},removeColumn:function(c){var _self=this,columns=_self.get("columns"),index;c=BUI.isNumber(c)?columns[c]:c;index=BUI.Array.indexOf(c,columns);columns.splice(index,1);_self.fire("remove",{column:c,index:index});return _self.removeChild(c,true)},bindUI:function(){var _self=this;_self._bindColumnsEvent()},initializer:function(){var _self=this,children=_self.get("children"),columns=_self.get("columns"),emptyColumn=_self._createEmptyColumn();$.each(columns,function(index,item){var columnControl=_self._createColumn(item);children[index]=columnControl;columns[index]=columnControl});children.push(emptyColumn);_self.set("emptyColumn",emptyColumn)},getColumns:function(){return this.get("columns")},getColumnsWidth:function(){var _self=this,columns=_self.getColumns(),totalWidth=0;$.each(columns,function(index,column){if(column.get("visible")){totalWidth+=column.get("el").outerWidth()}});return totalWidth},getColumnOriginWidth:function(){var _self=this,columns=_self.getColumns(),totalWidth=0;$.each(columns,function(index,column){if(column.get("visible")){var width=column.get("originWidth")||column.get("width");totalWidth+=width}});return totalWidth},getColumnByIndex:function(index){var _self=this,columns=_self.getColumns(),result=columns[index];return result},getColumn:function(func){var _self=this,columns=_self.getColumns(),result=null;$.each(columns,function(index,column){if(func(column)){result=column;return false}});return result},getColumnById:function(id){var _self=this;return _self.getColumn(function(column){return column.get("id")===id
})},getColumnIndex:function(column){var _self=this,columns=_self.getColumns();return BUI.Array.indexOf(column,columns)},scrollTo:function(obj){this.get("view").scrollTo(obj)},_bindColumnsEvent:function(){var _self=this;_self.on("afterWidthChange",function(e){var sender=e.target;if(sender!==_self){_self.setTableWidth()}});_self.on("afterVisibleChange",function(e){var sender=e.target;if(sender!==_self){_self.setTableWidth()}});_self.on("afterSortStateChange",function(e){var sender=e.target,columns=_self.getColumns(),val=e.newVal;if(val){$.each(columns,function(index,column){if(column!==sender){column.set("sortState","")}})}});_self.on("add",function(){_self.setTableWidth()});_self.on("remove",function(){_self.setTableWidth()})},_createColumn:function(cfg){if(cfg instanceof Column){return cfg}if(!cfg.id){cfg.id=BUI.guid("col")}return new Column(cfg)},_createEmptyColumn:function(){return new Column.Empty()},_isAllowScrollLeft:function(){var _self=this,parent=_self.get("parent");return parent&&!!parent.get("height")},forceFitColumns:function(){var _self=this,columns=_self.getColumns(),width=_self.get("width"),totalWidth=width,totalColumnsWidth=_self.getColumnOriginWidth(),realWidth=0,appendWidth=0,lastShowColumn=null,allowScroll=_self._isAllowScrollLeft();function setColoumnWidthSilent(column,colWidth){var columnEl=column.get("el");column.set("width",colWidth,{silent:1});columnEl.width(colWidth)}if(width){if(allowScroll){width-=CLS_SCROLL_WITH;totalWidth=width}var adjustCount=0;$.each(columns,function(index,column){if(column.get("visible")&&column.get("resizable")){adjustCount++}if(column.get("visible")&&!column.get("resizable")){var colWidth=column.get("el").outerWidth();totalWidth-=colWidth;totalColumnsWidth-=colWidth}});var colWidth=Math.floor(totalWidth/adjustCount),ratio=totalWidth/totalColumnsWidth;if(ratio===1){return}$.each(columns,function(index,column){if(column.get("visible")&&column.get("resizable")){var borderWidth=_self._getColumnBorderWith(column,index),originWidth=column.get("originWidth");if(!originWidth){column.set("originWidth",column.get("width"));originWidth=column.get("width")}colWidth=Math.floor((originWidth+borderWidth)*ratio);setColoumnWidthSilent(column,colWidth-borderWidth);realWidth+=colWidth;lastShowColumn=column}});if(lastShowColumn){appendWidth=totalWidth-realWidth;setColoumnWidthSilent(lastShowColumn,lastShowColumn.get("width")+appendWidth)}_self.fire("forceFitWidth")}},_getColumnBorderWith:function(column,index){var columnEl=column.get("el"),borderWidth=Math.round(parseFloat(columnEl.css("border-left-width"))||0)+Math.round(parseFloat(columnEl.css("border-right-width"))||0);borderWidth=UA.ie&&UA.ie<8?(index===0?1:borderWidth):borderWidth;return borderWidth},setTableWidth:function(){var _self=this,width=_self.get("width"),totalWidth=0,emptyColumn=null;if(width=="auto"){return}if(_self.get("forceFit")){_self.forceFitColumns()}else{if(_self._isAllowScrollLeft()){totalWidth=_self.getColumnsWidth();emptyColumn=_self.get("emptyColumn");if(width<totalWidth){emptyColumn.get("el").width(CLS_SCROLL_WITH)}else{emptyColumn.get("el").width("auto")}}}},_uiSetWidth:function(){var _self=this;_self.setTableWidth()},_uiSetForceFit:function(v){var _self=this;if(v){_self.setTableWidth()}}},{ATTRS:{columns:{value:[]},emptyColumn:{},focusable:{value:false},forceFit:{sync:false,view:true,value:false},tpl:{view:true,value:'<table cellspacing="0" class="'+PREFIX+'grid-table" cellpadding="0">'+"<thead><tr></tr></thead>"+"</table>"},tableCls:{view:true},xview:{value:headerView},events:{value:{"add":false,"remove":false}}}},{xclass:"grid-header",priority:1});return header});define("bui/grid/grid",["bui/common","bui/mask","bui/toolbar","bui/list","bui/grid/header","bui/grid/column"],function(require){var BUI=require("bui/common"),Mask=require("bui/mask"),UA=BUI.UA,Component=BUI.Component,toolbar=require("bui/toolbar"),List=require("bui/list"),Header=require("bui/grid/header"),Column=require("bui/grid/column");function isPercent(str){if(BUI.isString(str)){return str.indexOf("%")!==-1}return false}var PREFIX=BUI.prefix,CLS_GRID_HEADER_CONTAINER=PREFIX+"grid-header-container",CLS_GRID_BODY=PREFIX+"grid-body",CLS_GRID_WITH=PREFIX+"grid-width",CLS_GRID_HEIGHT=PREFIX+"grid-height",CLS_GRID_BORDER=PREFIX+"grid-border",CLS_GRID_TBAR=PREFIX+"grid-tbar",CLS_GRID_BBAR=PREFIX+"grid-bbar",CLS_BUTTON_BAR=PREFIX+"grid-button-bar",CLS_GRID_STRIPE=PREFIX+"grid-strip",CLS_GRID_ROW=PREFIX+"grid-row",CLS_ROW_ODD=PREFIX+"grid-row-odd",CLS_ROW_EVEN=PREFIX+"grid-row-even",CLS_ROW_FIRST=PREFIX+"grid-row-first",CLS_GRID_CELL=PREFIX+"grid-cell",CLS_GRID_CELL_INNER=PREFIX+"grid-cell-inner",CLS_TD_PREFIX="grid-td-",CLS_CELL_TEXT=PREFIX+"grid-cell-text",CLS_CELL_EMPTY=PREFIX+"grid-cell-empty",CLS_SCROLL_WITH="17",CLS_HIDE=PREFIX+"hidden",ATTR_COLUMN_FIELD="data-column-field",WIDTH_BORDER=2,HEIGHT_BAR_PADDING=1;function getInnerWidth(width){var _self=this;if(BUI.isNumber(width)){width-=WIDTH_BORDER}return width}var gridView=List.SimpleListView.extend({renderUI:function(){var _self=this,el=_self.get("el"),bodyEl=el.find("."+CLS_GRID_BODY);
_self.set("bodyEl",bodyEl);_self._setTableTpl()},getItemTpl:function(record,index){var _self=this,columns=_self._getColumns(),tbodyEl=_self.get("tbodyEl"),rowTpl=_self.get("rowTpl"),oddCls=index%2===0?CLS_ROW_ODD:CLS_ROW_EVEN,cellsTpl=[],rowEl;BUI.each(columns,function(column){var dataIndex=column.get("dataIndex");cellsTpl.push(_self._getCellTpl(column,dataIndex,record,index))});if(_self.get("useEmptyCell")){cellsTpl.push(_self._getEmptyCellTpl())}rowTpl=BUI.substitute(rowTpl,{cellsTpl:cellsTpl.join(""),oddCls:oddCls});return rowTpl},findRow:function(record){var _self=this;return $(_self.findElement(record))},findCell:function(id,rowEl){var cls=CLS_TD_PREFIX+id;return rowEl.find("."+cls)},resetHeaderRow:function(){if(!this.get("useHeaderRow")){return}var _self=this,headerRowEl=_self.get("headerRowEl"),tbodyEl=_self.get("tbodyEl");if(headerRowEl){headerRowEl.remove()}headerRowEl=_self._createHeaderRow();headerRowEl.prependTo(tbodyEl);_self.set("headerRowEl",headerRowEl)},resetColumnsWidth:function(column,width){var _self=this,headerRowEl=_self.get("headerRowEl"),cell=_self.findCell(column.get("id"),headerRowEl);width=width||column.get("width");if(cell){cell.width(width)}_self.setTableWidth()},setTableWidth:function(columnsWidth){if(!columnsWidth&&isPercent(this.get("width"))){this.get("tableEl").width("100%");return}var _self=this,width=_self._getInnerWidth(),height=_self.get("height"),tableEl=_self.get("tableEl"),forceFit=_self.get("forceFit"),headerRowEl=_self.get("headerRowEl");if(!isPercent(columnsWidth)){columnsWidth=columnsWidth||_self._getColumnsWidth();if(!width){return}if(width>=columnsWidth){columnsWidth=width;if(height){var scrollWidth=(UA.ie==6||UA.ie==7)?CLS_SCROLL_WITH+2:CLS_SCROLL_WITH;columnsWidth=width-scrollWidth}}}tableEl.width(columnsWidth)},setBodyWidth:function(width){var _self=this,bodyEl=_self.get("bodyEl");width=width||_self._getInnerWidth();bodyEl.width(width)},setBodyHeight:function(height){var _self=this,bodyEl=_self.get("bodyEl"),bodyHeight=height,siblings=bodyEl.siblings();BUI.each(siblings,function(item){if($(item).css("display")!=="none"){bodyHeight-=$(item).outerHeight()}});bodyEl.height(bodyHeight)},setColumnVisible:function(column){var _self=this,hide=!column.get("visible"),colId=column.get("id"),tbodyEl=_self.get("tbodyEl"),cells=$("."+CLS_TD_PREFIX+colId,tbodyEl);if(hide){cells.hide()}else{cells.show()}},updateItem:function(record){var _self=this,items=_self.getItems(),index=BUI.Array.indexOf(record,items),columns=_self._getColumns(),element=null,tpl;if(index>=0){element=_self.findElement(record);BUI.each(columns,function(column){var cellEl=_self.findCell(column.get("id"),$(element)),innerEl=cellEl.find("."+CLS_GRID_CELL_INNER),textTpl=_self._getCellText(column,record,index);innerEl.html(textTpl)});return element}},showEmptyText:function(){var _self=this,bodyEl=_self.get("bodyEl"),emptyDataTpl=_self.get("emptyDataTpl"),emptyEl=_self.get("emptyEl");if(emptyEl){emptyEl.remove()}var emptyEl=$(emptyDataTpl).appendTo(bodyEl);_self.set("emptyEl",emptyEl)},clearEmptyText:function(){var _self=this,emptyEl=_self.get("emptyEl");if(emptyEl){emptyEl.remove()}},_createHeaderRow:function(){var _self=this,columns=_self._getColumns(),tbodyEl=_self.get("tbodyEl"),rowTpl=_self.get("headerRowTpl"),rowEl,cellsTpl=[];$.each(columns,function(index,column){cellsTpl.push(_self._getHeaderCellTpl(column))});if(_self.get("useEmptyCell")){cellsTpl.push(_self._getEmptyCellTpl())}rowTpl=BUI.substitute(rowTpl,{cellsTpl:cellsTpl.join("")});rowEl=$(rowTpl).appendTo(tbodyEl);return rowEl},_getColumnsWidth:function(){var _self=this,columns=_self.get("columns"),totalWidth=0;BUI.each(columns,function(column){if(column.get("visible")){totalWidth+=column.get("el").outerWidth()}});return totalWidth},_getColumns:function(){return this.get("columns")},_getCellText:function(column,record,index){var _self=this,dataIndex=column.get("dataIndex"),textTpl=column.get("cellTpl")||_self.get("cellTextTpl"),text=_self._getCellInnerText(column,dataIndex,record,index);return BUI.substitute(textTpl,{text:text,tips:_self._getTips(column,dataIndex,record)})},_getCellInnerText:function(column,dataIndex,record,index){try{var _self=this,renderer=column.get("renderer"),text=renderer?renderer(record[dataIndex],record,index):record[dataIndex];return text==null?"":text}catch(ex){throw"column:"+column.get("title")+" fomat error!"}},_getCellTpl:function(column,dataIndex,record,index){var _self=this,cellText=_self._getCellText(column,record,index),cellTpl=_self.get("cellTpl");return BUI.substitute(cellTpl,{elCls:column.get("elCls"),id:column.get("id"),dataIndex:dataIndex,cellText:cellText,hideCls:!column.get("visible")?CLS_HIDE:""})},_getEmptyCellTpl:function(){return'<td class="'+CLS_GRID_CELL+" "+CLS_CELL_EMPTY+'">&nbsp;</td>'},_getHeaderCellTpl:function(column){var _self=this,headerCellTpl=_self.get("headerCellTpl");return BUI.substitute(headerCellTpl,{id:column.get("id"),width:column.get("width"),hideCls:!column.get("visible")?CLS_HIDE:""})
},_getInnerWidth:function(){return getInnerWidth(this.get("width"))},_getTips:function(column,dataIndex,record){var showTip=column.get("showTip"),value="";if(showTip){value=record[dataIndex];if(BUI.isFunction(showTip)){value=showTip(value,record)}}return value},_uiSetInnerBorder:function(v){var _self=this,el=_self.get("el");if(v){el.addClass(CLS_GRID_BORDER)}else{el.removeClass(CLS_GRID_BORDER)}},_setTableTpl:function(tpl){var _self=this,bodyEl=_self.get("bodyEl");tpl=tpl||_self.get("tableTpl");$(tpl).appendTo(bodyEl);var tableEl=bodyEl.find("table"),tbodyEl=bodyEl.find("tbody");_self.set("tableEl",tableEl);_self.set("tbodyEl",tbodyEl);_self.set("itemContainer",tbodyEl);_self._setTableCls(_self.get("tableCls"))},_uiSetTableCls:function(v){this._setTableCls(v)},_uiSetHeight:function(h){var _self=this,bodyEl=_self.get("bodyEl");_self.get("el").height(h);_self.get("el").addClass(CLS_GRID_HEIGHT)},_uiSetWidth:function(w){var _self=this;_self.get("el").width(w);_self.setBodyWidth(_self._getInnerWidth(w));_self.get("el").addClass(CLS_GRID_WITH)},_uiSetStripeRows:function(v){var _self=this,method=v?"addClass":"removeClass";_self.get("el")[method](CLS_GRID_STRIPE)},_setTableCls:function(cls){var _self=this,tableEl=_self.get("tableEl");tableEl.attr("class",cls)}},{ATTRS:{tableCls:{},bodyEl:{},tbodyEl:{},headerRowEl:{},tableEl:{},emptyEl:{}}},{xclass:"grid-view"});var grid=List.SimpleList.extend({initializer:function(){var _self=this,render=_self.get("render"),width=_self.get("width");if(!width){_self.set("width",$(render).width())}},createDom:function(){var _self=this;if(_self.get("width")){_self.get("el").addClass(CLS_GRID_WITH)}if(_self.get("height")){_self.get("el").addClass(CLS_GRID_HEIGHT)}if(_self.get("innerBorder")){_self.get("el").addClass(CLS_GRID_BORDER)}},renderUI:function(){var _self=this;_self._initHeader();_self._initBars();_self._initLoadMask();_self.get("view").resetHeaderRow()},bindUI:function(){var _self=this;_self._bindHeaderEvent();_self._bindBodyEvent();_self._bindItemsEvent()},addColumn:function(column,index){var _self=this,header=_self.get("header");if(header){column=header.addColumn(column,index)}else{column=new Column(column);_self.get("columns").splice(index,0,column)}return column},clearData:function(){this.clearItems()},getRecords:function(){return this.getItems()},findColumn:function(id){var _self=this,header=_self.get("header");if(BUI.isNumber(id)){return header.getColumnByIndex(id)}else{return header.getColumnById(id)}},findColumnByField:function(field){var _self=this,header=_self.get("header");return header.getColumn(function(column){return column.get("dataIndex")===field})},findCell:function(id,record){var _self=this,rowEl=null;if(record instanceof $){rowEl=record}else{rowEl=_self.findRow(record)}if(rowEl){return _self.get("view").findCell(id,rowEl)}return null},findRow:function(record){var _self=this;return _self.get("view").findRow(record)},removeColumn:function(column){var _self=this;_self.get("header").removeColumn(column)},showData:function(data){var _self=this;_self.set("items",data)},resetColumns:function(){var _self=this,store=_self.get("store");_self.get("view").resetHeaderRow();if(store){_self.onLoad()}},_bindScrollEvent:function(){var _self=this,el=_self.get("el"),bodyEl=el.find("."+CLS_GRID_BODY),header=_self.get("header");bodyEl.on("scroll",function(){var left=bodyEl.scrollLeft(),top=bodyEl.scrollTop();header.scrollTo({left:left,top:top});_self.fire("scroll",{scrollLeft:left,scrollTop:top,bodyWidth:bodyEl.width(),bodyHeight:bodyEl.height()})})},_bindHeaderEvent:function(){var _self=this,header=_self.get("header"),view=_self.get("view"),store=_self.get("store");header.on("afterWidthChange",function(e){var sender=e.target;if(sender!==header){view.resetColumnsWidth(sender)}});header.on("afterSortStateChange",function(e){var column=e.target,val=e.newVal;if(val&&store){store.sort(column.get("dataIndex"),column.get("sortState"))}});header.on("afterVisibleChange",function(e){var sender=e.target;if(sender!==header){view.setColumnVisible(sender);_self.fire("columnvisiblechange",{column:sender})}});header.on("click",function(e){var sender=e.target;if(sender!==header){_self.fire("columnclick",{column:sender,domTarget:e.domTarget})}});header.on("forceFitWidth",function(){if(_self.get("rendered")){_self.resetColumns()}});header.on("add",function(e){if(_self.get("rendered")){_self.fire("columnadd",{column:e.column,index:e.index});_self.resetColumns()}});header.on("remove",function(e){if(_self.get("rendered")){_self.resetColumns();_self.fire("columnremoved",{column:e.column,index:e.index})}})},_bindBodyEvent:function(){var _self=this;_self._bindScrollEvent()},_bindItemsEvent:function(){var _self=this,store=_self.get("store");_self.on("itemsshow",function(){_self.fire("aftershow")});_self.on("itemsclear",function(){_self.fire("clear")});_self.on("itemclick",function(ev){var target=ev.domTarget,record=ev.item,cell=$(target).closest("."+CLS_GRID_CELL),rowEl=$(target).closest("."+CLS_GRID_ROW),rst;
if(cell.length){rst=_self.fire("cellclick",{record:record,row:rowEl[0],cell:cell[0],field:cell.attr(ATTR_COLUMN_FIELD),domTarget:target,domEvent:ev.domEvent})}if(rst===false){return rst}return _self.fire("rowclick",{record:record,row:rowEl[0],domTarget:target})});_self.on("itemunselected",function(ev){_self.fire("rowunselected",getEventObj(ev))});_self.on("itemselected",function(ev){_self.fire("rowselected",getEventObj(ev))});_self.on("itemrendered",function(ev){_self.fire("rowcreated",getEventObj(ev))});_self.on("itemremoved",function(ev){_self.fire("rowremoved",getEventObj(ev))});_self.on("itemupdated",function(ev){_self.fire("rowupdated",getEventObj(ev))});function getEventObj(ev){return{record:ev.item,row:ev.domTarget,domTarget:ev.domTarget}}},_getInnerWidth:function(width){width=width||this.get("width");return getInnerWidth(width)},_initHeader:function(){var _self=this,header=_self.get("header"),container=_self.get("el").find("."+CLS_GRID_HEADER_CONTAINER);if(!header){header=new Header({columns:_self.get("columns"),tableCls:_self.get("tableCls"),forceFit:_self.get("forceFit"),width:_self._getInnerWidth(),render:container,parent:_self}).render();_self.set("header",header)}},_initBars:function(){var _self=this,bbar=_self.get("bbar"),tbar=_self.get("tbar");_self._initBar(bbar,CLS_GRID_BBAR,"bbar");_self._initBar(tbar,CLS_GRID_TBAR,"tbar")},_initBar:function(bar,cls,name){var _self=this,store=null,pagingBarCfg=null;if(bar){if(!bar.xclass&&!(bar instanceof Component.Controller)){bar.xclass="bar";bar.children=bar.children||[];if(bar.items){bar.children.push({xclass:"bar",defaultChildClass:"bar-item-button",elCls:CLS_BUTTON_BAR,children:bar.items});bar.items=null}if(bar.pagingBar){store=_self.get("store");pagingBarCfg={xclass:"pagingbar",store:store,pageSize:store.pageSize};if(bar.pagingBar!==true){pagingBarCfg=BUI.merge(pagingBarCfg,bar.pagingBar)}bar.children.push(pagingBarCfg)}}if(bar.xclass){var barContainer=_self.get("el").find("."+cls);barContainer.show();bar.render=barContainer;bar.elTagName="div";bar.autoRender=true;bar=_self.addChild(bar)}_self.set(name,bar)}return bar},_initLoadMask:function(){var _self=this,loadMask=_self.get("loadMask");if(loadMask&&!loadMask.show){loadMask=new BUI.Mask.LoadMask({el:_self.get("el")});_self.set("loadMask",loadMask)}},_uiSetWidth:function(w){var _self=this;if(_self.get("rendered")){if(!isPercent(w)){_self.get("header").set("width",_self._getInnerWidth(w))}else{_self.get("header").set("width","100%")}}_self.get("view").setTableWidth()},_uiSetForceFit:function(v){var _self=this;_self.get("header").set("forceFit",v)},_uiSetHeight:function(h,obj){var _self=this,header=_self.get("header");_self.get("view").setBodyHeight(h);if(_self.get("rendered")){if(_self.get("forceFit")&&!obj.prevVal){header.forceFitColumns();_self.get("view").setTableWidth()}header.setTableWidth()}},onLoad:function(){var _self=this,store=_self.get("store");grid.superclass.onLoad.call(this);if(_self.get("emptyDataTpl")){if(store&&store.getCount()==0){_self.get("view").showEmptyText()}else{_self.get("view").clearEmptyText()}}}},{ATTRS:{header:{},bbar:{},itemCls:{value:CLS_GRID_ROW},columns:{view:true,value:[]},forceFit:{sync:false,value:false},emptyDataTpl:{view:true},headerRowTpl:{view:true,value:'<tr class="'+PREFIX+'grid-header-row">{cellsTpl}</tr>'},headerCellTpl:{view:true,value:'<td class="{hideCls} '+CLS_TD_PREFIX+'{id}" width="{width}" style="height:0"></td>'},rowTpl:{view:true,value:'<tr class="'+CLS_GRID_ROW+' {oddCls}">{cellsTpl}</tr>'},cellTpl:{view:true,value:'<td  class="{elCls} {hideCls} '+CLS_GRID_CELL+" "+CLS_TD_PREFIX+'{id}" data-column-id="{id}" data-column-field = "{dataIndex}" >'+'<div class="'+CLS_GRID_CELL_INNER+'" >{cellText}</div>'+"</td>"},cellTextTpl:{view:true,value:'<span class="'+CLS_CELL_TEXT+' " title = "{tips}">{text}</span>'},events:{value:{"aftershow":false,"clear":false,"cellclick":false,"columnclick":false,"rowclick":false,"rowcreated":false,"rowremoved":false,"rowselected":false,"rowunselected":false,"scroll":false}},stripeRows:{view:true,value:true},tbar:{},tableCls:{view:true,sync:false,value:PREFIX+"grid-table"},tableTpl:{view:true,value:'<table cellspacing="0" cellpadding="0" >'+"<tbody></tbody>"+"</table>"},tpl:{value:'<div class="'+CLS_GRID_TBAR+'" style="display:none"></div><div class="'+CLS_GRID_HEADER_CONTAINER+'"></div><div class="'+CLS_GRID_BODY+'"></div><div style="display:none" class="'+CLS_GRID_BBAR+'"></div>'},innerBorder:{sync:false,value:true},useEmptyCell:{view:true,value:true},useHeaderRow:{view:true,value:true},xview:{value:gridView}}},{xclass:"grid"});grid.View=gridView;return grid});define("bui/grid/format",function(require){function formatTimeUnit(v){if(v<10){return"0"+v}return v}var Format={dateRenderer:function(d){if(!d){return""}if(BUI.isString(d)){return d}var date=null;try{date=new Date(d)}catch(e){return""}if(!date||!date.getFullYear){return""}return date.getFullYear()+"-"+formatTimeUnit(date.getMonth()+1)+"-"+formatTimeUnit(date.getDate())
},datetimeRenderer:function(d){if(!d){return""}if(BUI.isString(d)){return d}var date=null;try{date=new Date(d)}catch(e){return""}if(!date||!date.getFullYear){return""}return date.getFullYear()+"-"+formatTimeUnit(date.getMonth()+1)+"-"+formatTimeUnit(date.getDate())+" "+formatTimeUnit(date.getHours())+":"+formatTimeUnit(date.getMinutes())+":"+formatTimeUnit(date.getSeconds())},cutTextRenderer:function(length){return function(value){value=value||"";if(value.toString().length>length){return value.toString().substring(0,length)+"..."}return value}},enumRenderer:function(enumObj){return function(value){return enumObj[value]||""}},multipleItemsRenderer:function(enumObj){var enumFun=Format.enumRenderer(enumObj);return function(values){var result=[];if(!values){return""}if(!BUI.isArray(values)){values=values.toString().split(",")}$.each(values,function(index,value){result.push(enumFun(value))});return result.join(",")}},moneyCentRenderer:function(v){if(BUI.isString(v)){v=parseFloat(v)}if($.isNumberic(v)){return(v*0.01).toFixed(2)}return v}};return Format});(function(){var BASE="bui/grid/plugins/";define("bui/grid/plugins",["bui/common",BASE+"selection",BASE+"cascade",BASE+"cellediting",BASE+"rowediting",BASE+"autofit",BASE+"dialogediting",BASE+"menu",BASE+"summary",BASE+"rownumber"],function(r){var BUI=r("bui/common"),Selection=r(BASE+"selection"),Plugins={};BUI.mix(Plugins,{CheckSelection:Selection.CheckSelection,RadioSelection:Selection.RadioSelection,Cascade:r(BASE+"cascade"),CellEditing:r(BASE+"cellediting"),RowEditing:r(BASE+"rowediting"),DialogEditing:r(BASE+"dialogediting"),AutoFit:r(BASE+"autofit"),GridMenu:r(BASE+"menu"),Summary:r(BASE+"summary"),RowNumber:r(BASE+"rownumber")});return Plugins})})();define("bui/grid/plugins/autofit",["bui/common"],function(require){var BUI=require("bui/common");var AutoFit=function(cfg){AutoFit.superclass.constructor.call(this,cfg)};BUI.extend(AutoFit,BUI.Base);AutoFit.ATTRS={};BUI.augment(AutoFit,{bindUI:function(grid){var _self=this,handler;$(window).on("resize",function(){function autoFit(){clearTimeout(handler);handler=setTimeout(function(){_self._autoFit(grid)},100)}autoFit()})},_autoFit:function(grid){var render=grid.get("render"),width;grid.set("visible",false);width=$(render).width();grid.set("visible",true);grid.set("width",width)}});return AutoFit});define("bui/grid/plugins/menu",["bui/common","bui/menu"],function(require){var BUI=require("bui/common"),Menu=require("bui/menu"),PREFIX=BUI.prefix,ID_SORT_ASC="sort-asc",ID_SORT_DESC="sort-desc",ID_COLUMNS_SET="column-setting",CLS_COLUMN_CHECKED="icon-check";var gridMenu=function(config){gridMenu.superclass.constructor.call(this,config)};BUI.extend(gridMenu,BUI.Base);gridMenu.ATTRS={menu:{},activedColumn:{},triggerCls:{value:PREFIX+"grid-hd-menu-trigger"},items:{value:[{id:ID_SORT_ASC,text:"\u5347\u5e8f",iconCls:"icon-arrow-up"},{id:ID_SORT_DESC,text:"\u964d\u5e8f",iconCls:"icon-arrow-down"},{xclass:"menu-item-sparator"},{id:ID_COLUMNS_SET,text:"\u8bbe\u7f6e\u5217",iconCls:"icon-list-alt"}]}};BUI.augment(gridMenu,{initializer:function(grid){var _self=this;_self.set("grid",grid)},renderUI:function(grid){var _self=this,columns=grid.get("columns");BUI.each(columns,function(column){_self._addShowMenu(column)})},bindUI:function(grid){var _self=this;grid.on("columnadd",function(ev){_self._addShowMenu(ev.column)});grid.on("columnclick",function(ev){var sender=$(ev.domTarget),column=ev.column,menu;_self.set("activedColumn",column);if(sender.hasClass(_self.get("triggerCls"))){menu=_self.get("menu")||_self._initMenu();menu.set("align",{node:sender,points:["bl","tl"],offset:[0,0]});menu.show();_self._afterShow(column,menu)}})},_addShowMenu:function(column){if(!column.get("fixed")){column.set("showMenu",true)}},_afterShow:function(column,menu){var _self=this,grid=_self.get("grid");menu=menu||_self.get("menu");_self._resetSortMenuItems(column,menu);_self._resetColumnsVisible(menu)},_resetColumnsVisible:function(menu){var _self=this,settingItem=menu.findItemById(ID_COLUMNS_SET),subMenu=settingItem.get("subMenu")||_self._initColumnsMenu(settingItem),columns=_self.get("grid").get("columns");subMenu.removeChildren(true);$.each(columns,function(index,column){if(!column.get("fixed")){var config={xclass:"context-menu-item",text:column.get("title"),column:column,iconCls:"icon"},menuItem=subMenu.addChild(config);if(column.get("visible")){menuItem.set("selected",true)}}})},_resetSortMenuItems:function(column,menu){var ascItem=menu.findItemById(ID_SORT_ASC),descItem=menu.findItemById(ID_SORT_DESC);if(column.get("sortable")){ascItem.set("disabled",false);descItem.set("disabled",false)}else{ascItem.set("disabled",true);descItem.set("disabled",true)}},_initMenu:function(){var _self=this,menu=_self.get("menu"),menuItems;if(!menu){menuItems=_self.get("items");$.each(menuItems,function(index,item){if(!item.xclass){item.xclass="context-menu-item"}});menu=new Menu.ContextMenu({children:menuItems,elCls:"grid-menu"});_self._initMenuEvent(menu);_self.set("menu",menu)
}return menu},_initMenuEvent:function(menu){var _self=this;menu.on("itemclick",function(ev){var item=ev.item,id=item.get("id"),activedColumn=_self.get("activedColumn");if(id===ID_SORT_ASC){activedColumn.set("sortState","ASC")}else{if(id===ID_SORT_DESC){activedColumn.set("sortState","DESC")}}});menu.on("afterVisibleChange",function(ev){var visible=ev.newVal,activedColumn=_self.get("activedColumn");if(visible&&activedColumn){activedColumn.set("open",true)}else{activedColumn.set("open",false)}})},_initColumnsMenu:function(settingItem){var subMenu=new Menu.ContextMenu({multipleSelect:true,elCls:"grid-column-menu"});settingItem.set("subMenu",subMenu);subMenu.on("itemclick",function(ev){var item=ev.item,column=item.get("column"),selected=item.get("selected");if(selected){column.set("visible",true)}else{column.set("visible",false)}});return subMenu},destructor:function(){var _self=this,menu=_self.get("menu");if(menu){menu.destroy()}_self.off();_self.clearAttrVals()}});return gridMenu});define("bui/grid/plugins/cascade",["bui/common"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,CLS_GRID_CASCADE="",DATA_RECORD="data-record",CLS_CASCADE=PREFIX+"grid-cascade",CLS_CASCADE_EXPAND=CLS_CASCADE+"-expand",CLS_CASCADE_ROW=CLS_CASCADE+"-row",CLS_CASCADE_CELL=CLS_CASCADE+"-cell",CLS_CASCADE_ROW_COLLAPSE=CLS_CASCADE+"-collapse";var cascade=function(config){cascade.superclass.constructor.call(this,config)};BUI.extend(cascade,BUI.Base);cascade.ATTRS={width:{value:40},cellInner:{value:'<span class="'+CLS_CASCADE+'"><i class="'+CLS_CASCADE+'-icon"></i></span>'},rowTpl:{value:'<tr class="'+CLS_CASCADE_ROW+'"><td class="'+CLS_CASCADE_CELL+'"></td></tr>'},renderer:{},events:["expand","collapse","removed"]};BUI.augment(cascade,{initializer:function(grid){var _self=this;var cfg={title:"",elCls:"center",width:_self.get("width"),resizable:false,fixed:true,sortable:false,cellTpl:_self.get("cellInner")},expandColumn=grid.addColumn(cfg,0);grid.set("innerBorder",false);_self.set("grid",grid)},bindUI:function(grid){var _self=this;grid.on("cellclick",function(ev){var sender=$(ev.domTarget),cascadeEl=sender.closest("."+CLS_CASCADE);if(cascadeEl.length){if(!cascadeEl.hasClass(CLS_CASCADE_EXPAND)){_self._onExpand(ev.record,ev.row,cascadeEl)}else{_self._onCollapse(ev.record,ev.row,cascadeEl)}}});grid.on("columnvisiblechange",function(){_self._resetColspan()});grid.on("rowremoved",function(ev){_self.remove(ev.record)});grid.on("clear",function(){_self.removeAll()})},expandAll:function(){var _self=this,grid=_self.get("grid"),records=grid.getRecords();$.each(records,function(index,record){_self.expand(record)})},expand:function(record){var _self=this,grid=_self.get("grid");var row=grid.findRow(record);if(row){_self._onExpand(record,row)}},collapse:function(record){var _self=this,grid=_self.get("grid");var row=grid.findRow(record);if(row){_self._onCollapse(record,row)}},removeAll:function(){var _self=this,rows=_self._getAllCascadeRows();rows.each(function(index,row){_self._removeCascadeRow(row)})},remove:function(record){var _self=this,cascadeRow=_self._findCascadeRow(record);if(cascadeRow){_self._removeCascadeRow(cascadeRow)}},collapseAll:function(){var _self=this,grid=_self.get("grid"),records=grid.getRecords();$.each(records,function(index,record){_self.collapse(record)})},_getRowRecord:function(cascadeRow){return $(cascadeRow).data(DATA_RECORD)},_removeCascadeRow:function(row){this.fire("removed",{record:$(row).data(DATA_RECORD),row:row});$(row).remove()},_findCascadeRow:function(record){var _self=this,rows=_self._getAllCascadeRows(),result=null;$.each(rows,function(index,row){if(_self._getRowRecord(row)===record){result=row;return false}});return result},_getAllCascadeRows:function(){var _self=this,grid=_self.get("grid");return grid.get("el").find("."+CLS_CASCADE_ROW)},_getCascadeRow:function(gridRow){var nextRow=$(gridRow).next();if((nextRow).hasClass(CLS_CASCADE_ROW)){return nextRow}return null},_getRowContent:function(record){var _self=this,renderer=_self.get("renderer"),content=renderer?renderer(record):"";return content},_createCascadeRow:function(record,gridRow){var _self=this,rowTpl=_self.get("rowTpl"),content=_self._getRowContent(record),rowEl=$(rowTpl).insertAfter(gridRow);rowEl.find("."+CLS_CASCADE_CELL).append($(content));rowEl.data(DATA_RECORD,record);return rowEl},_onExpand:function(record,row,cascadeEl){var _self=this,cascadeRow=_self._getCascadeRow(row),colspan=_self._getColumnCount(row);cascadeEl=cascadeEl||$(row).find("."+CLS_CASCADE);cascadeEl.addClass(CLS_CASCADE_EXPAND);if(!cascadeRow||!cascadeRow.length){cascadeRow=_self._createCascadeRow(record,row)}$(cascadeRow).removeClass(CLS_CASCADE_ROW_COLLAPSE);_self._setColSpan(cascadeRow,row);_self.fire("expand",{record:record,row:cascadeRow[0]})},_onCollapse:function(record,row,cascadeEl){var _self=this,cascadeRow=_self._getCascadeRow(row);cascadeEl=cascadeEl||$(row).find("."+CLS_CASCADE);cascadeEl.removeClass(CLS_CASCADE_EXPAND);if(cascadeRow||!cascadeRow.length){$(cascadeRow).addClass(CLS_CASCADE_ROW_COLLAPSE);
_self.fire("collapse",{record:record,row:cascadeRow[0]})}},_getColumnCount:function(row){return $(row).children().filter(function(){return $(this).css("display")!=="none"}).length},_setColSpan:function(cascadeRow,gridRow){gridRow=gridRow||$(cascadeRow).prev();var _self=this,colspan=_self._getColumnCount(gridRow);$(cascadeRow).find("."+CLS_CASCADE_CELL).attr("colspan",colspan)},_resetColspan:function(){var _self=this,cascadeRows=_self._getAllCascadeRows();$.each(cascadeRows,function(index,cascadeRow){_self._setColSpan(cascadeRow)})},destructor:function(){var _self=this;_self.removeAll();_self.off();_self.clearAttrVals()}});return cascade});define("bui/grid/plugins/selection",["bui/common"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,CLS_CHECKBOX=PREFIX+"grid-checkBox",CLS_CHECK_ICON="x-grid-checkbox",CLS_RADIO=PREFIX+"grid-radio";function checkSelection(config){checkSelection.superclass.constructor.call(this,config)}BUI.extend(checkSelection,BUI.Base);checkSelection.ATTRS={width:{value:40},column:{},cellInner:{value:'<div class="'+CLS_CHECKBOX+'-container"><span class="'+CLS_CHECK_ICON+'"></span></div>'}};BUI.augment(checkSelection,{createDom:function(grid){var _self=this;var cfg={title:"",width:_self.get("width"),fixed:true,resizable:false,sortable:false,tpl:'<div class="'+PREFIX+'grid-hd-inner">'+_self.get("cellInner")+"",cellTpl:_self.get("cellInner")},checkColumn=grid.addColumn(cfg,0);grid.set("multipleSelect",true);_self.set("column",checkColumn)},bindUI:function(grid){var _self=this,col=_self.get("column"),colEl=col.get("el"),checkBox=colEl.find("."+CLS_CHECK_ICON);checkBox.on("click",function(){var checked=colEl.hasClass("checked");if(!checked){grid.setAllSelection();colEl.addClass("checked")}else{grid.clearSelection();colEl.removeClass("checked")}});grid.on("rowunselected",function(e){colEl.removeClass("checked")});grid.on("clear",function(){colEl.removeClass("checked")})}});var radioSelection=function(config){radioSelection.superclass.constructor.call(this,config)};BUI.extend(radioSelection,BUI.Base);radioSelection.ATTRS={width:{value:40},column:{},cellInner:{value:'<div class="'+PREFIX+'grid-radio-container"><input  class="'+CLS_RADIO+'" type="radio"></div>'}};BUI.augment(radioSelection,{createDom:function(grid){var _self=this;var cfg={title:"",width:_self.get("width"),resizable:false,fixed:true,sortable:false,cellTpl:_self.get("cellInner")},column=grid.addColumn(cfg,0);grid.set("multipleSelect",false);_self.set("column",column)},bindUI:function(grid){var _self=this;grid.on("rowselected",function(e){_self._setRowChecked(e.row,true)});grid.on("rowunselected",function(e){_self._setRowChecked(e.row,false)})},_setRowChecked:function(row,checked){var rowEl=$(row),radio=rowEl.find("."+CLS_RADIO);radio.attr("checked",checked)}});var Selection={CheckSelection:checkSelection,RadioSelection:radioSelection};return Selection});define("bui/grid/plugins/summary",["bui/common"],function(require){var BUI=require("bui/common"),PREFIX=BUI.prefix,CLS_GRID_ROW=PREFIX+"grid-row",CLS_GRID_BODY=PREFIX+"grid-body",CLS_SUMMARY_ROW=PREFIX+"grid-summary-row",CLS_GRID_CELL_INNER=PREFIX+"grid-cell-inner",CLS_COLUMN_PREFIX="grid-td-",CLS_GRID_CELL_TEXT=PREFIX+"grid-cell-text",CLS_GRID_CELL=PREFIX+"grid-cell";function getEmptyCellTemplate(colspan){if(colspan>0){return'<td class="'+CLS_GRID_CELL+'" colspan="'+colspan+'">&nbsp;</td>'}return""}function getCellTemplate(text,id){return'<td class="'+CLS_GRID_CELL+" "+CLS_COLUMN_PREFIX+id+'">'+getInnerTemplate(text)+"</td>"}function getInnerTemplate(text){return'<div class="'+CLS_GRID_CELL_INNER+'" >'+'<span class="'+CLS_GRID_CELL_TEXT+' ">'+text+"</span>"+"</div>"}function getLastEmptyCell(){return'<td class="'+CLS_GRID_CELL+" "+CLS_GRID_CELL+'-empty">&nbsp;</td>'}var summary=function(config){summary.superclass.constructor.call(this,config)};summary.ATTRS={footerTpl:{value:"<tfoot></tfoot>"},footerEl:{},summaryTitle:{value:"\u67e5\u8be2\u5408\u8ba1"},pageSummaryTitle:{value:"\u672c\u9875\u5408\u8ba1"},field:{value:"summary"},pageSummaryField:{value:"pageSummary"},summaryField:{value:"summary"},pageSummary:{},summary:{}};BUI.extend(summary,BUI.Base);BUI.augment(summary,{initializer:function(grid){var _self=this;_self.set("grid",grid)},renderUI:function(grid){var _self=this,bodyEl=grid.get("el").find("."+CLS_GRID_BODY),bodyTable=bodyEl.find("table"),footerEl=$(_self.get("footerTpl")).appendTo(bodyTable);_self.set("footerEl",footerEl)},bindUI:function(grid){var _self=this,store=grid.get("store");if(store){store.on("beforeprocessload",function(ev){_self._processSummary(ev.data)});store.on("add",function(){_self.resetPageSummary()});store.on("remove",function(){_self.resetPageSummary()});store.on("update",function(){_self.resetPageSummary()})}grid.on("aftershow",function(){_self.resetSummary()});grid.get("header").on("afterVisibleChange",function(){_self.resetSummary()})},_processSummary:function(data){var _self=this,footerEl=_self.get("footerEl");footerEl.empty();if(!data){return
}var pageSummary=data[_self.get("pageSummaryField")],summary=data[_self.get("summaryField")];_self.set("pageSummary",pageSummary);_self.set("summary",summary)},resetPageSummary:function(){var _self=this,grid=_self.get("grid"),columns=grid.get("columns"),pageSummary=_self._calculatePageSummary(),pageEl=_self.get("pageEl");_self.set("pageSummary",pageSummary);if(pageEl){BUI.each(columns,function(column){if(column.get("summary")&&column.get("visible")){var id=column.get("id"),cellEl=pageEl.find("."+CLS_COLUMN_PREFIX+id),text=_self._getSummaryCellText(column,pageSummary);cellEl.find("."+CLS_GRID_CELL_TEXT).text(text)}});_self._updateFirstRow(pageEl,_self.get("pageSummaryTitle"))}},resetSummary:function(pageSummary,summary){var _self=this,footerEl=_self.get("footerEl"),pageEl=null;footerEl.empty();pageSummary=pageSummary||_self.get("pageSummary");if(!pageSummary){pageSummary=_self._calculatePageSummary();_self.set("pageSummary",pageSummary)}summary=summary||_self.get("summary");pageEl=_self._creatSummaryRow(pageSummary,_self.get("pageSummaryTitle"));_self.set("pageEl",pageEl);_self._creatSummaryRow(summary,_self.get("summaryTitle"))},_creatSummaryRow:function(summary,title){if(!summary){return null}var _self=this,footerEl=_self.get("footerEl"),tpl=_self._getSummaryTpl(summary),rowEl=$(tpl).appendTo(footerEl);_self._updateFirstRow(rowEl,title);return rowEl},_updateFirstRow:function(rowEl,title){var firstCell=rowEl.find("td").first(),textEl=firstCell.find("."+CLS_GRID_CELL_INNER);if(textEl.length){var textPrefix=title+": ";text=textEl.text();if(text.indexOf(textPrefix)===-1){text=textPrefix+text}firstCell.html(getInnerTemplate(text))}else{firstCell.html(getInnerTemplate(title+":"))}},_getSummaryTpl:function(summary){var _self=this,grid=_self.get("grid"),columns=grid.get("columns"),cellTempArray=[],prePosition=-1,currentPosition=-1,rowTemplate=null;$.each(columns,function(colindex,column){if(column.get("visible")){currentPosition+=1;if(column.get("summary")){cellTempArray.push(getEmptyCellTemplate(currentPosition-prePosition-1));var text=_self._getSummaryCellText(column,summary),temp=getCellTemplate(text,column.get("id"));cellTempArray.push(temp);prePosition=currentPosition}}});if(prePosition!==currentPosition){cellTempArray.push(getEmptyCellTemplate(currentPosition-prePosition))}rowTemplate=['<tr class="',CLS_SUMMARY_ROW," ",CLS_GRID_ROW,'">',cellTempArray.join(""),getLastEmptyCell(),"</tr>"].join("");return rowTemplate},_getSummaryCellText:function(column,summary){var _self=this,val=summary[column.get("dataIndex")],value=val==null?"":val,renderer=column.get("renderer"),text=renderer?renderer(value,summary):value;return text},_calculatePageSummary:function(){var _self=this,grid=_self.get("grid"),store=grid.get("store"),columns=grid.get("columns"),rst={};BUI.each(columns,function(column){if(column.get("summary")){var dataIndex=column.get("dataIndex");rst[dataIndex]=store.sum(dataIndex)}});return rst}});return summary});define("bui/grid/plugins/editing",function(require){var CLS_CELL_INNER=BUI.prefix+"grid-cell-inner",CLS_CELL_ERROR=BUI.prefix+"grid-cell-error";function Editing(config){Editing.superclass.constructor.call(this,config)}BUI.extend(Editing,BUI.Base);Editing.ATTRS={align:{value:{points:["cl","cl"]}},showError:{value:true},errorTpl:{value:'<span class="x-icon '+CLS_CELL_ERROR+' x-icon-mini x-icon-error" title="{error}">!</span>'},isInitEditors:{value:false},record:{},curEditor:{},hasValid:{},editors:{shared:false,value:[]},triggerCls:{},triggerSelected:{value:true}};BUI.augment(Editing,{initializer:function(grid){var _self=this;_self.set("grid",grid);_self.initEditing(grid)},renderUI:function(){var _self=this,grid=_self.get("grid");BUI.use("bui/editor",function(Editor){_self.initEditors(Editor);_self._initGridEvent(grid);_self.set("isInitEditors",true)})},initEditing:function(grid){},_getCurEditor:function(){return this.get("curEditor")},_initGridEvent:function(grid){var _self=this,header=grid.get("header");grid.on("cellclick",function(ev){var editor=null,domTarget=ev.domTarget,triggerCls=_self.get("triggerCls"),curEditor=_self._getCurEditor();if(curEditor&&curEditor.get("acceptEvent")){curEditor.accept();curEditor.hide()}else{curEditor&&curEditor.cancel()}editor=_self.getEditor(ev.field);if(editor&&$(domTarget).closest("."+triggerCls).length){_self.showEditor(editor,ev);if(!_self.get("triggerSelected")){return false}}});grid.on("rowcreated",function(ev){validRow(ev.record,ev.row)});grid.on("rowremoved",function(ev){if(_self.get("record")==ev.record){_self.cancel()}});grid.on("rowupdated",function(ev){validRow(ev.record,ev.row)});grid.on("scroll",function(ev){var editor=_self._getCurEditor();if(editor){var align=editor.get("align"),node=align.node,pos=node.position();if(pos.top<0||pos.top>ev.bodyHeight){editor.hide()}else{editor.set("align",align);editor.show()}}});header.on("afterVisibleChange",function(ev){if(ev.target&&ev.target!=header){var column=ev.target;_self.onColumnVisibleChange(column)}});function validRow(record,row){if(_self.get("hasValid")){_self.validRecord(record,_self.getFields(),$(row))
}}},initEditors:function(Editor){var _self=this,grid=_self.get("grid"),fields=[],columns=grid.get("columns");BUI.each(columns,function(column){var field=_self.getFieldConfig(column);if(field){field.name=column.get("dataIndex");field.id=column.get("id");if(field.validator){field.validator=_self.wrapValidator(field.validator)}fields.push(field)}});var cfgs=_self.getEditorCfgs(fields);BUI.each(cfgs,function(cfg){_self.initEidtor(cfg,Editor)})},getFieldConfig:function(column){return column.get("editor")},wrapValidator:function(validator){var _self=this;return function(value){var record=_self.get("record");return validator(value,record)}},onColumnVisibleChange:function(column){},getEditorCfgs:function(fields){},getEditorConstructor:function(Editor){return Editor.Editor},initEidtor:function(cfg,Editor){var _self=this,con=_self.getEditorConstructor(Editor),editor=new con(cfg);editor.render();_self.get("editors").push(editor);_self.bindEidtor(editor);return editor},bindEidtor:function(editor){var _self=this,grid=_self.get("grid"),store=grid.get("store");editor.on("accept",function(){var record=_self.get("record");_self.updateRecord(store,record,editor);_self.fire("accept",{editor:editor,record:record});_self.set("curEditor",null)});editor.on("cancel",function(){_self.fire("cancel",{editor:editor,record:_self.get("record")});_self.set("curEditor",null)})},getEditor:function(options){},getAlignNode:function(options){},getEditValue:function(options){},showEditor:function(editor,options){var _self=this,value=_self.getEditValue(options),alignNode=_self.getAlignNode(options);_self.beforeShowEditor(editor,options);_self.set("record",options.record);editor.setValue(value);if(alignNode){var align=_self.get("align");align.node=alignNode;editor.set("align",align)}editor.show();_self.focusEditor(editor,options.field);_self.set("curEditor",editor);_self.fire("editorshow",{editor:editor})},focusEditor:function(editor,field){editor.focus()},beforeShowEditor:function(editor,options){},_createEditOptions:function(record,field){var _self=this,grid=_self.get("grid"),rowEl=grid.findRow(record),column=grid.findColumnByField(field),cellEl=grid.findCell(column.get("id"),rowEl);return{record:record,field:field,cell:cellEl[0],row:rowEl[0]}},valid:function(){var _self=this,grid=_self.get("grid"),store=grid.get("store");if(store){var records=store.getResult();BUI.each(records,function(record){_self.validRecord(record,_self.getFields())})}_self.set("hasValid",true)},isValid:function(){var _self=this,grid=_self.get("grid");if(!_self.get("hasValid")){_self.valid()}return !grid.get("el").find("."+CLS_CELL_ERROR).length},clearErrors:function(){var _self=this,grid=_self.get("grid");grid.get("el").find("."+CLS_CELL_ERROR).remove()},getFields:function(editors){},validRecord:function(record,fields,row){var _self=this,errors=[];_self.setInternal("record",record);fields=fields||_self.getFields();BUI.each(fields,function(field){var name=field.get("name"),value=record[name]||"",error=field.getValidError(value);if(error){errors.push({name:name,error:error,id:field.get("id")})}});_self.showRecordError(record,errors,row)},showRecordError:function(record,errors,row){var _self=this,grid=_self.get("grid");row=row||grid.findRow(record);if(row){_self._clearRowError(row);BUI.each(errors,function(item){var cell=grid.findCell(item.id,row);_self._showCellError(cell,item.error)})}},updateRecord:function(store,record,editor){},_clearRowError:function(row){row.find("."+CLS_CELL_ERROR).remove()},_showCellError:function(cell,error){var _self=this,errorTpl=BUI.substitute(_self.get("errorTpl"),{error:error}),innerEl=cell.find("."+CLS_CELL_INNER);$(errorTpl).appendTo(innerEl)},edit:function(record,field){var _self=this,options=_self._createEditOptions(record,field),editor=_self.getEditor(field);_self.showEditor(editor,options)},cancel:function(){var _self=this,editors=_self.get("editors");BUI.each(editors,function(editor){if(editor.get("visible")){editor.cancel()}});_self.set("curEditor",null);_self.set("record",null)},destructor:function(){var _self=this,editors=_self.get("editors");BUI.each(editors,function(editor){editor.destroy||editor.destroy()});_self.off();_self.clearAttrVals()}});return Editing});define("bui/grid/plugins/cellediting",["bui/grid/plugins/editing"],function(require){var Editing=require("bui/grid/plugins/editing"),CLS_BODY=BUI.prefix+"grid-body",CLS_CELL=BUI.prefix+"grid-cell";var CellEditing=function(config){CellEditing.superclass.constructor.call(this,config)};CellEditing.ATTRS={triggerCls:{value:CLS_CELL}};BUI.extend(CellEditing,Editing);BUI.augment(CellEditing,{getEditorCfgs:function(fields){var _self=this,grid=_self.get("grid"),bodyNode=grid.get("el").find("."+CLS_BODY),rst=[];BUI.each(fields,function(field){var cfg={field:field,changeSourceEvent:null,hideExceptNode:bodyNode,autoUpdate:false,preventHide:false,editableFn:field.editableFn};if(field.xtype==="checkbox"){cfg.innerValueField="checked"}rst.push(cfg)});return rst},getEditor:function(field){if(!field){return null
}var _self=this,editors=_self.get("editors"),editor=null;BUI.each(editors,function(item){if(item.get("field").get("name")===field){editor=item;return false}});return editor},beforeShowEditor:function(editor,options){var _self=this,cell=$(options.cell);_self.resetWidth(editor,cell.outerWidth());_self._makeEnable(editor,options)},_makeEnable:function(editor,options){var editableFn=editor.get("editableFn"),field,enable,record;if(BUI.isFunction(editableFn)){field=options.field;record=options.record;if(record&&field){enable=editableFn(record[field],record);if(enable){editor.get("field").enable()}else{editor.get("field").disable()}}}},resetWidth:function(editor,width){editor.set("width",width)},updateRecord:function(store,record,editor){var _self=this,value=editor.getValue(),fieldName=editor.get("field").get("name"),preValue=record[fieldName];value=BUI.isDate(value)?value.getTime():value;if(preValue!==value){store.setValue(record,fieldName,value)}},getAlignNode:function(options){return $(options.cell)},getFields:function(){var rst=[],_self=this,editors=_self.get("editors");BUI.each(editors,function(editor){rst.push(editor.get("field"))});return rst},getEditValue:function(options){if(options.record&&options.field){var value=options.record[options.field];return value==null?"":value}return""}});return CellEditing});define("bui/grid/plugins/rowediting",["bui/common","bui/grid/plugins/editing"],function(require){var BUI=require("bui/common"),Editing=require("bui/grid/plugins/editing"),CLS_ROW=BUI.prefix+"grid-row";var RowEditing=function(config){RowEditing.superclass.constructor.call(this,config)};RowEditing.ATTRS={autoSave:{value:false},align:{value:{points:["tl","tl"],offset:[-2,0]}},triggerCls:{value:CLS_ROW}};BUI.extend(RowEditing,Editing);BUI.augment(RowEditing,{getEditorCfgs:function(fields){var rst=[];rst.push({changeSourceEvent:null,autoUpdate:false,form:{children:fields,buttonBar:{elCls:"centered toolbar"}}});return rst},wrapValidator:function(validator){var _self=this;return function(value){var editor=_self.get("curEditor"),origin=_self.get("record"),record=editor?editor.getValue():origin;if(record){return validator(value,record,origin)}}},focusEditor:function(editor,field){var form=editor.get("form"),control=form.getField(field);if(control){control.focus()}},getFieldConfig:function(column){var editor=column.get("editor");if(editor){if(editor.xtype==="checkbox"){editor.innerValueField="checked"}return editor}var cfg={xtype:"plain"};if(column.get("dataIndex")&&column.get("renderer")){cfg.renderer=column.get("renderer")}return cfg},updateRecord:function(store,record,editor){var _self=this,value=editor.getValue();BUI.each(value,function(v,k){if(BUI.isDate(v)){value[k]=v.getTime()}});BUI.mix(record,value);store.update(record);if(_self.get("autoSave")){store.save(record)}},getEditor:function(field){var _self=this,editors=_self.get("editors");return editors[0]},onColumnVisibleChange:function(column){var _self=this,id=column.get("id"),editor=_self.getEditor(),field=editor.getChild(id,true);if(field){field.set("visible",column.get("visible"))}},beforeShowEditor:function(editor,options){var _self=this,grid=_self.get("grid"),columns=grid.get("columns"),form=editor.get("form"),row=$(options.row);editor.set("width",row.width());BUI.each(columns,function(column){var fieldName=column.get("dataIndex"),field=form.getField(fieldName);if(!column.get("visible")){field&&field.set("visible",false)}else{var width=column.get("el").outerWidth()-field.getAppendWidth();field.set("width",width)}})},getEditValue:function(options){return options.record},getEditorConstructor:function(Editor){return Editor.RecordEditor},getAlignNode:function(options){return $(options.row)},getFields:function(){var _self=this,editors=_self.get("editors");return editors[0].get("form").get("children")}});return RowEditing});define("bui/grid/plugins/dialogediting",["bui/common"],function(require){var BUI=require("bui/common"),TYPE_ADD="add",TYPE_EDIT="edit";function Dialog(config){Dialog.superclass.constructor.call(this,config)}Dialog.ATTRS={autoSave:{value:false},record:{},curIndex:{},contentId:{},editor:{},form:{},events:{value:{recordchange:false}},editType:{}};BUI.extend(Dialog,BUI.Base);BUI.augment(Dialog,{initializer:function(grid){var _self=this;_self.set("grid",grid);BUI.use("bui/editor",function(Editor){_self._initEditor(Editor)})},bindUI:function(grid){var _self=this,triggerCls=_self.get("triggerCls");if(triggerCls){grid.on("cellclick",function(ev){var sender=$(ev.domTarget),editor=_self.get("editor");if(sender.hasClass(triggerCls)&&editor){_self.edit(ev.record);if(grid.get("multipleSelect")){return false}}})}},_initEditor:function(Editor){var _self=this,contentId=_self.get("contentId"),formNode=$("#"+contentId).find("form"),editor=_self.get("editor"),cfg=BUI.merge(editor,{contentId:contentId,form:{srcNode:formNode}});editor=new Editor.DialogEditor(cfg);_self._bindEditor(editor);_self.set("editor",editor);_self.set("form",editor.get("form"))},_bindEditor:function(editor){var _self=this;
editor.on("accept",function(){var form=editor.get("form"),record=form.serializeToObject();_self.saveRecord(record);_self.fire("accept",{editor:editor,record:_self.get("record"),form:form})});editor.on("cancel",function(){_self.fire("cancel",{editor:editor,record:_self.get("record"),form:editor.get("form")})})},edit:function(record){var _self=this;_self.set("editType",TYPE_EDIT);_self.showEditor(record)},add:function(record,index){var _self=this;_self.set("editType",TYPE_ADD);_self.set("curIndex",index);_self.showEditor(record)},saveRecord:function(record){var _self=this,grid=_self.get("grid"),editType=_self.get("editType"),curIndex=_self.get("curIndex"),store=grid.get("store"),curRecord=_self.get("record");BUI.mix(curRecord,record);if(editType==TYPE_ADD){if(curIndex!=null){store.addAt(curRecord,curIndex)}else{store.add(curRecord)}}else{store.update(curRecord)}if(_self.get("autoSave")){store.save(curRecord)}},showEditor:function(record){var _self=this,editor=_self.get("editor");_self.set("record",record);editor.show();editor.setValue(record,true);_self.fire("recordchange",{record:record,editType:_self.get("editType")});_self.fire("editorshow",{eidtor:editor,editType:_self.get("editType")})},cancel:function(){var _self=this,editor=_self.get("editor");editor.cancel()},destructor:function(){var _self=this,editor=_self.get("editor");editor&&editor.destroy();_self.off();_self.clearAttrVals()}});return Dialog});define("bui/grid/plugins/rownumber",function(require){var CLS_NUMBER="x-grid-rownumber";function RowNumber(config){RowNumber.superclass.constructor.call(this,config)}BUI.extend(RowNumber,BUI.Base);RowNumber.ATTRS={width:{value:40},column:{}};BUI.augment(RowNumber,{createDom:function(grid){var _self=this;var cfg={title:"",width:_self.get("width"),fixed:true,resizable:false,sortable:false,renderer:function(value,obj,index){return index+1},elCls:CLS_NUMBER},column=grid.addColumn(cfg,0);_self.set("column",column)}});return RowNumber});define("bui/tree",["bui/common","bui/tree/treemixin","bui/tree/treelist","bui/tree/treemenu"],function(require){var BUI=require("bui/common"),Tree=BUI.namespace("Tree");BUI.mix(Tree,{TreeList:require("bui/tree/treelist"),Mixin:require("bui/tree/treemixin"),TreeMenu:require("bui/tree/treemenu")});return Tree});define("bui/tree/treemixin",["bui/common","bui/data"],function(require){function makeSureNode(self,node){if(BUI.isString(node)){node=self.findNode(node)}return node}function animateFn(fn,timeout,count){setTimeout(function(){fn()},timeout/count)}var BUI=require("bui/common"),Data=require("bui/data"),EXPAND="expanded",LOADING="loading",CHECKED="checked",PARTIAL_CHECKED="partial-checked",MAP_TYPES={NONE:"none",ALL:"all",CUSTOM:"custom",ONLY_LEAF:"onlyLeaf"},CLS_ICON="x-tree-icon",CLS_ELBOW="x-tree-elbow",CLS_SHOW_LINE="x-tree-show-line",CLS_ICON_PREFIX=CLS_ELBOW+"-",CLS_ICON_WRAPER=CLS_ICON+"-wraper",CLS_LINE=CLS_ICON_PREFIX+"line",CLS_END=CLS_ICON_PREFIX+"end",CLS_EMPTY=CLS_ICON_PREFIX+"empty",CLS_EXPANDER=CLS_ICON_PREFIX+"expander",CLS_CHECKBOX=CLS_ICON+"-checkbox",CLS_RADIO=CLS_ICON+"-radio",CLS_EXPANDER_END=CLS_EXPANDER+"-end",Mixin=function(){};Mixin.ATTRS={store:{getter:function(v){if(!v){var _self=this,store=new Data.TreeStore({root:_self.get("root"),data:_self.get("nodes")});_self.setInternal("store",store);return store}return v}},root:{},nodes:{sync:false},iconContainer:{},iconWraperTpl:{value:'<span class="'+CLS_ICON_WRAPER+'">{icons}</span>'},showLine:{value:false},showIcons:{value:true},iconTpl:{value:'<span class="x-tree-icon {cls}"></span>'},leafCls:{value:CLS_ICON_PREFIX+"leaf"},dirCls:{value:CLS_ICON_PREFIX+"dir"},checkType:{value:"custom"},accordion:{value:false},multipleCheck:{value:true},checkedField:{valueFn:function(){return this.getStatusField("checked")}},checkableField:{value:"checkable"},itemStatusFields:{value:{expanded:"expanded",disabled:"disabled",checked:"checked"}},dirSelectable:{value:true},showRoot:{value:false},events:{value:{expanded:false,collapsed:false,checkedchange:false}},expandEvent:{value:"itemdblclick"},expandAnimate:{value:false},collapseEvent:{value:"itemdblclick"},startLevel:{value:1}};BUI.augment(Mixin,{collapseAll:function(){var _self=this,elements=_self.get("view").getAllElements();BUI.each(elements,function(element){var item=_self.getItemByElement(element);if(item){_self._collapseNode(item,element,true)}})},collapseNode:function(node){var _self=this,element;if(BUI.isString(node)){node=_self.findNode(node)}if(!node){return}element=_self.findElement(node);_self._collapseNode(node,element)},expandAll:function(){var _self=this,elements=_self.get("view").getAllElements();BUI.each(elements,function(element){var item=_self.getItemByElement(element);_self._expandNode(item,element,true)})},expandNode:function(node,deep){var _self=this,element;if(BUI.isString(node)){node=_self.findNode(node)}if(!node){return}if(node.parent&&!_self.isExpanded(node.parent)){_self.expandNode(node.parent)}element=_self.findElement(node);_self._expandNode(node,element,deep)
},expandPath:function(path,async,startIndex){if(!path){return}startIndex=startIndex||0;var _self=this,store=_self.get("store"),preNode,node,i,id,arr=path.split(",");preNode=_self.findNode(arr[startIndex]);for(i=startIndex+1;i<arr.length;i++){id=arr[i];node=_self.findNode(id,preNode);if(preNode&&node){_self.expandNode(preNode);preNode=node}else{if(preNode&&async){store.load({id:preNode.id},function(){node=_self.findNode(id,preNode);if(node){_self.expandPath(path,async,i)}});break}}}},findNode:function(id,parent){return this.get("store").findNode(id,parent)},getCheckedLeaf:function(parent){var _self=this,store=_self.get("store");return store.findNodesBy(function(node){return node.leaf&&_self.isChecked(node)},parent)},getCheckedNodes:function(parent){var _self=this,store=_self.get("store");return store.findNodesBy(function(node){return _self.isChecked(node)},parent)},isItemSelectable:function(item){var _self=this,dirSelectable=_self.get("dirSelectable"),node=item;if(node&&!dirSelectable&&!node.leaf){return false}return true},isExpanded:function(node){if(!node||node.leaf){return false}var _self=this,element;if(_self._isRoot(node)&&!_self.get("showRoot")){return true}if(BUI.isString(node)){item=_self.getItem(node)}element=_self.findElement(node);return this._isExpanded(node,element)},isChecked:function(node){if(!node){return false}return !!node[this.get("checkedField")]},toggleExpand:function(node){var _self=this,element;if(BUI.isString(node)){item=_self.getItem(node)}element=_self.findElement(node);_self._toggleExpand(node,element)},setNodeChecked:function(node,checked,deep){deep=deep==null?true:deep;if(!node){return}var _self=this,parent,multipleCheck=_self.get("multipleCheck"),element;node=makeSureNode(this,node);if(!node){return}parent=node.parent;if(!_self.isCheckable(node)){return}if(_self.isChecked(node)!==checked||_self.hasStatus(node,"checked")!==checked){element=_self.findElement(node);if(element){_self.setItemStatus(node,CHECKED,checked,element);if(multipleCheck){_self._resetPatialChecked(node,checked,checked,element)}else{if(checked&&parent&&_self.isChecked(parent)!=checked){_self.setNodeChecked(parent,checked,false)}}}else{if(!_self.isItemDisabled(node)){_self.setStatusValue(node,"checked",checked)}}if(parent){if(_self.isChecked(parent)!=checked){_self._resetParentChecked(parent)}else{if(multipleCheck){_self._resetPatialChecked(parent,null,null,null,true)}}}if(checked&&!multipleCheck&&(_self.isChecked(parent)||parent==_self.get("root"))){var nodes=parent.children;BUI.each(nodes,function(slibNode){if(slibNode!==node&&_self.isChecked(slibNode)){_self.setNodeChecked(slibNode,false)}})}_self.fire("checkedchange",{node:node,element:element,checked:checked})}if(!node.leaf&&deep){BUI.each(node.children,function(subNode,index){if(multipleCheck||!checked||(!multipleCheck&&index==0)){_self.setNodeChecked(subNode,checked,deep)}})}},setChecked:function(node){this.setNodeChecked(node,true)},clearAllChecked:function(){var _self=this,nodes=_self.getCheckedNodes();BUI.each(nodes,function(node){_self.setNodeChecked(node,false)})},_initRoot:function(){var _self=this,store=_self.get("store"),root,showRoot=_self.get("showRoot"),nodes;if(store){root=store.get("root");_self.setInternal("root",root);if(showRoot){nodes=[root]}else{nodes=root.children}BUI.each(nodes,function(subNode){_self._initChecked(subNode,true)});_self.clearItems();_self.addItems(nodes)}},_initChecked:function(node,deep){var _self=this,checkType=_self.get("checkType"),checkedField=_self.get("checkedField"),multipleCheck=_self.get("multipleCheck"),checkableField=_self.get("checkableField"),parent;if(checkType===MAP_TYPES.NONE){node[checkableField]=false;node[checkedField]=false;return}if(checkType===MAP_TYPES.ONLY_LEAF){if(node.leaf){node[checkableField]=true}else{node[checkableField]=false;node[checkedField]=false;if(deep){BUI.each(node.children,function(subNode){_self._initChecked(subNode,deep)})}}return}if(checkType===MAP_TYPES.CUSTOM){if(node[checkableField]==null){node[checkableField]=node[checkedField]!=null}}if(checkType===MAP_TYPES.ALL){node[checkableField]=true}if(!node||!_self.isCheckable(node)){return}parent=node.parent;if(!_self.isChecked(node)){if(parent&&_self.isChecked(parent)){if(multipleCheck||!_self._hasChildChecked(parent)){_self.setStatusValue(node,"checked",true)}}if((node.children&&node.children.length&&_self._isAllChildrenChecked(node))||(!multipleCheck&&_self._hasChildChecked(node))){_self.setStatusValue(node,"checked",true)}}if(deep){BUI.each(node.children,function(subNode){_self._initChecked(subNode,deep)})}},_resetPatialChecked:function(node,checked,hasChecked,element,upper){if(!node||node.leaf){return true}var _self=this,hasChecked;checked=checked==null?_self.isChecked(node):checked;if(checked){_self.setItemStatus(node,PARTIAL_CHECKED,false,element);return}hasChecked=hasChecked==null?_self._hasChildChecked(node):hasChecked;_self.setItemStatus(node,PARTIAL_CHECKED,hasChecked,element);if(upper&&node.parent){_self._resetPatialChecked(node.parent,false,hasChecked?hasChecked:null,null,upper)
}},_resetParentChecked:function(parentNode){if(!this.isCheckable(parentNode)){return}var _self=this,multipleCheck=_self.get("multipleCheck"),allChecked=multipleCheck?_self._isAllChildrenChecked(parentNode):_self._hasChildChecked(parentNode);_self.setStatusValue(parentNode,"checked",allChecked);_self.setNodeChecked(parentNode,allChecked,false);multipleCheck&&_self._resetPatialChecked(parentNode,allChecked,null,null)},__bindUI:function(){var _self=this,el=_self.get("el"),multipleCheck=_self.get("multipleCheck");_self.on("itemclick",function(ev){var sender=$(ev.domTarget),element=ev.element,node=ev.item;if(sender.hasClass(CLS_EXPANDER)){_self._toggleExpand(node,element);return false}else{if(sender.hasClass(CLS_CHECKBOX)){var checked=_self.isChecked(node);_self.setNodeChecked(node,!checked)}else{if(sender.hasClass(CLS_RADIO)){_self.setNodeChecked(node,true)}}}});_self.on("itemrendered",function(ev){var node=ev.item,element=ev.domTarget;_self._resetIcons(node,element);if(_self.isCheckable(node)&&multipleCheck){_self._resetPatialChecked(node,null,null,element)}if(_self._isExpanded(node,element)){_self._showChildren(node)}});_self._initExpandEvent()},_initExpandEvent:function(){var _self=this,el=_self.get("el"),expandEvent=_self.get("expandEvent"),collapseEvent=_self.get("collapseEvent");function createCallback(methodName){return function(ev){var sender=$(ev.domTarget),element=ev.element,node=ev.item;if(!sender.hasClass(CLS_EXPANDER)){_self[methodName](node,element)}}}if(expandEvent==collapseEvent){_self.on(expandEvent,createCallback("_toggleExpand"))}else{if(expandEvent){_self.on(expandEvent,createCallback("_expandNode"))}if(collapseEvent){_self.on(collapseEvent,createCallback("_collapseNode"))}}},_isForceChecked:function(node){var _self=this,multipleCheck=_self.get("multipleCheck");return multipleCheck?_self._isAllChildrenChecked():_isForceChecked()},_isAllChildrenChecked:function(node){if(!node||node.leaf){return false}var _self=this,children=node.children,rst=true;BUI.each(children,function(subNode){rst=rst&&_self.isChecked(subNode);if(!rst){return false}});return rst},_hasChildChecked:function(node){if(!node||node.leaf){return false}var _self=this;return _self.getCheckedNodes(node).length!=0},_isRoot:function(node){var _self=this,store=_self.get("store");if(store&&store.get("root")==node){return true}return false},_setLoadStatus:function(node,element,loading){var _self=this;_self.setItemStatus(node,LOADING,loading,element)},_beforeLoadNode:function(node){var _self=this,element;if(BUI.isString(node)){node=_self.findNode(node)}element=_self.findElement(node);if(element){_self._collapseNode(node,element);_self._setLoadStatus(node,element,true)}else{if(node){BUI.each(node.children,function(subNode){_self._removeNode(subNode)})}}},onBeforeLoad:function(e){var _self=this,params=e.params,id=params.id,node=_self.findNode(id)||_self.get("root");_self._beforeLoadNode(node)},_addNode:function(node,index){var _self=this,parent=node.parent,scount,prevNode,nextNode,cIndex;_self._initChecked(node,true);if(parent){if(_self.isExpanded(parent)){scount=parent.children.length;cIndex=_self._getInsetIndex(node);_self.addItemAt(node,cIndex);if(index==scount-1&&index>0){prevNode=parent.children[index-1];_self._updateIcons(prevNode)}}_self._updateIcons(parent)}else{cIndex=_self._getInsetIndex(node);_self.addItemAt(node,cIndex);prevNode=_self.get("nodes")[index-1];_self._updateIcons(prevNode)}},_getInsetIndex:function(node){var _self=this,nextNode,rst=null;nextNode=_self._getNextItem(node);if(nextNode){return _self.indexOfItem(nextNode)}return _self.getItemCount()},_getNextItem:function(item){var _self=this,parent=item.parent,slibings,cIndex,rst=null;if(!parent){return null}slibings=parent.children;cIndex=BUI.Array.indexOf(item,slibings);rst=slibings[cIndex+1];return rst||_self._getNextItem(parent)},onAdd:function(e){var _self=this,node=e.node,index=e.index;_self._addNode(node,index)},_updateNode:function(node){var _self=this;_self.updateItem(node);_self._updateIcons(node)},onUpdate:function(e){var _self=this,node=e.node;_self._updateNode(node)},_removeNode:function(node,index){var _self=this,parent=node.parent,scount,prevNode;_self.collapseNode(node);if(!parent){return}_self.removeItem(node);if(_self.isExpanded(parent)){scount=parent.children.length;if(scount==index&&index!==0){prevNode=parent.children[index-1];_self._updateIcons(prevNode)}}_self._updateIcons(parent);_self._resetParentChecked(parent)},onRemove:function(e){var _self=this,node=e.node,index=e.index;_self._removeNode(node,index)},_loadNode:function(node){var _self=this;_self._initChecked(node,true);_self.expandNode(node);_self._updateIcons(node);_self.setItemStatus(node,LOADING,false)},__syncUI:function(){var _self=this,store=_self.get("store"),showRoot=_self.get("showRoot");if(showRoot&&!store.hasData()){_self._initRoot()}},onLoad:function(e){var _self=this,store=_self.get("store"),root=store.get("root"),node;if(!e||e.node==root){_self._initRoot()}if(e&&e.node){_self._loadNode(e.node)
}},_isExpanded:function(node,element){return this.hasStatus(node,EXPAND,element)},_getIconsTpl:function(node){var _self=this,level=node.level,start=_self.get("startLevel"),iconWraperTpl=_self.get("iconWraperTpl"),icons=[],i;for(i=start;i<level;i=i+1){icons.push(_self._getLevelIcon(node,i))}icons.push(_self._getExpandIcon(node));icons.push(_self._getCheckedIcon(node));icons.push(_self._getNodeTypeIcon(node));return BUI.substitute(iconWraperTpl,{icons:icons.join("")})},_getCheckedIcon:function(node){var _self=this,checkable=_self.isCheckable(node),cls;if(checkable){cls=_self.get("multipleCheck")?CLS_CHECKBOX:CLS_RADIO;return _self._getIcon(cls)}return""},isCheckable:function(node){return node[this.get("checkableField")]},_getExpandIcon:function(node){var _self=this,cls=CLS_EXPANDER;if(node.leaf){return _self._getLevelIcon(node)}if(_self._isLastNode(node)){cls=cls+" "+CLS_EXPANDER_END}return _self._getIcon(cls)},_getNodeTypeIcon:function(node){var _self=this,cls=node.cls?node.cls:(node.leaf?_self.get("leafCls"):_self.get("dirCls"));return _self._getIcon(cls)},_getLevelIcon:function(node,level){var _self=this,showLine=_self.get("showLine"),cls=CLS_EMPTY,levelNode;if(showLine){if(node.level===level||level==null){cls=_self._isLastNode(node)?CLS_END:CLS_ELBOW}else{levelNode=_self._getParentNode(node,level);cls=_self._isLastNode(levelNode)?CLS_EMPTY:CLS_LINE}}return _self._getIcon(cls)},_getParentNode:function(node,level){var nodeLevel=node.level,parent=node.parent,i=nodeLevel-1;if(nodeLevel<=level){return null}while(i>level){parent=parent.parent;i=i-1}return parent},_getIcon:function(cls){var _self=this,iconTpl=_self.get("iconTpl");return BUI.substitute(iconTpl,{cls:cls})},_isLastNode:function(node){if(!node){return false}if(node==this.get("root")){return true}var _self=this,parent=node.parent,siblings=parent?parent.children:_self.get("nodes"),count;count=siblings.length;return siblings[count-1]===node},_initNodes:function(nodes,level,parent){var _self=this;BUI.each(nodes,function(node){node.level=level;if(node.leaf==null){node.leaf=node.children?false:true}if(parent&&!node.parent){node.parent=parent}_self._initChecked(node);if(node.children){_self._initNodes(node.children,level+1,node)}})},_collapseNode:function(node,element,deep){var _self=this;if(node.leaf){return}if(_self.hasStatus(node,EXPAND,element)){_self.setItemStatus(node,EXPAND,false,element);if(deep){_self._collapseChildren(node,deep);_self.removeItems(node.children)}else{_self._hideChildrenNodes(node)}_self.fire("collapsed",{node:node,element:element})}},_hideChildrenNodes:function(node){var _self=this,children=node.children,elements=[];BUI.each(children,function(subNode){var element=_self.findElement(subNode);if(element){elements.push(element);_self._hideChildrenNodes(subNode)}});if(_self.get("expandAnimate")){elements=$(elements);elements.animate({height:0},function(){_self.removeItems(children)})}else{_self.removeItems(children)}},_collapseChildren:function(parentNode,deep){var _self=this,children=parentNode.children;BUI.each(children,function(node){_self.collapseNode(node,deep)})},_expandNode:function(node,element,deep){var _self=this,accordion=_self.get("accordion"),store=_self.get("store");if(node.leaf){return}if(!_self.hasStatus(node,EXPAND,element)){if(accordion&&node.parent){var slibings=node.parent.children;BUI.each(slibings,function(sNode){if(sNode!=node){_self.collapseNode(sNode)}})}if(store&&!store.isLoaded(node)){if(!_self._isLoading(node,element)){store.loadNode(node)}}else{if(element){_self.setItemStatus(node,EXPAND,true,element);_self._showChildren(node);_self.fire("expanded",{node:node,element:element})}}}BUI.each(node.children,function(subNode){if(deep||_self.isExpanded(subNode)){_self.expandNode(subNode,deep)}})},_showChildren:function(node){if(!node||!node.children){return}var _self=this,index=_self.indexOfItem(node),length=node.children.length,subNode,i=length-1,elements=[];for(i=length-1;i>=0;i--){subNode=node.children[i];if(!_self.getItem(subNode)){if(_self.get("expandAnimate")){el=_self._addNodeAt(subNode,index+1);el.hide();el.slideDown()}else{_self.addItemAt(subNode,index+1)}}}},_addNodeAt:function(item,index){var _self=this,items=_self.get("items");if(index===undefined){index=items.length}items.splice(index,0,item);return _self.addItemToView(item,index)},_isLoading:function(node,element){var _self=this;return _self.hasStatus(node,LOADING,element)},_resetIcons:function(node,element){if(!this.get("showIcons")){return}var _self=this,iconContainer=_self.get("iconContainer"),containerEl,iconsTpl=_self._getIconsTpl(node);$(element).find("."+CLS_ICON_WRAPER).remove();containerEl=$(element).find(iconContainer).first();if(iconContainer&&containerEl.length){$(iconsTpl).prependTo(containerEl)}else{$(element).prepend($(iconsTpl))}},_toggleExpand:function(node,element){var _self=this;if(_self._isExpanded(node,element)){_self._collapseNode(node,element)}else{_self._expandNode(node,element)}},_updateIcons:function(node){var _self=this,element=_self.findElement(node);
if(element){_self._resetIcons(node,element);if(_self._isExpanded(node,element)&&!node.leaf){BUI.each(node.children,function(subNode){_self._updateIcons(subNode)})}}},_uiSetShowRoot:function(v){var _self=this,start=this.get("showRoot")?0:1;_self.set("startLevel",start)},_uiSetNodes:function(v){var _self=this,store=_self.get("store");store.setResult(v)},_uiSetShowLine:function(v){var _self=this,el=_self.get("el");if(v){el.addClass(CLS_SHOW_LINE)}else{el.removeClass(CLS_SHOW_LINE)}}});return Mixin});define("bui/tree/selection",["bui/list"],function(require){var BUI=require("bui/common"),SimpleList=require("bui/list").SimpleList;var Selection=function(){};Selection.ATTRS={};BUI.augment(Selection,{getSelection:function(){var _self=this,field=_self.getStatusField("selected"),store;if(field){store=_self.get("store");return store.findNodesBy(function(node){return node[field]})}return SimpleList.prototype.getSelection.call(this)},getSelected:function(){var _self=this,field=_self.getStatusField("selected"),store;if(field){store=_self.get("store");return store.findNodeBy(function(node){return node[field]})}return SimpleList.prototype.getSelected.call(this)}});return Selection});define("bui/tree/treelist",["bui/common","bui/list","bui/tree/treemixin","bui/tree/selection"],function(require){var BUI=require("bui/common"),List=require("bui/list"),Mixin=require("bui/tree/treemixin"),Selection=require("bui/tree/selection");var TreeList=List.SimpleList.extend([Mixin,Selection],{},{ATTRS:{itemCls:{value:BUI.prefix+"tree-item"},itemTpl:{value:"<li>{text}</li>"},idField:{value:"id"}}},{xclass:"tree-list"});return TreeList});define("bui/tree/treemenu",["bui/common","bui/list","bui/tree/treemixin","bui/tree/selection"],function(require){var BUI=require("bui/common"),List=require("bui/list"),Mixin=require("bui/tree/treemixin"),Selection=require("bui/tree/selection");var TreeMenuView=List.SimpleList.View.extend({getItemTpl:function(item,index){var _self=this,render=_self.get("itemTplRender"),itemTpl=item.leaf?_self.get("leafTpl"):_self.get("dirTpl");if(render){return render(item,index)}return BUI.substitute(itemTpl,item)}},{xclass:"tree-menu-view"});var TreeMenu=List.SimpleList.extend([Mixin,Selection],{},{ATTRS:{itemCls:{value:BUI.prefix+"tree-item"},dirSelectable:{value:false},expandEvent:{value:"itemclick"},itemStatusFields:{value:{selected:"selected"}},collapseEvent:{value:"itemclick"},xview:{value:TreeMenuView},dirTpl:{view:true,value:'<li class="{cls}"><a href="#">{text}</a></li>'},leafTpl:{view:true,value:'<li class="{cls}"><a href="{href}">{text}</a></li>'},idField:{value:"id"}}},{xclass:"tree-menu"});TreeMenu.View=TreeMenuView;return TreeMenu});define("bui/tooltip",["bui/common","bui/tooltip/tip","bui/tooltip/tips"],function(require){var BUI=require("bui/common"),Tooltip=BUI.namespace("Tooltip"),Tip=require("bui/tooltip/tip"),Tips=require("bui/tooltip/tips");BUI.mix(Tooltip,{Tip:Tip,Tips:Tips});return Tooltip});define("bui/tooltip/tip",["bui/common","bui/overlay"],function(require){var BUI=require("bui/common"),Overlay=require("bui/overlay"),CLS_ALIGN_PREFIX="x-align-",MAP_TYPES={left:["cl","cr"],right:["cr","cl"],top:["tc","bc"],bottom:["bc","tc"],"top-left":["tl","bl"],"top-right":["tr","br"],"bottom-left":["bl","tl"],"bottom-right":["br","tr"]};function getOffset(type,offset){if(type==="left"){return[-1*offset,-4]}if(type==="right"){return[offset,-4]}if(type.indexOf("top")){return[0,offset]}if(type.indexOf("bottom")){return[0,-1*offset]}}var TipView=Overlay.OverlayView.extend({renderUI:function(){},_getTitleContainer:function(){return this.get("el")},_uiSetTitle:function(title){var _self=this,titleTpl=_self.get("titleTpl"),container=_self._getTitleContainer(),titleEl=_self.get("titleEl"),tem;if(titleEl){titleEl.remove()}title=title||"";if(BUI.isString(title)){title={title:title}}tem=BUI.substitute(titleTpl,title);titleEl=$(tem).appendTo(container);_self.set("titleEl",titleEl)},_uiSetAlignType:function(type,ev){var _self=this;if(ev&&ev.prevVal){_self.get("el").removeClass(CLS_ALIGN_PREFIX+ev.prevVal)}if(type){_self.get("el").addClass(CLS_ALIGN_PREFIX+type)}}},{ATTRS:{title:{},titleEl:{},alignType:{}}},{xclass:"tooltip-view"});var Tip=Overlay.Overlay.extend({_uiSetAlignType:function(type){var _self=this,offset=_self.get("offset"),align=_self.get("align")||{},points=MAP_TYPES[type];if(points){align.points=points;if(offset){align.offset=getOffset(type,offset)}_self.set("align",align)}}},{ATTRS:{delegateTrigger:{value:true},alignType:{view:true},title:{view:true},showArrow:{value:true},arrowContainer:{view:true},autoHide:{value:true},autoHideType:{value:"leave"},offset:{value:0},triggerEvent:{value:"mouseover"},titleTpl:{view:true,value:"<span>{title}</span>"},xview:{value:TipView}}},{xclass:"tooltip"});Tip.View=TipView;return Tip});define("bui/tooltip/tips",["bui/common","bui/tooltip/tip"],function(require){function isObjectString(str){return/^{.*}$/.test(str)}var BUI=require("bui/common"),Tip=require("bui/tooltip/tip"),Tips=function(config){Tips.superclass.constructor.call(this,config)
};Tips.ATTRS={tip:{},defaultAlignType:{}};BUI.extend(Tips,BUI.Base);BUI.augment(Tips,{_init:function(){this._initDom();this._initEvent()},_initDom:function(){var _self=this,tip=_self.get("tip"),defaultAlignType;if(tip&&!tip.isController){defaultAlignType=tip.alignType;tip=new Tip(tip);tip.render();_self.set("tip",tip);if(defaultAlignType){_self.set("defaultAlignType",defaultAlignType)}}},_initEvent:function(){var _self=this,tip=_self.get("tip");tip.on("triggerchange",function(ev){var curTrigger=ev.curTrigger;_self._replaceTitle(curTrigger);_self._setTitle(curTrigger,tip)})},_replaceTitle:function(triggerEl){var title=triggerEl.attr("title");if(title){triggerEl.attr("data-title",title);triggerEl[0].removeAttribute("title")}},_setTitle:function(triggerEl,tip){var _self=this,title=triggerEl.attr("data-title"),alignType=triggerEl.attr("data-align")||_self.get("defaultAlignType");if(isObjectString(title)){title=BUI.JSON.looseParse(title)}tip.set("title",title);if(alignType){tip.set("alignType",alignType)}},render:function(){this._init();return this}});return Tips});(function(){if(BUI.loaderScript.getAttribute("data-auto-use")=="false"){return}BUI.use(["bui/common","bui/data","bui/list","bui/picker","bui/menu","bui/toolbar","bui/progressbar","bui/cookie","bui/form","bui/mask","bui/select","bui/tab","bui/calendar","bui/overlay","bui/editor","bui/grid","bui/tree","bui/tooltip"])})();