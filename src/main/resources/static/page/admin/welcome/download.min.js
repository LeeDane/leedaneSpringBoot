layui.use(["layer"],function(){layer=layui.layer;winH=$(window).height();queryPaging();$(window).scroll(function(a){a=a||window.event;if(a.wheelDelta){if(0<a.wheelDelta)return}else if(a.detail&&0<a.detail)return;a=$(document.body).height();var c=$(window).scrollTop();a=(a-winH-c)/winH;!isLoad&&.2>a&&canLoadData&&(isLoad=!0,method="lowloading",queryPaging())})});var last_id=0,first_id=0,method="firstloading",winH,canLoadData=!0,isLoad=!1,appVersions;function queryPaging(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/av/versions?"+jsonToGetRequestParams(getQueryPagingParams()),dataType:"json",beforeSend:function(){},success:function(c){layer.close(a);if(c.success){if(0==c.message.length){canLoadData=!1;layer.msg("\u65e0\u66f4\u591a\u6570\u636e");return}if("firstloading"==method){$(".list-row").remove();appVersions=c.message;for(var b=0;b<appVersions.length;b++)buildEachRow(appVersions[b],b),0==b&&(first_id=appVersions[b].id),b==appVersions.length-1&&(last_id=appVersions[b].id)}else for(var d=appVersions.length,b=0;b<c.message.length;b++)appVersions.push(c.message[b]),buildEachRow(c.message[b],d),b==c.message.length-1&&(last_id=c.message[b].id)}else ajaxError(c);isLoad=!1},error:function(c){isLoad=!1;layer.close(a);ajaxError(c)}})}function getQueryPagingParams(){var a=15;"firstloading"!=method&&(a=10);return{pageSize:a,last_id:last_id,first_id:first_id,method:method,t:Math.random()}}function buildEachRow(a,c){var b='\x3cdiv class\x3d"row list-row"\x3e\x3cdiv class\x3d"col-lg-12"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-4"\x3e\u7248\u672c\u53f7\uff1a'+a.file_version+'\x3c/div\x3e\x3cdiv class\x3d"col-lg-4"\x3e\u6587\u4ef6\u5927\u5c0f\uff1a'+(a.lenght/1024/1024).toFixed(2)+'M\x3c/div\x3e\x3cdiv class\x3d"col-lg-4"\x3e\u53d1\u5e03\u65f6\u95f4\uff1a'+a.create_time+'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12"\x3e'+a.file_desc+'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12"\x3e\x3ca type\x3d"button" class\x3d"btn btn-primary" href\x3d"'+a.path+'"\x3e\u4e0b\u8f7d\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';$(".mainContainer").append(b)};