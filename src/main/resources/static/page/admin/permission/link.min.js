layui.use(["layer"],function(){layer=layui.layer;initPage(".pagination","getLinks");$addOrEditModal=$("#add-or-edit-role-or-permission");$("#totalCheckbox").change(function(){$(this).hasClass("checked")?($("tr.each-row").find("input[type\x3d'checkbox']").each(function(){$(this).removeAttr("checked")}),$(this).removeClass("checked")):($("tr.each-row").find("input[type\x3d'checkbox']").each(function(){$(this).prop("checked",!0)}),$(this).addClass("checked"))});$("tr.each-row").find("input[type\x3d'checkbox']").on("click",function(){alert("ddd")});$tableContainer=$(".table");getLinks()});var links,$addOrEditModal,$tableContainer;function getLinks(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/ln/links?"+jsonToGetRequestParams(getQueryPagingParams()),dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);$tableContainer.find(".each-row").remove();if(b.success)if(0==b.message.length)0==currentIndex?$tableContainer.append('\x3ctr class\x3d"each-row"\x3e\x3ctd colspan\x3d"10"\x3e\u6682\u65f6\u8fd8\u6ca1\u6709\u4efb\u4f55\u94fe\u63a5\uff01\x3c/td\x3e\x3c/tr\x3e'):($tableContainer.append('\x3ctr class\x3d"each-row"\x3e\x3ctd colspan\x3d"10"\x3e\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u94fe\u63a5\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01\x3c/td\x3e\x3c/tr\x3e'),pageDivUtil(b.total));else{links=b.message;for(var c=0;c<links.length;c++)$tableContainer.append(buildRow(links[c],c)),1!=links[c].status&&$tableContainer.find(".each-row").eq(c).addClass("status-disabled-row");pageDivUtil(b.total)}else ajaxError(b)},error:function(b){layer.close(a);isLoad=!1;ajaxError(b)}})}function addRole(){$addOrEditModal.attr("data-id","");$addOrEditModal.find('input[name\x3d"link"]').val("");$addOrEditModal.find('input[name\x3d"alias"]').val("");$addOrEditModal.find('input[name\x3d"order"]').val("");$addOrEditModal.find('input[name1\x3d"status_normal"]').prop("checked",!0);$addOrEditModal.find('input[name1\x3d"status_disabled"]').removeAttr("checked");$addOrEditModal.find('input[name1\x3d"all_true"]').prop("checked",!0);$addOrEditModal.find('input[name1\x3d"all_false"]').removeAttr("checked");$addOrEditModal.find('input[name1\x3d"role_true"]').prop("checked",!0);$addOrEditModal.find('input[name1\x3d"role_false"]').removeAttr("checked");$addOrEditModal.modal("show")}function editRole(){var a=$("tr.each-row").find('input[type\x3d"checkbox"]:checked');a&&0!=a.length?a&&1<a.length?layer.msg("\u4e00\u6b21\u53ea\u80fd\u7f16\u8f91\u4e00\u4e2a\u94fe\u63a5"):(a=links[$(a[0]).closest("tr").attr("index")],$addOrEditModal.attr("data-id",a.id),$addOrEditModal.find('input[name\x3d"link"]').val(a.link),$addOrEditModal.find('input[name\x3d"alias"]').val(a.alias),$addOrEditModal.find('input[name\x3d"order"]').val(a.order_),1==a.status?($addOrEditModal.find('input[name1\x3d"status_normal"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"status_disabled"]').removeAttr("checked")):($addOrEditModal.find('input[name1\x3d"status_disabled"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"status_normal"]').removeAttr("checked")),a.all_?($addOrEditModal.find('input[name1\x3d"all_true"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"all_false"]').removeAttr("checked")):($addOrEditModal.find('input[name1\x3d"all_false"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"all_true"]').removeAttr("checked")),a.role?($addOrEditModal.find('input[name1\x3d"role_true"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"role_false"]').removeAttr("checked")):($addOrEditModal.find('input[name1\x3d"role_false"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"role_true"]').removeAttr("checked")),$addOrEditModal.modal("show")):layer.msg("\u8bf7\u9009\u62e9\u60a8\u8981\u7f16\u8f91\u7684\u94fe\u63a5")}function rowEditRole(a){a=$(a).closest("tr.each-row").attr("index");a=links[a];$addOrEditModal.attr("data-id",a.id);$addOrEditModal.find('input[name\x3d"link"]').val(a.link);$addOrEditModal.find('input[name\x3d"alias"]').val(a.alias);$addOrEditModal.find('input[name\x3d"order"]').val(a.order_);1==a.status?($addOrEditModal.find('input[name1\x3d"status_normal"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"status_disabled"]').removeAttr("checked")):($addOrEditModal.find('input[name1\x3d"status_disabled"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"status_normal"]').removeAttr("checked"));a.all_?($addOrEditModal.find('input[name1\x3d"all_true"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"all_false"]').removeAttr("checked")):($addOrEditModal.find('input[name1\x3d"all_false"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"all_true"]').removeAttr("checked"));a.role?($addOrEditModal.find('input[name1\x3d"role_true"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"role_false"]').removeAttr("checked")):($addOrEditModal.find('input[name1\x3d"role_false"]').prop("checked",!0),$addOrEditModal.find('input[name1\x3d"role_true"]').removeAttr("checked"));$addOrEditModal.modal("show")}function rowDeleteRole(a){var b=$(a).closest("tr.each-row").attr("data-id");layer.confirm("\u60a8\u8981\u5220\u9664\u8fd91\u6761\u94fe\u63a5\u8bb0\u5f55\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",url:"/ln/link/"+b,dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);b.success?(layer.msg(b.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})},function(){})}function deletesRole(){var a=$("tr.each-row").find('input[type\x3d"checkbox"]:checked');a&&0!=a.length?layer.confirm("\u60a8\u8981\u5220\u9664\u8fd9"+a.length+"\u6761\u94fe\u63a5\u8bb0\u5f55\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){for(var b="",c=0;c<a.length;c++)b+=$(a[c]).closest("tr.each-row").attr("data-id")+",";var b=deleteLastStr(b),d=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",url:"/ln/links?lnids\x3d"+b,dataType:"json",beforeSend:function(){},success:function(a){layer.close(d);a.success?(layer.msg(a.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(d);ajaxError(a)}})},function(){}):layer.msg("\u8bf7\u9009\u62e9\u60a8\u8981\u5220\u9664\u7684\u94fe\u63a5")}function showRoleOrPermissionList(a,b,c){var d=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/ln/link/"+c+"/roleOrPermissions?role\x3d"+b,dataType:"json",beforeSend:function(){$("#alreadyCodes").html("");$("#notCodes").html("")},success:function(a){layer.close(d);if(a.success){for(var e=0;e<a.message.length;e++)isEmpty(a.message[e].has)?buildNotCodesHtml(a.message[e]):buildAlreadyCodesHtml(a.message[e]);$("#role-list").modal("show");$("#role-list").attr("data-id",c);$("#role-list").attr("isRole",b)}else ajaxError(a)},error:function(a){layer.close(d);ajaxError(a)}})}function buildNotCodesHtml(a){a='\x3cspan class\x3d"label label-info" data-id\x3d"'+a.id+'" onclick\x3d"notClick(this);"\x3e'+a.code+"\x3c/span\x3e";$("#notCodes").append(a)}function buildAlreadyCodesHtml(a){a='\x3cspan class\x3d"label label-primary" data-id\x3d"'+a.id+'" onclick\x3d"alreadyClick(this);"\x3e'+a.code+"\x3c/span\x3e";$("#alreadyCodes").append(a)}function notClick(a){var b={};b.id=$(a).attr("data-id");b.code=$(a).text();$(a).remove();buildAlreadyCodesHtml(b)}function alreadyClick(a){var b={};b.id=$(a).attr("data-id");b.code=$(a).text();$(a).remove();buildNotCodesHtml(b)}function roleOrPermission(a){var b=$(a).closest(".modal");a=b.attr("data-id");var c="";b.find("#alreadyCodes span").each(function(){c+=$(this).attr("data-id")+","});var b=b.attr("isRole"),c=deleteLastStr(c),d=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/ln/link/"+a+"/roleOrPermissions/allot?role\x3d"+b+"\x26roleOrPermissionIds\x3d"+c,dataType:"json",beforeSend:function(){},success:function(a){layer.close(d);a.success?(layer.msg(a.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(d);ajaxError(a)}})}function addOrEditCommit(a){a=$(a).closest(".modal");var b=a.attr("data-id"),c={},d=!0;a.find(".form-control").each(function(a){a=$(this).attr("name");var b=$(this).attr("empty");if(b&&"false"==b&&isEmpty($(this).val()))return $(this).focus(),layer.msg($(this).attr("placeholder")),d=!1;c[a]=$(this).val()});if(d){c.id=b;c.status=a.find('input[name\x3d"status"]:checked').val();c.role="true"==a.find('input[name\x3d"role"]:checked').val()?!0:!1;c.all="true"==a.find('input[name\x3d"all"]:checked').val()?!0:!1;console.log(c);var e=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:isEmpty(b)?"post":"put",data:c,url:"/ln/link",dataType:"json",beforeSend:function(){},success:function(a){layer.close(e);a.success?(layer.msg(a.message+",1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout("window.location.reload();",1E3)):ajaxError(a)},error:function(a){layer.close(e);ajaxError(a)}})}}function getQueryPagingParams(){return{page_size:pageSize,current:currentIndex,total:totalPage,t:Math.random()}}function buildRow(a,b){var c='\x3ctr class\x3d"each-row" data-id\x3d"'+a.id+'" index\x3d"'+b+'"\x3e\x3ctd\x3e\x3cinput type\x3d"checkbox" /\x3e\x3c/td\x3e\x3ctd\x3e'+changeNotNullString(a.link)+"\x3c/td\x3e\x3ctd\x3e"+changeNotNullString(a.alias)+"\x3c/td\x3e\x3ctd\x3e"+changeNotNullString(a.order_)+"\x3c/td\x3e";if(isNotEmpty(a.roleOrPermissionCodes)){for(var d=a.roleOrPermissionCodes.split(","),c=c+"\x3ctd\x3e",e=0;e<d.length;e++)c+='\x3cspan class\x3d"label label-primary"\x3e'+d[e]+"\x3c/span\x3e";c+="\x3c/td\x3e"}else c+="\x3ctd\x3e\x3c/td\x3e";return c+="\x3ctd\x3e"+(1==a.status?"\u6b63\u5e38":"\u7981\u7528")+"\x3c/td\x3e\x3ctd\x3e"+(a.all_?"\u5168\u90e8\u5339\u914d":"\u4efb\u610f\u5339\u914d")+"\x3c/td\x3e\x3ctd\x3e"+(a.role?"\u89d2\u8272\u63a7\u5236":"\u6743\u9650\u63a7\u5236")+"\x3c/td\x3e\x3ctd\x3e"+a.create_time+'\x3c/td\x3e\x3ctd\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"showRoleOrPermissionList(this, '+a.role+","+a.id+');" style\x3d"margin-right: 10px;"\x3e\u5206\u914d\x3c/a\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"rowEditRole(this);" style\x3d"margin-right: 10px;"\x3e\u7f16\u8f91\x3c/a\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"rowDeleteRole(this);" style\x3d"margin-right: 10px;"\x3e\u5220\u9664\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e'};