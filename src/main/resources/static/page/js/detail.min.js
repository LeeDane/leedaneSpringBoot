layui.use(["layer"],function(){layer=layui.layer;isEmpty(bid)?layer.msg("\u6587\u7ae0\u4e0d\u5b58\u5728"):(getInfo(bid),getComments(bid),$container=$(".container"),$container.on("click",".reply-other-btn",function(){$(this).closest(".list-group").find(".reply-container").toggle("fast")}),$container.on("click",".delete-other-btn",function(){var a=$(this).closest(".comment-list").attr("data-id"),b=$(this).closest(".comment-list").attr("create-user-id");0<a&&0<b&&layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u8bc4\u8bba\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",dataType:"json",url:"/cm/comment?cid\x3d"+a+"\x26create_user_id\x3d"+b,beforeSend:function(){},success:function(b){layer.close(c);b.isSuccess?(layer.msg(b.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(b)},error:function(b){layer.close(c);ajaxError(b)}})},function(){})}),$(window).scroll(function(a){a=a||window.event;if(a.wheelDelta){if(0<a.wheelDelta)return}else if(a.detail&&0<a.detail)return;a=$(document.body).height();var b=$(window).scrollTop();.2>(a-winH-b)/winH&&!isLoad&&canLoadData&&(isLoad=!0,method="lowloading",getComments(bid))}))});var last_id=0,first_id=0,method="firstloading",comments,winH=$(window).height(),isLoad=!1,canLoadData=!0,$container;function getInfo(a){$.ajax({url:"/bg/blog/"+a+"?t\x3d"+Math.random(),dataType:"json",beforeSend:function(){},success:function(b){if(b.isSuccess&&0<b.message.length){var c=b.message[0];document.title=b.message[0].title;$("#b-title").html(changeNotNullString(c.title));$("#b-account").html(changeNotNullString(c.account));$("#b-account").attr("onclick","linkToMy("+c.create_user_id+")");$("#b-create-time").html("\u53d1\u8868\u4e8e:"+changeNotNullString(c.create_time));$("#b-read-time").html("\u9605\u8bfb:"+c.read_number);$("#b-comment-number").html("\u8bc4\u8bba:"+c.comment_number);$("#b-transmit-number").html("\u8f6c\u53d1:"+c.transmit_number);$("#b-zan-number").html("\u70b9\u8d5e:"+c.zan_number);$("#b-share-number").html("\u5206\u4eab:"+c.share_number);var a=c.keywords;if("undefined"!=typeof a&&0<a.length){$("#keywords").find("a").remove();for(var d=0;d<a.length;d++)$("#keywords").append('\x3ca href\x3d"/s?q\x3d'+a[d]+"\x26t\x3d"+Math.random()+'" target\x3d"_self" class\x3d"marginRight"\x3e'+a[d]+"\x3c/a\x3e")}d=c.tag;$("#tags").empty();if(isNotEmpty(d))for(a=d.split(","),d=0;d<a.length;d++)0==d?$("#tags").append('\x3cspan class\x3d"label label-default tag" style\x3d"font-size: 13px;"\x3e'+a[d]+"\x3c/span\x3e"):1==d?$("#tags").append('\x3cspan class\x3d"label label-primary tag" style\x3d"font-size: 13px;"\x3e'+a[d]+"\x3c/span\x3e"):$("#tags").append('\x3cspan class\x3d"label label-success tag" style\x3d"font-size: 13px;"\x3e'+a[d]+"\x3c/span\x3e");isNotEmpty(c.origin_link)&&isNotEmpty(c.source)&&"leedane"==c.source?$("#isOriginal").html('\x3cspan class\x3d"original"\x3e\u539f\x3c/span\x3e'):$("#isOriginal").html('\x3cspan class\x3d"original red"\x3e\u722c\x3c/span\x3e');c.is_recommend&&$("#isRecommed").html('\x3cspan class\x3d"original red"\x3e\u8350\x3c/span\x3e');$(".row-content").html(b.message[0].content)}else ajaxError(b)},error:function(b){ajaxError(b)}})}function getCommentsRequestParams(){var a=15;"firstloading"!=method&&(a=5);return{table_name:"t_blog",table_id:bid,showUserInfo:!0,pageSize:a,last_id:last_id,first_id:first_id,method:method,t:Math.random()}}function getComments(a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cm/comments?"+jsonToGetRequestParams(getCommentsRequestParams()),dataType:"json",beforeSend:function(){},success:function(c){layer.close(b);if(c.isSuccess){"firstloading"==method&&$(".comment-list").remove();if(0==c.message.length&&"firstloading"!=method){canLoadData=!1;layer.msg("\u5df2\u65e0\u66f4\u591a\u8bc4\u8bba\u6570\u636e");return}if("firstloading"==method){comments=c.message;for(var a=0;a<comments.length;a++)buildEachCommentRow(a,comments[a]),0==a&&(first_id=comments[a].id),a==comments.length-1&&(last_id=comments[a].id)}else for(var d=comments.length,a=0;a<c.message.length;a++)comments.push(c.message[a]),buildEachCommentRow(d+a,c.message[a]),a==c.message.length-1&&(last_id=c.message[a].id)}else ajaxError(c);isLoad=!1},error:function(a){isLoad=!1;layer.close(b);ajaxError(a)}})}function buildEachCommentRow(a,b){var c='\x3cdiv class\x3d"row comment-list comment-list-padding" data-id\x3d"'+b.id+'" create-user-id\x3d"'+b.create_user_id+'"\x3e\x3cdiv class\x3d"col-lg-1 col-md-1 col-sm-2 col-xs-2"\x3e\x3cimg src\x3d"'+changeNotNullString(b.user_pic_path)+'" width\x3d"40" height\x3d"40" class\x3d"img-rounded hand center-block"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-11 col-md-11 col-sm-10 col-xs-10"\x3e\x3cdiv class\x3d"list-group"\x3e\x3cdiv class\x3d"list-group-item comment-list-item active"\x3e\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"linkToMy('+b.create_user_id+')" target\x3d"_blank" class\x3d"marginRight"\x3e'+changeNotNullString(b.account)+'\x3c/a\x3e\x3cspan class\x3d"marginRight publish-time"\x3e\u53d1\u8868\u4e8e:'+changeNotNullString(b.create_time)+'\x3c/span\x3e\x3cspan class\x3d"marginRight publish-time"\x3e\u6765\u81ea:'+changeNotNullString(b.froms)+"\x3c/span\x3e\x3c/div\x3e",c=c+'\x3cdiv class\x3d"list-group-item comment-list-item"\x3e\x3cdiv class\x3d"row"\x3e';isNotEmpty(b.blockquote_content)&&(c+='\x3cdiv class\x3d"col-lg-12"\x3e\x3cblockquote\x3e'+b.blockquote_content,isNotEmpty(b.blockquote_account)&&(c+="\x3csmall\x3e\x3ccite\x3e"+b.blockquote_account+"\x3c/cite\x3e\x26nbsp;\x26nbsp;"+changeNotNullString(b.blockquote_time)+"\x3c/small\x3e"),c+="\x3c/blockquote\x3e\x3c/div\x3e");c+='\x3cdiv class\x3d"col-lg-12"\x3e'+changeNotNullString(b.content)+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";if(isLogin){c+='\x3cdiv class\x3d"list-group-item comment-list-item"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12 col-sm-12 col-md-12 col-xs-12 text-align-right"\x3e\x3cbutton class\x3d"btn btn-sm btn-primary btn-block pull-right reply-other-btn" style\x3d"width: 60px;" type\x3d"button"\x3e\u56de\u590dTA\x3c/button\x3e';if(isAdmin||b.create_user_id==loginUserId)c+='\x3cbutton class\x3d"btn btn-sm btn-primary pull-right delete-other-btn" style\x3d"width: 60px; margin-right: 5px;" type\x3d"button"\x3e\u5220\u9664\x3c/button\x3e';c+='\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12 reply-container" table-id\x3d"'+b.table_id+'" table-name\x3d"'+b.table_name+'" style\x3d"display: none;"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12"\x3e\x3cform class\x3d"form-signin" role\x3d"form"\x3e\x3cfieldset\x3e\x3ctextarea class\x3d"form-control reply-comment-text" placeholder\x3d"\u56de\u590dTA\uff0c\u6700\u591a250\u4e2a\u6587\u5b57\u3002"\x3e \x3c/textarea\x3e\x3c/fieldset\x3e\x3c/form\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-12 col-sm-12 col-md-12 col-xs-12 text-align-right" style\x3d"margin-top: 10px;"\x3e\x3cbutton class\x3d"btn btn-sm btn-info btn-block pull-right" style\x3d"width: 60px;" type\x3d"button" onclick\x3d"commentItem(this, '+b.id+", "+b.table_id+');"\x3e\u8bc4\u8bba\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}c+="\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";$(".container").append(c)}function commentItem(a,b,c){a=$(a).closest(".reply-container").find(".reply-comment-text").val();doAddComment({table_name:"t_blog",table_id:c,content:a,pid:b,froms:"web\u7aef",t:Math.random()})}function addComment(a){a=$("#comment").find('[name\x3d"add-comment"]');isEmpty(a.val())?(a.focus(),layer.msg("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a")):(a={table_name:"t_blog",table_id:bid,content:a.val(),froms:"web\u7aef",t:Math.random()},doAddComment(a))}function doAddComment(a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:a,url:"/cm/comment",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.isSuccess?(layer.msg("\u8bc4\u8bba\u6210\u529f,1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout("window.location.reload();",1E3)):layer.msg("\u6dfb\u52a0\u8bc4\u8bba\u5931\u8d25\uff0c"+a.message)},error:function(){layer.close(b);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})}function dd(){};