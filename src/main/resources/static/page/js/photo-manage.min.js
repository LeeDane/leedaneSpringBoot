var $model;$(function(){$(".navbar-nav .nav-main-li").each(function(){$(this).removeClass("active")});$(".nav-photo").addClass("active");$(".manage-to-gallery").on("click",function(){var a=$(".gallery-link").val();isEmpty(a)?(layer.msg("\u8bf7\u8f93\u5165\u56fe\u7247\u7684\u94fe\u63a5"),$(".gallery-link").focus()):isLink(a)?(a={id:photoId,category:categoryId,path:$(".gallery-link").val(),desc:$(".gallery-desc").val(),width:$(".gallery-width").val(),height:$(".gallery-height").val(),length:$(".gallery-length").val(),t:Math.random()},addLink(a)):(layer.msg("\u8be5\u56fe\u7247\u7684\u94fe\u63a5\u4e0d\u5408\u6cd5"),$(".gallery-link").focus())});$model=$("#manage-grallery");$("body").on("mouseover",".layui-table-main .laytable-cell-1-0-1",function(a){var b=$(this).html(),b="\x3cdiv id\x3d'imgTooltip'\x3e\x3cimg src\x3d'"+b+"' alt\x3d'"+b+"' width\x3d'180' height\x3d'180' /\x3e\x3c/div\x3e";$("body").append(b);$("#imgTooltip").css({top:a.pageY+20+"px",left:a.pageX+10+"px"}).show("fast")});$("body").on("mouseout",".layui-table-main .laytable-cell-1-0-1",function(a){$("#imgTooltip").remove()});$("body").on("mousemove",".layui-table-main .laytable-cell-1-0-1",function(a){$("#imgTooltip").css({top:a.pageY+20+"px",left:a.pageX+10+"px"})})});layui.use("table",function(){var a=layui.table;a.render({elem:"#test",url:"/gl/photos",title:"\u6570\u636e\u8868",cols:[[{field:"id",title:"ID",width:80,unresize:!0,sort:!0},{field:"path",title:"\u56fe\u7247\u8def\u5f84",width:600},{field:"format-length",title:"\u5927\u5c0f",width:80},{field:"height",title:"\u9ad8\u5ea6",width:80},{field:"width",title:"\u5bbd\u5ea6",width:80},{field:"gallery_desc",title:"\u63cf\u8ff0\u4fe1\u606f",width:120},{field:"category",title:"\u5206\u7c7b",width:120},{field:"modify_time",title:"\u6700\u540e\u4fee\u6539\u65f6\u95f4",width:120},{fixed:"right",title:"\u64cd\u4f5c",toolbar:"#barDemo",width:120}]],page:!0});a.on("tool(test)",function(a){var b=a.data;"del"===a.event?layer.confirm("\u771f\u7684\u5220\u9664\u884c\u4e48",function(a){var c=layer.load("\u52aa\u529b\u5220\u9664\u4e2d\u2026");$.ajax({type:"delete",url:"/gl/photo/"+b.id,dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.isSuccess?(layer.msg(a.message+",1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout("window.location.reload();",1E3)):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}):"edit"===a.event&&modelShow(b)})});function modelShow(a){$model.modal("show");a?(categoryId=a.category_id,photoId=a.id,$model.find("#myModalLabel").html("\u7f16\u8f91\u56fe\u5e93"),$model.find(".manage-to-gallery").text("\u7f16\u8f91"),$model.find(".gallery-link").val(a.path),$model.find(".gallery-desc").val(changeNotNullString(a.gallery_desc)),$model.find(".gallery-width").val(changeNotNullString(a.width)),$model.find(".gallery-height").val(changeNotNullString(a.height)),$model.find(".gallery-length").val(changeNotNullString(a.length)),$model.find(".gallery-category").val(changeNotNullString(a.category))):(photoId=categoryId=0,$model.find("#myModalLabel").html("\u6dfb\u52a0\u56fe\u5e93"),$model.find(".manage-to-gallery").text("\u6dfb\u52a0"),$model.find(".gallery-link").val(""),$model.find(".gallery-desc").val(""),$model.find(".gallery-width").val(""),$model.find(".gallery-height").val(""),$model.find(".gallery-length").val(""),$model.find(".gallery-category").val(""))}var photoId=0;function addLink(a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:a,url:"/gl/photo",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.isSuccess?(layer.msg(a.message),reloadPage(1E3)):(layer.msg(a.message),layer.close(b))},error:function(a){layer.close(b);ajaxError(a)}})}function afterSelectLink(a){isNotEmpty(a)&&($model.find(".gallery-width").val(""),$model.find(".gallery-height").val(""),$model.find(".gallery-length").val(""),$model.find(".gallery-link").val(a))}var categoryId=0;function afterSelectCategory(a,b){console.log(a+""+b);categoryId=a;$(".gallery-category").val(b);$(".gallery-desc").val("\u4ece\u7d20\u6750\u9009\u62e9");$("body").removeClass("modal-open")};