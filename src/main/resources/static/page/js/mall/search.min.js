var SEARCH_PRODUCT_PLATFORM,currentSort;layui.use(["form","laypage","layer"],function(){layer=layui.layer;var b=layui.element;laypage=layui.laypage;b.on("tab(resultTabBrief)",function(b){searchCurrentIndex=0;currentSort="";switch(b.index){case 0:SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51";doSearch();break;case 1:SEARCH_PRODUCT_PLATFORM="\u4eac\u4e1c";console.log(b.elem);doSearch();break;case 2:SEARCH_PRODUCT_PLATFORM="\u62fc\u591a\u591a",console.log(b.elem),doSearch()}});$(".common-search").remove();searchKey=getURLParam(decodeURI(window.location.href),"q");SEARCH_PRODUCT_PLATFORM=getURLParam(decodeURI(window.location.href),"platform");isEmpty(SEARCH_PRODUCT_PLATFORM)&&(SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51");$SearchContainer=$("#search-value");$SearchContainer.bind("input propertychange",function(){console.log($(this).val())});isNotEmpty(condition)&&(condition=JSON.parse(condition),buildSortConditionBtn());isEmpty(searchKey)?console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"):($SearchContainer.val(searchKey),doSearch(),initClipBoard())});var $SearchContainer,searchKey;function searchProductBtn(b,a){SEARCH_PRODUCT_PLATFORM=a;currentSort="";searchCurrentIndex=0;doSearch()}function doSearch(){$productContainer=$("#product-row-container");$productContainer.empty();searchKey=$SearchContainer.val();if(isEmpty(searchKey))console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"),layer.msg("\u8bf7\u5148\u8f93\u5165\u68c0\u7d22\u5b57\u6bb5");else{"\u6dd8\u5b9d\u7f51"==SEARCH_PRODUCT_PLATFORM?($("#li-tb-product").addClass("layui-this"),$("#li-jd-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this"),condition&&buildSortConditionBtn()):"\u4eac\u4e1c"==SEARCH_PRODUCT_PLATFORM?($("#li-jd-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this"),condition&&buildSortConditionBtn()):"\u62fc\u591a\u591a"==SEARCH_PRODUCT_PLATFORM&&($("#li-pdd-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-jd-product").removeClass("layui-this"),condition&&buildSortConditionBtn());var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026"),a="/mall/search/product?"+jsonToGetRequestParams(getRequestParams());$.ajax({type:"get",url:a,dataType:"json",beforeSend:function(){$productContainer.empty()},success:function(a){layer.close(b);$(".search-need-time").text(a.consumeTime);a.isSuccess&&isNotEmpty(a.message)?dealProductSearch(a.message.list,a.total,a.platform):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})}}function dealProductSearch(b,a,c){$productContainer.empty();products=b;if(0==b.length)0==searchCurrentIndex?$productContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$productContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(b=0;b<products.length;b++)buildEachSearchProductRow(b,products[b],c);0!=searchCurrentIndex||products&&0!=products.length?($("#tb-product-pager").css("padding","5px"),laypage.render({elem:"tb-product-pager",layout:["prev","page","next","count","skip"],count:a,limit:searchPageSize,curr:searchCurrentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(searchCurrentIndex=a.curr-1,doSearch())}})):($("#tb-product-pager").empty(),$("#tb-product-pager").css("padding","0"))}var searchPageSize=12,searchCurrentIndex=0,products,$productContainer;function getRequestParams(){return{sort:currentSort,platform:SEARCH_PRODUCT_PLATFORM,keyword:searchKey,current:searchCurrentIndex,rows:searchPageSize,t:Math.random()}}function buildEachSearchProductRow(b,a,c){b="";"\u6dd8\u5b9d\u7f51"==c||"\u5929\u732b"==c?b="tb_"+a.auctionId:"\u4eac\u4e1c"==c?b="jd_"+a.auctionId:"\u62fc\u591a\u591a"==c&&(b="pdd_"+a.auctionId);c='\x3cdiv class\x3d"layui-col-md3 layui-col-xs12 button_link" style\x3d"cursor: pointer;" onclick\x3d"toProductDetail(\''+b+'\');"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-product-item"\x3e\x3cimg alt\x3d"" src\x3d"'+a.img+'" class\x3d"m-product-item-img"/\x3e\t\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3cp style\x3d" margin-top: 6px;"\x3e\x3ca class\x3d"m-product-desc" title\x3d"'+changeNotNullString(a.title)+'"\x3e'+changeNotNullString(a.title)+"\x3c/a\x3e\x3c/p\x3e";0<a.couponAmount&&(c+='\x3cp style\x3d"margin-left: 5px; text-align: left;"\x3e\x3cspan class\x3d"coupon-discount"\x3e'+a.couponAmount+'\u5143\u5238\x3c/span\x3e\x3cspan class\x3d"coupon-left"\x3e\u5269'+a.couponLeftCount+"\u5f20\x3c/span\x3e\x3c/p\x3e");c+='\x3cp style\x3d"margin-left: 5px; text-align: left; margin-top: 6px;"\x3e\x3cspan style\x3d"font-size: 0.9em;"\x3e'+a.shopTitle+'\x3c/span\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3cspan class\x3d"m-product-price" style\x3d"float: right; margin-right: 8px;"\x3e\u00a5'+a.price+'\x3c/span\x3e\x3c/p\x3e\x3cp style\x3d"text-align: left; margin-top: 4px;"\x3e\x3cspan class\x3d"m-product-price" style\x3d"font-size: 1.0em;"\x3e\u6bd4\u7387\uff1a'+a.cashBackRatio+'%\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px; font-size: 1.0em;"\x3e\u9884\u4f30\u4f63\u91d1: \u00a5'+a.cashBack+'\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d"line line_top"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_right"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_bottom"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_left"\x3e\x3c/span\x3e\x3c/div\x3e';$productContainer.append(c)}function buildSortConditionBtn(){var b=condition.condition[SEARCH_PRODUCT_PLATFORM].sort;if(!currentSort||isEmpty(currentSort))currentSort=condition.condition[SEARCH_PRODUCT_PLATFORM]["default"];if(b&&0<b.length){for(var a="",c=0;c<b.length;c++){var f=!currentSort||currentSort!=b[c].desc&&currentSort!=b[c].asc?"layui-btn-warm":"",d="",e=isNotEmpty(b[c].desc)&&isNotEmpty(b[c].asc);currentSort&&e&&(d="\x26#xe61a;",currentSort==b[c].asc&&(d="\x26#xe619;"));a+='\x3cbutton class\x3d"layui-btn layui-btn-radius layui-btn-xs '+f+'" desc\x3d"true" index\x3d"'+c+'" onclick\x3d"sortClick(this);" style\x3d"height: 30px !important; line-height: 30px!important;"\x3e'+b[c].value+(e?'\x3ci class\x3d"layui-icon" style\x3d"margin-left: 5px;"\x3e'+d+"\x3c/i\x3e":"")+"\x3c/button\x3e"}$("#sort-btn-group").html(a)}return a}function sortClick(b){b=$(b);if(b.hasClass("layui-btn-warm")||!(1>b.find("i").length)){var a=parseInt(b.attr("index")),a=condition.condition[SEARCH_PRODUCT_PLATFORM].sort[a];b.hasClass("layui-btn-warm")?(currentSort=a.desc,isEmpty(currentSort)&&(currentSort=a.asc)):currentSort=currentSort==a.desc?a.asc:a.desc;searchCurrentIndex=0;doSearch()}};