var SEARCH_PRODUCT_PLATFORM,currentSort;layui.use(["form","laypage","layer"],function(){layer=layui.layer;var a=layui.element;laypage=layui.laypage;form=layui.form;form.on("submit(do-search-filter)",function(a){searchCurrentIndex=0;currentSort="";SEARCH_PRODUCT_PLATFORM=a.field.platform;isEmpty(SEARCH_PRODUCT_PLATFORM)&&(SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51");doSearch();return!1});a.on("tab(resultTabBrief)",function(a){searchCurrentIndex=0;currentSort="";switch(a.index){case 0:SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51";break;case 1:SEARCH_PRODUCT_PLATFORM="\u4eac\u4e1c";console.log(a.elem);break;case 2:SEARCH_PRODUCT_PLATFORM="\u62fc\u591a\u591a";console.log(a.elem);break;case 3:SEARCH_PRODUCT_PLATFORM="\u82cf\u5b81",console.log(a.elem)}$("select").val(SEARCH_PRODUCT_PLATFORM);form.render("select");doSearch()});$(".common-search").remove();searchKey=getURLParam(decodeURI(window.location.href),"q");SEARCH_PRODUCT_PLATFORM=getURLParam(decodeURI(window.location.href),"platform");isEmpty(SEARCH_PRODUCT_PLATFORM)?SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51":($("select").val(SEARCH_PRODUCT_PLATFORM),form.render("select"));$SearchContainer=$("#search-value");$SearchContainer.bind("input propertychange",function(){console.log($(this).val())});isNotEmpty(condition)&&(condition=JSON.parse(condition));isEmpty(searchKey)?(console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"),buildSortConditionBtn()):($SearchContainer.val(searchKey),doSearch(),initClipBoard())});var $SearchContainer,searchKey;function searchProductBtn(a,b){SEARCH_PRODUCT_PLATFORM=b;currentSort="";searchCurrentIndex=0;doSearch()}function doSearch(){$productContainer=$("#product-row-container");$productContainer.empty();searchKey=$SearchContainer.val();condition&&buildSortConditionBtn();if(isEmpty(searchKey))console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"),$("#search-value").focus(),layer.tips("\u8bf7\u5148\u8f93\u5165\u68c0\u7d22\u5b57\u6bb5","#search-value",{tips:[3,"#FFB800"],time:3E3});else{searchPageSize=12;"\u6dd8\u5b9d\u7f51"==SEARCH_PRODUCT_PLATFORM?($("#li-tb-product").addClass("layui-this"),$("#li-jd-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this"),$("#li-sn-product").removeClass("layui-this")):"\u4eac\u4e1c"==SEARCH_PRODUCT_PLATFORM?($("#li-jd-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this"),$("#li-sn-product").removeClass("layui-this")):"\u62fc\u591a\u591a"==SEARCH_PRODUCT_PLATFORM?($("#li-pdd-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-jd-product").removeClass("layui-this"),$("#li-sn-product").removeClass("layui-this")):"\u82cf\u5b81"==SEARCH_PRODUCT_PLATFORM&&(searchPageSize=8,$("#li-sn-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-jd-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this"));var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026"),b="/mall/search/product?"+jsonToGetRequestParams(getRequestParams());$.ajax({type:"get",url:b,dataType:"json",beforeSend:function(){$productContainer.empty()},success:function(b){layer.close(a);$(".search-need-time").text(b.consumeTime);b.isSuccess&&isNotEmpty(b.message)?dealProductSearch(b.message.list,b.total,b.platform):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}}function dealProductSearch(a,b,c){$productContainer.empty();products=a;if(0==a.length)0==searchCurrentIndex?$productContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$productContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(a=0;a<products.length;a++)buildEachSearchProductRow(a,products[a],c);"\u4eac\u4e1c"==SEARCH_PRODUCT_PLATFORM||"\u82cf\u5b81"==SEARCH_PRODUCT_PLATFORM?($("#product-pager").empty(),$("#product-pager").html('\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-sm" onclick\x3d"goPre();"\x3e\x3ci class\x3d"layui-icon"\x3e\ue603\x3c/i\x3e\u4e0a\u4e00\u9875('+searchCurrentIndex+')\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-sm" onclick\x3d"goAfter();" style\x3d"float: right;"\x3e\u4e0b\u4e00\u9875('+(searchCurrentIndex+2)+')\x3ci class\x3d"layui-icon"\x3e\ue602\x3c/i\x3e\x3c/button\x3e'),$("#product-pager").css("padding","10px")):($("#product-pager").css("padding","5px"),laypage.render({elem:"product-pager",layout:["prev","page","next","count","skip"],count:b,limit:searchPageSize,curr:searchCurrentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(searchCurrentIndex=a.curr-1,doSearch())}}))}var searchPageSize=12,searchCurrentIndex=0,products,$productContainer;function getRequestParams(){return{sort:currentSort,platform:SEARCH_PRODUCT_PLATFORM,keyword:searchKey,current:searchCurrentIndex,rows:searchPageSize,t:Math.random()}}function buildEachSearchProductRow(a,b,c){a='\x3cdiv class\x3d"layui-col-md3 layui-col-xs12 button_link" style\x3d"cursor: pointer;" onclick\x3d"toProductDetail(\''+b.clickId+'\');"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-product-item"\x3e\x3cimg alt\x3d"" src\x3d"'+b.img+'" class\x3d"m-product-item-img"/\x3e\t\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3cp style\x3d" margin-top: 6px;"\x3e\x3ca class\x3d"m-product-desc" title\x3d"'+changeNotNullString(b.title)+'"\x3e'+changeNotNullString(b.title)+"\x3c/a\x3e\x3c/p\x3e";a+='\x3cp style\x3d"margin-left: 5px; text-align: left; height: 18px;"\x3e';0<b.couponAmount&&(a+='\x3cspan class\x3d"coupon-discount"\x3e'+b.couponAmount+'\u5143\u5238\x3c/span\x3e\x3cspan class\x3d"coupon-left"\x3e\u5269'+b.couponLeftCount+"\u5f20\x3c/span\x3e");b.sales&&(a+='\x3cspan class\x3d"" style\x3d"float: right;margin-right: 8px;font-size: 12px;color: #999999;"\x3e'+b.sales+"\x3c/span\x3e");a=a+"\x3c/p\x3e"+('\x3cp style\x3d"margin-left: 5px; text-align: left; margin-top: 6px;"\x3e\x3cspan style\x3d"font-size: 0.9em;"\x3e'+b.shopTitle+'\x3c/span\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3cspan class\x3d"m-product-price" style\x3d"float: right; margin-right: 8px;"\x3e\u00a5'+b.price+'\x3c/span\x3e\x3c/p\x3e\x3cp style\x3d"text-align: left; margin-top: 4px;"\x3e\x3cspan class\x3d"m-product-price" style\x3d"font-size: 1.0em;"\x3e\u6bd4\u7387\uff1a'+b.cashBackRatio+'%\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px; font-size: 1.0em;"\x3e\u9884\u4f30\u4f63\u91d1: \u00a5'+b.cashBack+'\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d"line line_top"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_right"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_bottom"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_left"\x3e\x3c/span\x3e\x3c/div\x3e');$productContainer.append(a)}function buildSortConditionBtn(){if(condition.condition[SEARCH_PRODUCT_PLATFORM]){var a=condition.condition[SEARCH_PRODUCT_PLATFORM].sort;if(!currentSort||isEmpty(currentSort))currentSort=condition.condition[SEARCH_PRODUCT_PLATFORM]["default"];if(a&&0<a.length){for(var b="",c=0;c<a.length;c++){var f=!currentSort||currentSort!=a[c].desc&&currentSort!=a[c].asc?"layui-btn-warm":"",d="",e=isNotEmpty(a[c].desc)&&isNotEmpty(a[c].asc);currentSort&&e&&(d="\x26#xe61a;",currentSort==a[c].asc&&(d="\x26#xe619;"));b+='\x3cbutton class\x3d"layui-btn layui-btn-radius layui-btn-xs '+f+'" desc\x3d"true" index\x3d"'+c+'" onclick\x3d"sortClick(this);" style\x3d"height: 30px !important; line-height: 30px!important;"\x3e'+a[c].value+(e?'\x3ci class\x3d"layui-icon" style\x3d"margin-left: 5px;"\x3e'+d+"\x3c/i\x3e":"")+"\x3c/button\x3e"}$("#sort-btn-group").html(b)}return b}}function sortClick(a){a=$(a);if(a.hasClass("layui-btn-warm")||!(1>a.find("i").length)){var b=parseInt(a.attr("index")),b=condition.condition[SEARCH_PRODUCT_PLATFORM].sort[b];a.hasClass("layui-btn-warm")?(currentSort=b.desc,isEmpty(currentSort)&&(currentSort=b.asc)):currentSort=currentSort==b.desc?b.asc:b.desc;searchCurrentIndex=0;doSearch()}}function goPre(){0==searchCurrentIndex?layer.msg("\u6ca1\u6709\u4e0a\u4e00\u9875\u4e86\uff01"):(searchCurrentIndex--,doSearch())}function goAfter(){searchCurrentIndex++;doSearch()};