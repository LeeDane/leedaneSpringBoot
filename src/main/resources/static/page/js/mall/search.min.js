var SEARCH_TYPE_PRODUCT=5,SEARCH_TYPE_SHOP=4,SEARCH_TYPE_TAOBAO=6;layui.use(["form","laypage"],function(){layui.element.on("tab(resultTabBrief)",function(c){console.log(this);console.log(c.index);switch(c.index){case 0:preType=SEARCH_TYPE_PRODUCT;product_currentIndex=product_start=0;doSearch();break;case 1:preType=SEARCH_TYPE_SHOP;shop_currentIndex=shop_start=0;console.log(c.elem);doSearch();break;case 2:preType=SEARCH_TYPE_TAOBAO,taobao_currentIndex=taobao_start=0,console.log(c.elem),doSearch()}});laypage=layui.laypage;$(".common-search").remove();searchKey=getURLParam(decodeURI(window.location.href),"q");preType=getURLParam(decodeURI(window.location.href),"tp");$SearchContainer=$("input[name\x3d'shop-search-value']");$("input[name\x3d'shop-search-value']").bind("input propertychange",function(){console.log($(this).val())});isEmpty(searchKey)?console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"):($SearchContainer.val(searchKey),isEmpty(preType)||preType==SEARCH_TYPE_PRODUCT?(preType=SEARCH_TYPE_PRODUCT,$("#li-product").addClass("layui-this"),$("#li-shop").removeClass("layui-this"),$("#li-taobao").removeClass("layui-this"),$("#tab-content-product").addClass("layui-show"),$("#tab-content-shop").removeClass("layui-show"),$("#tab-content-taobao").removeClass("layui-show")):preType==SEARCH_TYPE_SHOP?(preType=SEARCH_TYPE_SHOP,$("#li-shop").addClass("layui-this"),$("#li-product").removeClass("layui-this"),$("#li-taobao").removeClass("layui-this"),$("#tab-content-shop").addClass("layui-show"),$("#tab-content-product").removeClass("layui-show"),$("#tab-content-taobao").removeClass("layui-show")):preType==SEARCH_TYPE_TAOBAO&&(preType=SEARCH_TYPE_TAOBAO,$("#li-taobao").addClass("layui-this"),$("#li-product").removeClass("layui-this"),$("#li-shop").removeClass("layui-this"),$("#tab-content-taobao").addClass("layui-show"),$("#tab-content-product").removeClass("layui-show"),$("#tab-content-shop").removeClass("layui-show")),doSearch(),initClipBoard())});var $SearchContainer,searchKey,preType=4;$(function(){});function searchShop(c,a){var b=$SearchContainer.val();isEmpty(b)?(layer.msg("\u8bf7\u8f93\u5165\u60a8\u8981\u641c\u7d22\u7684\u5185\u5bb9\uff01"),$SearchContainer.focus()):(searchKey=b,preType=a,isEmpty(preType)||preType==SEARCH_TYPE_PRODUCT?(preType=SEARCH_TYPE_PRODUCT,$("#li-product").addClass("layui-this"),$("#li-shop").removeClass("layui-this"),$("#li-taobao").removeClass("layui-this"),$("#tab-content-product").addClass("layui-show"),$("#tab-content-shop").removeClass("layui-show"),$("#tab-content-taobao").removeClass("layui-show")):preType==SEARCH_TYPE_SHOP?(preType=SEARCH_TYPE_SHOP,$("#li-shop").addClass("layui-this"),$("#li-product").removeClass("layui-this"),$("#li-taobao").removeClass("layui-this"),$("#tab-content-shop").addClass("layui-show"),$("#tab-content-product").removeClass("layui-show"),$("#tab-content-taobao").removeClass("layui-show")):preType==SEARCH_TYPE_TAOBAO&&(preType=SEARCH_TYPE_TAOBAO,$("#li-taobao").addClass("layui-this"),$("#li-product").removeClass("layui-this"),$("#li-shop").removeClass("layui-this"),$("#tab-content-taobao").addClass("layui-show"),$("#tab-content-product").removeClass("layui-show"),$("#tab-content-shop").removeClass("layui-show")),doSearch())}function doSearch(){var c="";SEARCH_TYPE_PRODUCT==preType?($productContainer=$("#product-row-container"),$productContainer.empty(),c="/s/s?"+jsonToGetRequestParams(getProductsRequestParams())):SEARCH_TYPE_SHOP==preType?($shopContainer=$("#shop-row-container"),$shopContainer.empty(),c="/s/s?"+jsonToGetRequestParams(getShopsRequestParams())):SEARCH_TYPE_TAOBAO==preType&&($taobaoContainer=$("#taobao-row-container"),$taobaoContainer.empty(),c="/mall/taobao/search?"+jsonToGetRequestParams(getTaobaosRequestParams()));var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"get",url:c,dataType:"json",beforeSend:function(){SEARCH_TYPE_PRODUCT==preType&&$productContainer.empty()},beforeSend:function(){},success:function(b){layer.close(a);$(".search-need-time").text(b.consumeTime);b.isSuccess&&isNotEmpty(b.message)?b.message[preType]?SEARCH_TYPE_PRODUCT==preType?dealProductSearch(b.message[preType],b.total):SEARCH_TYPE_SHOP==preType&&dealShopSearch(b.message[preType],b.total):SEARCH_TYPE_TAOBAO==preType&&dealTaobaoSearch(b.message.list,b.total):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}function dealProductSearch(c,a){$productContainer.empty();products=c;if(0==c.length)0==product_currentIndex?$productContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$productContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(var b=0;b<products.length;b++)buildEachSearchProductRow(b,products[b]);0!=product_currentIndex||products&&0!=products.length?($("#product-pager").css("padding","5px"),laypage.render({elem:"product-pager",layout:["prev","page","next","count","skip"],count:a[preType],limit:product_pageSize,curr:product_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(product_currentIndex=a.curr-1,doSearch())}})):($("#product-pager").empty(),$("#product-pager").css("padding","0"))}var product_pageSize=3,product_start=0,product_currentIndex=0,product_totalPage=0,products,$productContainer,product_sort="createTime",product_sort_desc=!0;function getProductsRequestParams(){return{keyword:searchKey,sort:product_sort,desc:product_sort_desc,start:product_currentIndex*product_pageSize,current:product_currentIndex,type:preType,rows:product_pageSize,t:Math.random()}}function buildEachSearchProductRow(c,a){var b='\x3cdiv class\x3d"layui-col-md4 layui-col-xs12"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-product-item"\x3e\x3cimg alt\x3d"" src\x3d"'+a.mainImgLinks.split(";")[0]+'" class\x3d"m-product-item-img"/\x3e\t\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3ca class\x3d"m-product-desc" href\x3d"/mall/product/'+a.id+'/detail" title\x3d"'+changeNotNullString(a.title)+'"\x3e'+changeNotNullString(a.title)+'\x3c/a\x3e\x3cp style\x3d"text-align: left;"\x3e\x3cspan class\x3d"m-product-price"\x3e\u00a5'+a.price+'\x3c/span\x3e \x3cspan style\x3d"float: right; margin-right: 8px; text-decoration: line-through; font-size: 0.6em;"\x3e\u539f\u4ef7: \u00a5'+a.oldPrice+'\x3c/span\x3e\x3c/p\x3e\x3cp style\x3d"text-align: left;"\x3e\x3cspan class\x3d"m-product-price" style\x3d"font-size: 1.0em;"\x3e\u6bd4\u7387\uff1a'+a.cashBackRatio+'%\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px; font-size: 1.0em;"\x3e\u4f63\u91d1: \u00a5'+(a.price*a.cashBackRatio/100).toFixed(2)+"\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";$productContainer.append(b)}function productTimeSort(c){}function productPriceSort(c){}function dealShopSearch(c,a){$shopContainer.empty();shops=c;if(0==c.length)0==shop_currentIndex?$shopContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$shopContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(var b=0;b<shops.length;b++)buildEachSearchShopRow(b,shops[b]);0!=shop_currentIndex||shops&&0!=shops.length?($("#shop-pager").css("padding","5px"),laypage.render({elem:"shop-pager",layout:["prev","page","next","count","skip"],count:a[preType],limit:shop_pageSize,curr:shop_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(shop_currentIndex=a.curr-1,doSearch())}})):($("#shop-pager").empty(),$("#shop-pager").css("padding","0"))}var shop_pageSize=3,shop_start=0,shop_currentIndex=0,shop_totalPage=0,shops,$shopContainer;function getShopsRequestParams(){return{keyword:searchKey,start:shop_currentIndex*shop_pageSize,current:shop_currentIndex,type:preType,rows:shop_pageSize,t:Math.random()}}function buildEachSearchShopRow(c,a){$shopContainer.append('\x3cdiv class\x3d"layui-col-md4 layui-col-xs12"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-product-item"\x3e\x3cimg alt\x3d"" src\x3d"'+a.img+'" class\x3d"m-product-item-img" style\x3d""/\x3e\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3ca class\x3d"m-product-desc" href\x3d"/shop/'+a.id+'" title\x3d"'+a.name+'" style\x3d"margin-left: 0px!important; margin-top: 10px;"\x3e'+a.name+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e")}function dealTaobaoSearch(c,a){$taobaoContainer.empty();taobaos=c;if(0==c.length)0==taobao_currentIndex?$taobaoContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$taobaoContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(var b=0;b<taobaos.length;b++)buildEachSearchTaobaoRow(b,taobaos[b]);0!=taobao_currentIndex||taobaos&&0!=taobaos.length?($("#taobao-pager").css("padding","5px"),laypage.render({elem:"taobao-pager",layout:["prev","page","next","count","skip"],count:a,limit:taobao_pageSize,curr:taobao_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(taobao_currentIndex=a.curr-1,doSearch())}})):($("#taobao-pager").empty(),$("#taobao-pager").css("padding","0"))}var taobao_pageSize=12,taobao_start=0,taobao_currentIndex=0,taobao_totalPage=0,taobaos,$taobaoContainer;function getTaobaosRequestParams(){return{keyword:searchKey,current:taobao_currentIndex,type:preType,rows:taobao_pageSize,t:Math.random()}}function buildEachSearchTaobaoRow(c,a){var b='\x3cdiv class\x3d"layui-col-md4 layui-col-xs12" style\x3d"cursor: pointer;" onclick\x3d"buildShareLink('+a.auctionId+');"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-taobao-item"\x3e\x3cimg alt\x3d"" src\x3d"'+a.img+'" class\x3d"m-product-item-img"/\x3e\t\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3ca class\x3d"m-product-desc" title\x3d"'+changeNotNullString(a.title)+'"\x3e'+changeNotNullString(a.title)+"\x3c/a\x3e";0<a.couponAmount&&(b+='\x3cp style\x3d"margin-left: 5px; text-align: left;"\x3e\u4f18\u60e0\uff1a\x3cspan style\x3d"color: red;"\x3e'+a.couponAmount+'\x3c/span\x3e\u5143\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px;"\x3e\u5269\u4f59\uff1a'+a.couponLeftCount+"\x3c/span\x3e\x3c/p\x3e");b+='\x3cp style\x3d"margin-left: 5px; text-align: left;"\x3e\x3cspan style\x3d"font-size: 0.8em;"\x3e'+a.shopTitle+'\x3c/span\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3cspan class\x3d"m-product-price" style\x3d"float: right; margin-right: 8px;"\x3e\u00a5'+a.price+'\x3c/span\x3e\x3c/p\x3e\x3cp style\x3d"text-align: left;"\x3e\x3cspan class\x3d"m-product-price" style\x3d"font-size: 1.0em;"\x3e\u6bd4\u7387\uff1a'+a.cashBackRatio+'%\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px; font-size: 1.0em;"\x3e\u4f63\u91d1: \u00a5'+(a.price*a.cashBackRatio/100).toFixed(2)+"\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";$taobaoContainer.append(b)};