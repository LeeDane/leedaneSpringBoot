var SEARCH_PRODUCT_PLATFORM;layui.use(["form","laypage","layer"],function(){layer=layui.layer;var c=layui.element;laypage=layui.laypage;c.on("tab(resultTabBrief)",function(a){console.log(this);console.log(a.index);tb_product_currentIndex=tb_product_start=0;switch(a.index){case 0:SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51";doSearch();break;case 1:SEARCH_PRODUCT_PLATFORM="\u4eac\u4e1c";console.log(a.elem);doSearch();break;case 2:SEARCH_PRODUCT_PLATFORM="\u62fc\u591a\u591a",console.log(a.elem),doSearch()}});$(".common-search").remove();searchKey=getURLParam(decodeURI(window.location.href),"q");SEARCH_PRODUCT_PLATFORM=getURLParam(decodeURI(window.location.href),"platform");$SearchContainer=$("#search-value");$SearchContainer.bind("input propertychange",function(){console.log($(this).val())});isEmpty(searchKey)?console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"):($SearchContainer.val(searchKey),isEmpty(SEARCH_PRODUCT_PLATFORM)&&(SEARCH_PRODUCT_PLATFORM="\u6dd8\u5b9d\u7f51"),doSearch(),initClipBoard())});var $SearchContainer,searchKey;$(function(){});function searchProductBtn(c,a){searchKey=$SearchContainer.val();SEARCH_PRODUCT_PLATFORM=a;doSearch()}function doSearch(){$taobaoProductContainer=$("#tb-product-row-container");$taobaoProductContainer.empty();if(isEmpty(searchKey))console.log("\u83b7\u53d6\u4e0d\u5230\u60a8\u8981\u68c0\u7d22\u7684\u5173\u952e\u5b57\uff01"),layer.msg("\u8bf7\u5148\u8f93\u5165\u68c0\u7d22\u5b57\u6bb5");else{var c="/mall/search/product?"+jsonToGetRequestParams(getTaobaosRequestParams());"\u6dd8\u5b9d\u7f51"==SEARCH_PRODUCT_PLATFORM?($("#li-tb-product").addClass("layui-this"),$("#li-jd-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this")):"\u4eac\u4e1c"==SEARCH_PRODUCT_PLATFORM?($("#li-jd-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-pdd-product").removeClass("layui-this")):"\u62fc\u591a\u591a"==SEARCH_PRODUCT_PLATFORM&&($("#li-pdd-product").addClass("layui-this"),$("#li-tb-product").removeClass("layui-this"),$("#li-jd-product").removeClass("layui-this"));var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"get",url:c,dataType:"json",beforeSend:function(){$taobaoProductContainer.empty()},success:function(b){layer.close(a);$(".search-need-time").text(b.consumeTime);b.isSuccess&&isNotEmpty(b.message)?dealTaobaoProductSearch(b.message.list,b.total,b.platform):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}}function dealTaobaoProductSearch(c,a,b){$taobaoProductContainer.empty();taobaos=c;if(0==c.length)0==tb_product_currentIndex?$taobaoProductContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$taobaoProductContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(c=0;c<taobaos.length;c++)buildEachSearchTaobaoProductRow(c,taobaos[c],b);0!=tb_product_currentIndex||taobaos&&0!=taobaos.length?($("#tb-product-pager").css("padding","5px"),laypage.render({elem:"tb-product-pager",layout:["prev","page","next","count","skip"],count:a,limit:taobao_pageSize,curr:tb_product_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(tb_product_currentIndex=a.curr-1,doSearch())}})):($("#tb-product-pager").empty(),$("#tb-product-pager").css("padding","0"))}var taobao_pageSize=12,taobao_start=0,tb_product_currentIndex=0,taobao_totalPage=0,taobaos,$taobaoProductContainer;function getTaobaosRequestParams(){return{platform:SEARCH_PRODUCT_PLATFORM,keyword:searchKey,current:tb_product_currentIndex,rows:taobao_pageSize,t:Math.random()}}function buildEachSearchTaobaoProductRow(c,a,b){c="";"\u6dd8\u5b9d\u7f51"==b||"\u5929\u732b"==b?c="tb_"+a.auctionId:"\u4eac\u4e1c"==b?c="jd_"+a.auctionId:"\u62fc\u591a\u591a"==b&&(c="pdd_"+a.auctionId);b='\x3cdiv class\x3d"layui-col-md3 layui-col-xs12 button_link" style\x3d"cursor: pointer;" onclick\x3d"toProductDetail(\''+c+'\');"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-taobao-item"\x3e\x3cimg alt\x3d"" src\x3d"'+a.img+'" class\x3d"m-product-item-img"/\x3e\t\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3cp style\x3d" margin-top: 6px;"\x3e\x3ca class\x3d"m-product-desc" title\x3d"'+changeNotNullString(a.title)+'"\x3e'+changeNotNullString(a.title)+"\x3c/a\x3e\x3c/p\x3e";0<a.couponAmount&&(b+='\x3cp style\x3d"margin-left: 5px; text-align: left;"\x3e\x3cspan class\x3d"coupon-discount"\x3e'+a.couponAmount+'\u5143\u5238\x3c/span\x3e\x3cspan class\x3d"coupon-left"\x3e\u5269'+a.couponLeftCount+"\u5f20\x3c/span\x3e\x3c/p\x3e");b+='\x3cp style\x3d"margin-left: 5px; text-align: left; margin-top: 6px;"\x3e\x3cspan style\x3d"font-size: 0.9em;"\x3e'+a.shopTitle+'\x3c/span\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3cspan class\x3d"m-product-price" style\x3d"float: right; margin-right: 8px;"\x3e\u00a5'+a.price+'\x3c/span\x3e\x3c/p\x3e\x3cp style\x3d"text-align: left; margin-top: 4px;"\x3e\x3cspan class\x3d"m-product-price" style\x3d"font-size: 1.0em;"\x3e\u6bd4\u7387\uff1a'+a.cashBackRatio+'%\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px; font-size: 1.0em;"\x3e\u9884\u4f30\u4f63\u91d1: \u00a5'+a.cashBack+'\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d"line line_top"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_right"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_bottom"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_left"\x3e\x3c/span\x3e\x3c/div\x3e';$taobaoProductContainer.append(b)};