layui.use(["carousel","form","laypage","laydate","layer"],function(){var c=layui.carousel,a=layui.form;a.on("submit(do-search-filter)",function(a){var b=$("#search-value");if(isEmpty(b.val()))return d.tips("\u8bf7\u5148\u8f93\u5165\u68c0\u7d22\u5b57\u6bb5","#search-value",{tips:[3,"#FFB800"],time:3E3}),b.focus(),!1;a=a.field.platform;isEmpty(a)&&(a="\u6dd8\u5b9d\u7f51");window.open("/mall/s?q\x3d"+b.val()+"\x26platform\x3d"+a,"_blank");return!1});var b=$("#detail-info-contrainer").height();$("#images-carousel-contrainer").find(".carousel-img").css("height",b+"px");c.render({elem:"#images-carousel-contrainer",width:"100%",height:b+"px",interval:5E3});var d=layui.layer,c=layui.laydate;(new Date).Format("yyyy-MM-dd");var b=(new Date((new Date).getTime()-864E5)).Format("yyyy-MM-dd"),e=(new Date((new Date).getTime()-2592E6)).Format("yyyy-MM-dd"),f=(new Date((new Date).getTime()-1728E5)).Format("yyyy-MM-dd"),g=(new Date((new Date).getTime()-26784E5)).Format("yyyy-MM-dd");c.render({elem:"#startDate",isToday:!1,isclear:!1,min:g,max:f,ready:function(a){$(".laydate-btns-now").remove()}});c.render({elem:"#endDate",istoday:!1,min:e,max:b,ready:function(a){$(".laydate-btns-now").remove()}});layui.element.on("tab(docDemoTabBrief)",function(a){console.log(this);console.log(a.index);switch($(this).data("id")){case "base-detail":resetParticlesHeight();getBigField();break;case "comment":getComments();break;case "big-event":console.log(a.elem);getBigEvents();break;case "graph":myChart=echarts.init(document.getElementById("main"));doStatistics($("#startDate").val(),$("#endDate").val());resetParticlesHeight();break;case 4:resetParticlesHeight()}});a.on("submit(search-statistics-form-submit)",function(a){a=$("#startDate").val();var b=$("#endDate").val();doStatistics(a,b);return!1});$("#longLinkTip").hover(function(){openTipMsg("#longLinkTip","1\u3001\u8bf7\u52ff\u5c06\u6b64\u63a8\u5e7f\u94fe\u63a5\u6253\u5f00\u540e\u518d\u53d1\u9001\u7ed9\u7528\u6237\uff0c\u5426\u5219\u65e0\u6cd5\u8ddf\u8e2a\u3002\x3cbr/\x3e2\u3001\u82e5\u8ba2\u5355\u4f7f\u7528\u7ea2\u5305\u6216\u8d2d\u7269\u5238\u540e\u4f63\u91d1\u6709\u53ef\u80fd\u652f\u4ed8\u7ed9\u7ea2\u5305\u63a8\u5e7f\u8005\uff0c\u5982\u60a8\u662f\u81ea\u63a8\u81ea\u4e70\uff0c\u8bf7\u52ff\u4f7f\u7528\u4ed6\u4eba\u5206\u4eab\u7684\u7ea2\u5305\u53ca\u8d2d\u7269\u5238\u3002\u7ea2\u5305\u63a8\u5e7f\u662f\u4ec0\u4e48\uff1f\x3cbr/\x3ePs:\u5f53\u9762\u4ed8\u3001\u706b\u8f66\u7968\u6216\u8005\u7406\u8d22\u4fdd\u9669\u7c7b\u5546\u54c1\u4e0d\u652f\u6301\u4f63\u91d1\x3cbr/\x3e",4)},function(){d.close(subtips)});$("#shortLinkTip").hover(function(){openTipMsg("#shortLinkTip","1\u3001\u6709\u6548\u671f\uff1a300\u5929\uff0c\u8fc7\u671f\u5931\u6548\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u3002\x3cbr/\x3e2\u3001\u8bf7\u52ff\u5c06\u6b64\u63a8\u5e7f\u94fe\u63a5\u6253\u5f00\u540e\u518d\u53d1\u9001\u7ed9\u7528\u6237\uff0c\u5426\u5219\u65e0\u6cd5\u8ddf\u8e2a\u3002\x3cbr/\x3e3\u3001\u82e5\u8ba2\u5355\u4f7f\u7528\u7ea2\u5305\u6216\u8d2d\u7269\u5238\u540e\u4f63\u91d1\u6709\u53ef\u80fd\u652f\u4ed8\u7ed9\u7ea2\u5305\u63a8\u5e7f\u8005\uff0c\u5982\u60a8\u662f\u81ea\u63a8\u81ea\u4e70\uff0c\u8bf7\u52ff\u4f7f\u7528\u4ed6\u4eba\u5206\u4eab\u7684\u7ea2\u5305\u53ca\u8d2d\u7269\u5238\u3002\u7ea2\u5305\u63a8\u5e7f\u662f\u4ec0\u4e48\uff1f\x3cbr/\x3ePs:\u5f53\u9762\u4ed8\u3001\u706b\u8f66\u7968\u6216\u8005\u7406\u8d22\u4fdd\u9669\u7c7b\u5546\u54c1\u4e0d\u652f\u6301\u4f63\u91d1\x3cbr/\x3e",4)},function(){d.close(subtips)});$("#koulingLinkTip").hover(function(){openTipMsg("#koulingLinkTip","1\u3001\u6709\u6548\u671f\uff1a30\u5929\uff0c\u8fc7\u671f\u5931\u6548\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u3002\x3cbr/\x3e2\u3001\u82e5\u8ba2\u5355\u4f7f\u7528\u7ea2\u5305\u6216\u8d2d\u7269\u5238\u540e\u4f63\u91d1\u6709\u53ef\u80fd\u652f\u4ed8\u7ed9\u7ea2\u5305\u63a8\u5e7f\u8005\uff0c\u5982\u60a8\u662f\u81ea\u63a8\u81ea\u4e70\uff0c\u8bf7\u52ff\u4f7f\u7528\u4ed6\u4eba\u5206\u4eab\u7684\u7ea2\u5305\u53ca\u8d2d\u7269\u5238\u3002\u7ea2\u5305\u63a8\u5e7f\u662f\u4ec0\u4e48\uff1f\x3cbr/\x3ePs:\u5f53\u9762\u4ed8\u3001\u706b\u8f66\u7968\u6216\u8005\u7406\u8d22\u4fdd\u9669\u7c7b\u5546\u54c1\u4e0d\u652f\u6301\u4f63\u91d1\x3cbr/\x3e",4)},function(){d.close(subtips)});$("#qrcodeTip").hover(function(){openTipMsg("#qrcodeTip","1\u3001\u6709\u6548\u671f\uff1a300\u5929\uff0c\u8fc7\u671f\u5931\u6548\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u3002\x3cbr/\x3e2\u3001\u82e5\u8ba2\u5355\u4f7f\u7528\u7ea2\u5305\u6216\u8d2d\u7269\u5238\u540e\u4f63\u91d1\u6709\u53ef\u80fd\u652f\u4ed8\u7ed9\u7ea2\u5305\u63a8\u5e7f\u8005\uff0c\u5982\u60a8\u662f\u81ea\u63a8\u81ea\u4e70\uff0c\u8bf7\u52ff\u4f7f\u7528\u4ed6\u4eba\u5206\u4eab\u7684\u7ea2\u5305\u53ca\u8d2d\u7269\u5238\u3002\u7ea2\u5305\u63a8\u5e7f\u662f\u4ec0\u4e48\uff1f\x3cbr/\x3ePs:\u5f53\u9762\u4ed8\u3001\u706b\u8f66\u7968\u6216\u8005\u7406\u8d22\u4fdd\u9669\u7c7b\u5546\u54c1\u4e0d\u652f\u6301\u4f63\u91d1\x3cbr/\x3e",4)},function(){d.close(subtips)});laypage=layui.laypage;doRecommend();getShareLinks();initClipBoard()});var $container,$commentContainer,$recommendContainer,laypage;$(function(){$bigEventContainer=$(".big-event-container");$container=$(".layui-container");$container.on("click",".reply-other-btn",function(){$(this).closest(".reply-group").find(".reply-container").toggle("fast")});$commentContainer=$("#comment-list-container");$recommendContainer=$("#recommend-container")});function getBigField(){if(isNotEmpty(productDetail))$("#bigfield-contrainer").html(productDetail);else{var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{productUrl:productUrl,couponUrl:couponUrl,title:productTitle},url:"/mall/search/"+productSourceId+"/bigfield",dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.success?$("#bigfield-contrainer").html(a.message):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}}function getShareLinks(){if(isEmpty(productUrl)||isEmpty(productTitle))console.log("\u7a7a\u7684productUrl\u6216\u8005productTitle\uff0c\u65e0\u6cd5\u6267\u884c\u83b7\u53d6\u5171\u4eab\u94fe\u63a5");else{var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{productUrl:productUrl,couponUrl:couponUrl,title:productTitle},url:"/mall/tool/link/transform/"+productSourceId,dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);if(a.success){a=a.message;var b=productSourceId.indexOf("tb_");0==b&&($("#taobao-links").show(),$("#longLink").val(productUrl),isNotEmpty(couponUrl)&&($(".longCouponLink-contrainer").show(),$("#longCouponLink").val(couponUrl)),isNotEmpty(a.shortLinkUrl)&&($(".shortLink-contrainer").show(),$("#shortLink").val(a.shortLinkUrl)),isNotEmpty(a.couponShortLinkUrl)&&($(".shortCouponLink-contrainer").show(),$("#shortCouponLink").val(a.couponShortLinkUrl)),isNotEmpty(a.taoToken)&&($(".koulingLink-contrainer").show(),$("#koulingLink").val(a.taoToken)),isNotEmpty(a.couponLinkTaoToken)&&($(".koulingCouponLink-contrainer").show(),$("#koulingCouponLink").val(a.couponLinkTaoToken)),isNotEmpty(a.qrCodeUrl)&&($(".qrCode-contrainer").show(),$("#qrCode").attr("src",a.qrCodeUrl)),isNotEmpty(a.qrCouponCodeUrl)&&($(".qrCouponCode-contrainer").show(),$("#qrCouponCode").attr("src",a.qrCouponCodeUrl)));b=productSourceId.indexOf("jd_");0==b&&($("#jingdong-links").show(),$("#longJDLink").val(productUrl),isNotEmpty(couponUrl)&&($(".longCouponLink-contrainer").show(),$("#longJDCouponLink").val(couponUrl)),isNotEmpty(a.shortLinkUrl)&&($(".shortLink-contrainer").show(),$("#shortJDLink").val(a.shortLinkUrl)),isNotEmpty(a.couponShortLinkUrl)&&($(".shortCouponLink-contrainer").show(),$("#shortJDCouponLink").val(a.couponShortLinkUrl)));b=productSourceId.indexOf("pdd_");0==b&&($("#pdd-links").show(),$("#longPDDLink").val(productUrl),isNotEmpty(couponUrl)&&($(".longCouponLink-contrainer").show(),$("#longPDDCouponLink").val(couponUrl)),isNotEmpty(a.shortLinkUrl)&&($(".shortLink-contrainer").show(),$("#shortPDDLink").val(a.shortLinkUrl)),isNotEmpty(a.couponShortLinkUrl)&&($(".shortCouponLink-contrainer").show(),$("#shortPDDCouponLink").val(a.couponShortLinkUrl)))}else ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}}function openThirdLink(c){var a=$(c).parent().find("input").val();isEmpty(a)?(c=$(c).parent().find("input").attr("id"),layer.tips("\u94fe\u63a5\u4e3a\u7a7a\u3002","#"+c,{time:2E3,tips:[1,"#FF5722"]})):openLink(a)}function doRecommend(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"GET",url:"/mall/search/product/"+productSourceId+"/recommend",dataType:"json",beforeSend:function(){$recommendContainer.empty()},success:function(a){layer.close(c);if(a.success)for(var b=0;b<a.message.length;b++)$recommendContainer.append(buildRecommendRow(b,a.message[b]));resetParticlesHeight()},error:function(a){layer.close(c);ajaxError(a)}})}function buildRecommendRow(c,a){return'\x3cdiv class\x3d"layui-col-md2 layui-col-xs12 m-product-item button_link" style\x3d"cursor: pointer;"  onclick\x3d"toProductDetail(\''+a.clickId+'\');"\x3e\x3cimg alt\x3d"" src\x3d"'+a.img+'" class\x3d"m-product-item-img"/\x3e\x3cdiv class\x3d"m-product-contrainer"\x3e\x3ca class\x3d"m-product-desc"\x3e'+a.title+'\x3c/a\x3e\x3cp\x3e\x3cspan class\x3d"m-product-price"\x3e\u00a5'+a.price+'\x3c/span\x3e\x3cspan style\x3d"text-decoration: line-through; font-size: 0.6em;"\x3e\u539f\u4ef7: \u00a5'+a.oldPrice+"\x3c/span\x3e\x3c/p\x3e\x3ch6\x3e\u5e97\u94fa: "+a.shopTitle+'\x3c/h6\x3e\x3c/div\x3e\x3cspan class\x3d"line line_top"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_right"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_bottom"\x3e\x3c/span\x3e\x3cspan class\x3d"line line_left"\x3e\x3c/span\x3e\x3c/div\x3e'}function searchProduct(c,a){var b=$("input[name\x3d'shop-search-value']");isEmpty(b.val())?(layer.msg("\u8bf7\u5148\u8f93\u5165\u68c0\u7d22\u7684\u5185\u5bb9\uff01"),b.focus()):window.open("/mall/s?q\x3d"+b.val()+"\x26platform\x3d"+a,"_blank")}function addWish(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{product_id:productId},url:"/mall/wish",dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);b.success?(layer.msg(b.message+"\uff0c1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}var $bigEventContainer,bigEvents,bigEvent_pageSize=100,bigEvent_currentIndex=0,bigEvent_totalPage=0;function getBigEvents(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/mall/product/"+productId+"/bigEvents?"+jsonToGetRequestParams(getBigEventsRequestParams()),dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);$bigEventContainer.empty();if(a.success){bigEvents=a.message;if(0==bigEvents.length){0==bigEvent_currentIndex?$bigEventContainer.append("\u8fd8\u6ca1\u6709\u5927\u4e8b\u4ef6\uff01"):$bigEventContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5927\u4e8b\u4ef6\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");return}for(a=0;a<bigEvents.length;a++)$bigEventContainer.append(buildBigEventRow(a,bigEvents[a]))}else ajaxError(a);isLoad=!1;resetParticlesHeight()},error:function(a){isLoad=!1;layer.close(c);ajaxError(a)}})}function buildBigEventRow(c,a){return'\x3cli class\x3d"layui-timeline-item"\x3e\x3ci class\x3d"layui-icon layui-timeline-axis"\x3e\ue63f\x3c/i\x3e\x3cdiv class\x3d"layui-timeline-content layui-text"\x3e\x3ch3 class\x3d"layui-timeline-title"\x3e'+a.create_time+"\x3c/h3\x3e\x3cp\x3e"+a.text+"\x3c/p\x3e\x3c/div\x3e\x3c/li\x3e"}function getBigEventsRequestParams(){return{page_size:bigEvent_pageSize,current:bigEvent_currentIndex,total:bigEvent_totalPage,t:Math.random()}}var comment_pageSize=10,comment_currentIndex=0,comment_totalPage=0,comments;function getCommentsRequestParams(){return{format_time:!0,current:comment_currentIndex,total:comment_totalPage,table_name:"t_mall_product",table_id:productId,showUserInfo:!0,page_size:comment_pageSize,t:Math.random()}}function getComments(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cm/comments/paging?"+jsonToGetRequestParams(getCommentsRequestParams()),dataType:"json",beforeSend:function(){$commentContainer.empty()},success:function(b){layer.close(a);if(b.success){comments=b.message;if(0==b.message.length)0==comment_currentIndex?$commentContainer.append("\u8fd8\u6ca1\u6709\u53d1\u8868\u8fc7\u4efb\u4f55\u8bc4\u8bba\uff0c\u8bf7\u7ed9TA\u8bc4\u8bba\u5427\uff01"):$commentContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u8bc4\u8bba\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(var c=0;c<comments.length;c++)buildEachCommentRow(c,comments[c]);0!=comment_currentIndex||comments&&0!=comments.length?($("#comment-pager").css("padding","5px"),laypage.render({elem:"comment-pager",layout:["prev","page","next","count","skip"],count:b.total,limit:comment_pageSize,curr:comment_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(comment_currentIndex=a.curr-1,getComments())}})):($("#comment-pager").empty(),$("#comment-pager").css("padding","0"))}else ajaxError(b);resetParticlesHeight()},error:function(b){layer.close(a);ajaxError(b)}})}function buildEachCommentRow(c,a){var b='\x3cdiv class\x3d"layui-row"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12"\x3e\x3cdiv\x3e\x3cimg alt\x3d"" src\x3d"'+a.user_pic_path+'" style\x3d"width: 25px; height: 25px;" /\x3e\x26nbsp;\x26nbsp;\x3ca\x3e'+a.account+'\x3c/a\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"font-size: 11px;"\x3e'+a.create_time+"\x3c/span\x3e";isNotEmpty(a.blockquote_content)&&(b+='\x3cblockquote class\x3d"layui-elem-quote layui-quote-nm" style\x3d"margin-top: 5px; margin-left: 30px;"\x3e'+a.blockquote_content+"\x3cbr /\x3e\u2014\u2014"+a.blockquote_account+'\x26nbsp;\x26nbsp;\x3cspan style\x3d"font-size: 10px;"\x3e'+changeNotNullString(a.blockquote_time)+"\x3c/span\x3e\x3c/blockquote\x3e");b+='\x3cp style\x3d"margin-top: 10px; text-indent: 2em;"\x3e'+a.content+'\x3c/p\x3e\x3cdiv class\x3d"reply-group" style\x3d"text-align: right; " \x3e\x3ca class\x3d"layui-btn layui-btn-normal layui-btn-small reply-other-btn" style\x3d""\x3e\u56de\u590dTA\x3c/a\x3e\x3cdiv class\x3d"reply-container" style\x3d"display: none;"\x3e\x3ctextarea placeholder\x3d"\u8bf7\u8f93\u5165\u60a8\u60f3\u5bf9TA\u7684\u5185\u5bb9" class\x3d"layui-textarea reply-comment-text" style\x3d"margin-top: 5px;"\x3e\x3c/textarea\x3e\x3ca class\x3d"layui-btn layui-btn-normal layui-btn-small" style\x3d"margin-top: 5px;" onclick\x3d"commentItem(this, '+a.id+", "+a.table_id+');"\x3e\u8bc4\u8bba\x3c/a\x3e\t\x3c/div\x3e\x3c/div\x3e\x3chr /\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';$commentContainer.append(b)}function commentItem(c,a,b){c=$(c).closest(".reply-container").find(".reply-comment-text").val();doAddComment({table_name:"t_mall_product",table_id:b,content:c,pid:a,froms:"web\u7aef",t:Math.random()})}function addComment(c){c=$("#comment").find('[name\x3d"add-comment"]');isEmpty(c.val())?(c.focus(),layer.msg("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a")):(c={table_name:"t_mall_product",table_id:productId,content:c.val(),froms:"web\u7aef",t:Math.random()},doAddComment(c))}function doAddComment(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:c,url:"/cm/comment",dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);b.success?(layer.msg("\u8bc4\u8bba\u6210\u529f,1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout("window.location.reload();",1E3)):layer.msg("\u6dfb\u52a0\u8bc4\u8bba\u5931\u8d25\uff0c"+b.message)},error:function(){layer.close(a);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})}function doStatistics(c,a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"get",data:{start:c,end:a,t:Math.random()},url:"/mall/product/"+productId+"/statistics",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.success?(delete a.message.title,delete a.message.toolbox,myChart.setOption(a.message)):layer.msg("\u83b7\u53d6\u56fe\u8868\u6570\u636e\u5931\u8d25\uff0c"+a.message)},error:function(){layer.close(b);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})};