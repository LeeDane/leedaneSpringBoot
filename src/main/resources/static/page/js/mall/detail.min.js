layui.use(["carousel","form","laypage","laydate"],function(){var c=layui.form;layui.carousel.render({elem:"#test10",width:"100%",height:"280px",interval:5E3});var a=layui.laydate;(new Date).Format("yyyy-MM-dd");var b=(new Date((new Date).getTime()-864E5)).Format("yyyy-MM-dd"),d=(new Date((new Date).getTime()-2592E6)).Format("yyyy-MM-dd"),e=(new Date((new Date).getTime()-1728E5)).Format("yyyy-MM-dd"),f=(new Date((new Date).getTime()-26784E5)).Format("yyyy-MM-dd");a.render({elem:"#startDate",isToday:!1,isclear:!1,min:f,max:e,ready:function(a){$(".laydate-btns-now").remove()}});a.render({elem:"#endDate",istoday:!1,min:d,max:b,ready:function(a){$(".laydate-btns-now").remove()}});layui.element.on("tab(docDemoTabBrief)",function(a){console.log(this);console.log(a.index);switch(a.index){case 0:resetParticlesHeight;break;case 1:getComments();break;case 2:console.log(a.elem);getBigEvents();break;case 3:myChart=echarts.init(document.getElementById("main"));doStatistics($("#startDate").val(),$("#endDate").val());resetParticlesHeight();break;case 4:resetParticlesHeight()}});c.on("submit(search-statistics-form-submit)",function(a){a=$("#startDate").val();var b=$("#endDate").val();doStatistics(a,b);return!1});laypage=layui.laypage;initClipBoard();doRecommend()});var $container,$commentContainer,$recommendContainer,laypage;$(function(){$bigEventContainer=$(".big-event-container");$container=$(".layui-container");$container.on("click",".reply-other-btn",function(){$(this).closest(".reply-group").find(".reply-container").toggle("fast")});$commentContainer=$("#comment-list-container");$recommendContainer=$("#recommend-container")});function doRecommend(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"GET",url:"/mall/product/"+productId+"/recommend",dataType:"json",beforeSend:function(){$recommendContainer.empty()},success:function(a){layer.close(c);if(a.isSuccess)for(var b=0;b<a.message.length;b++)$recommendContainer.append(buildRecommendRow(b,a.message[b]));resetParticlesHeight()},error:function(a){layer.close(c);ajaxError(a)}})}function buildRecommendRow(c,a){return'\x3cdiv class\x3d"layui-col-md3 layui-col-xs12 m-product-item m-border-left m-border-bottom" style\x3d"cursor: pointer;" onclick\x3d"buildShareLink('+a.auctionId+');"\x3e\x3cimg alt\x3d"" src\x3d"'+a.img+'" class\x3d"m-product-item-img"/\x3e\x3cdiv class\x3d"m-product-contrainer"\x3e\x3ca class\x3d"m-product-desc"\x3e'+a.title+'\x3c/a\x3e\x3cp\x3e\x3cspan class\x3d"m-product-price"\x3e\u00a5'+a.price+'\x3c/span\x3e \x3cspan style\x3d"text-decoration: line-through; font-size: 0.6em;"\x3e\u539f\u4ef7: \u00a5'+a.oldPrice+"\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e"}function searchShop(c,a){var b=$("input[name\x3d'shop-search-value']");isEmpty(b.val())?(layer.msg("\u8bf7\u5148\u8f93\u5165\u68c0\u7d22\u7684\u5185\u5bb9\uff01"),b.focus()):window.open("/mall/s?q\x3d"+b.val()+"\x26tp\x3d"+a,"_blank")}function addWish(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{product_id:productId},url:"/mall/wish",dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);b.isSuccess?(layer.msg(b.message+"\uff0c1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}var $bigEventContainer,bigEvents,bigEvent_pageSize=100,bigEvent_currentIndex=0,bigEvent_totalPage=0;function getBigEvents(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/mall/product/"+productId+"/bigEvents?"+jsonToGetRequestParams(getBigEventsRequestParams()),dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);$bigEventContainer.empty();if(a.isSuccess){bigEvents=a.message;if(0==bigEvents.length){0==bigEvent_currentIndex?$bigEventContainer.append("\u8fd8\u6ca1\u6709\u5927\u4e8b\u4ef6\uff01"):$bigEventContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5927\u4e8b\u4ef6\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");return}for(a=0;a<bigEvents.length;a++)$bigEventContainer.append(buildBigEventRow(a,bigEvents[a]))}else ajaxError(a);isLoad=!1;resetParticlesHeight()},error:function(a){isLoad=!1;layer.close(c);ajaxError(a)}})}function buildBigEventRow(c,a){return'\x3cli class\x3d"layui-timeline-item"\x3e\x3ci class\x3d"layui-icon layui-timeline-axis"\x3e\ue63f\x3c/i\x3e\x3cdiv class\x3d"layui-timeline-content layui-text"\x3e\x3ch3 class\x3d"layui-timeline-title"\x3e'+a.create_time+"\x3c/h3\x3e\x3cp\x3e"+a.text+"\x3c/p\x3e\x3c/div\x3e\x3c/li\x3e"}function getBigEventsRequestParams(){return{page_size:bigEvent_pageSize,current:bigEvent_currentIndex,total:bigEvent_totalPage,t:Math.random()}}var comment_pageSize=10,comment_currentIndex=0,comment_totalPage=0,comments;function getCommentsRequestParams(){return{format_time:!0,current:comment_currentIndex,total:comment_totalPage,table_name:"t_mall_product",table_id:productId,showUserInfo:!0,page_size:comment_pageSize,t:Math.random()}}function getComments(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cm/comments/paging?"+jsonToGetRequestParams(getCommentsRequestParams()),dataType:"json",beforeSend:function(){$commentContainer.empty()},success:function(b){layer.close(a);if(b.isSuccess){comments=b.message;if(0==b.message.length)0==comment_currentIndex?$commentContainer.append("\u8fd8\u6ca1\u6709\u53d1\u8868\u8fc7\u4efb\u4f55\u8bc4\u8bba\uff0c\u8bf7\u7ed9TA\u8bc4\u8bba\u5427\uff01"):$commentContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u8bc4\u8bba\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else for(var c=0;c<comments.length;c++)buildEachCommentRow(c,comments[c]);0!=comment_currentIndex||comments&&0!=comments.length?($("#comment-pager").css("padding","5px"),laypage.render({elem:"comment-pager",layout:["prev","page","next","count","skip"],count:b.total,limit:comment_pageSize,curr:comment_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(comment_currentIndex=a.curr-1,getComments())}})):($("#comment-pager").empty(),$("#comment-pager").css("padding","0"))}else ajaxError(b);resetParticlesHeight()},error:function(b){layer.close(a);ajaxError(b)}})}function buildEachCommentRow(c,a){var b='\x3cdiv class\x3d"layui-row"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12"\x3e\x3cdiv\x3e\x3cimg alt\x3d"" src\x3d"'+a.user_pic_path+'" style\x3d"width: 25px; height: 25px;" /\x3e\x26nbsp;\x26nbsp;\x3ca\x3e'+a.account+'\x3c/a\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"font-size: 11px;"\x3e'+a.create_time+"\x3c/span\x3e";isNotEmpty(a.blockquote_content)&&(b+='\x3cblockquote class\x3d"layui-elem-quote layui-quote-nm" style\x3d"margin-top: 5px; margin-left: 30px;"\x3e'+a.blockquote_content+"\x3cbr /\x3e\u2014\u2014"+a.blockquote_account+'\x26nbsp;\x26nbsp;\x3cspan style\x3d"font-size: 10px;"\x3e'+changeNotNullString(a.blockquote_time)+"\x3c/span\x3e\x3c/blockquote\x3e");b+='\x3cp style\x3d"margin-top: 10px; text-indent: 2em;"\x3e'+a.content+'\x3c/p\x3e\x3cdiv class\x3d"reply-group" style\x3d"text-align: right; " \x3e\x3ca class\x3d"layui-btn layui-btn-normal layui-btn-small reply-other-btn" style\x3d""\x3e\u56de\u590dTA\x3c/a\x3e\x3cdiv class\x3d"reply-container" style\x3d"display: none;"\x3e\x3ctextarea placeholder\x3d"\u8bf7\u8f93\u5165\u60a8\u60f3\u5bf9TA\u7684\u5185\u5bb9" class\x3d"layui-textarea reply-comment-text" style\x3d"margin-top: 5px;"\x3e\x3c/textarea\x3e\x3ca class\x3d"layui-btn layui-btn-normal layui-btn-small" style\x3d"margin-top: 5px;" onclick\x3d"commentItem(this, '+a.id+", "+a.table_id+');"\x3e\u8bc4\u8bba\x3c/a\x3e\t\x3c/div\x3e\x3c/div\x3e\x3chr /\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';$commentContainer.append(b)}function commentItem(c,a,b){c=$(c).closest(".reply-container").find(".reply-comment-text").val();doAddComment({table_name:"t_mall_product",table_id:b,content:c,pid:a,froms:"web\u7aef",t:Math.random()})}function addComment(c){c=$("#comment").find('[name\x3d"add-comment"]');isEmpty(c.val())?(c.focus(),layer.msg("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a")):(c={table_name:"t_mall_product",table_id:productId,content:c.val(),froms:"web\u7aef",t:Math.random()},doAddComment(c))}function doAddComment(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:c,url:"/cm/comment",dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);b.isSuccess?(layer.msg("\u8bc4\u8bba\u6210\u529f,1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout("window.location.reload();",1E3)):layer.msg("\u6dfb\u52a0\u8bc4\u8bba\u5931\u8d25\uff0c"+b.message)},error:function(){layer.close(a);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})}function doStatistics(c,a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"get",data:{start:c,end:a,t:Math.random()},url:"/mall/product/"+productId+"/statistics",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.isSuccess?(delete a.message.title,delete a.message.toolbox,myChart.setOption(a.message)):layer.msg("\u83b7\u53d6\u56fe\u8868\u6570\u636e\u5931\u8d25\uff0c"+a.message)},error:function(){layer.close(b);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})};