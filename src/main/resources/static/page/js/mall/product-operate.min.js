layui.use(["layer"],function(){layer=layui.layer;$contentContainer=$("textarea[name\x3d'detail_source']");$contentContainer.markdown();$("[data-toggle\x3d'tooltip']").tooltip();$('[name\x3d"has_img"]').click(function(){this.checked?$(".img-url-row").removeClass("hidden"):$(".img-url-row").addClass("hidden")});$('[name\x3d"is_original"]').click(function(){this.checked?$(".is-original-row").addClass("hidden"):$(".is-original-row").removeClass("hidden")})});var $contentContainer;function getEditBlog(b){$.ajax({url:"/bg/blog/edit/"+b,dataType:"json",beforeSend:function(){},success:function(a){null!=a&&a.success&&1==a.message.length?addToEdit(a.message[0]):(ajaxError(a),window.history.forward(1),setTimeout('window.open("/pb", "_self")',1500))},error:function(a){ajaxError(a)}})}function addTag(b){b=$(b);var a=b.val();isEmpty(a)?(layer.msg("\u6807\u7b7e\u4e0d\u80fd\u4e3a\u7a7a"),b.focus()):10<a.length?layer.msg("\u6807\u7b7e\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc710\u4f4d"):addTagItem(b,a)}function addTagItem(b,a){var d=b.closest(".row").find(".tag-list"),e=d.find(".tag-item"),c=e.length;e&&2<c?layer.msg("\u6807\u7b7e\u8d85\u8fc73\u4e2a\uff0c\u8bf7\u5148\u5220\u9664\u540e\u6dfb\u52a0"):(d.append('\x3cdiv class\x3d"btn-group dropup tag-item tag-item-'+c+'"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary tag-value"\x3e'+a+'\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle" data-toggle\x3d"dropdown" aria-expanded\x3d"false"\x3e\x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3cspan class\x3d"sr-only"\x3eToggle Dropdown\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu dropdown-menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteTag(this, '+c+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"moveLeftTag(this, '+c+');"\x3e\u5de6\u79fb\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"moveRightTag(this, '+c+');"\x3e\u53f3\u79fb\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"clearTag(this);"\x3e\u6e05\u7a7a\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e'),b.val(""))}function deleteTag(b){b=$(b);b.closest(".row").find(".tag-input").focus();b.closest(".tag-item").remove()}function moveLeftTag(b,a){var d=$(b);if(0!=a){var e=d.closest(".tag-item").find(".tag-value").text(),c=a-1,c=d.closest(".tag-list").find(".tag-item-"+c),f=c.find(".tag-value").text();d.closest(".tag-item").find(".tag-value").text(f);c.find(".tag-value").text(e)}}function moveRightTag(b,a){var d=$(b);if(1!=$(b).closest(".tag-list").find(".tag-item").length&&2!=a){var e=d.closest(".tag-item").find(".tag-value").text(),c=a+1,c=d.closest(".tag-list").find(".tag-item-"+c),f=c.find(".tag-value").text();d.closest(".tag-item").find(".tag-value").text(f);c.find(".tag-value").text(e)}}function clearTag(b){b=$(b);b.closest(".row").find(".tag-input").focus();b.closest(".tag-list").empty();b.remove()}function release(b,a){var d={status:1};buildParams(d)&&doRelease(d,a)}function doRelease(b,a){var d=!0;$(".container").find(".form-control").each(function(a){a=$(this).attr("name");var c=$(this).attr("empty");if(c&&"false"==c&&isEmpty($(this).val()))return $(this).focus(),layer.msg($(this).attr("placeholder")),d=!1;"detail_source"==a?(c=$contentContainer.data("markdown").parseContent(),b[a]=c):b[a]=$(this).val()});if(d){a&&(b.product_id=productId);var e=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:a?"PUT":"post",data:b,url:"/mall/product",dataType:"json",beforeSend:function(){},success:function(a){layer.close(e);null!=a&&a.success?(layer.msg(a.message),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(e);ajaxError(a)}})}}function buildParams(b){var a=$(".img-container").find("img");if(a&&0<a.length){var d="";a.each(function(a){d=d+$(this)[0].src+";"});b.has_img=!0;b.imgs=deleteLastStr(d)}else b.has_img=!1;a=$('[name\x3d"is_recommend"]').is(":checked");b.product_recommend=a;var e=$(".tag-item"),c="";if(e&&0<e.length){for(a=0;a<e.length;a++)c=a==e.length-1?c+$(e[a]).find(".tag-value").text():c+$(e[a]).find(".tag-value").text()+",";b.tag=c}a=$('[name\x3d"can_comment"]').is(":checked");b.can_comment=a;a=$('[name\x3d"can_transmit"]').is(":checked");b.can_transmit=a;b.froms="web\u7f51\u9875\u7aef";a=$('[name\x3d"create_user_id"]').val();isNotEmpty(a)&&(b.create_user_id=a);a=$("#platforms").find("label.active").find("input[type\x3d'radio']").attr("data");if(isEmpty(a))return layer.msg("\u8bf7\u9009\u62e9\u5e73\u53f0"),!1;b.platform=a;a=$("#selectCategory");if(isEmpty(a.text()))return layer.msg("\u8bf7\u9009\u62e9\u5206\u7c7b"),!1;b.category_id=a.data("id");a=$("input[name\x3d'price']");if(0>=a.val())return layer.msg("\u8bf7\u586b\u5199\u5408\u6cd5\u7684\u73b0\u4ef7(\u5927\u4e8e0.0)"),!1;b.price=a.val();a=$("input[name\x3d'link']");if(!isLink(a.val()))return layer.msg("\u94fe\u63a5\u4e0d\u5408\u6cd5\uff0c\u8bf7\u91cd\u65b0\u586b\u5199"),a.focus(),!1;b.link=a.val();if(1==$("#selectImages").find("button.active").index()){e=$(".img-container").find("img");if(!e||1>e.length)return layer.msg("\u8bf7\u5148\u81f3\u5c11\u9009\u62e91\u5f20\u4e3b\u56fe\u7247"),createSelectMaterialModal(this,5,1,"afterSelect"),!1;c="";for(a=0;a<e.length;a++)c+=e.eq(a).attr("src")+";";b.main_img_links=deleteLastStr(c)}return!0}function btnSelectDetail(b){$(b).parent().find("button").removeClass("active");$(b).addClass("active");$(".img-container").empty()}function btnSelectMaterial(b){$(b).parent().find("button").removeClass("active");$(b).addClass("active");createSelectMaterialModal(this,5,1,"afterSelect")}function afterSelect(b){$(".img-container").empty();b=b.split(";");for(var a="",d=0;d<b.length;d++)a+='\x3cdiv class\x3d"col-lg-2"\x3e\x3cimg src\x3d"'+changeNotNullString(b[d])+'" style\x3d"width: 100%; height: 150px;" class\x3d"img-responsive" onClick\x3d"" /\x3e\x3c/div\x3e';$(".img-container").append(a);$("body").removeClass("modal-open")}function afterSelectCategory(b,a){$("#selectCategory").text(a);$("#selectCategory").data("id",b);$("body").removeClass("modal-open")};