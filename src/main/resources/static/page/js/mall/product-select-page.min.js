var layerIndex,$SearchContainer;layui.use(["layer","laypage"],function(){layer=layui.layer;laypage=layui.laypage;$SearchContainer=$("input[name\x3d'shop-search-value']");$productContainer=$("#product-row-container")});var product_pageSize=4,product_start=0,product_currentIndex=0,product_totalPage=0,products,product_sort="createTime",product_sort_desc=!0;function doSearch(){var c=$SearchContainer.val();if(isEmpty(c))layer.msg("\u8bf7\u8f93\u5165\u60a8\u8981\u641c\u7d22\u7684\u5185\u5bb9\uff01"),$SearchContainer.focus();else{var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"get",url:"/s/s?"+jsonToGetRequestParams({keyword:c,sort:product_sort,desc:product_sort_desc,start:product_currentIndex*product_pageSize,current:product_currentIndex,type:5,rows:product_pageSize,t:Math.random()}),dataType:"json",beforeSend:function(){},beforeSend:function(){},success:function(a){layer.close(b);$(".search-need-time").text(a.consumeTime);a.isSuccess&&isNotEmpty(a.message)?dealProductSearch(a.message[5],a.total):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})}}function dealProductSearch(c,b){$productContainer.empty();if(0==c.length)0==product_currentIndex?$productContainer.append("\u641c\u7d22\u4e0d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u5546\u54c1\uff0c\u8bf7\u6362\u6761\u4ef6\u8bd5\u8bd5\uff01"):$productContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5546\u54c1\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");else{products=c;for(var a=0;a<products.length;a++)buildEachSearchProductRow(a,products[a])}0!=product_currentIndex||products&&0!=products.length?laypage.render({elem:"product-pager",layout:["prev","page","next","count","skip"],count:b[5],limit:product_pageSize,curr:product_currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(product_currentIndex=a.curr-1,doSearch())}}):$("#product-pager").empty()}function buildEachSearchProductRow(c,b){var a='\x3cdiv class\x3d"layui-col-md6 layui-col-xs6" onclick\x3d"getSelectProductData('+c+');"\x3e\x3cdiv class\x3d"layui-col-md12 layui-col-xs12 m-product-item"\x3e\x3cimg alt\x3d"" src\x3d"'+b.mainImgLinks.split(";")[0]+'" class\x3d"m-product-item-img"/\x3e\t\t\x3cdiv class\x3d"m-product-contrainer"\x3e\x3ca class\x3d"m-product-desc" href\x3d"javascript:void(0);" title\x3d"'+changeNotNullString(b.title)+'"\x3e'+changeNotNullString(b.title)+'\x3c/a\x3e\x3cp style\x3d"text-align: left;"\x3e\x3cspan class\x3d"m-product-price"\x3e\u00a5'+b.price+'\x3c/span\x3e \x3cspan style\x3d"float: right; margin-right: 8px; text-decoration: line-through; font-size: 0.6em;"\x3e\u539f\u4ef7: \u00a5'+b.oldPrice+'\x3c/span\x3e\x3c/p\x3e\x3cp style\x3d"text-align: left;"\x3e\x3cspan class\x3d"m-product-price" style\x3d"font-size: 1.0em;"\x3e\u6bd4\u7387\uff1a'+b.cashBackRatio+'%\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan style\x3d"float: right; margin-right: 8px; font-size: 1.0em;"\x3e\u4f63\u91d1: \u00a5'+(b.price*b.cashBackRatio/100).toFixed(2)+"\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";$productContainer.append(a)}function getSelectProductData(c){layerIndex=parent.layer.getFrameIndex(window.name);parent.getSelectProductData(layerIndex,products[c])};