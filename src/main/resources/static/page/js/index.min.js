var $blogContainer;layui.use(["layer","laypage"],function(){layer=layui.layer;laypage=layui.laypage;$("[data-toggle\x3d'tooltip']").tooltip();$(".navbar-nav .nav-main-li").each(function(){$(this).removeClass("active")});$(".nav-blog").addClass("active");$blogContainer=$("#blog-container");getWebBackgroud();getMainContentData();getCarouselImgs()});var imgs=[],blogs,winH=$(window).height(),isLoad=!1;function getWebBackgroud(){$.ajax({data:"t\x3d"+Math.random(),url:"wc/background",beforeSend:function(){},success:function(b){null!=b&&b.isSuccess?$(".main_bg").css("background",'url("'+b.message+'")'):ajaxError(b)},error:function(b){ajaxError(b)}})}function getMainContentData(){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({dataType:"json",url:"/bg/blogs/paging?"+jsonToGetRequestParams(getMainContentRequestParams()),beforeSend:function(){},success:function(a){layer.close(b);$blogContainer.empty();if(null!=a&&a.isSuccess){if(0==a.message.length){canLoadData=!1;$blogContainer.append('\x3cdiv class\x3d"row row-list"\x3e\u6ca1\u6709\u66f4\u591a\u6570\u636e\x3c/div\x3e');return}blogs=a.message;for(var c=0;c<blogs.length;c++)a.message[c].has_img?$blogContainer.append(buildHasImgRow(c,blogs[c])):$blogContainer.append(buildNotHasImgRow(c,blogs[c]));scrollToPageTop(1E3);laypage.render({elem:"item-pager",layout:["prev","page","next","count","skip"],count:a.total,limit:pageSize,theme:"#337ab7",curr:currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(currentIndex=a.curr-1,getMainContentData())}})}else ajaxError(a);console.log(a);isLoad=!1},error:function(a){isLoad=!1;layer.close(b);ajaxError(a)}})}function buildHasImgRow(b,a){var c='\x3cdiv class\x3d"row row-list row_'+b+'"\x3e\x3cdiv class\x3d"col-lg-3 col-padding-eight"\x3e\x3cimg width\x3d"100%" height\x3d"324" class\x3d"img-rounded" alt\x3d"" src\x3d"'+a.img_url+'" onClick\x3d"showImg('+b+');"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-9 col-padding-eight" style\x3d"min-height:324px;"\x3e\x3cdiv class\x3d"panel panel-info has-img-panel-info"\x3e\x3cdiv class\x3d"panel-heading"\x3e\x3cdiv class\x3d"page-header"\x3e\x3ch2 class\x3d"hand cut-text" onclick\x3d"goToReadFull('+a.id+')"\x3e'+a.title+'\x3csmall\x3e\x3c/small\x3e\x3c/h2\x3e\x3col class\x3d"breadcrumb"\x3e\x3cli\x3e'+changeNotNullString(a.category)+'\x3c/li\x3e\x3cli class\x3d"active"\x3e'+a.create_time+"\x3c/li\x3e\x3c/ol\x3e";if(isNotEmpty(a.tag))for(var e=a.tag.split(","),d=0;d<e.length;d++)0==d&&(c+='\x3cspan class\x3d"label label-default tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),1==d&&(c+='\x3cspan class\x3d"label label-primary tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),2==d&&(c+='\x3cspan class\x3d"label label-success tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e");c+='\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-body hand" onclick\x3d"goToReadFull('+a.id+')"\x3e'+(100<a.digest.length?a.digest+"...":a.digest)+'\x3c/div\x3e\x3cdiv class\x3d"panel-footer"\x3e';isLogin&&(c+='\x3cdiv class\x3d"btn-group dropup"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle btn-default" data-toggle\x3d"dropdown"\x3e\u64cd\u4f5c \x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu" role\x3d"menu"\x3e\x3cli\x3e\x3ca class\x3d"attention" href\x3d"javascript:void(0);" onclick\x3d"attention('+a.id+","+b+');"\x3e\u5173\u6ce8\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"collection" href\x3d"javascript:void(0);" onclick\x3d"collect('+a.id+","+b+');"\x3e\u6536\u85cf\x3c/a\x3e\x3c/li\x3e',c=isAdmin||loginUserId==a.create_user_id?c+('\x3cli\x3e\x3ca class\x3d"delete-blog" href\x3d"javascript:void(0);" onclick\x3d"updateBlog('+a.id+","+b+');"\x3e\u7f16\u8f91\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteBlog('+a.id+","+b+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e'):c+('\x3cli\x3e\x3ca class\x3d"report-blog" href\x3d"javascript:void(0);" onclick\x3d"reportBlog('+a.id+","+b+');"\x3e\u4e3e\u62a5\x3c/a\x3e\x3c/li\x3e'),c+="\x3c/ul\x3e\x3c/div\x3e");return c+='\x3cbutton type\x3d"button" class\x3d"btn btn-primary btn-default" href\x3d"javascript:void(0);" onclick\x3d"my('+a.create_user_id+');"\x3e\x3cspan class\x3d"glyphicon glyphicon-user"\x3e\x3c/span\x3e '+a.account+'\x3c/button\x3e\x3cbutton data-toggle\x3d"tooltip" title\x3d"\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u7ec6\u4fe1\u606f" onMouseOver\x3d"$(this).tooltip(\'show\')" type\x3d"button" class\x3d"btn btn-primary btn-default" onclick\x3d"goToReadFull('+a.id+')"\x3e\x3cspan class\x3d"glyphicon glyphicon-phone"\x3e\x3c/span\x3e \u67e5\u770b\u5168\u6587\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}function buildNotHasImgRow(b,a){var c='\x3cdiv class\x3d"row row-list row_'+b+'"\x3e\x3cdiv class\x3d"col-lg-12 col-padding-eight"\x3e\x3cdiv class\x3d"panel panel-info"\x3e\x3cdiv class\x3d"panel-heading"\x3e\x3cdiv class\x3d"page-header"\x3e\x3ch2 class\x3d"hand cut-text" onclick\x3d"goToReadFull('+a.id+')"\x3e'+a.title+'\x3csmall\x3e\x3c/small\x3e\x3c/h2\x3e\x3col class\x3d"breadcrumb"\x3e\x3cli\x3e'+changeNotNullString(a.category)+'\x3c/li\x3e\x3cli class\x3d"active"\x3e'+a.create_time+"\x3c/li\x3e\x3c/ol\x3e";if(isNotEmpty(a.tag))for(var e=a.tag.split(","),d=0;d<e.length;d++)0==d&&(c+='\x3cspan class\x3d"label label-default tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),1==d&&(c+='\x3cspan class\x3d"label label-primary tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),2==d&&(c+='\x3cspan class\x3d"label label-success tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e");c+='\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-body hand" onclick\x3d"goToReadFull('+a.id+')"\x3e'+(100<a.digest.length?a.digest+"...":a.digest)+'\x3c/div\x3e\x3cdiv class\x3d"panel-footer"\x3e';isLogin&&(c+='\x3cdiv class\x3d"btn-group dropup"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle btn-default" data-toggle\x3d"dropdown"\x3e\u64cd\u4f5c \x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu" role\x3d"menu"\x3e\x3cli\x3e\x3ca class\x3d"attention" href\x3d"javascript:void(0);" onclick\x3d"attention('+a.id+","+b+');"\x3e\u5173\u6ce8\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"collection" href\x3d"javascript:void(0);" onclick\x3d"collection('+a.id+","+b+');"\x3e\u6536\u85cf\x3c/a\x3e\x3c/li\x3e',c=isAdmin||loginUserId==a.create_user_id?c+('\x3cli\x3e\x3ca class\x3d"delete-blog" href\x3d"javascript:void(0);" onclick\x3d"updateBlog('+a.id+","+b+');"\x3e\u7f16\u8f91\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteBlog('+a.id+","+b+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e'):c+('\x3cli\x3e\x3ca class\x3d"report-blog" href\x3d"javascript:void(0);" onclick\x3d"reportBlog('+a.id+","+b+');"\x3e\u4e3e\u62a5\x3c/a\x3e\x3c/li\x3e'),c+="\x3c/ul\x3e\x3c/div\x3e");return c+='\x3cbutton type\x3d"button" class\x3d"btn btn-primary btn-default" href\x3d"javascript:void(0);" onclick\x3d"my('+a.create_user_id+');"\x3e\x3cspan class\x3d"glyphicon glyphicon-user"\x3e\x3c/span\x3e '+a.account+'\x3c/button\x3e\x3cbutton data-toggle\x3d"tooltip" title\x3d"\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u7ec6\u4fe1\u606f" onMouseOver\x3d"$(this).tooltip(\'show\')" type\x3d"button" class\x3d"btn btn-primary btn-default" onclick\x3d"goToReadFull('+a.id+')"\x3e\x3cspan class\x3d"glyphicon glyphicon-phone"\x3e\x3c/span\x3e \u67e5\u770b\u5168\u6587\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}function getMainContentRequestParams(){pageSize=10;return{page_size:pageSize,current:currentIndex,total:totalPage,t:Math.random()}}function getCarouselImgs(){$.ajax({url:"/bg/carouselImgs?num\x3d5\x26method\x3drecommend\x26t\x3d"+Math.random(),beforeSend:function(){},success:function(b){$("#main-container .carousel-indicators").empty();$("#main-container .carousel-inner").empty();if(null!=b&&b.isSuccess)if(0<b.message.length)for(var a=0;a<b.message.length;a++){var c='\x3cli data-target\x3d"#carousel-example-generic" data-slide-to\x3d"0" '+(0==a?'class\x3d"active"':"")+"\x3e\x3c/li\x3e";$("#main-container .carousel-indicators").append(c);c='\x3cdiv class\x3d"item '+(0==a?"active":"")+'"\x3e\x3cimg onclick\x3d"goToReadFull('+b.message[a].id+')" class\x3d"carousel-img hand" src\x3d"'+changeNotNullString(b.message[a].img_url)+'" alt\x3d"'+changeNotNullString(b.message[a].title)+'"/\x3e\x3cdiv class\x3d"carousel-caption"\x3e\x3ch1\x3e'+changeNotNullString(b.message[a].title)+"\x3c/h1\x3e\x3cp\x3e"+changeNotNullString(b.message[a].digest)+"\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e";$("#main-container .carousel-inner").append(c)}else $("#carousel-example-generic").remove();else $("#carousel-example-generic").remove(),ajaxError(b)},error:function(b){ajaxError(b)}})}function showImg(b){b=blogs[b];layer.photos({photos:{title:"\u76f8\u518c\u6807\u9898",id:0,start:0,data:[{alt:b.title,pid:0,src:b.img_url,thumb:b.img_url}]},shift:1})}function attention(b,a){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{table_name:"t_blog",table_id:b,t:Math.random()},dataType:"json",url:"/at/attention",beforeSend:function(){},success:function(b){layer.close(c);b.isSuccess?(layer.msg(b.message),$(".row_"+a).find(".attention").text("\u5df2\u5173\u6ce8")):ajaxError(b)},error:function(a){layer.close(c);ajaxError(a)}})}function collection(b,a){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{table_name:"t_blog",table_id:b,t:Math.random()},dataType:"json",url:"/cl/collection",beforeSend:function(){},success:function(b){layer.close(c);b.isSuccess?(layer.msg(b.message),$(".row_"+a).find(".collection").text("\u5df2\u6536\u85cf")):ajaxError(b)},error:function(a){layer.close(c);ajaxError(a)}})}function deleteBlog(b,a){layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u7bc7\u6587\u7ae0\u8bb0\u5f55\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",dataType:"json",url:"/bg/blog?b_id\x3d"+b,beforeSend:function(){},success:function(b){layer.close(c);b.isSuccess?(layer.msg(b.message),$(".row_"+a).remove()):ajaxError(b)},error:function(a){layer.close(c);ajaxError(a)}})},function(){})}function updateBlog(b,a){window.open("/pb?bid\x3d"+b,"_self")}function reportBlog(b,a){1>parseInt(b)?layer.msg("\u65e0\u6cd5\u83b7\u53d6\u6587\u7ae0"):($("#report-blog").modal("show"),$("#report-modal-body").find(".report-btn").removeClass("active"),$("#report-modal-body").find(".default-report-btn").addClass("active"),$("#report-modal-body").find("textarea").val(""),$("#report-modal-body").attr("blog-id",b))}function my(b){isEmpty(b)?layer.msg("\u8be5\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6838\u5b9e"):linkToMy(b)};