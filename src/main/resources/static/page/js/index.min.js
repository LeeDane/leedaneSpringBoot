layui.use(["layer"],function(){layer=layui.layer;$("[data-toggle\x3d'tooltip']").tooltip();$(".navbar-nav .nav-main-li").each(function(){$(this).removeClass("active")});$(".nav-blog").addClass("active");getWebBackgroud();$(window).scroll(function(a){a=a||window.event;if(a.wheelDelta){if(0<a.wheelDelta)return}else if(a.detail&&0<a.detail)return;a=$(document.body).height();var b=$(window).scrollTop();a=(a-winH-b)/winH;!isLoad&&.2>a&&(isLoad=!0,method="lowloading",getMainContentData())});getMainContentData();getCarouselImgs()});var last_id=0,first_id=0,method="firstloading",imgs=[],blogs,winH=$(window).height(),isLoad=!1;function getWebBackgroud(){$.ajax({data:"t\x3d"+Math.random(),url:"wc/background",beforeSend:function(){},success:function(a){null!=a&&a.isSuccess?$(".main_bg").css("background",'url("'+a.message+'")'):ajaxError(a)},error:function(a){ajaxError(a)}})}function getMainContentData(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({dataType:"json",url:"/bg/blogs?"+jsonToGetRequestParams(getMainContentRequestParams()),beforeSend:function(){},success:function(b){layer.close(a);if(null!=b&&b.isSuccess){"firstloading"==method&&$(".container").find(".row-list").remove();if(0==b.message.length){canLoadData=!1;layer.msg("\u65e0\u66f4\u591a\u6570\u636e");return}if("firstloading"==method){blogs=b.message;for(var c=0;c<blogs.length;c++)b.message[c].has_img?$(".container").append(buildHasImgRow(c,blogs[c])):$(".container").append(buildNotHasImgRow(c,blogs[c])),0==c&&(first_id=blogs[c].id),c==blogs.length-1&&(last_id=blogs[c].id)}else for(var e=blogs.length,c=0;c<b.message.length;c++)blogs.push(b.message[c]),b.message[c].has_img?$(".container").append(buildHasImgRow(e+c,b.message[c])):$(".container").append(buildNotHasImgRow(e+c,b.message[c])),c==b.message.length-1&&(last_id=b.message[c].id);resetSideHeight()}else ajaxError(b);console.log(b);isLoad=!1},error:function(b){isLoad=!1;layer.close(a);ajaxError(b)}})}function buildHasImgRow(a,b){var c='\x3cdiv class\x3d"row row-list row_'+a+'"\x3e\x3cdiv class\x3d"col-lg-3 col-padding-eight"\x3e\x3cimg width\x3d"100%" height\x3d"324" class\x3d"img-rounded" alt\x3d"" src\x3d"'+b.img_url+'" onClick\x3d"showImg('+a+');"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-9 col-padding-eight" style\x3d"min-height:324px;"\x3e\x3cdiv class\x3d"panel panel-info has-img-panel-info"\x3e\x3cdiv class\x3d"panel-heading"\x3e\x3cdiv class\x3d"page-header"\x3e\x3ch2 class\x3d"hand cut-text" onclick\x3d"goToReadFull('+b.id+')"\x3e'+b.title+'\x3csmall\x3e\x3c/small\x3e\x3c/h2\x3e\x3col class\x3d"breadcrumb"\x3e\x3cli\x3e'+changeNotNullString(b.category)+'\x3c/li\x3e\x3cli class\x3d"active"\x3e'+b.create_time+"\x3c/li\x3e\x3c/ol\x3e";if(isNotEmpty(b.tag))for(var e=b.tag.split(","),d=0;d<e.length;d++)0==d&&(c+='\x3cspan class\x3d"label label-default tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),1==d&&(c+='\x3cspan class\x3d"label label-primary tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),2==d&&(c+='\x3cspan class\x3d"label label-success tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e");c+='\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-body hand" onclick\x3d"goToReadFull('+b.id+')"\x3e'+(100<b.digest.length?b.digest+"...":b.digest)+'\x3c/div\x3e\x3cdiv class\x3d"panel-footer"\x3e';isLogin&&(c+='\x3cdiv class\x3d"btn-group dropup"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle btn-default" data-toggle\x3d"dropdown"\x3e\u64cd\u4f5c \x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu" role\x3d"menu"\x3e\x3cli\x3e\x3ca class\x3d"attention" href\x3d"javascript:void(0);" onclick\x3d"attention('+b.id+","+a+');"\x3e\u5173\u6ce8\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"collection" href\x3d"javascript:void(0);" onclick\x3d"collect('+b.id+","+a+');"\x3e\u6536\u85cf\x3c/a\x3e\x3c/li\x3e',c=isAdmin||loginUserId==b.create_user_id?c+('\x3cli\x3e\x3ca class\x3d"delete-blog" href\x3d"javascript:void(0);" onclick\x3d"updateBlog('+b.id+","+a+');"\x3e\u7f16\u8f91\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteBlog('+b.id+","+a+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e'):c+('\x3cli\x3e\x3ca class\x3d"report-blog" href\x3d"javascript:void(0);" onclick\x3d"reportBlog('+b.id+","+a+');"\x3e\u4e3e\u62a5\x3c/a\x3e\x3c/li\x3e'),c+="\x3c/ul\x3e\x3c/div\x3e");return c+='\x3cbutton type\x3d"button" class\x3d"btn btn-primary btn-default" href\x3d"javascript:void(0);" onclick\x3d"my('+b.create_user_id+');"\x3e\x3cspan class\x3d"glyphicon glyphicon-user"\x3e\x3c/span\x3e '+b.account+'\x3c/button\x3e\x3cbutton data-toggle\x3d"tooltip" title\x3d"\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u7ec6\u4fe1\u606f" onMouseOver\x3d"$(this).tooltip(\'show\')" type\x3d"button" class\x3d"btn btn-primary btn-default" onclick\x3d"goToReadFull('+b.id+')"\x3e\x3cspan class\x3d"glyphicon glyphicon-phone"\x3e\x3c/span\x3e \u67e5\u770b\u5168\u6587\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}function buildNotHasImgRow(a,b){var c='\x3cdiv class\x3d"row row-list row_'+a+'"\x3e\x3cdiv class\x3d"col-lg-12 col-padding-eight"\x3e\x3cdiv class\x3d"panel panel-info"\x3e\x3cdiv class\x3d"panel-heading"\x3e\x3cdiv class\x3d"page-header"\x3e\x3ch2 class\x3d"hand cut-text" onclick\x3d"goToReadFull('+b.id+')"\x3e'+b.title+'\x3csmall\x3e\x3c/small\x3e\x3c/h2\x3e\x3col class\x3d"breadcrumb"\x3e\x3cli\x3e'+changeNotNullString(b.category)+'\x3c/li\x3e\x3cli class\x3d"active"\x3e'+b.create_time+"\x3c/li\x3e\x3c/ol\x3e";if(isNotEmpty(b.tag))for(var e=b.tag.split(","),d=0;d<e.length;d++)0==d&&(c+='\x3cspan class\x3d"label label-default tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),1==d&&(c+='\x3cspan class\x3d"label label-primary tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e"),2==d&&(c+='\x3cspan class\x3d"label label-success tag" style\x3d"font-size: 13px;"\x3e'+e[d]+"\x3c/span\x3e");c+='\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-body hand" onclick\x3d"goToReadFull('+b.id+')"\x3e'+(100<b.digest.length?b.digest+"...":b.digest)+'\x3c/div\x3e\x3cdiv class\x3d"panel-footer"\x3e';isLogin&&(c+='\x3cdiv class\x3d"btn-group dropup"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle btn-default" data-toggle\x3d"dropdown"\x3e\u64cd\u4f5c \x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu" role\x3d"menu"\x3e\x3cli\x3e\x3ca class\x3d"attention" href\x3d"javascript:void(0);" onclick\x3d"attention('+b.id+","+a+');"\x3e\u5173\u6ce8\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"collection" href\x3d"javascript:void(0);" onclick\x3d"collection('+b.id+","+a+');"\x3e\u6536\u85cf\x3c/a\x3e\x3c/li\x3e',c=isAdmin||loginUserId==b.create_user_id?c+('\x3cli\x3e\x3ca class\x3d"delete-blog" href\x3d"javascript:void(0);" onclick\x3d"updateBlog('+b.id+","+a+');"\x3e\u7f16\u8f91\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteBlog('+b.id+","+a+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e'):c+('\x3cli\x3e\x3ca class\x3d"report-blog" href\x3d"javascript:void(0);" onclick\x3d"reportBlog('+b.id+","+a+');"\x3e\u4e3e\u62a5\x3c/a\x3e\x3c/li\x3e'),c+="\x3c/ul\x3e\x3c/div\x3e");return c+='\x3cbutton type\x3d"button" class\x3d"btn btn-primary btn-default" href\x3d"javascript:void(0);" onclick\x3d"my('+b.create_user_id+');"\x3e\x3cspan class\x3d"glyphicon glyphicon-user"\x3e\x3c/span\x3e '+b.account+'\x3c/button\x3e\x3cbutton data-toggle\x3d"tooltip" title\x3d"\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u7ec6\u4fe1\u606f" onMouseOver\x3d"$(this).tooltip(\'show\')" type\x3d"button" class\x3d"btn btn-primary btn-default" onclick\x3d"goToReadFull('+b.id+')"\x3e\x3cspan class\x3d"glyphicon glyphicon-phone"\x3e\x3c/span\x3e \u67e5\u770b\u5168\u6587\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}function getMainContentRequestParams(){var a=5;"firstloading"!=method&&(a=5);return{pageSize:a,last_id:last_id,first_id:first_id,method:method,t:Math.random()}}function getCarouselImgs(){$.ajax({url:"/bg/carouselImgs?num\x3d5\x26method\x3drecommend\x26t\x3d"+Math.random(),beforeSend:function(){},success:function(a){$("#main-container .carousel-indicators").empty();$("#main-container .carousel-inner").empty();if(null!=a&&a.isSuccess)if(0<a.message.length)for(var b=0;b<a.message.length;b++){var c='\x3cli data-target\x3d"#carousel-example-generic" data-slide-to\x3d"0" '+(0==b?'class\x3d"active"':"")+"\x3e\x3c/li\x3e";$("#main-container .carousel-indicators").append(c);c='\x3cdiv class\x3d"item '+(0==b?"active":"")+'"\x3e\x3cimg onclick\x3d"goToReadFull('+a.message[b].id+')" class\x3d"carousel-img hand" src\x3d"'+changeNotNullString(a.message[b].img_url)+'" alt\x3d"'+changeNotNullString(a.message[b].title)+'"/\x3e\x3cdiv class\x3d"carousel-caption"\x3e\x3ch1\x3e'+changeNotNullString(a.message[b].title)+"\x3c/h1\x3e\x3cp\x3e"+changeNotNullString(a.message[b].digest)+"\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e";$("#main-container .carousel-inner").append(c)}else $("#carousel-example-generic").remove();else $("#carousel-example-generic").remove(),ajaxError(a)},error:function(a){ajaxError(a)}})}function showImg(a){a=blogs[a];layer.photos({photos:{title:"\u76f8\u518c\u6807\u9898",id:0,start:0,data:[{alt:a.title,pid:0,src:a.img_url,thumb:a.img_url}]},shift:1})}function attention(a,b){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{table_name:"t_blog",table_id:a,t:Math.random()},dataType:"json",url:"/at/attention",beforeSend:function(){},success:function(a){layer.close(c);a.isSuccess?(layer.msg(a.message),$(".row_"+b).find(".attention").text("\u5df2\u5173\u6ce8")):ajaxError(a)},error:function(b){layer.close(c);ajaxError(b)}})}function collection(a,b){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:{table_name:"t_blog",table_id:a,t:Math.random()},dataType:"json",url:"/cl/collection",beforeSend:function(){},success:function(a){layer.close(c);a.isSuccess?(layer.msg(a.message),$(".row_"+b).find(".collection").text("\u5df2\u6536\u85cf")):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}function deleteBlog(a,b){layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u7bc7\u6587\u7ae0\u8bb0\u5f55\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",dataType:"json",url:"/bg/blog?b_id\x3d"+a,beforeSend:function(){},success:function(a){layer.close(c);a.isSuccess?(layer.msg(a.message),$(".row_"+b).remove()):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})},function(){})}function updateBlog(a,b){window.open("/pb?bid\x3d"+a,"_self")}function reportBlog(a,b){1>parseInt(a)?layer.msg("\u65e0\u6cd5\u83b7\u53d6\u6587\u7ae0"):($("#report-blog").modal("show"),$("#report-modal-body").find(".report-btn").removeClass("active"),$("#report-modal-body").find(".default-report-btn").addClass("active"),$("#report-modal-body").find("textarea").val(""),$("#report-modal-body").attr("blog-id",a))}function my(a){isEmpty(a)?layer.msg("\u8be5\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u6838\u5b9e"):linkToMy(a)};