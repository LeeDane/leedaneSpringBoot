var layEditIndex=0;layui.use(["element","util","form","laydate","layedit"],function(){elem=layui.element;form=layui.form;util=layui.util;laydate=layui.laydate;layedit=layui.layedit;layEditIndex=layedit.build("content",{tool:"strong italic underline del | left center right".split(" ")});var d=(new Date).Format("yyyy-MM-dd HH:mm:ss");laydate.render({elem:"#end-date",type:"datetime",btns:["clear","confirm"],min:d});$("#layui-badge-dot-text").hover(function(){openTipMsg("#layui-badge-dot-text","1\u3001\u6bcf\u53d1\u9001\u4e00\u6761\u77ed\u4fe1\uff0c\u5e73\u53f0\u5c06\u81ea\u8d39\u652f\u4ed80.045\u5143\uff0c\u8bf7\u5408\u7406\u4f7f\u7528\u8be5\u529f\u80fd.\x3cbr/\x3e2\u3001\u8bf7\u5408\u6cd5\u4f7f\u7528\uff0c\u4e0d\u8981\u53d1\u9001\u975e\u6cd5\u4fe1\u606f.\x3cbr/\x3e3\u3001\u5982\u679c\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6709\u4ec0\u4e48\u95ee\u9898(\u5305\u62ec\u4fb5\u6743\u3001\u6d89\u6848\u3001\u53d6\u8bc1\u7b49)\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7ba1\u7406\u5458\u5904\u7406\u3002\u611f\u8c22\u60a8\u7684\u5408\u4f5c\u3002\x3cbr/\x3e",2)},function(){layer.close(subtips)});form.on("checkbox(way)",function(a){switch(a.elem.name){case "waySms":a.elem.checked?$("#phoneContainer").show(500):$("#phoneContainer").hide(500);break;case "wayEmail":a.elem.checked?$("#emailContainer").show(500):$("#emailContainer").hide(500)}console.log(a.elem);console.log(a.elem.checked);console.log(a.value);console.log(a.othis)});form.on("submit(add-letter)",function(a){var g=layedit.getContent(layEditIndex);if(isEmpty(g))return layer.tips("\u8bf7\u5148\u8f93\u5165\u4fe1\u4ef6\u7684\u5185\u5bb9\uff01","#contentContainer",{tips:[3,"#FFB800"],time:3E3}),!1;var e=a.field.phone;if(isEmpty(a.field.waySms))e="";else if(!/^1\d{10}$/.test(e))return layer.tips("\u8bf7\u5148\u8f93\u5165\u5408\u6cd5\u624b\u673a\u53f7\u7801\uff01","#phone",{tips:[3,"#FFB800"],time:3E3}),!1;var f=a.field.email;if(isEmpty(a.field.wayEmail))f="";else if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(f))return layer.tips("\u8bf7\u5148\u8f93\u5165\u5408\u6cd5\u7535\u5b50\u90ae\u7bb1\uff01","#email",{tips:[3,"#FFB800"],time:3E3}),!1;if("day"==a.field.cycle){var c=a.field.time,b=c.substring(0,2),d=c.substring(3,5),c=c.substring(6,8);parseInt(c);parseInt(d);parseInt(b)}b="";isEmpty(a.field.waySms)||(b+=" \u77ed\u4fe1");isEmpty(a.field.wayNotify)||(b+=" \u7ad9\u5185\u4fe1");isEmpty(a.field.wayEmail)||(b+=" \u90ae\u4ef6");if(isEmpty(b))return layer.tips("\u901a\u77e5\u65b9\u5f0f\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\uff01","#way",{tips:[2,"#FFB800"],time:3E3}),!1;a={calla:a.field.calla,end:a.field.end,content:g,publica:isEmpty(a.field.publica)?!1:a.field.publica,sign:a.field.sign,subject:a.field.subject,phone:e,email:f,way:b};var h=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"POST",url:"/my/manage/future/letter",data:a,dataType:"json",success:function(a){layer.close(h);a.success?(layer.msg(a.message+", 1\u79d2\u540e\u81ea\u52a8\u8df3\u8f6c"),reloadPage(1E3)):ajaxError(a)},error:function(a){ajaxError(a);layer.close(h)}});return!1})});