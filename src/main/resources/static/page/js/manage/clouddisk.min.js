var path="/",$pathBreadcrumb,$cards;layui.use(["element","util","table","upload","form"],function(){elem=layui.element;form=layui.form;util=layui.util;var b=layui.table;upload=layui.upload;b.render({elem:"#mytable",url:"/my/manage/all/my/attention",title:"\u6570\u636e\u8868",cols:[[{field:"id",title:"ID",width:80,unresize:!0,sort:!0},{field:"type",title:"\u7c7b\u578b",width:100},{field:"source",title:"\u6807\u9898",width:600},{field:"link",title:"\u94fe\u63a5",width:180},{field:"create_time",title:"\u521b\u5efa\u65f6\u95f4",width:180},{fixed:"right",title:"\u64cd\u4f5c",toolbar:"#barDemo",width:100}]],page:!0});b.on("toolbar(mytable)",function(a){var c=b.checkStatus(a.config.id);switch(a.event){case "getCheckData":a=c.data;layer.alert(JSON.stringify(a));break;case "getCheckLength":a=c.data;layer.msg("\u9009\u4e2d\u4e86\uff1a"+a.length+" \u4e2a");break;case "isAll":layer.msg(c.isAll?"\u5168\u9009":"\u672a\u5168\u9009")}});b.on("tool(mytable)",function(a){var c=a.data;"del"===a.event&&layer.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8be5\u6761\u5173\u6ce8\u8bb0\u5f55\u5417",function(a){var b=layer.load("\u52aa\u529b\u5220\u9664\u4e2d\u2026");$.ajax({type:"delete",url:"/my/manage/all/my/attention?id\x3d"+c.id,dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.success?(layer.msg(a.message+",2\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(2E3)):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})})});$("#layui-badge-dot-text").hover(function(){openTipMsg("#layui-badge-dot-text","1\u3001\u8bf7\u4e0d\u8981\u4e0a\u4f20\u8fdd\u6cd5\u884c\u4e3a\u3001\u8272\u60c5\u3001\u66b4\u52a8\u3001\u653f\u6cbb\u76ee\u7684\u5f3a\u7b49\u6587\u4ef6\u5230\u4e91\u76d8.\x3cbr/\x3e2\u3001\u4e91\u76d8\u5b8c\u5168\u514d\u8d39\u4f7f\u7528\uff0c\u4f46\u662f\u670d\u52a1\u5668\u8d44\u6e90\u6709\u9650\uff0c\u8bf7\u914c\u60c5\u5408\u7406\u4f7f\u7528\u5373\u53ef\u3002\x3cbr/\x3e3\u3001\u5982\u679c\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7ba1\u7406\u5458\u5904\u7406\u3002\u611f\u8c22\u4f60\u7684\u5408\u4f5c\u3002\x3cbr/\x3e",2)},function(){layer.close(subtips)});form.on("checkbox(select-all)",function(a){console.log(a.elem);console.log(a.elem.checked);console.log(a.value);console.log(a.othis);$(".layui-card-body input[type\x3dcheckbox]").prop("checked",a.elem.checked);form.render("checkbox")});form.on("checkbox(select-single)",function(a){console.log(a.elem);console.log(a.elem.checked);console.log(a.value);console.log(a.othis);if(a.elem.checked){form.render("checkbox");a=!0;for(var b=$(".layui-card-body input[type\x3dcheckbox]"),d=0;d<b.length;d++)if(!b.eq(d).prop("checked")){a=!1;break}a&&($(".layui-card-header input[lay-filter\x3dselect-all]").eq(0).prop("checked",!0),form.render("checkbox"))}else{var b=$(".layui-card-header input[lay-filter\x3dselect-all]");b.eq(0).prop("checked",!1);form.render("checkbox")}});$pathBreadcrumb=$("#path-breadcrumb");$cards=$("#cards");list()});function list(){$(".layui-card-header input[lay-filter\x3dselect-all]").eq(0).prop("checked",!1);form.render("checkbox");var b=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"get",url:"/my/manage/clouddisk/read/catalog?path\x3d"+getPath(),dataType:"json",beforeSend:function(){$cards.find(".layui-card-body").remove()},success:function(a){layer.close(b);if(a.success)if(buildBreadcrumb(),$cards.find(".layui-card-body").remove(),path=a.extra.path,0==a.message.length)$cards.append('\x3cdiv class\x3d"layui-card-body"\x3e\u8be5\u76ee\u5f55\u4e0b\u6682\u65f6\u6ca1\u6709\u6587\u4ef6\uff0c\u8bf7\u5148\u4e0a\u4f20\x3c/div\x3e');else{for(var c=0;c<a.message.length;c++){var d=a.message[c],e='\x3cdiv class\x3d"layui-card-body"\x3e\x3cdiv class\x3d"layui-container"\x3e\x3cdiv class\x3d"layui-row"\x3e\x3cdiv class\x3d"layui-col-md1 layui-col-xs12" style\x3d"text-align:center;"\x3e\x3cdiv class\x3d"layui-form"\x3e\x3cdiv class\x3d"layui-form-item"\x3e\x3cinput type\x3d"checkbox" name\x3d"" lay-skin\x3d"primary" lay-filter\x3d"select-single"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"layui-col-md5 layui-col-xs12"\x3e',e=d.isdir?e+('\x3ci class\x3d"layui-icon layui-icon-file" style\x3d"font-size: 15px; color: #FFB800; margin-right: 5px;"\x3e\x3c/i\x3e\x3ca class\x3d"myfilename" onclick\x3d"ckickFolder(this);"\x3e'+changeNotNullString(d.name)+"\x3c/a\x3e"):e+('\x3ci class\x3d"layui-icon layui-icon-file-b" style\x3d"font-size: 13px; margin-right: 5px;"\x3e\x3c/i\x3e\x3ca class\x3d"myfilename"\x3e'+changeNotNullString(d.name)+"\x3c/a\x3e"),e=e+('\x3c/div\x3e\x3cdiv class\x3d"layui-col-md1 layui-col-xs12"\x3e'+(d.isdir?"\u6587\u4ef6\u5939":formatFileSize(d.size))+'\x3c/div\x3e\x3cdiv class\x3d"layui-col-md2 layui-col-xs12"\x3e'+setTimeAgo(d.time)+'\x3c/div\x3e\x3cdiv class\x3d"layui-col-md3 layui-col-xs12"\x3e\x3cdiv class\x3d"layui-btn-group"\x3e\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-xs layui-btn-warm" onclick\x3d"rename(this);"\x3e\u91cd\u547d\u540d\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-xs layui-btn-danger" onclick\x3d"deleteFile(this);"\x3e\u5220\u9664\x3c/button\x3e');d.isdir||(e+='\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-xs" onclick\x3d"downloadFile(this);"\x3e\u4e0b\u8f7d\x3c/button\x3e');e+="\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";$cards.append(e)}form.render()}else ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})}function buildBreadcrumb(){$pathBreadcrumb.empty();if(!isEmpty(path))for(var b=path.split("/"),a=0;a<b.length;a++)isEmpty(b[a])||$pathBreadcrumb.append('\x3cspan lay-separator\x3e/\x3c/span\x3e\x3ca onclick\x3d"ckickBreadcrumb(this);" data-index\x3d"'+a+'"\x3e'+b[a]+"\x3c/a\x3e");elem.render("breadcrumb","bread")}var tmpUploadIndex=-1;function openUpload(){layer.open({type:1,skin:"layui-layer-rim",area:["650px","340px"],content:'\x3cdiv class\x3d"layui-upload" style\x3d"padding: 8px;"\x3e\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-warm" id\x3d"testList"\x3e\u9009\u62e9\u591a\u6587\u4ef6\x3c/button\x3e \x3cdiv class\x3d"layui-upload-list"\x3e\x3ctable class\x3d"layui-table"\x3e\x3cthead\x3e\x3ctr\x3e\x3cth\x3e\u6587\u4ef6\u540d\x3c/th\x3e\x3cth\x3e\u5927\u5c0f\x3c/th\x3e\x3cth\x3e\u72b6\u6001\x3c/th\x3e\x3cth\x3e\u64cd\u4f5c\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e\x3ctbody id\x3d"demoList"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cbutton type\x3d"button" class\x3d"layui-btn" id\x3d"testListAction"\x3e\u5f00\u59cb\u4e0a\u4f20\x3c/button\x3e\x3c/div\x3e '});var b=$("#demoList"),a=upload.render({elem:"#testList",url:"/my/manage/clouddisk/create/file",data:{path:getPath()},accept:"file",type:"POST",multiple:!0,auto:!1,bindAction:"#testListAction",choose:function(c){var d=this.files=c.pushFile();c.preview(function(e,g,h){var f=$(['\x3ctr id\x3d"upload-'+e+'"\x3e',"\x3ctd\x3e"+g.name+"\x3c/td\x3e","\x3ctd\x3e"+(g.size/1024).toFixed(1)+"kb\x3c/td\x3e",'\x3ctd\x3e\u7b49\u5f85\u4e0a\u4f20\x3c/td\x3e\x3ctd\x3e\x3cbutton class\x3d"layui-btn layui-btn-xs demo-reload layui-hide"\x3e\u91cd\u4f20\x3c/button\x3e\x3cbutton class\x3d"layui-btn layui-btn-xs layui-btn-danger demo-delete"\x3e\u5220\u9664\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e'].join(""));f.find(".demo-reload").on("click",function(){c.upload(e,g)});f.find(".demo-delete").on("click",function(){delete d[e];f.remove();a.config.elem.next()[0].value=""});b.append(f)})},before:function(a){layer.load(2,{shade:[.1,"#fff"]});tmpUploadIndex=0},done:function(a,d,e){if(a.success)return tmpUploadIndex+=1,a=b.find("tr#upload-"+d).children(),a.eq(2).html('\x3cspan style\x3d"color: #5FB878;"\x3e\u4e0a\u4f20\u6210\u529f\x3c/span\x3e'),a.eq(3).html(""),b.find("tr").length==tmpUploadIndex&&(list(),layer.closeAll()),delete this.files[d];this.error(d,e)},error:function(a,d){var c=b.find("tr#upload-"+a).children();c.eq(2).html('\x3cspan style\x3d"color: #FF5722;"\x3e\u4e0a\u4f20\u5931\u8d25\x3c/span\x3e');c.eq(3).find(".demo-reload").removeClass("layui-hide")}})}function addFolder(){layer.prompt({title:"\u8bf7\u6dfb\u52a0\u6587\u4ef6\u5939\u5230\u76ee\u5f55\uff1a"+getPath(),formType:3},function(b,a){layer.close(a);var c=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",url:"/my/manage/clouddisk/create/folder",data:{path:getPath()+"/"+b},dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.success?list():ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})})}function ckickFolder(b){path=path+"/"+$(b).text();list()}function ckickBreadcrumb(b){b=$(b).data("index");if(!isEmpty(path))for(var a=path.split("/"),c="",d=0;d<a.length;d++)if(!isEmpty(a[d])&&(c+="/"+a[d],d==b)){path=c;list();break}}function getPath(){return isEmpty(path)?"/":path}function rename(b){var a=$(b).closest(".layui-row").find(".myfilename").html();layer.prompt({title:"\u5c06\u540d\u79f0\u300a"+a+"\u300b\u8fdb\u884c\u66ff\u6362\u6210",formType:3},function(b,d){layer.close(d);var c=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",url:"/my/manage/clouddisk/rename",data:{oldName:getPath()+"/"+a,newName:getPath()+"/"+b},dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.success?list():ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})})}function toRoot(){path="/";list()}function deleteFile(b){var a=$(b).closest(".layui-row").find(".myfilename").html();layer.confirm("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u6587\u4ef6\u300a"+a+"\u300b, \u5982\u679c\u662f\u6587\u4ef6\u5939\uff0c\u5176\u5b50\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u5c06\u88ab\u5220\u9664\uff1f",{icon:2,skin:"delete-confirm-btn",btn:["\u786e\u5b9a","\u53d6\u6d88"]},function(){var b=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"delete",url:"/my/manage/clouddisk/delete?path\x3d"+getPath()+"/"+a,dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);layer.closeAll();a.success?list():ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})}function deleteBatch(){if(1>$(".layui-card-body input[type\x3dcheckbox]:checked").length)layer.msg("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6");else{for(var b=$(".layui-card-body input[type\x3dcheckbox]:checked"),a="",c=0;c<b.length;c++)a+=b.eq(c).closest(".layui-row").find(".myfilename").html()+",";b=0<$(".layui-card-header input[lay-filter\x3dselect-all]:checked").length?"\u60a8\u786e\u5b9a\u8981\u6e05\u7a7a\u8be5\u6587\u4ef6\u5939\u4e0b\u6240\u6709\u6587\u4ef6\uff1f":"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8fd9"+b.length+"\u4e2a\u6587\u4ef6\uff1f";layer.confirm(b+", \u5982\u679c\u662f\u6587\u4ef6\u5939\uff0c\u5176\u5b50\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u5c06\u88ab\u5220\u9664\u3002",{icon:2,skin:"delete-confirm-btn",btn:["\u786e\u5b9a","\u53d6\u6d88"]},function(){var b=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"delete",url:"/my/manage/clouddisk/delete/batch?path\x3d"+deleteLastStr(a)+"\x26\x26root\x3d"+getPath(),dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);layer.closeAll();a.success?list():ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})}}function downloadFile(b){b=$(b).closest(".layui-row").find(".myfilename").html();var a=document.createElement("a");a.download=b;a.href="/my/manage/clouddisk/download/file?path\x3d"+getPath()+"/"+b+"\x26name\x3d"+b;a.click()};