layui.use(["form"],function(){form=layui.form;if(0<$("#has-referrer-code").length){var c=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"GET",url:"/my/manage/mall/referrer/relation",dataType:"json",success:function(a){layer.close(c);if(a.success){myChart=echarts.init(document.getElementById("my-chart"));var b={};b.nodes=a.message.nodes;b.links=a.message.links;a=[{name:"\u4e0a\u4e0a\u7ea7",itemStyle:{color:"rgb(0,134,139)"}},{name:"\u4e0a\u7ea7",itemStyle:{color:"rgb(123,104,238)"}},{name:"\u60a8",itemStyle:{color:"rgb(255,0,0)"}},{name:"\u4e0b\u7ea7",itemStyle:{color:"rgb(205,92,92)"}},{name:"\u4e0b\u4e0b\u7ea7",itemStyle:{color:"rgb(255\uff0c0\uff0c255)"}}];b.nodes.forEach(function(a){a.value=a.symbolSize;a.draggable=!0;a.label="dddd";delete a.attributes;delete a.sourceId;delete a.parentId;delete a.x;delete a.y;delete a.z;delete a.value});console.log(JSON.stringify(b));option={title:{text:"\u63a8\u8350\u5173\u7cfb\u56fe",subtext:"Default layout",top:"bottom",left:"right"},tooltip:{},legend:[{data:a.map(function(a){return a.name})}],animation:!1,series:[{name:"\u4e0e\u60a8\u5173\u7cfb",type:"graph",layout:"force",data:b.nodes,links:b.links,categories:a,roam:!0,label:{position:"right"},force:{repulsion:250}}]};myChart.setOption(option)}else ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}});function bindReferrer(){var c=$("#referrer-code").val();isEmpty(c)?layer.confirm("\u60a8\u6ca1\u586b\u5199\u63a8\u8350\u7801\uff0c\u662f\u5426\u9ed8\u8ba4\u7ed1\u5b9a\u7cfb\u7edf\u7ba1\u7406\u5458\u505a\u4e3a\u60a8\u7684\u63a8\u8350\u4eba\uff1f",{btn:["\u7ed1\u5b9a\u7ba1\u7406\u5458","\u8003\u8651\u4e00\u4e0b"]},function(){doBind(c)},function(){layer.tips("\u8bf7\u5148\u586b\u5199\u6b63\u786e\u7684\u63a8\u8350\u7801","#referrer-code",{tips:[3,"#FFB800"],time:3E3})}):doBind(c)}function doBind(c){var a=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"POST",url:"/my/manage/mall/referrer/bind",data:{code:c},dataType:"json",success:function(b){layer.close(a);b.success?(layer.msg(b.message+"\uff0c2\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(2E3)):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}function buildReferrerCode(){if(0<$("#referrer-code").length)layer.tips("\u8bf7\u5148\u7ed1\u5b9a\u63a8\u8350\u4eba\u540e\u624d\u64cd\u4f5c","#referrer-code",{tips:[3,"#FFB800"],time:3E3});else{var c=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"POST",url:"/my/manage/mall/referrer/code",dataType:"json",success:function(a){layer.close(c);a.success?(layer.msg(a.message+" 2\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(2E3)):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}};