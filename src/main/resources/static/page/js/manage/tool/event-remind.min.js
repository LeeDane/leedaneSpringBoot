var path="/",$pathBreadcrumb,$cards;layui.use(["element","util","form","laydate","table"],function(){elem=layui.element;form=layui.form;util=layui.util;table=layui.table;laydate=layui.laydate;laydate.render({elem:"#task-time",type:"time"});var b=new Date,b=b.setDate(b.getDate()+1),b=new Date(b),b=b.Format("yyyy-MM-dd");laydate.render({elem:"#end-date",type:"date",min:b});table.render({elem:"#mytable",url:"/my/manage/tool/event/reminds",title:"\u6570\u636e\u8868",cols:[[{field:"id",title:"ID",width:80,unresize:!0,sort:!0},{field:"name",title:"\u540d\u79f0",width:150},{field:"type",title:"\u7c7b\u578b",width:150},{field:"content",title:"\u5185\u5bb9",width:150},{field:"time",title:"\u6267\u884c\u65f6\u95f4",width:90},{field:"cycle",title:"\u6267\u884c\u5468\u671f",width:90},{field:"cron",title:"\u8868\u8fbe\u5f0f",width:120},{field:"way",title:"\u65b9\u5f0f",width:150},{field:"create_time",title:"\u521b\u5efa\u65f6\u95f4",width:180},{fixed:"right",title:"\u64cd\u4f5c",toolbar:"#barDemo",width:100}]],page:!0});$("#layui-badge-dot-text").hover(function(){openTipMsg("#layui-badge-dot-text","1\u3001\u6bcf\u53d1\u9001\u4e00\u6761\u77ed\u4fe1\uff0c\u5e73\u53f0\u5c06\u81ea\u8d39\u652f\u4ed80.045\u5143\uff0c\u8bf7\u5408\u7406\u4f7f\u7528\u8be5\u529f\u80fd.\x3cbr/\x3e2\u3001\u8bf7\u5408\u6cd5\u4f7f\u7528\uff0c\u4e0d\u8981\u53d1\u9001\u975e\u6cd5\u4fe1\u606f.\x3cbr/\x3e3\u3001\u5982\u679c\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6709\u4ec0\u4e48\u95ee\u9898(\u5305\u62ec\u4fb5\u6743\u3001\u6d89\u6848\u3001\u53d6\u8bc1\u7b49)\uff0c\u8bf7\u53ca\u65f6\u8054\u7cfb\u7ba1\u7406\u5458\u5904\u7406\u3002\u611f\u8c22\u60a8\u7684\u5408\u4f5c\u3002\x3cbr/\x3e",2)},function(){layer.close(subtips)});$("#layui-badge-task-way").hover(function(){openTipMsg("#layui-badge-task-way","1\u3001\u5982\u679c\u77ed\u4fe1\u65e0\u6cd5\u9009\u62e9\uff0c\u8bf7\u6838\u67e5\u662f\u5426\u7ed1\u5b9a\u624b\u673a\u53f7\u7801.\x3cbr/\x3e2\u3001\u5982\u679c\u90ae\u4ef6\u65e0\u6cd5\u9009\u62e9\uff0c\u8bf7\u6838\u67e5\u662f\u5426\u7ed1\u5b9a\u7535\u5b50\u90ae\u7bb1.\x3cbr/\x3e3\u3001\u5176\u4ed6\u95ee\u9898\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u53cd\u9988\u3002\x3cbr/\x3e",2)},function(){layer.close(subtips)});$pathBreadcrumb=$("#path-breadcrumb");$cards=$("#cards");form.on("submit(add-task)",function(a){if(isEmpty(a.field.name))return layer.tips("\u8bf7\u5148\u8f93\u5165\u6d88\u606f\u540d\u79f0\uff01","#task-name",{tips:[3,"#FFB800"],time:3E3}),!1;if(isEmpty(a.field.time))return layer.tips("\u8bf7\u5148\u9009\u62e9\u65f6\u95f4\uff01","#task-time",{tips:[3,"#FFB800"],time:3E3}),!1;var b;if("day"==a.field.cycle){var d=a.field.time;b=d.substring(0,2);var c=d.substring(3,5),d=d.substring(6,8);b=parseInt(d)+" "+parseInt(c)+" "+parseInt(b)+" * * ?"}c="";isEmpty(a.field.waySms)||(c+=" \u77ed\u4fe1");isEmpty(a.field.wayNotify)||(c+=" \u7ad9\u5185\u4fe1");isEmpty(a.field.wayEmail)||(c+=" \u90ae\u4ef6");if(isEmpty(c))return layer.tips("\u901a\u77e5\u65b9\u5f0f\u81f3\u5c11\u9009\u62e9\u4e00\u79cd\uff01","#task-way",{tips:[2,"#FFB800"],time:3E3}),!1;a={name:a.field.name,cron:b,time:a.field.time,cycle:a.field.cycle,type:a.field.type,end:a.field.end,way:c,content:isEmpty(a.field.content)?a.field.name:a.field.content};var e=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"POST",url:"/my/manage/tool/event/remind",data:a,dataType:"json",success:function(a){layer.close(e);a.success?(layer.msg(a.message+", 1\u79d2\u540e\u81ea\u52a8\u8df3\u8f6c"),reloadPage(1E3)):ajaxError(a)},error:function(a){ajaxError(a);layer.close(e)}});return!1});table.on("tool(mytable)",function(a){var b=a.data;"del"===a.event&&layer.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8be5\u6761\u63d0\u9192\u8bb0\u5f55\u5417",function(a){var c=layer.load("\u52aa\u529b\u5220\u9664\u4e2d\u2026");$.ajax({type:"delete",url:"/my/manage/tool/event/remind/"+b.id,dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.success?(layer.msg(a.message+",1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})})})});