layui.use(["layedit","form"],function(){form=layui.form;$("#get-check-code").on("click",function(){var a=$("#phone"),b=a.val();if(isEmpty(b)||11!=b.length)return layer.tips("\u8bf7\u5148\u586b\u5199\u5b8c\u657411\u4f4d\u624b\u673a\u53f7\u7801\uff01","#phone",{tips:[3,"#FFB800"],time:3E3}),!1;if(!/^1\d{10}$/.test(b))return layer.tips("\u8bf7\u5148\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801\uff01","#phone",{tips:[3,"#FFB800"],time:3E3}),!1;var c=$("#old-phone").text();if(isNotEmpty(c)&&c==b)return layer.tips("\u9700\u8981\u7ed1\u5b9a\u7684\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u8ddf\u539f\u6765\u7684\u4e00\u81f4\uff01","#phone",{tips:[3,"#FFB800"],time:3E3}),!1;var d=$(this);d.find("button").addClass("layui-btn-disabled");d.find("button").attr("disabled","disabled");a.attr("disabled","disabled");var e=layer.load(2,{shade:[.1,"#fff"]});$.ajax({type:"POST",url:"/tl/sms/sendCode",data:{phone:b,type:"bindPhone"},dataType:"json",success:function(b){layer.close(e);b.isSuccess?(layer.msg(b.message),leftSeconds(120,function(a){d.html('\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-sm layui-btn-disabled" disabled\x3d"disabled"\x3e\u8fd8\u5269\u4f59'+a+"\u79d2\x3c/button\x3e")},function(){a.removeAttr("disabled");d.html('\x3cbutton type\x3d"button" class\x3d"layui-btn layui-btn-sm" style\x3d""\x3e\x3ci class\x3d"layui-icon layui-icon-release" style\x3d"font-size: 12px!important;"\x3e\x3c/i\x3e\u83b7\u53d6\u9a8c\u8bc1\u7801\x3c/button\x3e')})):(d.find("button").removeClass("layui-btn-disabled"),d.find("button").removeAttr("disabled"),a.removeAttr("disabled"),ajaxError(b))},error:function(b){layer.close(e);d.find("button").removeClass("layui-btn-disabled");d.find("button").removeAttr("disabled");a.removeAttr("disabled");ajaxError(b)}});return!1});form.on("submit(send-phone)",function(a){var b=layer.load(2,{shade:[.1,"#fff"]}),c=new JSEncrypt;c.setPublicKey($("#publicKey").val());$.ajax({type:"POST",url:"/my/manage/my/phone/bind",data:{phone:a.field.phone,code:a.field.code,type:"bindPhone",pwd:c.encrypt($.md5(a.field.password))},dataType:"json",success:function(a){layer.close(b);a.isSuccess?(layer.msg(a.message),reloadPage(2E3)):ajaxError(a)},error:function(a){ajaxError(a);layer.close(b)}});return!1})});function leftSeconds(a,b,c){b(a);a&&0>a?c():setTimeout(function(){--a;leftSeconds(a,b,c)},1E3)};