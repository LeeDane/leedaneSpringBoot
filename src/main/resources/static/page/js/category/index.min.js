layui.use(["layer"],function(){layer=layui.layer;$tree=$("#tree");getChildNodes(0,0)});var $tree;function getChildNodes(e,a){var d=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cg/category/"+a+"/children",dataType:"json",beforeSend:function(){},success:function(b){layer.close(d);b.success?(b=b.message,1>a?$tree.treeview({data:b,enableLinks:!1,onNodeExpanded:function(a,c){console.log("data\x3d");getChildNodes(c.nodeId,c.id)}}):$tree.treeview("addNodes",[e,{node:b}])):ajaxError(b)},error:function(a){layer.close(d);ajaxError(a)}})}function addRoot(e){layer.prompt({title:"\u8bf7\u8f93\u5165\u6839\u8282\u70b9\u7684\u6587\u672c(\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u4e0d\u80fd\u8d85\u8fc78\u4e2a\u5b57\u7b26)",formType:0},function(a,d){layer.load(1,{shade:[.1,"#fff"]});var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"POST",data:{text:a},url:"/cg/category",dataType:"json",beforeSend:function(){},success:function(a){a.success?(layer.closeAll(),layer.msg("\u6839\u8282\u70b9\u6dfb\u52a0\u6210\u529f\uff0c1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):(layer.close(b),ajaxError(a))},error:function(a){layer.close(b);ajaxError(a)}})})}function addNode(e){var a=$tree.treeview("getSelected",0);a&&0<a.length?layer.prompt({title:"\u8bf7\u8f93\u5165\u5b50\u8282\u70b9\u7684\u6587\u672c(\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u4e0d\u80fd\u8d85\u8fc78\u4e2a\u5b57\u7b26)",formType:0},function(d,b){layer.load(1,{shade:[.1,"#fff"]});var f=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"POST",data:{text:d,pid:a[0].id},url:"/cg/category",dataType:"json",beforeSend:function(){},success:function(c){c.success?(layer.closeAll(),c=c.message,c.state={},c.state.expanded=!0,$tree.treeview("addNode",[a[0].nodeId,{node:c}])):(layer.close(f),ajaxError(c))},error:function(a){layer.close(f);ajaxError(a)}})}):layer.msg("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u8282\u70b9\uff01")}function updateNode(e){var a=$tree.treeview("getSelected",0);a&&0<a.length?(e=a[0].is_system,!isAdmin&&e?layer.msg("\u60a8\u6ca1\u6709\u4fee\u6539\u6839\u8282\u70b9\u7684\u6743\u9650"):layer.prompt({title:"\u8bf7\u8f93\u5165\u4fee\u6539\u5b50\u8282\u70b9\u7684\u6587\u672c(\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u4e0d\u80fd\u8d85\u8fc78\u4e2a\u5b57\u7b26)",formType:0},function(d,b){layer.load(1,{shade:[.1,"#fff"]});var f=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"PUT",data:{text:d},url:"/cg/category/"+a[0].id,dataType:"json",beforeSend:function(){},success:function(c){c.success?(layer.closeAll(),layer.msg(c.message),$tree.treeview("updateNode",[a[0].nodeId,{node:{text:d,state:{expanded:!0}}}])):(layer.close(f),ajaxError(c))},error:function(a){layer.close(f);ajaxError(a)}})})):layer.msg("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u60a8\u8981\u4fee\u6539\u7684\u8282\u70b9\uff01")}function deleteNode(e){var a=$tree.treeview("getSelected",0);a&&0<a.length?(e=a[0].is_system,!isAdmin&&e?layer.msg("\u60a8\u6ca1\u6709\u5220\u9664\u6839\u8282\u70b9\u7684\u6743\u9650"):layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u8282\u70b9\u4ee5\u53ca\u5176\u4e0b\u9762\u7684\u5168\u90e8\u8282\u70b9\u5417\uff1f\r\n\u5220\u9664\u6210\u529f\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u8bf7\u614e\u91cd\uff01",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var d=a[0].id,b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"DELETE",url:"/cg/category/"+d,dataType:"json",beforeSend:function(){},success:function(f){layer.close(b);f.success?(layer.msg(f.message),$tree.treeview("deleteNode",[a[0].nodeId,{silent:!0}])):ajaxError(f)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})):layer.msg("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u8981\u5220\u9664\u7684\u8282\u70b9\uff01")};