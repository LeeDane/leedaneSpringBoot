layui.use(["layer"],function(){layer=layui.layer;0<bid&&ue.addListener("ready",function(){getEditBlog(bid)});$('[name\x3d"has_img"]').click(function(){this.checked?$(".img-url-row").removeClass("hidden"):$(".img-url-row").addClass("hidden")});$('[name\x3d"is_original"]').click(function(){this.checked?$(".is-original-row").addClass("hidden"):$(".is-original-row").removeClass("hidden")})});var ue=UE.getEditor("editor",{initialFrameHeight:"200",toolbars:["fullscreen source | undo redo | bold italic underline fontborder strikethrough superscript subscript removeformat formatmatch autotypeset blockquote pasteplain | forecolor backcolor insertorderedlist insertunorderedlist selectall cleardoc | rowspacingtop rowspacingbottom lineheight | customstyle paragraph fontfamily fontsize | directionalityltr directionalityrtl indent | justifyleft justifycenter justifyright justifyjustify | touppercase tolowercase | link unlink anchor | imagenone imageleft imageright imagecenter | simpleupload insertimage emotion scrawl attachment map insertframe insertcode pagebreak template background | horizontal date time spechars wordimage | inserttable deletetable insertparagraphbeforetable insertrow deleterow insertcol deletecol mergecells mergeright mergedown splittocells splittorows splittocols charts | print preview searchreplace drafts".split(" ")],enterTag:"\x26nbsp;"});function getEditBlog(a){$.ajax({url:"/bg/blog/edit/"+a,dataType:"json",beforeSend:function(){},success:function(b){null!=b&&b.success&&1==b.message.length?addToEdit(b.message[0]):(ajaxError(b),window.history.forward(1),setTimeout('window.open("/pb", "_self")',1500))},error:function(b){ajaxError(b)}})}function addTag(a){a=$(a);var b=a.val();isEmpty(b)?(layer.msg("\u6807\u7b7e\u4e0d\u80fd\u4e3a\u7a7a"),a.focus()):10<b.length?layer.msg("\u6807\u7b7e\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc710\u4f4d"):addTagItem(a,b)}function addTagItem(a,b){var c=a.closest(".row").find(".tag-list"),d=c.find(".tag-item"),e=d.length;d&&2<e?layer.msg("\u6807\u7b7e\u8d85\u8fc73\u4e2a\uff0c\u8bf7\u5148\u5220\u9664\u540e\u6dfb\u52a0"):(c.append('\x3cdiv class\x3d"btn-group dropup tag-item tag-item-'+e+'"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary tag-value"\x3e'+b+'\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle" data-toggle\x3d"dropdown" aria-expanded\x3d"false"\x3e\x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3cspan class\x3d"sr-only"\x3eToggle Dropdown\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu dropdown-menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteTag(this, '+e+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"moveLeftTag(this, '+e+');"\x3e\u5de6\u79fb\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"moveRightTag(this, '+e+');"\x3e\u53f3\u79fb\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"clearTag(this);"\x3e\u6e05\u7a7a\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e'),a.val(""))}function deleteTag(a){a=$(a);a.closest(".row").find(".tag-input").focus();a.closest(".tag-item").remove()}function moveLeftTag(a,b){var c=$(a);if(0!=b){var d=c.closest(".tag-item").find(".tag-value").text(),e=b-1,e=c.closest(".tag-list").find(".tag-item-"+e),f=e.find(".tag-value").text();c.closest(".tag-item").find(".tag-value").text(f);e.find(".tag-value").text(d)}}function moveRightTag(a,b){var c=$(a);if(1!=$(a).closest(".tag-list").find(".tag-item").length&&2!=b){var d=c.closest(".tag-item").find(".tag-value").text(),e=b+1,e=c.closest(".tag-list").find(".tag-item-"+e),f=e.find(".tag-value").text();c.closest(".tag-item").find(".tag-value").text(f);e.find(".tag-value").text(d)}}function clearTag(a){a=$(a);a.closest(".row").find(".tag-input").focus();a.closest(".tag-list").empty();a.remove()}function release(){var a={status:1};buildParams(a)&&doRelease(a)}function draft(){var a={status:-1};buildParams(a)&&doRelease(a)}function doRelease(a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:a,url:"/bg/blog",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);null!=a&&a.success?(layer.msg("\u53d1\u5e03\u6587\u7ae0\u6210\u529f"),window.location.reload()):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})}function buildParams(a){var b=$('[name\x3d"title"]'),c=b.val();if(isEmpty(c))return layer.msg(b.attr("placeholder")),b.focus(),!1;a.title=c;b=ue.getContent();if(isEmpty(b))return layer.msg("\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"),ue.focus(),!1;console.log(ue.getAllHtml());a.content=b;if(b=$('[name\x3d"has_img"]').is(":checked")){c=$('[name\x3d"img_url"]').val();if(isNotEmpty(c)&&!isLink(c))return layer.msg("\u8be5\u56fe\u7247\u7684\u94fe\u63a5\u4e0d\u5408\u6cd5"),$('[name\x3d"img_url"]').focus(),!1;a.img_url=c}a.has_img=b;if(!$('[name\x3d"is_original"]').is(":checked")){b=$('[name\x3d"origin_link"]');c=b.val();if(isEmpty(c))return layer.msg(b.attr("placeholder")),b.focus(),!1;if(!isLink(c))return layer.msg("\u8be5\u56fe\u7247\u7684\u94fe\u63a5\u4e0d\u5408\u6cd5"),b.focus(),!1;a.origin_link=c;b=$('[name\x3d"source"]');c=b.val();if(isEmpty(c))return layer.msg(b.attr("placeholder")),b.focus(),!1;a.source=c}b=$('[name\x3d"is_recommend"]').is(":checked");a.is_recommend=b;b=$('[name\x3d"is_stick"]').is(":checked");a.is_stick=b;b=$('[name\x3d"digest"]').val();a.has_digest=isEmpty(b);a.digest=b;b=$(".tag-item");c="";if(b&&0<b.length){for(var d=0;d<b.length;d++)c=d==b.length-1?c+$(b[d]).find(".tag-value").text():c+$(b[d]).find(".tag-value").text()+",";a.tag=c}b=$('[name\x3d"can_comment"]').is(":checked");a.can_comment=b;b=$('[name\x3d"can_transmit"]').is(":checked");a.can_transmit=b;b=$('[name\x3d"public"]').is(":checked");a.public_=b;a.froms="web\u7f51\u9875\u7aef";a.category=$('[name\x3d"category"]').val();bid&&0<bid&&(a.bid=bid);b=$('[name\x3d"create_user_id"]').val();isNotEmpty(b)&&(a.create_user_id=b);return!0}var draftList;function draftlist(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/bg/drafts",dataType:"json",beforeSend:function(){$("#draft-group-list").empty();draftList=[]},success:function(b){layer.close(a);null!=b&&b.success?($("#load-draft").modal("show"),buildDraftList(b.message)):ajaxError(b)},error:function(b){layer.close(a);ajaxError(b)}})}function buildDraftList(a){draftList=a;$("#draft-group-list").empty();for(var b=0;b<a.length;b++){var c='\x3cdiv class\x3d"list-group-item draft-item" style\x3d"cursor:pointer;"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-1 col-sm-1" onclick\x3d"addDraftToEdit('+b+');"\x3e\x3cspan class\x3d"badge"\x3e'+(b+1)+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-6 col-sm-6" onclick\x3d"addDraftToEdit('+b+');"\x3e'+a[b].title+'\x3c/div\x3e\x3cdiv class\x3d"col-lg-4 col-sm-4" onclick\x3d"addDraftToEdit('+b+');"\x3e'+a[b].create_time+'\x3c/div\x3e\x3cdiv class\x3d"col-lg-1 col-sm-1"  onclick\x3d"deleteDraft(this, '+b+');"\x3e\x3cbutton type\x3d"button" class\x3d"close" aria-hidden\x3d"true"\x3e\u00d7\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';$("#draft-group-list").append(c)}}function addDraftToEdit(a){!draftList||1>draftList.length?layer.msg("\u8349\u7a3f\u5217\u8868\u4e3a\u7a7a"):draftList.length<=a?layer.msg("\u7f16\u8f91\u7684\u8349\u7a3f\u7d22\u5f15\u8d8a\u754c\uff0c\u8bf7\u5237\u65b0"):(addToEdit(draftList[a]),$("#load-draft").modal("hide"))}function deleteDraft(a,b){!draftList||1>draftList.length?layer.msg("\u8349\u7a3f\u5217\u8868\u4e3a\u7a7a"):draftList.length<=b?layer.msg("\u7f16\u8f91\u7684\u8349\u7a3f\u7d22\u5f15\u8d8a\u754c\uff0c\u8bf7\u5237\u65b0"):layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u6761\u8349\u7a3f\u8bb0\u5f55\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",url:"/bg/blog?b_id\x3d"+draftList[b].id,dataType:"json",beforeSend:function(){},success:function(c){layer.close(a);c.success?(layer.msg(c.message),draftList.splice(b,1),buildDraftList(draftList)):ajaxError(c)},error:function(b){layer.close(a);ajaxError(b)}})},function(a){ajaxError(a)})}function addToEdit(a){$('[name\x3d"title"]').val(a.title);ue.setContent(a.content);$('[name\x3d"has_img"]').attr("checked",a.has_img);a.has_img&&($(".img-url-row").removeClass("hidden"),$('[name\x3d"img_url"]').val(a.img_url));var b=isNotEmpty(a.source)&&"leedane"==a.source;$('[name\x3d"is_original"]').prop("checked",b);b||($(".is-original-row").removeClass("hidden"),$('[name\x3d"origin_link"]').val(changeNotNullString(a.origin_link)),$('[name\x3d"source"]').val(changeNotNullString(a.source)));$('[name\x3d"is_recommend"]').prop("checked",a.is_recommend);$('[name\x3d"is_stick"]').prop("checked",0<a.stick);$('[name\x3d"digest"]').val(a.digest);var c=a.tag;if(isNotEmpty(c))for(var b=$(".tag-input"),c=c.split(","),d=0;d<c.length;d++)addTagItem(b,c[d]);$('[name\x3d"can_comment"]').attr("checked",a.can_comment);$('[name\x3d"category"]').val(a.category);$('[name\x3d"can_transmit"]').attr("checked",a.can_transmit);$('[name\x3d"create_user_id"]').val(""+a.create_user_id)}function afterSelectCategory(a,b){console.log(a+""+b);$('[name\x3d"category"]').val(b);$("body").removeClass("modal-open")};