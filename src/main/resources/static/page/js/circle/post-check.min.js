layui.use(["layer","laypage"],function(){layer=layui.layer;laypage=layui.laypage;initPage(".pagination","getNoCheckList");$tableContainer=$(".table tbody");$(document).on("click",".post-detail",function(b){b.stopPropagation();(b=$(this).closest(".row-item").data("post"))&&window.open("/cc/"+b.circle_id+"/post/"+b.id+"/audit","_self")});$(document).on("click",".post-agree",function(b){b.stopPropagation();var a=$(this).closest(".row-item").data("post");a&&layer.confirm("\u60a8\u786e\u5b9a\u5c06\u5e16\u5b50\u300a"+a.title+"\u300b\u5ba1\u6838\u901a\u8fc7\u5417\uff1f",{btn:["\u786e\u5b9a","\u653e\u5f03"]},function(){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"POST",url:"/cc/"+a.circle_id+"/post/"+a.id+"/check",data:{status:1},dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);a.isSuccess?(layer.msg(a.message+"\uff0c1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})});$(document).on("click",".post-no-agree",function(b){b.stopPropagation();var a=$(this).closest(".row-item").data("post");layer.confirm("\u60a8\u8981\u5c06\u5e16\u5b50\u300a"+a.title+"\u300b\u5ba1\u6838\u4e0d\u901a\u8fc7\u5417\uff1f\u4e0d\u901a\u8fc7\u5c06\u5220\u9664\u8be5\u5e16\u5b50\u5e76\u65e0\u6cd5\u6062\u590d\uff0c\u8bf7\u614e\u91cd\uff01",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){layer.prompt({title:"\u8bf7\u8f93\u5165\u5ba1\u6838\u4e0d\u901a\u8fc7\u7684\u539f\u56e0(\u5fc5\u586b)",formType:0},function(b,d){layer.load(1,{shade:[.1,"#fff"]});var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"POST",url:"/cc/"+a.circle_id+"/post/"+a.id+"/check",data:{status:2,reason:b},dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.isSuccess?(layer.msg(a.message+"\uff0c1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):(layer.msg(a.message),layer.close(c))},error:function(){layer.close(c);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})})},function(){})});getNoCheckList()});var posts,$circleEditModal,$tableContainer;function getNoCheckList(){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cc/"+circleId+"/post/nochecks?t\x3d"+Math.random(),dataType:"json",beforeSend:function(){$tableContainer.find("tr").remove();$(".pagination").empty()},success:function(a){layer.close(b);if(a.isSuccess){posts=a.message;if(0==posts.length){0==currentIndex?$tableContainer.append('\x3ctr\x3e\x3ctd colspan\x3d"7"\x3e\u8be5\u5708\u5b50\u5df2\u7ecf\u6ca1\u6709\u5f85\u5ba1\u6838\u7684\u5e16\u5b50\uff01\x3c/td\x3e\x3c/tr\x3e'):$tableContainer.append('\x3ctr\x3e\x3ctd colspan\x3d"7"\x3e\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u5f85\u5ba1\u6838\u7684\u5e16\u5b50\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01\x3c/td\x3e\x3c/tr\x3e');return}for(var c=0;c<posts.length;c++)$tableContainer.append(buildEachPostRow(c,posts[c])),$("#row-index-"+c).data("post",posts[c]);laypage.render({elem:"item-pager",layout:["prev","page","next","count","skip"],count:a.total,limit:pageSize,theme:"#337ab7",curr:currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(currentIndex=a.curr-1,getNoCheckList())}})}else ajaxError(a);isLoad=!1},error:function(a){isLoad=!1;layer.close(b);ajaxError(a)}})}function buildEachPostRow(b,a){return'\x3ctr class\x3d"row-item" id\x3d"row-index-'+b+'"\x3e\x3ctd width\x3d"50"\x3e\x3cimg alt\x3d"" src\x3d"'+(isEmpty(a.user_pic_path)?"":a.user_pic_path)+'" width\x3d"25" height\x3d"25"/\x3e\x3c/td\x3e\x3ctd width\x3d"80" class\x3d"cut-text"\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"linkToMy('+a.create_user_id+');"\x3e'+a.account+'\x3c/a\x3e\x3c/td\x3e\x3ctd class\x3d"post-detail hand"\x3e\x3ca\x3e'+(isEmpty(a.title)?"":a.title)+"\x3c/a\x3e\x3c/td\x3e\x3ctd\x3e"+(isEmpty(a.digest)?"":a.digest)+'\x3c/td\x3e\x3ctd width\x3d"100"\x3e'+a.create_time+'\x3c/td\x3e\x3ctd width\x3d"140"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-success btn-sm post-agree" style\x3d"margin-right: 10px;"\x3e\u901a\u8fc7\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-danger btn-sm post-no-agree" style\x3d"margin-right: 10px;"\x3e\u4e0d\u901a\u8fc7\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e'};