layui.use(["layer"],function(){layer=layui.layer;$contentContainer=$("textarea[name\x3d'content']");$contentContainer.markdown();$("[data-toggle\x3d'tooltip']").tooltip();$('[name\x3d"has_img"]').click(function(){this.checked?$(".img-url-row").removeClass("hidden"):$(".img-url-row").addClass("hidden")});$('[name\x3d"is_original"]').click(function(){this.checked?$(".is-original-row").addClass("hidden"):$(".is-original-row").removeClass("hidden")})});var $contentContainer;function getEditBlog(a){$.ajax({url:"/bg/blog/edit/"+a,dataType:"json",beforeSend:function(){},success:function(a){null!=a&&a.success&&1==a.message.length?addToEdit(a.message[0]):(ajaxError(a),window.history.forward(1),setTimeout('window.open("/pb", "_self")',1500))},error:function(a){ajaxError(a)}})}function addTag(a){a=$(a);var b=a.val();isEmpty(b)?(layer.msg("\u6807\u7b7e\u4e0d\u80fd\u4e3a\u7a7a"),a.focus()):10<b.length?layer.msg("\u6807\u7b7e\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc710\u4f4d"):addTagItem(a,b)}function addTagItem(a,b){var c=a.closest(".row").find(".tag-list"),e=c.find(".tag-item"),d=e.length;e&&2<d?layer.msg("\u6807\u7b7e\u8d85\u8fc73\u4e2a\uff0c\u8bf7\u5148\u5220\u9664\u540e\u6dfb\u52a0"):(c.append('\x3cdiv class\x3d"btn-group dropup tag-item tag-item-'+d+'"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary tag-value"\x3e'+b+'\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-primary dropdown-toggle" data-toggle\x3d"dropdown" aria-expanded\x3d"false"\x3e\x3cspan class\x3d"caret"\x3e\x3c/span\x3e\x3cspan class\x3d"sr-only"\x3eToggle Dropdown\x3c/span\x3e\x3c/button\x3e\x3cul class\x3d"dropdown-menu dropdown-menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"deleteTag(this, '+d+');"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"moveLeftTag(this, '+d+');"\x3e\u5de6\u79fb\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"moveRightTag(this, '+d+');"\x3e\u53f3\u79fb\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"divider"\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"javascript:void(0);" onclick\x3d"clearTag(this);"\x3e\u6e05\u7a7a\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e'),a.val(""))}function deleteTag(a){a=$(a);a.closest(".row").find(".tag-input").focus();a.closest(".tag-item").remove()}function moveLeftTag(a,b){var c=$(a);if(0!=b){var e=c.closest(".tag-item").find(".tag-value").text(),d=b-1,d=c.closest(".tag-list").find(".tag-item-"+d),f=d.find(".tag-value").text();c.closest(".tag-item").find(".tag-value").text(f);d.find(".tag-value").text(e)}}function moveRightTag(a,b){var c=$(a);if(1!=$(a).closest(".tag-list").find(".tag-item").length&&2!=b){var e=c.closest(".tag-item").find(".tag-value").text(),d=b+1,d=c.closest(".tag-list").find(".tag-item-"+d),f=d.find(".tag-value").text();c.closest(".tag-item").find(".tag-value").text(f);d.find(".tag-value").text(e)}}function clearTag(a){a=$(a);a.closest(".row").find(".tag-input").focus();a.closest(".tag-list").empty();a.remove()}function release(a,b){var c={status:1};buildParams(c)&&doRelease(c,b)}function doRelease(a,b){var c=!0;$(".container").find(".form-control").each(function(b){b=$(this).attr("name");var d=$(this).attr("empty");if(d&&"false"==d&&isEmpty($(this).val()))return $(this).focus(),layer.msg($(this).attr("placeholder")),c=!1;"content"==b?(d=$contentContainer.data("markdown").parseContent(),a[b]=d):a[b]=$(this).val()});0<pid&&(a.title="\u8f6c\u53d1\u5e16\u5b50");if(c){b&&(a.post_id=postId);var e=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:b?"PUT":"post",data:a,url:"/cc/"+circleId+"/post",dataType:"json",beforeSend:function(){},success:function(a){layer.close(e);null!=a&&a.success?(layer.msg(a.message),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(e);ajaxError(a)}})}}function buildParams(a){var b=$(".img-container").find("img,audio,video");if(b&&0<b.length){var c="";b.each(function(a){c=c+$(this)[0].src+";"});a.has_img=!0;a.imgs=deleteLastStr(c)}else a.has_img=!1;b=$('[name\x3d"is_recommend"]').is(":checked");a.post_recommend=b;var b=$(".tag-item"),e="";if(b&&0<b.length){for(var d=0;d<b.length;d++)e=d==b.length-1?e+$(b[d]).find(".tag-value").text():e+$(b[d]).find(".tag-value").text()+",";a.tag=e}b=$('[name\x3d"can_comment"]').is(":checked");a.can_comment=b;b=$('[name\x3d"can_transmit"]').is(":checked");a.can_transmit=b;a.froms="web\u7f51\u9875\u7aef";circleId&&0<circleId&&(a.circle_id=circleId);b=$('[name\x3d"create_user_id"]').val();isNotEmpty(b)&&(a.create_user_id=b);return!0}function afterSelect(a){$(".img-container").empty();a=a.split(";");for(var b="",c=0;c<a.length;c++)if(isVideo(a[c]))b+='\x3cdiv class\x3d"col-lg-4"\x3e',b+=getVideoHtml(a[c]),b+="\x3c/div\x3e";else if(isAudio(a[c]))b+='\x3cdiv class\x3d"col-lg-4"\x3e',b+=getAudioHtml(a[c]),b+="\x3c/div\x3e";else if(isImg(a[c]))b+='\x3cdiv class\x3d"col-lg-4"\x3e\x3cimg src\x3d"'+changeNotNullString(a[c])+'" style\x3d"width: 100%; height: 180px;" class\x3d"img-responsive" onClick\x3d"" /\x3e\x3c/div\x3e';else return layer.msg("\u76ee\u524d\u53ea\u5904\u7406\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u7b49\u683c\u5f0f\u7684\u6587\u4ef6"),!1;$(".img-container").append(b);$("body").removeClass("modal-open")};