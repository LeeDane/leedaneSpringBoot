layui.use(["layer","laypage","util"],function(){layer=layui.layer;laypage=layui.laypage;util=layui.util;$commentListContainer=$("#comment-list-container");$container=$(".container");$container.on("click",".reply-other-btn",function(){$(this).closest(".list-group").find(".reply-container").toggle("fast")});$container.on("click",".delete-other-btn",function(){var c=$(this).closest(".comment-list").attr("data-id"),a=$(this).closest(".comment-list").attr("create-user-id");0<c&&0<a&&layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u7559\u8a00\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",dataType:"json",url:"/cm/comment?cid\x3d"+c+"\x26create_user_id\x3d"+a,beforeSend:function(){},success:function(a){layer.close(b);a.success?(layer.msg(a.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),reloadPage(1E3)):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})});getMessageBoards()});var messageBoards,$commentListContainer,$container;function getMessageBoardsRequestParams(){return{page_size:pageSize,current:currentIndex,total:totalPage,t:Math.random()}}function getMessageBoards(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cm/user/"+uid+"/messageBoards?"+jsonToGetRequestParams(getMessageBoardsRequestParams()),dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);$commentListContainer.empty();if(a.success){messageBoards=a.message;if(0==messageBoards.length){0==currentIndex?$commentListContainer.append("\u8fd8\u6ca1\u6709\u7559\u8a00\uff0c\u8bf7\u7ed9TA\u7559\u8a00\uff01"):$commentListContainer.append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u7559\u8a00\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");return}for(var b=0;b<messageBoards.length;b++)$commentListContainer.append(buildEachCommentRow(b,messageBoards[b]));laypage.render({elem:"item-pager",layout:["prev","page","next","count","skip"],count:a.total,limit:pageSize,theme:"#337ab7",curr:currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(currentIndex=a.curr-1,getMessageBoards())}});resetParticlesHeight()}else ajaxError(a);isLoad=!1},error:function(a){isLoad=!1;layer.close(c);ajaxError(a)}})}function buildEachCommentRow(c,a){var b='\x3cdiv class\x3d"row comment-list comment-list-padding" data-id\x3d"'+a.id+'" create-user-id\x3d"'+a.create_user_id+'"\x3e\x3cdiv class\x3d"col-lg-1 col-md-1 col-sm-2 col-xs-2"\x3e\x3cimg src\x3d"'+changeNotNullString(a.user_pic_path)+'" width\x3d"40" height\x3d"40" class\x3d"img-rounded"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-11 col-md-11 col-sm-10 col-xs-10"\x3e\x3cdiv class\x3d"list-group"\x3e\x3cdiv class\x3d"list-group-item comment-list-item active"\x3e\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"linkToMy('+a.create_user_id+')" target\x3d"_blank" class\x3d"marginRight"\x3e'+changeNotNullString(a.account)+'\x3c/a\x3e\x3cspan class\x3d"marginRight publish-time"\x3e\u53d1\u8868\u4e8e:'+changeNotNullString(a.create_time)+'\x3c/span\x3e\x3cspan class\x3d"marginRight publish-time"\x3e\u6765\u81ea:'+changeNotNullString(a.froms)+"\x3c/span\x3e\x3c/div\x3e",b=b+'\x3cdiv class\x3d"list-group-item comment-list-item"\x3e\x3cdiv class\x3d"row"\x3e'+('\x3cdiv class\x3d"col-lg-12 comment-list-item-main"\x3e'+changeNotNullString(a.content)+"\x3c/div\x3e"),b=b+blockquote(a),b=b+"\x3c/div\x3e\x3c/div\x3e";isLogin&&(b=b+'\x3cdiv class\x3d"list-group-item comment-list-item"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12 col-sm-12 col-md-12 col-xs-12 text-align-right"\x3e\x3cbutton class\x3d"btn btn-sm btn-primary pull-right reply-other-btn" style\x3d"width: 60px;" type\x3d"button"\x3e\u56de\u590dTA\x3c/button\x3e\x3cbutton class\x3d"btn btn-sm btn-primary pull-right delete-other-btn" style\x3d"width: 60px; margin-right: 5px;" type\x3d"button"\x3e\u5220\u9664\x3c/button\x3e'+('\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12 reply-container" table-id\x3d"'+a.table_id+'" table-name\x3d"'+a.table_name+'" style\x3d"display: none;"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12"\x3e\x3cform class\x3d"form-signin" role\x3d"form"\x3e\x3cfieldset\x3e\x3ctextarea class\x3d"form-control reply-comment-text" placeholder\x3d"\u56de\u590dTA\uff0c\u6700\u591a250\u4e2a\u6587\u5b57\u3002"\x3e\x3c/textarea\x3e\x3c/fieldset\x3e\x3c/form\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-12 col-sm-12 col-md-12 col-xs-12 text-align-right" style\x3d"margin-top: 10px;"\x3e\x3cbutton class\x3d"btn btn-sm btn-info pull-right" style\x3d"width: 60px;" type\x3d"button" onclick\x3d"commentItem(this, '+a.id+", "+a.create_user_id+');"\x3e\u56de\u590d\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'));return b+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}function commentItem(c,a){var b=$(c).closest(".reply-container").find(".reply-comment-text").val();doAddComment({table_name:"t_message_board",check:!1,table_id:uid,content:b,pid:a,froms:"web\u7aef",t:Math.random()})}function addComment(c){c=$("#comment").find('[name\x3d"add-comment"]');isEmpty(c.val())?(c.focus(),layer.msg("\u8bf7\u5148\u8bf4\u70b9\u4ec0\u4e48\u5427")):(c={table_name:"t_message_board",check:!1,table_id:uid,content:c.val(),froms:"web\u7aef",t:Math.random()},doAddComment(c))}function doAddComment(c){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"post",data:c,url:"/cm/comment",dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);b.success?(layer.msg("\u7559\u8a00\u6210\u529f,1\u79d2\u949f\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout("window.location.reload();",1E3)):layer.msg("\u7559\u8a00\u5931\u8d25\uff0c"+b.message)},error:function(){layer.close(a);layer.msg("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25")}})};