layui.use(["layer","laydate","util"],function(){layer=layui.layer;laydate=layui.laydate;util=layui.util;$(".navbar-nav .nav-main-li").each(function(){$(this).removeClass("active")});$(".nav-baby").addClass("active");laydate.render({elem:"#test-n2",position:"static",lang:"cn",showBottom:!1,theme:"#337ab7",calendar:!0,mark:mark,done:function(a,b,d){console.log(a);console.log(b);console.log(d);getLifes(a,a,0,null)}},function(a){alert(ddd)});var b=$(window).width();900>b&&($aa=$(".laydate-theme-molv .layui-laydate-main"),$aa.attr("max-width",b-20+"px!important"));$lifesContrainer=$("#lifes-contrainer");babyId&&0<babyId&&getLifes((new Date).Format("yyyy-MM-dd"),(new Date).Format("yyyy-MM-dd"),0,null)});var $lifesContrainer;function showBar(b){myChart=echarts.init(document.getElementById("echarts"));var a={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["\u5403\u559d","\u7761\u89c9","\u6d17\u6fa1"]},grid:{left:"5%",top:"60",right:"2%",bottom:"20"},calculable:!0,xAxis:[{type:"category",data:"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24".split(" ")}],yAxis:[{type:"value"}],series:[{name:"\u5403\u559d",type:"bar",stack:"\u5403\u559d",itemStyle:{color:"#337ab7"},data:[320,332,301,334,390,330,320,320,332,301,334,390,330,0,320,3,31,4,390,330,320,320,320,332]},{name:"\u7761\u89c9",type:"bar",stack:"\u5403\u559d",itemStyle:{color:"#5cb85c"},data:[0,132,101,134,90,230,0,120,132,101,134,90,0,210,120,132,101,134,90,230,210,320,320,332]},{name:"\u6d17\u6fa1",type:"bar",stack:"\u5403\u559d",itemStyle:{color:"#f0ad4e"},data:[220,182,191,234,290,330,310,220,182,0,234,290,330,310,220,182,191,234,290,330,310,320,320,332]}]},a={legend:{data:["\u5403\u559d","\u7761\u89c9","\u6d17\u5237","\u81ed\u81ed"]},xAxis:{data:b.xAxis,axisLabel:{inside:!1,textStyle:{color:"#000"}},axisTick:{show:!1},axisLine:{show:!1},z:10},yAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#999"}},max:function(a){return Math.ceil(1.5*a.max)}},grid:{left:"5%",top:"60",right:"2%",bottom:"20"},dataZoom:[{type:"inside"}],tooltip:{show:!0,orient:"vertical",left:"right",top:"center",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar","stack","tiled"]},restore:{show:!0},saveAsImage:{show:!0}}},series:b.series};myChart.on("click",function(a){console.log(b.xAxis[Math.max(a.dataIndex-3,0)]);myChart.dispatchAction({type:"dataZoom",startValue:b.xAxis[Math.max(a.dataIndex-3,0)],endValue:b.xAxis[Math.min(a.dataIndex+3,b.series[0].data.length-1)]})});myChart.setOption(a)}function getLifes(b,a,c,d){var e=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026"),f="";isNotEmpty(b)&&(f+="\x26start\x3d"+b);isNotEmpty(a)&&(f+="\x26end\x3d"+a);isNotEmpty(c)&&(f+="\x26type\x3d"+c);isNotEmpty(d)&&(f+="\x26keyword\x3d"+d);$.ajax({url:"/baby/"+babyId+"/lifes?"+f+"\x26t\x3d"+Math.random(),dataType:"json",beforeSend:function(){$("#eat-number").empty();$("#sleep-number").empty();$("#wash-number").empty();$("#sick-number").empty();$("#show-occur-date").empty();$lifesContrainer.empty();$("#echarts").hide()},success:function(a){layer.close(e);if(null!=a&&a.success){$("#eat-number").text(a.message.eatNumber);$("#sleep-number").text(a.message.sleepNumber);$("#wash-number").text(a.message.washNumber);$("#sick-number").text(a.message.sickNumber);$("#show-occur-date").text(a.message.occurDate);if(0==a.message.displays.length){$lifesContrainer.append("\u60a8\u7684\u5b9d\u5b9d\u8fd8\u6ca1\u6709\u6dfb\u52a0\u751f\u6d3b\u65b9\u5f0f\u8bb0\u5f55\uff01");return}for(var b=0;b<a.message.displays.length;b++)$lifesContrainer.append(buildEachRow(a.message.displays[b]));$("#echarts").show();showBar(a.message)}else ajaxError(a);console.log(a)},error:function(a){layer.close(e);ajaxError(a)}})}function buildEachRow(b){var a,c,d,e;1==b.type?(c="eat-box",a="panel-info",d="\u5403",e="eat"):2==b.type?(c="sleep-box",a="panel-success",d="\u7761",e="sleep"):3==b.type?(c="swap-box",a="panel-warning",d="\u6d17",e="swap"):4==b.type&&(c="sick-box",a="panel-danger",d="\u81ed",e="sick");a='\x3cdiv class\x3d"panel '+a+'"\x3e\x3cdiv class\x3d"panel-heading"\x3e\x3cdiv class\x3d"'+c+'"\x3e\x3c/div\x3e\x3ch3 class\x3d"panel-title"\x3e'+d+'\x3c/h3\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-body"\x3e\x3cdiv style\x3d"word-break:break-all; word-wrap:break-all;"\x3e\x3ctable class\x3d"table" \x3e\x3ctbody\x3e';for(c=0;c<b.displays.length;c++)a+='\x3ctr\x3e\x3ctd width\x3d"120" style\x3d"border: 0px solid transparent !important; padding: 4px!important;"\x3e'+b.displays[c].key+'\x3c/td\x3e\x3ctd style\x3d"border: 0px solid transparent !important; padding: 4px!important;"\x3e'+b.displays[c].value+"\x3c/td\x3e\x3c/tr\x3e";return a+='\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-footer"\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-default btn-xs" onclick\x3d"deleteLife('+b.id+');"\x3e\x3cspan class\x3d"glyphicon glyphicon-trash" aria-hidden\x3d"true"\x3e\x3c/span\x3e \u5220\u9664\x3c/button\x3e\x3cbutton type\x3d"button" class\x3d"btn btn-default btn-xs" style\x3d"margin-left: 10px;" onclick\x3d"linkToEdit(babyId, \''+e+'\');"\x3e\x3cspan class\x3d"glyphicon glyphicon-pencil" aria-hidden\x3d"true"\x3e\x3c/span\x3e \u7f16\u8f91\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e'}function linkToEdit(b,a){window.open("/baby/"+babyId+"/"+a+"/manage")}function advancedSearch(b){b=$("#advanced-start-time");var a=$("#advanced-end-time");b=b.val();a=a.val();if(isNotEmpty(b)&&isNotEmpty(a)){var c=b.substring(0,4),d=b.substring(5,7),e=a.substring(0,4),f=a.substring(5,7);if(c!=e||d!=f){layer.msg("\u76ee\u524d\u53ea\u652f\u6301\u83b7\u53d6\u5355\u4e2a\u6708\u4efd\u7684\u6570\u636e\uff01");return}}c=$("#advanced-keyword");d=$("#advanced-life-type");getLifes(b,a,parseInt(d.val()),c.val())}function changeBorn(){layer.confirm("\u606d\u559c\uff0c\u60a8\u7684\u5b9d\u5b9d\u5df2\u7ecf\u51fa\u751f\u5566",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"PUT",url:"/baby/"+babyId+"/changeBorn",dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);null!=a&&a.success?(layer.msg(a.message),window.location.reload()):ajaxError(a);console.log(a)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})}function deleteLife(b){layer.confirm("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u751f\u6d3b\u65b9\u5f0f\u8bb0\u5f55\u5417\uff1f\u6b64\u662f\u4e0d\u53ef\u9006\u884c\u4e3a\uff0c\u8bf7\u614e\u91cd!",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var a=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"DELETE",url:"/baby/"+babyId+"/life/"+b,dataType:"json",beforeSend:function(){},success:function(b){layer.close(a);null!=b&&b.success?(layer.msg(b.message),window.location.reload()):ajaxError(b);console.log(b)},error:function(b){layer.close(a);ajaxError(b)}})},function(){})};