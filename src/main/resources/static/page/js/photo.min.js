$(function(){$(".navbar-nav .nav-main-li").each(function(){$(this).removeClass("active")});$(".nav-photo").addClass("active")});var isFirst=!1,$tree,categoryId=-1;layui.use(["layer"],function(){layer=layui.layer;$(window).scroll(function(b){b=b||window.event;if(b.wheelDelta){if(0<b.wheelDelta)return}else if(b.detail&&0<b.detail)return;b=$(document.body).height();var a=$(window).scrollTop();b=(b-winH-a)/winH;!isLoad&&.2>b&&(isLoad=!0,method="lowloading",getWebPhotos())});$("#fh5co-main").find(".fh5co-desc").on("click",function(b){layer.msg("\u5220\u9664\u6210\u529f!",{icon:1,time:1E3});layer.confirm("\u662f\u5426\u4fee\u6539\u8be5\u56fe\u7247\u7684\u63cf\u8ff0\u4fe1\u606f!",{btn:["\u786e\u5b9a","\u53d6\u6d88"]},function(b,c){layer.msg("\u5220\u9664\u6210\u529f!",{icon:1,time:1E3})})});$tree=$("#tree");getChildNodes(0,131);getWebPhotos()});var last_id=0,first_id=0,method="firstloading",photos,column1Height=0,column2Height=0,column3Height=0,canLoadData=!0,winH=$(window).height(),isLoad=!1;function getChildNodes(b,a){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/cg/category/"+a+"/children",dataType:"json",beforeSend:function(){},success:function(a){layer.close(c);a.success?(a=a.message,isFirst?$tree.treeview("addNodes",[b,{node:a}]):(a.push({id:-1,text:"\u5168\u90e8"}),$tree.treeview({data:a,enableLinks:!1,onNodeSelected:function(b,a){},onNodeExpanded:function(b,a){getChildNodes(a.nodeId,a.id)}}),isFirst=!0),900>$(window).width()&&setTimeout(function(){$("#fh5co-main").css("margin-top",$("#tree").height()+"px")},500)):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}function getWebPhotos(){isLoad=!0;var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/gl/all?"+jsonToGetRequestParams(getPhotosRequestParams()),dataType:"json",beforeSend:function(){},success:function(a){layer.close(b);"firstloading"==method&&($(".column-item1").empty(),$(".column-item2").empty(),$(".column-item3").empty(),$(".column-item4").empty());if(null!=a&&a.success){$("#fh5co-board").closest(".my-container").find(".no-result").remove();if(0==a.message.length){canLoadData=!1;"firstloading"==method?$("#fh5co-board").closest(".my-container").append("\x3cdiv class\x3d'row no-result'\x3e\u8be5\u5206\u7ec4\u4e0b\u8fd8\u6ca1\u6709\u627e\u5230\u56fe\u7247\u3002\x3c/div\x3e"):$("#fh5co-board").closest(".my-container").append("\x3cdiv class\x3d'row no-result'\x3e\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u56fe\u7247\u3002\x3c/div\x3e");return}if("firstloading"==method){photos=a.message;for(var c=0;c<photos.length;c++){var e='\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"animate-box"\x3e\x3ca href\x3d"'+photos[c].path+'" class\x3d"image-popup fh5co-board-img" title\x3d"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Explicabo, eos?"\x3e\x3cimg src\x3d"'+photos[c].path+'" alt\x3d"'+photos[c].gallery_desc+'"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"fh5co-desc" onclick\x3d"descEdit('+a.message[c].id+",'"+a.message[c].gallery_desc+"');\"\x3e"+photos[c].gallery_desc+"\x3c/div\x3e\x3c/div\x3e",d=findLowContrainer();d.append(e);0==c&&(first_id=photos[c].id);c==photos.length-1&&(last_id=photos[c].id)}}else for(c=0;c<a.message.length;c++)e='\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"animate-box"\x3e\x3ca href\x3d"'+a.message[c].path+'" class\x3d"image-popup fh5co-board-img" title\x3d"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Explicabo, eos?"\x3e\x3cimg src\x3d"'+a.message[c].path+'" alt\x3d"'+a.message[c].gallery_desc+'"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"fh5co-desc" onclick\x3d"descEdit('+a.message[c].id+",'"+a.message[c].gallery_desc+"');\"\x3e"+a.message[c].gallery_desc+"\x3c/div\x3e\x3c/div\x3e",d=findLowContrainer(),d.append(e),c==a.message.length-1&&(last_id=a.message[c].id)}else ajaxError(a);isLoad=!1;setTimeout(function(){magnifPopup();offCanvass();mobileMenuOutsideClick();animateBoxWayPoint()},500)},error:function(a){layer.close(b);isLoad=!1;ajaxError(a)}})}function findLowContrainer(){var b=$(".column-item1").height(),a=$(".column-item2").height(),c=$(".column-item3").height(),e=$(".column-item4").height(),d=b;d>=a&&(d=a);d>=c&&(d=c);d>=e&&(d=e);if(d==b)return $(".column-item1");if(d==a)return $(".column-item2");if(d==c)return $(".column-item3");if(d==e)return $(".column-item4")}function getPhotosRequestParams(){var b=150;"firstloading"!=method&&(b=10);return{pageSize:b,last_id:last_id,first_id:first_id,method:method,category:categoryId,t:Math.random()}}function showImg(b){b={title:"\u76f8\u518c\u6807\u9898",id:0,start:b};for(var a=[],c=0;c<photos.length;c++){var e={};e.alt=photos[c].gallery_desc;e.pid=photos[c].id;var d=photos[c].path;if(0>d.indexOf("7xnv8i.com1.z0.glb.clouddn.com")||0>d.indexOf("pic.onlyloveu.top"))d=$(".index_"+c).attr("src");e.src=d;e.alt=d;a.push(e)}b.data=a;layer.photos({photos:b,shift:1})}var photosAjaxArray=[];function asynchronousPhotos(){$(".out-link").each(function(b){var a=$(this),c=$.ajax({url:"/tl/networdImage?url\x3d"+a.attr("temp-src"),dataType:"json",beforeSend:function(){},success:function(c){c.success?($(".out-link").eq(b),a.attr("src",c.message),a.removeClass("out-link")):ajaxError(c)},error:function(a){ajaxError(a)}});photosAjaxArray.push(c)})}window.onbeforeunload=onbeforeunload_handler;window.onunload=onunload_handler;function onbeforeunload_handler(){if(0<photosAjaxArray.length)for(var b=0;b<photosAjaxArray.length;b++)photosAjaxArray[b].abort()}function onunload_handler(){if(0<photosAjaxArray.length)for(var b=0;b<photosAjaxArray.length;b++)photosAjaxArray[b].abort()}function findColumnToAdd(b,a){var c=Math.min(column1Height,column2Height,column3Height),e=$("#column-01").width(),d=b.height;1.5*e<d&&(d=1.5*e);e=0<=b.path.indexOf("7xnv8i.com1.z0.glb.clouddn.com")||0<=b.path.indexOf("pic.onlyloveu.top")?'\x3cimg width\x3d"100%" title\x3d"'+(isNotEmpty(b.desc)?isNotEmpty(b.desc):"")+'" height\x3d"'+d+'" style\x3d"margin-top: 10px;" class\x3d"img-show img-rounded index_'+a+'" alt\x3d"" src\x3d"'+b.path+'" onclick\x3d"showImg('+a+')" onmouseover\x3d"imgHandOver(this, '+a+');" onmouseout\x3d"imgHandOut(this, '+a+');"\x3e':'\x3cimg width\x3d"100%" title\x3d"'+(isNotEmpty(b.desc)?isNotEmpty(b.desc):"")+'" height\x3d"'+d+'" style\x3d"margin-top: 10px;" class\x3d"img-show out-link index_'+a+'" alt\x3d"" temp-src\x3d"'+b.path+'" onclick\x3d"showImg('+a+')" onmouseover\x3d"imgHandOver(this, '+a+');" onmouseout\x3d"imgHandOut(this, '+a+');"\x3e';c==column1Height?($("#column-01").append(e),column1Height+=d):c==column2Height?($("#column-02").append(e),column2Height+=d):c==column3Height&&($("#column-03").append(e),column3Height+=d)}function imgHandOver(b,a){var c=photos[a];if(isNotEmpty(c.gallery_desc)){var e=$(b).offset().top,d=$(b).offset().left;$("body").append('\x3cspan id\x3d"desc_'+a+'" \x3e'+c.gallery_desc+"\x3c/span\x3e");c=$("#desc_"+a);c.css("position","absolute");c.css("top",e);c.css("left",d);c.css("color","#fff");c.css("background-color","#666")}console.log("over")}function imgHandOut(b,a){$("#desc_"+a).remove();console.log("out")}function customItemClick(b){if(null==b.nodes||0==b.nodes.length)categoryId=b.id,first_id=last_id=0,method="firstloading",getWebPhotos();900>$(window).width()&&setTimeout(function(){$("#fh5co-main").css("margin-top",$("#tree").height()+"px")},500)}function getTreeRootId(){return"tree"}function descEdit(b,a){layer.prompt({title:"\u662f\u5426\u4fee\u6539\u8be5\u56fe\u7247\u7684\u63cf\u8ff0\u4fe1\u606f!",formType:2},function(a,b){layer.close(b);if(isNotEmpty(a)){var c=layer.load("\u66f4\u65b0\u63cf\u8ff0\u4e2d\u2026");$.ajax({url:"/gl/all?"+jsonToGetRequestParams(getPhotosRequestParams()),dataType:"json",beforeSend:function(){},success:function(a){layer.close(c)},error:function(a){layer.close(c);isLoad=!1;ajaxError(a)}})}})}function toManage(){window.open("/pt/manage","_self")};