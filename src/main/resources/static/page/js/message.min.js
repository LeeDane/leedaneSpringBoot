layui.use(["layer","laypage"],function(){layer=layui.layer;laypage=layui.laypage;$(".navbar-nav .nav-main-li").each(function(){$(this).removeClass("active")});$(".nav-msg").addClass("active");isNotEmpty(tabName)&&$("#notification-tabs").find("li").each(function(a){if($(this).attr("data-value")==tabName)return type=tabName,$(this).addClass("active"),!0;$(this).removeClass("active")});if(isEmpty(type)){var c=$("#notification-tabs").find("li").eq(0);c.addClass("active");type=c.attr("data-value")}isEmpty(type)?layer.msg("\u65e0\u6cd5\u83b7\u53d6\u901a\u77e5\u7c7b\u578b"):($("#notification-tabs").find("li").on("click",function(a){$("#notification-tabs").find("li").removeClass("active");$(this).addClass("active");type=$(this).attr("data-value");currentIndex=0;getMessages()}),$(".container").on("click",".tag-read-btn",function(){var a=$(this).closest(".notification-list").attr("data-id");if(0<a){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"put",data:{nid:a,read:!0},dataType:"json",url:"/nf/notification",beforeSend:function(){},success:function(a){layer.close(b);a.isSuccess?(layer.msg(a.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout(linkToSpecifiedTab(type),1E3)):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})}}),$(".container").on("click",".delete-other-btn",function(){var a=$(this).closest(".notification-list").attr("data-id");0<a&&layer.confirm("\u60a8\u8981\u5220\u9664\u8be5\u8bc4\u8bba\u5417\uff1f",{btn:["\u786e\u5b9a","\u70b9\u9519\u4e86"]},function(){var b=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"delete",dataType:"json",url:"/nf/notification?nid\x3d"+a,beforeSend:function(){},success:function(a){layer.close(b);a.isSuccess?(layer.msg(a.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout(linkToSpecifiedTab(type),1E3)):ajaxError(a)},error:function(a){layer.close(b);ajaxError(a)}})},function(){})}),getMessages())});var messages,type;function allRead(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({type:"put",data:{type:type,read:!0},dataType:"json",url:"/nf/notification/all",beforeSend:function(){},success:function(a){layer.close(c);a.isSuccess?(layer.msg(a.message+",1\u79d2\u540e\u81ea\u52a8\u5237\u65b0"),setTimeout(linkToSpecifiedTab(type),1E3)):ajaxError(a)},error:function(a){layer.close(c);ajaxError(a)}})}function linkToSpecifiedTab(c){window.location.href="/msg?tab\x3d"+c}function getMessages(){var c=layer.load("\u52aa\u529b\u52a0\u8f7d\u4e2d\u2026");$.ajax({url:"/nf/notifications/paging?"+jsonToGetRequestParams({page_size:pageSize,current:currentIndex,total:totalPage,type:type,t:Math.random()}),dataType:"json",beforeSend:function(){$("#message-list-content").empty();$(".pagination").empty()},success:function(a){layer.close(c);if(a.isSuccess){messages=a.message;if(0==messages.length){0==currentIndex?$("#message-list-content").append("\u6682\u65f6\u6ca1\u6709\u66f4\u591a\u7684\u6570\u636e\uff01"):$("#message-list-content").append("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u7684\u6d88\u606f\u5566\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01");return}for(var b=0;b<messages.length;b++)$("#message-list-content").append(buildEachMessageRow(b,messages[b]));laypage.render({elem:"item-pager",layout:["prev","page","next","count","skip"],count:a.total,limit:pageSize,theme:"#337ab7",curr:currentIndex+1,jump:function(a,b){console.log(a.curr);console.log(a.limit);b||(currentIndex=a.curr-1,getMessages())}})}else ajaxError(a);isLoad=!1},error:function(a){isLoad=!1;layer.close(c);ajaxError(a)}})}function buildEachMessageRow(c,a){var b='\x3cdiv class\x3d"row notification-list notification-list-padding" data-id\x3d"'+a.id+'"\x3e\x3cdiv class\x3d"col-lg-1 col-md-1 col-sm-2 col-xs-2" style\x3d"text-align: center;"\x3e\x3cimg src\x3d"'+changeNotNullString(a.user_pic_path)+'" width\x3d"40" height\x3d"40" class\x3d"img-rounded"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-lg-11 col-md-11 col-sm-10 col-xs-10"\x3e\x3cdiv class\x3d"list-group"\x3e\x3cdiv class\x3d"list-group-item notification-list-item active"\x3e\x3ca href\x3d"JavaScript:void(0);" onclick\x3d"linkToMy('+a.from_user_id+')" target\x3d"_blank" class\x3d"marginRight"\x3e'+changeNotNullString(a.account)+'\x3c/a\x3e\x3cspan class\x3d"marginRight publish-time"\x3e\u53d1\u8868\u4e8e:'+changeNotNullString(a.create_time)+"\x3c/span\x3e\x3c/div\x3e",b=b+'\x3cdiv class\x3d"list-group-item notification-list-item"\x3e\x3cdiv class\x3d"row"\x3e';isNotEmpty(a.source)&&(b+='\x3cdiv class\x3d"col-lg-12 '+(isNotEmpty(a.source_account)&&isNotEmpty(a.source_user_id)?'hand" onclick\x3d"linkToTable(\''+a.table_name+"', "+a.table_id+", "+a.source_user_id+')"':'"')+"\x3e\x3cblockquote\x3e"+a.source,isNotEmpty(a.source_account)&&(b+="\x3csmall\x3e\x3ccite\x3e"+a.source_account+"\x3c/cite\x3e\x26nbsp;\x26nbsp;"+changeNotNullString(a.create_time)+"\x3c/small\x3e"),b+="\x3c/blockquote\x3e\x3c/div\x3e");b+='\x3cdiv class\x3d"col-lg-12"\x3e'+changeNotNullString(a.content)+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";if(isLogin){b+='\x3cdiv class\x3d"list-group-item notification-list-item"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col-lg-12 col-sm-12 col-md-12 col-xs-12 text-align-right"\x3e';a.is_read||(b+='\x3cbutton class\x3d"btn btn-sm btn-primary pull-right tag-read-btn" style\x3d"width: 80px;" type\x3d"button"\x3e\u6807\u4e3a\u5df2\u8bfb\x3c/button\x3e');if(isAdmin||a.to_user_id==loginUserId)b+='\x3cbutton class\x3d"btn btn-sm btn-primary pull-right delete-other-btn" style\x3d"width: 60px; margin-right: 5px;" type\x3d"button"\x3e\u5220\u9664\x3c/button\x3e';b+="\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}return b+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"};