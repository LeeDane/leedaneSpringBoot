<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
	namespace：必须与对应的接口全类名一致
	id:必须与对应接口的某个对应的方法名一致
	
 -->
<mapper namespace="com.cn.leedane.mapper.clock.ClockInMapper">
	<select id="getClockInsRangeDate" resultType="java.util.Map">
		SELECT COUNT(id) number, date_format(clock_date, '%Y-%m-%d') clock_date
		from t_clock_in 
		where clock_id = #{clockId} and `status` = 1 and clock_date &gt;= date_format(#{start}, '%Y-%m-%d') and clock_date &lt;= date_format(#{end}, '%Y-%m-%d')  
		GROUP BY clock_date 
		ORDER BY clock_date desc
	</select>
	
	<select id="getTopMember" resultType="java.util.Map">
		SELECT COUNT(ci.id) number, ci.create_user_id, date_format(cm.create_time, '%Y-%m-%d %H:%i:%s') create_time
		from t_clock_in ci INNER JOIN t_clock_member cm on ci.create_user_id = cm.member_id and ci.clock_id = cm.clock_id and cm.`status` = 1
		where ci.clock_id = #{clockId} and ci.`status` = 1 
		GROUP BY ci.create_user_id 
		ORDER BY number desc, cm.create_time
		<if test="limit > 0">
			limit #{limit}
		</if>
	</select>

	<select id="membersSortByIns" resultType="java.util.Map">
		SELECT ci.id inId, cm.create_user_id, cm.member_id, ci.create_time create_time
		from t_clock_member cm LEFT JOIN t_clock_in ci on ci.create_user_id = cm.member_id and ci.clock_id = cm.clock_id and ci.`status` = 1 and ci.clock_date = #{date}
		where cm.clock_id = #{clockId} and cm.`status` = 1
		ORDER BY ci.create_time is null, ci.create_time asc, cm.create_time
		<if test="limit > 0">
			limit #{limit}
		</if>
	</select>
</mapper>